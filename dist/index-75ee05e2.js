var e,t,n,r,i,o,s,a,l,c,u,p,d,h,f,v,m,b,g,_,w,x,y,E,P,C,A,S,k,T,L,R,I,F,M,V,O,N,B,D,z,U,j,G,W,H,K,q,X,Y,$,Q,Z,J=Object.defineProperty,ee=(e,t,n)=>(((e,t,n)=>{t in e?J(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n})(e,"symbol"!=typeof t?t+"":t,n),n),te=(e,t,n)=>{if(!t.has(e))throw TypeError("Cannot "+n)},ne=(e,t,n)=>(te(e,t,"read from private field"),n?n.call(e):t.get(e)),re=(e,t,n)=>{if(t.has(e))throw TypeError("Cannot add the same private member more than once");t instanceof WeakSet?t.add(e):t.set(e,n)},ie=(e,t,n,r)=>(te(e,t,"write to private field"),r?r.call(e,n):t.set(e,n),n),oe=(e,t,n)=>(te(e,t,"access private method"),n);!function(){const e=document.createElement("link").relList;if(!(e&&e.supports&&e.supports("modulepreload"))){for(const e of document.querySelectorAll('link[rel="modulepreload"]'))t(e);new MutationObserver((e=>{for(const n of e)if("childList"===n.type)for(const e of n.addedNodes)"LINK"===e.tagName&&"modulepreload"===e.rel&&t(e)})).observe(document,{childList:!0,subtree:!0})}function t(e){if(e.ep)return;e.ep=!0;const t=function(e){const t={};return e.integrity&&(t.integrity=e.integrity),e.referrerpolicy&&(t.referrerPolicy=e.referrerpolicy),"use-credentials"===e.crossorigin?t.credentials="include":"anonymous"===e.crossorigin?t.credentials="omit":t.credentials="same-origin",t}(e);fetch(e.href,t)}}();var se=function(e,t){return(se=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(e,t)};function ae(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function n(){this.constructor=e}se(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}function le(e,t,n,r){return new(n||(n=Promise))((function(i,o){function s(e){try{l(r.next(e))}catch(t){o(t)}}function a(e){try{l(r.throw(e))}catch(t){o(t)}}function l(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,a)}l((r=r.apply(e,t||[])).next())}))}function ce(e,t){var n,r,i,o,s={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function a(a){return function(l){return function(a){if(n)throw new TypeError("Generator is already executing.");for(;o&&(o=0,a[0]&&(s=0)),s;)try{if(n=1,r&&(i=2&a[0]?r.return:a[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,a[1])).done)return i;switch(r=0,i&&(a=[2&a[0],i.value]),a[0]){case 0:case 1:i=a;break;case 4:return s.label++,{value:a[1],done:!1};case 5:s.label++,r=a[1],a=[0];continue;case 7:a=s.ops.pop(),s.trys.pop();continue;default:if(!(i=s.trys,(i=i.length>0&&i[i.length-1])||6!==a[0]&&2!==a[0])){s=0;continue}if(3===a[0]&&(!i||a[1]>i[0]&&a[1]<i[3])){s.label=a[1];break}if(6===a[0]&&s.label<i[1]){s.label=i[1],i=a;break}if(i&&s.label<i[2]){s.label=i[2],s.ops.push(a);break}i[2]&&s.ops.pop(),s.trys.pop();continue}a=t.call(e,s)}catch(l){a=[6,l],r=0}finally{n=i=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,l])}}}function ue(e){var t="function"==typeof Symbol&&Symbol.iterator,n=t&&e[t],r=0;if(n)return n.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&r>=e.length&&(e=void 0),{value:e&&e[r++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")}function pe(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var r,i,o=n.call(e),s=[];try{for(;(void 0===t||t-- >0)&&!(r=o.next()).done;)s.push(r.value)}catch(a){i={error:a}}finally{try{r&&!r.done&&(n=o.return)&&n.call(o)}finally{if(i)throw i.error}}return s}function de(e,t,n){if(n||2===arguments.length)for(var r,i=0,o=t.length;i<o;i++)!r&&i in t||(r||(r=Array.prototype.slice.call(t,0,i)),r[i]=t[i]);return e.concat(r||Array.prototype.slice.call(t))}function he(e){return this instanceof he?(this.v=e,this):new he(e)}function fe(e,t,n){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var r,i=n.apply(e,t||[]),o=[];return r={},s("next"),s("throw"),s("return"),r[Symbol.asyncIterator]=function(){return this},r;function s(e){i[e]&&(r[e]=function(t){return new Promise((function(n,r){o.push([e,t,n,r])>1||a(e,t)}))})}function a(e,t){try{(n=i[e](t)).value instanceof he?Promise.resolve(n.value.v).then(l,c):u(o[0][2],n)}catch(r){u(o[0][3],r)}var n}function l(e){a("next",e)}function c(e){a("throw",e)}function u(e,t){e(t),o.shift(),o.length&&a(o[0][0],o[0][1])}}function ve(e){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var t,n=e[Symbol.asyncIterator];return n?n.call(e):(e=ue(e),t={},r("next"),r("throw"),r("return"),t[Symbol.asyncIterator]=function(){return this},t);function r(n){t[n]=e[n]&&function(t){return new Promise((function(r,i){(function(e,t,n,r){Promise.resolve(r).then((function(t){e({value:t,done:n})}),t)})(r,i,(t=e[n](t)).done,t.value)}))}}}function me(e){return"function"==typeof e}var be,ge=((be=function(e){return function(t){e(this),this.message=t?t.length+" errors occurred during unsubscription:\n"+t.map((function(e,t){return t+1+") "+e.toString()})).join("\n  "):"",this.name="UnsubscriptionError",this.errors=t}}((function(e){Error.call(e),e.stack=(new Error).stack}))).prototype=Object.create(Error.prototype),be.prototype.constructor=be,be);function _e(e,t){if(e){var n=e.indexOf(t);0<=n&&e.splice(n,1)}}var we=function(){function e(e){this.initialTeardown=e,this.closed=!1,this._parentage=null,this._finalizers=null}var t;return e.prototype.unsubscribe=function(){var e,t,n,r,i;if(!this.closed){this.closed=!0;var o=this._parentage;if(o)if(this._parentage=null,Array.isArray(o))try{for(var s=ue(o),a=s.next();!a.done;a=s.next()){a.value.remove(this)}}catch(h){e={error:h}}finally{try{a&&!a.done&&(t=s.return)&&t.call(s)}finally{if(e)throw e.error}}else o.remove(this);var l=this.initialTeardown;if(me(l))try{l()}catch(f){i=f instanceof ge?f.errors:[f]}var c=this._finalizers;if(c){this._finalizers=null;try{for(var u=ue(c),p=u.next();!p.done;p=u.next()){var d=p.value;try{ye(d)}catch(v){i=null!=i?i:[],v instanceof ge?i=de(de([],pe(i)),pe(v.errors)):i.push(v)}}}catch(m){n={error:m}}finally{try{p&&!p.done&&(r=u.return)&&r.call(u)}finally{if(n)throw n.error}}}if(i)throw new ge(i)}},e.prototype.add=function(t){var n;if(t&&t!==this)if(this.closed)ye(t);else{if(t instanceof e){if(t.closed||t._hasParent(this))return;t._addParent(this)}(this._finalizers=null!==(n=this._finalizers)&&void 0!==n?n:[]).push(t)}},e.prototype._hasParent=function(e){var t=this._parentage;return t===e||Array.isArray(t)&&t.includes(e)},e.prototype._addParent=function(e){var t=this._parentage;this._parentage=Array.isArray(t)?(t.push(e),t):t?[t,e]:e},e.prototype._removeParent=function(e){var t=this._parentage;t===e?this._parentage=null:Array.isArray(t)&&_e(t,e)},e.prototype.remove=function(t){var n=this._finalizers;n&&_e(n,t),t instanceof e&&t._removeParent(this)},e.EMPTY=((t=new e).closed=!0,t),e}();function xe(e){return e instanceof we||e&&"closed"in e&&me(e.remove)&&me(e.add)&&me(e.unsubscribe)}function ye(e){me(e)?e():e.unsubscribe()}we.EMPTY;var Ee=void 0,Pe=!1,Ce={setTimeout:function(e,t){for(var n=[],r=2;r<arguments.length;r++)n[r-2]=arguments[r];var i=Ce.delegate;return(null==i?void 0:i.setTimeout)?i.setTimeout.apply(i,de([e,t],pe(n))):setTimeout.apply(void 0,de([e,t],pe(n)))},clearTimeout:function(e){var t=Ce.delegate;return((null==t?void 0:t.clearTimeout)||clearTimeout)(e)},delegate:void 0};function Ae(e){Ce.setTimeout((function(){throw e}))}function Se(){}var ke=function(e){function t(t){var n=e.call(this)||this;return n.isStopped=!1,t?(n.destination=t,xe(t)&&t.add(n)):n.destination=Me,n}return ae(t,e),t.create=function(e,t,n){return new Ie(e,t,n)},t.prototype.next=function(e){this.isStopped||this._next(e)},t.prototype.error=function(e){this.isStopped||(this.isStopped=!0,this._error(e))},t.prototype.complete=function(){this.isStopped||(this.isStopped=!0,this._complete())},t.prototype.unsubscribe=function(){this.closed||(this.isStopped=!0,e.prototype.unsubscribe.call(this),this.destination=null)},t.prototype._next=function(e){this.destination.next(e)},t.prototype._error=function(e){try{this.destination.error(e)}finally{this.unsubscribe()}},t.prototype._complete=function(){try{this.destination.complete()}finally{this.unsubscribe()}},t}(we),Te=Function.prototype.bind;function Le(e,t){return Te.call(e,t)}var Re=function(){function e(e){this.partialObserver=e}return e.prototype.next=function(e){var t=this.partialObserver;if(t.next)try{t.next(e)}catch(n){Fe(n)}},e.prototype.error=function(e){var t=this.partialObserver;if(t.error)try{t.error(e)}catch(n){Fe(n)}else Fe(e)},e.prototype.complete=function(){var e=this.partialObserver;if(e.complete)try{e.complete()}catch(t){Fe(t)}},e}(),Ie=function(e){function t(t,n,r){var i,o,s=e.call(this)||this;me(t)||!t?i={next:null!=t?t:void 0,error:null!=n?n:void 0,complete:null!=r?r:void 0}:s&&Pe?((o=Object.create(t)).unsubscribe=function(){return s.unsubscribe()},i={next:t.next&&Le(t.next,o),error:t.error&&Le(t.error,o),complete:t.complete&&Le(t.complete,o)}):i=t;return s.destination=new Re(i),s}return ae(t,e),t}(ke);function Fe(e){Ae(e)}var Me={closed:!0,next:Se,error:function(e){throw e},complete:Se},Ve="function"==typeof Symbol&&Symbol.observable||"@@observable";function Oe(e){return e}function Ne(e){return 0===e.length?Oe:1===e.length?e[0]:function(t){return e.reduce((function(e,t){return t(e)}),t)}}var Be=function(){function e(e){e&&(this._subscribe=e)}return e.prototype.lift=function(t){var n=new e;return n.source=this,n.operator=t,n},e.prototype.subscribe=function(e,t,n){var r,i=this,o=(r=e)&&r instanceof ke||function(e){return e&&me(e.next)&&me(e.error)&&me(e.complete)}(r)&&xe(r)?e:new Ie(e,t,n);return function(){var e=i,t=e.operator,n=e.source;o.add(t?t.call(o,n):n?i._subscribe(o):i._trySubscribe(o))}(),o},e.prototype._trySubscribe=function(e){try{return this._subscribe(e)}catch(t){e.error(t)}},e.prototype.forEach=function(e,t){var n=this;return new(t=De(t))((function(t,r){var i=new Ie({next:function(t){try{e(t)}catch(n){r(n),i.unsubscribe()}},error:r,complete:t});n.subscribe(i)}))},e.prototype._subscribe=function(e){var t;return null===(t=this.source)||void 0===t?void 0:t.subscribe(e)},e.prototype[Ve]=function(){return this},e.prototype.pipe=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return Ne(e)(this)},e.prototype.toPromise=function(e){var t=this;return new(e=De(e))((function(e,n){var r;t.subscribe((function(e){return r=e}),(function(e){return n(e)}),(function(){return e(r)}))}))},e.create=function(t){return new e(t)},e}();function De(e){var t;return null!==(t=null!=e?e:Ee)&&void 0!==t?t:Promise}function ze(e){return function(t){if(function(e){return me(null==e?void 0:e.lift)}(t))return t.lift((function(t){try{return e(t,this)}catch(n){this.error(n)}}));throw new TypeError("Unable to lift unknown Observable type")}}function Ue(e,t,n,r,i){return new je(e,t,n,r,i)}var je=function(e){function t(t,n,r,i,o,s){var a=e.call(this,t)||this;return a.onFinalize=o,a.shouldUnsubscribe=s,a._next=n?function(e){try{n(e)}catch(r){t.error(r)}}:e.prototype._next,a._error=i?function(e){try{i(e)}catch(n){t.error(n)}finally{this.unsubscribe()}}:e.prototype._error,a._complete=r?function(){try{r()}catch(e){t.error(e)}finally{this.unsubscribe()}}:e.prototype._complete,a}return ae(t,e),t.prototype.unsubscribe=function(){var t;if(!this.shouldUnsubscribe||this.shouldUnsubscribe()){var n=this.closed;e.prototype.unsubscribe.call(this),!n&&(null===(t=this.onFinalize)||void 0===t||t.call(this))}},t}(ke),Ge={now:function(){return(Ge.delegate||Date).now()},delegate:void 0},We=function(e){function t(t,n){return e.call(this)||this}return ae(t,e),t.prototype.schedule=function(e,t){return this},t}(we),He={setInterval:function(e,t){for(var n=[],r=2;r<arguments.length;r++)n[r-2]=arguments[r];var i=He.delegate;return(null==i?void 0:i.setInterval)?i.setInterval.apply(i,de([e,t],pe(n))):setInterval.apply(void 0,de([e,t],pe(n)))},clearInterval:function(e){var t=He.delegate;return((null==t?void 0:t.clearInterval)||clearInterval)(e)},delegate:void 0},Ke=function(e){function t(t,n){var r=e.call(this,t,n)||this;return r.scheduler=t,r.work=n,r.pending=!1,r}return ae(t,e),t.prototype.schedule=function(e,t){var n;if(void 0===t&&(t=0),this.closed)return this;this.state=e;var r=this.id,i=this.scheduler;return null!=r&&(this.id=this.recycleAsyncId(i,r,t)),this.pending=!0,this.delay=t,this.id=null!==(n=this.id)&&void 0!==n?n:this.requestAsyncId(i,this.id,t),this},t.prototype.requestAsyncId=function(e,t,n){return void 0===n&&(n=0),He.setInterval(e.flush.bind(e,this),n)},t.prototype.recycleAsyncId=function(e,t,n){if(void 0===n&&(n=0),null!=n&&this.delay===n&&!1===this.pending)return t;null!=t&&He.clearInterval(t)},t.prototype.execute=function(e,t){if(this.closed)return new Error("executing a cancelled action");this.pending=!1;var n=this._execute(e,t);if(n)return n;!1===this.pending&&null!=this.id&&(this.id=this.recycleAsyncId(this.scheduler,this.id,null))},t.prototype._execute=function(e,t){var n,r=!1;try{this.work(e)}catch(i){r=!0,n=i||new Error("Scheduled action threw falsy error")}if(r)return this.unsubscribe(),n},t.prototype.unsubscribe=function(){if(!this.closed){var t=this.id,n=this.scheduler,r=n.actions;this.work=this.state=this.scheduler=null,this.pending=!1,_e(r,this),null!=t&&(this.id=this.recycleAsyncId(n,t,null)),this.delay=null,e.prototype.unsubscribe.call(this)}},t}(We),qe=function(){function e(t,n){void 0===n&&(n=e.now),this.schedulerActionCtor=t,this.now=n}return e.prototype.schedule=function(e,t,n){return void 0===t&&(t=0),new this.schedulerActionCtor(this,e).schedule(n,t)},e.now=Ge.now,e}(),Xe=new(function(e){function t(t,n){void 0===n&&(n=qe.now);var r=e.call(this,t,n)||this;return r.actions=[],r._active=!1,r}return ae(t,e),t.prototype.flush=function(e){var t=this.actions;if(this._active)t.push(e);else{var n;this._active=!0;do{if(n=e.execute(e.state,e.delay))break}while(e=t.shift());if(this._active=!1,n){for(;e=t.shift();)e.unsubscribe();throw n}}},t}(qe))(Ke),Ye=new Be((function(e){return e.complete()}));function $e(e){return e[e.length-1]}function Qe(e){return(t=$e(e))&&me(t.schedule)?e.pop():void 0;var t}function Ze(e,t){return"number"==typeof $e(e)?e.pop():t}var Je=function(e){return e&&"number"==typeof e.length&&"function"!=typeof e};function et(e){return me(null==e?void 0:e.then)}function tt(e){return me(e[Ve])}function nt(e){return Symbol.asyncIterator&&me(null==e?void 0:e[Symbol.asyncIterator])}function rt(e){return new TypeError("You provided "+(null!==e&&"object"==typeof e?"an invalid object":"'"+e+"'")+" where a stream was expected. You can provide an Observable, Promise, ReadableStream, Array, AsyncIterable, or Iterable.")}var it="function"==typeof Symbol&&Symbol.iterator?Symbol.iterator:"@@iterator";function ot(e){return me(null==e?void 0:e[it])}function st(e){return fe(this,arguments,(function(){var t,n,r;return ce(this,(function(i){switch(i.label){case 0:t=e.getReader(),i.label=1;case 1:i.trys.push([1,,9,10]),i.label=2;case 2:return[4,he(t.read())];case 3:return n=i.sent(),r=n.value,n.done?[4,he(void 0)]:[3,5];case 4:return[2,i.sent()];case 5:return[4,he(r)];case 6:return[4,i.sent()];case 7:return i.sent(),[3,2];case 8:return[3,10];case 9:return t.releaseLock(),[7];case 10:return[2]}}))}))}function at(e){return me(null==e?void 0:e.getReader)}function lt(e){if(e instanceof Be)return e;if(null!=e){if(tt(e))return i=e,new Be((function(e){var t=i[Ve]();if(me(t.subscribe))return t.subscribe(e);throw new TypeError("Provided object does not correctly implement Symbol.observable")}));if(Je(e))return r=e,new Be((function(e){for(var t=0;t<r.length&&!e.closed;t++)e.next(r[t]);e.complete()}));if(et(e))return n=e,new Be((function(e){n.then((function(t){e.closed||(e.next(t),e.complete())}),(function(t){return e.error(t)})).then(null,Ae)}));if(nt(e))return ct(e);if(ot(e))return t=e,new Be((function(e){var n,r;try{for(var i=ue(t),o=i.next();!o.done;o=i.next()){var s=o.value;if(e.next(s),e.closed)return}}catch(a){n={error:a}}finally{try{o&&!o.done&&(r=i.return)&&r.call(i)}finally{if(n)throw n.error}}e.complete()}));if(at(e))return ct(st(e))}var t,n,r,i;throw rt(e)}function ct(e){return new Be((function(t){(function(e,t){var n,r,i,o;return le(this,void 0,void 0,(function(){var s,a;return ce(this,(function(l){switch(l.label){case 0:l.trys.push([0,5,6,11]),n=ve(e),l.label=1;case 1:return[4,n.next()];case 2:if((r=l.sent()).done)return[3,4];if(s=r.value,t.next(s),t.closed)return[2];l.label=3;case 3:return[3,1];case 4:return[3,11];case 5:return a=l.sent(),i={error:a},[3,11];case 6:return l.trys.push([6,,9,10]),r&&!r.done&&(o=n.return)?[4,o.call(n)]:[3,8];case 7:l.sent(),l.label=8;case 8:return[3,10];case 9:if(i)throw i.error;return[7];case 10:return[7];case 11:return t.complete(),[2]}}))}))})(e,t).catch((function(e){return t.error(e)}))}))}function ut(e,t,n,r,i){void 0===r&&(r=0),void 0===i&&(i=!1);var o=t.schedule((function(){n(),i?e.add(this.schedule(null,r)):this.unsubscribe()}),r);if(e.add(o),!i)return o}function pt(e,t){return void 0===t&&(t=0),ze((function(n,r){n.subscribe(Ue(r,(function(n){return ut(r,e,(function(){return r.next(n)}),t)}),(function(){return ut(r,e,(function(){return r.complete()}),t)}),(function(n){return ut(r,e,(function(){return r.error(n)}),t)})))}))}function dt(e,t){return void 0===t&&(t=0),ze((function(n,r){r.add(e.schedule((function(){return n.subscribe(r)}),t))}))}function ht(e,t){if(!e)throw new Error("Iterable cannot be null");return new Be((function(n){ut(n,t,(function(){var r=e[Symbol.asyncIterator]();ut(n,t,(function(){r.next().then((function(e){e.done?n.complete():n.next(e.value)}))}),0,!0)}))}))}function ft(e,t){if(null!=e){if(tt(e))return function(e,t){return lt(e).pipe(dt(t),pt(t))}(e,t);if(Je(e))return function(e,t){return new Be((function(n){var r=0;return t.schedule((function(){r===e.length?n.complete():(n.next(e[r++]),n.closed||this.schedule())}))}))}(e,t);if(et(e))return function(e,t){return lt(e).pipe(dt(t),pt(t))}(e,t);if(nt(e))return ht(e,t);if(ot(e))return function(e,t){return new Be((function(n){var r;return ut(n,t,(function(){r=e[it](),ut(n,t,(function(){var e,t,i;try{t=(e=r.next()).value,i=e.done}catch(o){return void n.error(o)}i?n.complete():n.next(t)}),0,!0)})),function(){return me(null==r?void 0:r.return)&&r.return()}}))}(e,t);if(at(e))return function(e,t){return ht(st(e),t)}(e,t)}throw rt(e)}function vt(e,t){return t?ft(e,t):lt(e)}function mt(e,t){return ze((function(n,r){var i=0;n.subscribe(Ue(r,(function(n){r.next(e.call(t,n,i++))})))}))}var bt=Array.isArray;function gt(e){return mt((function(t){return function(e,t){return bt(t)?e.apply(void 0,de([],pe(t))):e(t)}(e,t)}))}function _t(e,t,n){return void 0===n&&(n=1/0),me(t)?_t((function(n,r){return mt((function(e,i){return t(n,e,r,i)}))(lt(e(n,r)))}),n):("number"==typeof t&&(n=t),ze((function(t,r){return function(e,t,n,r,i,o,s,a){var l=[],c=0,u=0,p=!1,d=function(){!p||l.length||c||t.complete()},h=function(e){return c<r?f(e):l.push(e)},f=function(e){o&&t.next(e),c++;var a=!1;lt(n(e,u++)).subscribe(Ue(t,(function(e){null==i||i(e),o?h(e):t.next(e)}),(function(){a=!0}),void 0,(function(){if(a)try{c--;for(var e=function(){var e=l.shift();s?ut(t,s,(function(){return f(e)})):f(e)};l.length&&c<r;)e();d()}catch(n){t.error(n)}})))};return e.subscribe(Ue(t,h,(function(){p=!0,d()}))),function(){null==a||a()}}(t,r,e,n)})))}function wt(e){return void 0===e&&(e=1/0),_t(Oe,e)}var xt=["addListener","removeListener"],yt=["addEventListener","removeEventListener"],Et=["on","off"];function Pt(e,t,n,r){if(me(n)&&(r=n,n=void 0),r)return Pt(e,t,n).pipe(gt(r));var i=pe(function(e){return me(e.addEventListener)&&me(e.removeEventListener)}(e)?yt.map((function(r){return function(i){return e[r](t,i,n)}})):function(e){return me(e.addListener)&&me(e.removeListener)}(e)?xt.map(Ct(e,t)):function(e){return me(e.on)&&me(e.off)}(e)?Et.map(Ct(e,t)):[],2),o=i[0],s=i[1];if(!o&&Je(e))return _t((function(e){return Pt(e,t,n)}))(lt(e));if(!o)throw new TypeError("Invalid event target");return new Be((function(e){var t=function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];return e.next(1<t.length?t:t[0])};return o(t),function(){return s(t)}}))}function Ct(e,t){return function(n){return function(r){return e[n](t,r)}}}var At="undefined"!=typeof Float32Array?Float32Array:Array;function St(){var e=new At(16);return At!=Float32Array&&(e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=0,e[12]=0,e[13]=0,e[14]=0),e[0]=1,e[5]=1,e[10]=1,e[15]=1,e}function kt(e,t){var n=t[0],r=t[1],i=t[2],o=t[3],s=t[4],a=t[5],l=t[6],c=t[7],u=t[8],p=t[9],d=t[10],h=t[11],f=t[12],v=t[13],m=t[14],b=t[15],g=n*a-r*s,_=n*l-i*s,w=n*c-o*s,x=r*l-i*a,y=r*c-o*a,E=i*c-o*l,P=u*v-p*f,C=u*m-d*f,A=u*b-h*f,S=p*m-d*v,k=p*b-h*v,T=d*b-h*m,L=g*T-_*k+w*S+x*A-y*C+E*P;return L?(L=1/L,e[0]=(a*T-l*k+c*S)*L,e[1]=(i*k-r*T-o*S)*L,e[2]=(v*E-m*y+b*x)*L,e[3]=(d*y-p*E-h*x)*L,e[4]=(l*A-s*T-c*C)*L,e[5]=(n*T-i*A+o*C)*L,e[6]=(m*w-f*E-b*_)*L,e[7]=(u*E-d*w+h*_)*L,e[8]=(s*k-a*A+c*P)*L,e[9]=(r*A-n*k-o*P)*L,e[10]=(f*y-v*w+b*g)*L,e[11]=(p*w-u*y-h*g)*L,e[12]=(a*C-s*S-l*P)*L,e[13]=(n*S-r*C+i*P)*L,e[14]=(v*_-f*x-m*g)*L,e[15]=(u*x-p*_+d*g)*L,e):null}function Tt(e,t){var n=new At(3);!function(e,t){var n=t[0],r=t[1],i=t[2],o=t[4],s=t[5],a=t[6],l=t[8],c=t[9],u=t[10];e[0]=Math.hypot(n,r,i),e[1]=Math.hypot(o,s,a),e[2]=Math.hypot(l,c,u)}(n,t);var r=1/n[0],i=1/n[1],o=1/n[2],s=t[0]*r,a=t[1]*i,l=t[2]*o,c=t[4]*r,u=t[5]*i,p=t[6]*o,d=t[8]*r,h=t[9]*i,f=t[10]*o,v=s+u+f,m=0;return v>0?(m=2*Math.sqrt(v+1),e[3]=.25*m,e[0]=(p-h)/m,e[1]=(d-l)/m,e[2]=(a-c)/m):s>u&&s>f?(m=2*Math.sqrt(1+s-u-f),e[3]=(p-h)/m,e[0]=.25*m,e[1]=(a+c)/m,e[2]=(d+l)/m):u>f?(m=2*Math.sqrt(1+u-s-f),e[3]=(d-l)/m,e[0]=(a+c)/m,e[1]=.25*m,e[2]=(p+h)/m):(m=2*Math.sqrt(1+f-s-u),e[3]=(a-c)/m,e[0]=(d+l)/m,e[1]=(p+h)/m,e[2]=.25*m),e}Math.hypot||(Math.hypot=function(){for(var e=0,t=arguments.length;t--;)e+=arguments[t]*arguments[t];return Math.sqrt(e)});var Lt=function(e,t,n,r,i){var o,s=1/Math.tan(t/2);return e[0]=s/n,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=s,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=-1,e[12]=0,e[13]=0,e[15]=0,null!=i&&i!==1/0?(o=1/(r-i),e[10]=(i+r)*o,e[14]=2*i*r*o):(e[10]=-1,e[14]=-2*r),e};function Rt(e,t,n,r){var i=t[0],o=t[1],s=t[2],a=r[0],l=r[1],c=r[2],u=i-n[0],p=o-n[1],d=s-n[2],h=u*u+p*p+d*d;h>0&&(u*=h=1/Math.sqrt(h),p*=h,d*=h);var f=l*d-c*p,v=c*u-a*d,m=a*p-l*u;return(h=f*f+v*v+m*m)>0&&(f*=h=1/Math.sqrt(h),v*=h,m*=h),e[0]=f,e[1]=v,e[2]=m,e[3]=0,e[4]=p*m-d*v,e[5]=d*f-u*m,e[6]=u*v-p*f,e[7]=0,e[8]=u,e[9]=p,e[10]=d,e[11]=0,e[12]=i,e[13]=o,e[14]=s,e[15]=1,e}function It(){var e=new At(3);return At!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0),e}function Ft(e){var t=new At(3);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t}function Mt(e,t,n){var r=new At(3);return r[0]=e,r[1]=t,r[2]=n,r}function Vt(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e}function Ot(e,t,n){return e[0]=t[0]+n[0],e[1]=t[1]+n[1],e[2]=t[2]+n[2],e}function Nt(e,t,n){return e[0]=t[0]-n[0],e[1]=t[1]-n[1],e[2]=t[2]-n[2],e}function Bt(e,t,n){return e[0]=t[0]*n,e[1]=t[1]*n,e[2]=t[2]*n,e}function Dt(e,t){var n=t[0],r=t[1],i=t[2],o=n*n+r*r+i*i;return o>0&&(o=1/Math.sqrt(o)),e[0]=t[0]*o,e[1]=t[1]*o,e[2]=t[2]*o,e}function zt(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]}function Ut(e,t,n){var r=t[0],i=t[1],o=t[2],s=n[0],a=n[1],l=n[2];return e[0]=i*l-o*a,e[1]=o*s-r*l,e[2]=r*a-i*s,e}var jt=Nt;function Gt(){var e=new At(4);return At!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0,e[3]=0),e}function Wt(e,t,n,r){var i=new At(4);return i[0]=e,i[1]=t,i[2]=n,i[3]=r,i}function Ht(e,t,n){return e[0]=t[0]*n,e[1]=t[1]*n,e[2]=t[2]*n,e[3]=t[3]*n,e}function Kt(){var e=new At(4);return At!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0),e[3]=1,e}function qt(e,t,n){n*=.5;var r=Math.sin(n);return e[0]=r*t[0],e[1]=r*t[1],e[2]=r*t[2],e[3]=Math.cos(n),e}function Xt(e,t,n){var r=t[0],i=t[1],o=t[2],s=t[3],a=n[0],l=n[1],c=n[2],u=n[3];return e[0]=r*u+s*a+i*c-o*l,e[1]=i*u+s*l+o*a-r*c,e[2]=o*u+s*c+r*l-i*a,e[3]=s*u-r*a-i*l-o*c,e}It(),function(){var e=Gt()}();var Yt,$t=function(e){var t=new At(4);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t},Qt=Wt,Zt=function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e},Jt=Ht,en=function(e,t){var n=t[0],r=t[1],i=t[2],o=t[3],s=n*n+r*r+i*i+o*o;return s>0&&(s=1/Math.sqrt(s)),e[0]=n*s,e[1]=r*s,e[2]=i*s,e[3]=o*s,e};function tn(){var e=new At(2);return At!=Float32Array&&(e[0]=0,e[1]=0),e}function nn(e,t){var n=new At(2);return n[0]=e,n[1]=t,n}It(),Mt(1,0,0),Mt(0,1,0),Kt(),Kt(),Yt=new At(9),At!=Float32Array&&(Yt[1]=0,Yt[2]=0,Yt[3]=0,Yt[5]=0,Yt[6]=0,Yt[7]=0),Yt[0]=1,Yt[4]=1,Yt[8]=1,function(){var e=tn()}();
/* @license twgl.js 5.3.0 Copyright (c) 2015, Gregg Tavares All Rights Reserved.
Available via the MIT license.
see: http://github.com/greggman/twgl.js for details */
let rn=Float32Array;function on(e,t,n){const r=new rn(3);return e&&(r[0]=e),t&&(r[1]=t),n&&(r[2]=n),r}function sn(e,t,n){return(n=n||new rn(3))[0]=e[0]+t[0],n[1]=e[1]+t[1],n[2]=e[2]+t[2],n}let an=Float32Array;function ln(e,t,n){n=n||on();const r=t[0],i=t[1],o=t[2],s=r*e[3]+i*e[7]+o*e[11]+e[15];return n[0]=(r*e[0]+i*e[4]+o*e[8]+e[12])/s,n[1]=(r*e[1]+i*e[5]+o*e[9]+e[13])/s,n[2]=(r*e[2]+i*e[6]+o*e[10]+e[14])/s,n}function cn(e,t,n){n=n||on();const r=t[0],i=t[1],o=t[2];return n[0]=r*e[0]+i*e[4]+o*e[8],n[1]=r*e[1]+i*e[5]+o*e[9],n[2]=r*e[2]+i*e[6]+o*e[10],n}const un=5120,pn=5121,dn=5122,hn=5123,fn=5124,vn=5125,mn=5126,bn={};{const e=bn;e[5120]=Int8Array,e[5121]=Uint8Array,e[5122]=Int16Array,e[5123]=Uint16Array,e[5124]=Int32Array,e[5125]=Uint32Array,e[5126]=Float32Array,e[32819]=Uint16Array,e[32820]=Uint16Array,e[33635]=Uint16Array,e[5131]=Uint16Array,e[33640]=Uint32Array,e[35899]=Uint32Array,e[35902]=Uint32Array,e[36269]=Uint32Array,e[34042]=Uint32Array}function gn(e){if(e instanceof Int8Array)return un;if(e instanceof Uint8Array)return pn;if(e instanceof Uint8ClampedArray)return pn;if(e instanceof Int16Array)return dn;if(e instanceof Uint16Array)return hn;if(e instanceof Int32Array)return fn;if(e instanceof Uint32Array)return vn;if(e instanceof Float32Array)return mn;throw new Error("unsupported typed array type")}function _n(e){if(e===Int8Array)return un;if(e===Uint8Array)return pn;if(e===Uint8ClampedArray)return pn;if(e===Int16Array)return dn;if(e===Uint16Array)return hn;if(e===Int32Array)return fn;if(e===Uint32Array)return vn;if(e===Float32Array)return mn;throw new Error("unsupported typed array type")}function wn(e){const t=bn[e];if(!t)throw new Error("unknown gl type");return t}const xn="undefined"!=typeof SharedArrayBuffer?function(e){return e&&e.buffer&&(e.buffer instanceof ArrayBuffer||e.buffer instanceof SharedArrayBuffer)}:function(e){return e&&e.buffer&&e.buffer instanceof ArrayBuffer};function yn(...e){console.error(...e)}function En(...e){console.warn(...e)}const Pn=new Map;function Cn(e,t){if(!e||"object"!=typeof e)return!1;let n=Pn.get(t);n||(n=new WeakMap,Pn.set(t,n));let r=n.get(e);if(void 0===r){const i=Object.prototype.toString.call(e);r=i.substring(8,i.length-1)===t,n.set(e,r)}return r}function An(e,t){return"undefined"!=typeof WebGLRenderbuffer&&Cn(t,"WebGLRenderbuffer")}function Sn(e,t){return"undefined"!=typeof WebGLTexture&&Cn(t,"WebGLTexture")}const kn=34962,Tn="";function Ln(e,t,n,r,i){e.bindBuffer(t,n),e.bufferData(t,r,i||35044)}function Rn(e,t,n,r){if(i=t,"undefined"!=typeof WebGLBuffer&&Cn(i,"WebGLBuffer"))return t;var i;n=n||kn;const o=e.createBuffer();return Ln(e,n,o,t,r),o}function In(e){return"indices"===e}function Fn(e){return e.length?e:e.data}const Mn=/coord|texture/i,Vn=/color|colour/i;function On(e,t,n){return e.numComponents||e.size||function(e,t){let n;if(n=Mn.test(e)?2:Vn.test(e)?4:3,t%n>0)throw new Error(`Can not guess numComponents for attribute '${e}'. Tried ${n} but ${t} values is not evenly divisible by ${n}. You should specify it.`);return n}(t,n||Fn(e).length)}function Nn(e,t){if(xn(e))return e;if(xn(e.data))return e.data;Array.isArray(e)&&(e={data:e});let n=e.type?Bn(e.type):void 0;return n||(n=In(t)?Uint16Array:Float32Array),new n(e.data)}function Bn(e){return"number"==typeof e?wn(e):e||Float32Array}function Dn(e,t){return{buffer:t.buffer,numValues:24,type:(n=t.type,"number"==typeof n?n:n?_n(n):5126),arrayType:Bn(t.type)};var n}function zn(e,t){const n=t.data||t,r=Bn(t.type),i=n*r.BYTES_PER_ELEMENT,o=e.createBuffer();return e.bindBuffer(kn,o),e.bufferData(kn,i,t.drawType||35044),{buffer:o,numValues:n,type:_n(r),arrayType:r}}function Un(e,t,n){const r=Nn(t,n);return{arrayType:r.constructor,buffer:Rn(e,r,void 0,t.drawType),type:gn(r),numValues:0}}function jn(e,t){const n={};return Object.keys(t).forEach((function(r){if(!In(r)){const o=t[r],s=o.attrib||o.name||o.attribName||Tn+r;if(o.value){if(!Array.isArray(o.value)&&!xn(o.value))throw new Error("array.value is not array or typedarray");n[s]={value:o.value}}else{let t;t=o.buffer&&o.buffer instanceof WebGLBuffer?Dn:"number"==typeof o||"number"==typeof o.data?zn:Un;const{buffer:a,type:l,numValues:c,arrayType:u}=t(e,o,r),p=void 0!==o.normalize?o.normalize:(i=u)===Int8Array||i===Uint8Array,d=On(o,r,c);n[s]={buffer:a,numComponents:d,type:l,normalize:p,stride:o.stride||0,offset:o.offset||0,divisor:void 0===o.divisor?void 0:o.divisor,drawType:o.drawType}}}var i})),e.bindBuffer(kn,null),n}function Gn(e,t,n,r){n=Nn(n),void 0!==r?(e.bindBuffer(kn,t.buffer),e.bufferSubData(kn,r,n)):Ln(e,kn,t.buffer,n,t.drawType)}const Wn=["position","positions","a_position"];function Hn(e,t,n){const r=jn(e,t),i=Object.assign({},n||{});i.attribs=Object.assign({},n?n.attribs:{},r);const o=t.indices;if(o){const t=Nn(o,"indices");i.indices=Rn(e,t,34963),i.numElements=t.length,i.elementType=gn(t)}else i.numElements||(i.numElements=function(e,t){let n,r;for(r=0;r<Wn.length&&(n=Wn[r],!(n in t))&&(n=Tn+n,!(n in t));++r);r===Wn.length&&(n=Object.keys(t)[0]);const i=t[n];if(!i.buffer)return 1;e.bindBuffer(kn,i.buffer);const o=e.getBufferParameter(kn,34660);var s;e.bindBuffer(kn,null);const a=o/(5120===(s=i.type)||5121===s?1:5122===s||5123===s?2:5124===s||5125===s||5126===s?4:0),l=i.numComponents||i.size,c=a/l;if(c%1!=0)throw new Error(`numComponents ${l} not correct for length ${length}`);return c}(e,i.attribs));return i}function Kn(e,t){const n={};return Object.keys(t).forEach((function(r){n[r]=function(e,t,n){const r="indices"===n?34963:kn;return Rn(e,Nn(t,n),r)}(e,t[r],r)})),t.indices?(n.numElements=t.indices.length,n.elementType=gn(Nn(t.indices))):n.numElements=function(e){let t,n;for(n=0;n<Wn.length&&(t=Wn[n],!(t in e));++n);n===Wn.length&&(t=Object.keys(e)[0]);const r=e[t],i=Fn(r).length;if(void 0===i)return 1;const o=On(r,t),s=i/o;if(i%o>0)throw new Error(`numComponents ${o} not correct for length ${i}`);return s}(t),n}const qn=Fn,Xn=On;function Yn(e,t){let n=0;return e.push=function(){for(let t=0;t<arguments.length;++t){const r=arguments[t];if(r instanceof Array||xn(r))for(let t=0;t<r.length;++t)e[n++]=r[t];else e[n++]=r}},e.reset=function(e){n=e||0},e.numComponents=t,Object.defineProperty(e,"numElements",{get:function(){return this.length/this.numComponents|0}}),e}function $n(e,t,n){return Yn(new(n||Float32Array)(e*t),e)}function Qn(e){return"indices"!==e}function Zn(e,t,n){const r=e.length,i=new Float32Array(3);for(let o=0;o<r;o+=3)n(t,[e[o],e[o+1],e[o+2]],i),e[o]=i[0],e[o+1]=i[1],e[o+2]=i[2]}function Jn(e,t,n){n=n||on();const r=t[0],i=t[1],o=t[2];return n[0]=r*e[0]+i*e[1]+o*e[2],n[1]=r*e[4]+i*e[5]+o*e[6],n[2]=r*e[8]+i*e[9]+o*e[10],n}function er(e,t){return Zn(e,t,cn),e}function tr(e,t){return Zn(e,function(e,t){t=t||new an(16);const n=e[0],r=e[1],i=e[2],o=e[3],s=e[4],a=e[5],l=e[6],c=e[7],u=e[8],p=e[9],d=e[10],h=e[11],f=e[12],v=e[13],m=e[14],b=e[15],g=d*b,_=m*h,w=l*b,x=m*c,y=l*h,E=d*c,P=i*b,C=m*o,A=i*h,S=d*o,k=i*c,T=l*o,L=u*v,R=f*p,I=s*v,F=f*a,M=s*p,V=u*a,O=n*v,N=f*r,B=n*p,D=u*r,z=n*a,U=s*r,j=g*a+x*p+y*v-(_*a+w*p+E*v),G=_*r+P*p+S*v-(g*r+C*p+A*v),W=w*r+C*a+k*v-(x*r+P*a+T*v),H=E*r+A*a+T*p-(y*r+S*a+k*p),K=1/(n*j+s*G+u*W+f*H);return t[0]=K*j,t[1]=K*G,t[2]=K*W,t[3]=K*H,t[4]=K*(_*s+w*u+E*f-(g*s+x*u+y*f)),t[5]=K*(g*n+C*u+A*f-(_*n+P*u+S*f)),t[6]=K*(x*n+P*s+T*f-(w*n+C*s+k*f)),t[7]=K*(y*n+S*s+k*u-(E*n+A*s+T*u)),t[8]=K*(L*c+F*h+M*b-(R*c+I*h+V*b)),t[9]=K*(R*o+O*h+D*b-(L*o+N*h+B*b)),t[10]=K*(I*o+N*c+z*b-(F*o+O*c+U*b)),t[11]=K*(V*o+B*c+U*h-(M*o+D*c+z*h)),t[12]=K*(I*d+V*m+R*l-(M*m+L*l+F*d)),t[13]=K*(B*m+L*i+N*d-(O*d+D*m+R*i)),t[14]=K*(O*l+U*m+F*i-(z*m+I*i+N*l)),t[15]=K*(z*d+M*i+D*l-(B*l+U*d+V*i)),t}(t),Jn),e}function nr(e,t){return Zn(e,t,ln),e}function rr(e,t){return Object.keys(e).forEach((function(n){const r=e[n];n.indexOf("pos")>=0?nr(r,t):n.indexOf("tan")>=0||n.indexOf("binorm")>=0?er(r,t):n.indexOf("norm")>=0&&tr(r,t)})),e}function ir(e,t,n){return e=e||2,{position:{numComponents:2,data:[(t=t||0)+-1*(e*=.5),(n=n||0)+-1*e,t+1*e,n+-1*e,t+-1*e,n+1*e,t+1*e,n+1*e]},normal:[0,0,1,0,0,1,0,0,1,0,0,1],texcoord:[0,0,1,0,0,1,1,1],indices:[0,1,2,2,1,3]}}function or(e,t,n,r,i){var o;e=e||1,t=t||1,n=n||1,r=r||1,i=i||((o=o||new an(16))[0]=1,o[1]=0,o[2]=0,o[3]=0,o[4]=0,o[5]=1,o[6]=0,o[7]=0,o[8]=0,o[9]=0,o[10]=1,o[11]=0,o[12]=0,o[13]=0,o[14]=0,o[15]=1,o);const s=(n+1)*(r+1),a=$n(3,s),l=$n(3,s),c=$n(2,s);for(let d=0;d<=r;d++)for(let i=0;i<=n;i++){const o=i/n,s=d/r;a.push(e*o-.5*e,0,t*s-.5*t),l.push(0,1,0),c.push(o,s)}const u=n+1,p=$n(3,n*r*2,Uint16Array);for(let d=0;d<r;d++)for(let e=0;e<n;e++)p.push((d+0)*u+e,(d+1)*u+e,(d+0)*u+e+1),p.push((d+1)*u+e,(d+1)*u+e+1,(d+0)*u+e+1);return rr({position:a,normal:l,texcoord:c,indices:p},i)}function sr(e,t,n,r,i,o,s){if(t<=0||n<=0)throw new Error("subdivisionAxis and subdivisionHeight must be > 0");r=r||0,o=o||0;const a=(i=i||Math.PI)-r,l=(s=s||2*Math.PI)-o,c=(t+1)*(n+1),u=$n(3,c),p=$n(3,c),d=$n(2,c);for(let v=0;v<=n;v++)for(let i=0;i<=t;i++){const s=i/t,c=v/n,h=l*s+o,f=a*c+r,m=Math.sin(h),b=Math.cos(h),g=Math.sin(f),_=b*g,w=Math.cos(f),x=m*g;u.push(e*_,e*w,e*x),p.push(_,w,x),d.push(1-s,c)}const h=t+1,f=$n(3,t*n*2,Uint16Array);for(let v=0;v<t;v++)for(let e=0;e<n;e++)f.push((e+0)*h+v,(e+0)*h+v+1,(e+1)*h+v),f.push((e+1)*h+v,(e+0)*h+v+1,(e+1)*h+v+1);return{position:u,normal:p,texcoord:d,indices:f}}const ar=[[3,7,5,1],[6,2,0,4],[6,7,3,2],[0,1,5,4],[7,6,4,5],[2,3,1,0]];function lr(e){const t=(e=e||1)/2,n=[[-t,-t,-t],[+t,-t,-t],[-t,+t,-t],[+t,+t,-t],[-t,-t,+t],[+t,-t,+t],[-t,+t,+t],[+t,+t,+t]],r=[[1,0,0],[-1,0,0],[0,1,0],[0,-1,0],[0,0,1],[0,0,-1]],i=[[1,0],[0,0],[0,1],[1,1]],o=$n(3,24),s=$n(3,24),a=$n(2,24),l=$n(3,12,Uint16Array);for(let c=0;c<6;++c){const e=ar[c];for(let l=0;l<4;++l){const t=n[e[l]],u=r[c],p=i[l];o.push(t),s.push(u),a.push(p)}const t=4*c;l.push(t+0,t+1,t+2),l.push(t+0,t+2,t+3)}return{position:o,normal:s,texcoord:a,indices:l}}function cr(e,t,n,r,i,o,s){if(r<3)throw new Error("radialSubdivisions must be 3 or greater");if(i<1)throw new Error("verticalSubdivisions must be 1 or greater");const a=void 0===o||o,l=void 0===s||s,c=(a?2:0)+(l?2:0),u=(r+1)*(i+1+c),p=$n(3,u),d=$n(3,u),h=$n(2,u),f=$n(3,r*(i+c/2)*2,Uint16Array),v=r+1,m=Math.atan2(e-t,n),b=Math.cos(m),g=Math.sin(m),_=i+(l?2:0);for(let w=a?-2:0;w<=_;++w){let o,s=w/i,a=n*s;w<0?(a=0,s=1,o=e):w>i?(a=n,s=1,o=t):o=e+w/i*(t-e),-2!==w&&w!==i+2||(o=0,s=0),a-=n/2;for(let e=0;e<v;++e){const t=Math.sin(e*Math.PI*2/r),n=Math.cos(e*Math.PI*2/r);p.push(t*o,a,n*o),w<0?d.push(0,-1,0):w>i?d.push(0,1,0):0===o?d.push(0,0,0):d.push(t*b,g,n*b),h.push(e/r,1-s)}}for(let w=0;w<i+c;++w)if(!(1===w&&a||w===i+c-2&&l))for(let e=0;e<r;++e)f.push(v*(w+0)+0+e,v*(w+0)+1+e,v*(w+1)+1+e),f.push(v*(w+0)+0+e,v*(w+1)+1+e,v*(w+1)+0+e);return{position:p,normal:d,texcoord:h,indices:f}}function ur(e,t){t=t||[];const n=[];for(let r=0;r<e.length;r+=4){const i=e[r],o=e.slice(r+1,r+4);o.push.apply(o,t);for(let e=0;e<i;++e)n.push.apply(n,o)}return n}function pr(){const e=[0,0,0,0,150,0,30,0,0,0,150,0,30,150,0,30,0,0,30,0,0,30,30,0,100,0,0,30,30,0,100,30,0,100,0,0,30,60,0,30,90,0,67,60,0,30,90,0,67,90,0,67,60,0,0,0,30,30,0,30,0,150,30,0,150,30,30,0,30,30,150,30,30,0,30,100,0,30,30,30,30,30,30,30,100,0,30,100,30,30,30,60,30,67,60,30,30,90,30,30,90,30,67,60,30,67,90,30,0,0,0,100,0,0,100,0,30,0,0,0,100,0,30,0,0,30,100,0,0,100,30,0,100,30,30,100,0,0,100,30,30,100,0,30,30,30,0,30,30,30,100,30,30,30,30,0,100,30,30,100,30,0,30,30,0,30,60,30,30,30,30,30,30,0,30,60,0,30,60,30,30,60,0,67,60,30,30,60,30,30,60,0,67,60,0,67,60,30,67,60,0,67,90,30,67,60,30,67,60,0,67,90,0,67,90,30,30,90,0,30,90,30,67,90,30,30,90,0,67,90,30,67,90,0,30,90,0,30,150,30,30,90,30,30,90,0,30,150,0,30,150,30,0,150,0,0,150,30,30,150,30,0,150,0,30,150,30,30,150,0,0,0,0,0,0,30,0,150,30,0,0,0,0,150,30,0,150,0],t=ur([18,0,0,1,18,0,0,-1,6,0,1,0,6,1,0,0,6,0,-1,0,6,1,0,0,6,0,1,0,6,1,0,0,6,0,-1,0,6,1,0,0,6,0,-1,0,6,-1,0,0]),n=ur([18,200,70,120,18,80,70,200,6,70,200,210,6,200,200,70,6,210,100,70,6,210,160,70,6,70,180,210,6,100,70,210,6,76,210,100,6,140,210,80,6,90,130,110,6,160,160,220],[255]),r=e.length/3,i={position:$n(3,r),texcoord:$n(2,r),normal:$n(3,r),color:$n(4,r,Uint8Array),indices:$n(3,r/3,Uint16Array)};i.position.push(e),i.texcoord.push([.22,.19,.22,.79,.34,.19,.22,.79,.34,.79,.34,.19,.34,.19,.34,.31,.62,.19,.34,.31,.62,.31,.62,.19,.34,.43,.34,.55,.49,.43,.34,.55,.49,.55,.49,.43,0,0,1,0,0,1,0,1,1,0,1,1,0,0,1,0,0,1,0,1,1,0,1,1,0,0,1,0,0,1,0,1,1,0,1,1,0,0,1,0,1,1,0,0,1,1,0,1,0,0,1,0,1,1,0,0,1,1,0,1,0,0,0,1,1,1,0,0,1,1,1,0,0,0,1,1,0,1,0,0,1,0,1,1,0,0,1,1,0,1,0,0,1,0,1,1,0,0,1,1,0,1,0,0,1,0,1,1,0,0,0,1,1,1,0,0,1,1,1,0,0,0,1,1,0,1,0,0,1,0,1,1,0,0,0,1,1,1,0,0,1,1,1,0,0,0,0,1,1,1,0,0,1,1,1,0]),i.normal.push(t),i.color.push(n);for(let o=0;o<r;++o)i.indices.push(o);return i}function dr(e,t,n,r,i,o,s){if(i<=0)throw new Error("subdivisionDown must be > 0");const a=(s=s||1)-(o=o||0),l=2*(i+1)*4,c=$n(3,l),u=$n(3,l),p=$n(2,l);function d(e,t,n){return e+(t-e)*n}function h(t,n,s,l,h,f){for(let g=0;g<=i;g++){const _=n/1,w=g/i,x=2*(_-.5),y=(o+w*a)*Math.PI,E=Math.sin(y),P=Math.cos(y),C=d(e,t,E),A=x*r,S=P*e,k=E*C;c.push(A,S,k);const T=sn((v=[0,E,P],m=s,(b=(b=void 0)||new rn(3))[0]=v[0]*m[0],b[1]=v[1]*m[1],b[2]=v[2]*m[2],b),l);u.push(T),p.push(_*h+f,w)}var v,m,b}for(let b=0;b<2;b++){const e=2*(b/1-.5);h(t,b,[1,1,1],[0,0,0],1,0),h(t,b,[0,0,0],[e,0,0],0,0),h(n,b,[1,1,1],[0,0,0],1,0),h(n,b,[0,0,0],[e,0,0],0,1)}const f=$n(3,2*i*4,Uint16Array);function v(e,t){for(let n=0;n<i;++n)f.push(e+n+0,e+n+1,t+n+0),f.push(e+n+1,t+n+1,t+n+0)}const m=i+1;return v(0*m,4*m),v(5*m,7*m),v(6*m,2*m),v(3*m,1*m),{position:c,normal:u,texcoord:p,indices:f}}function hr(e,t,n,r,i,o){return cr(e,e,t,n,r,i,o)}function fr(e,t,n,r,i,o){if(n<3)throw new Error("radialSubdivisions must be 3 or greater");if(r<3)throw new Error("verticalSubdivisions must be 3 or greater");i=i||0;const s=(o=o||2*Math.PI)-i,a=n+1,l=r+1,c=a*l,u=$n(3,c),p=$n(3,c),d=$n(2,c),h=$n(3,n*r*2,Uint16Array);for(let f=0;f<l;++f){const o=f/r,l=o*Math.PI*2,c=Math.sin(l),h=e+c*t,v=Math.cos(l),m=v*t;for(let e=0;e<a;++e){const t=e/n,r=i+t*s,a=Math.sin(r),l=Math.cos(r),f=a*h,b=l*h,g=a*c,_=l*c;u.push(f,m,b),p.push(g,v,_),d.push(t,1-o)}}for(let f=0;f<r;++f)for(let e=0;e<n;++e){const t=1+e,n=1+f;h.push(a*f+e,a*n+e,a*f+t),h.push(a*n+e,a*n+t,a*f+t)}return{position:u,normal:p,texcoord:d,indices:h}}function vr(e,t,n,r,i){if(t<3)throw new Error("divisions must be at least 3");i=i||1,r=r||0;const o=(t+1)*((n=n||1)+1),s=$n(3,o),a=$n(3,o),l=$n(2,o),c=$n(3,n*t*2,Uint16Array);let u=0;const p=e-r,d=t+1;for(let h=0;h<=n;++h){const e=r+p*Math.pow(h/n,i);for(let r=0;r<=t;++r){const i=2*Math.PI*r/t,o=e*Math.cos(i),p=e*Math.sin(i);if(s.push(o,0,p),a.push(0,1,0),l.push(1-r/t,h/n),h>0&&r!==t){const e=u+(r+1),t=u+r,n=u+r-d,i=u+(r+1)-d;c.push(e,t,n),c.push(e,n,i)}}u+=t+1}return{position:s,normal:a,texcoord:l,indices:c}}function mr(e){return function(t){const n=e.apply(this,Array.prototype.slice.call(arguments,1));return Kn(t,n)}}function br(e){return function(t){const n=e.apply(null,Array.prototype.slice.call(arguments,1));return Hn(t,n)}}const gr=["numComponents","size","type","normalize","stride","offset","attrib","name","attribName"];function _r(e,t,n,r){r=r||0;const i=e.length;for(let o=0;o<i;++o)t[n+o]=e[o]+r}function wr(e,t){const n=qn(e),r=new n.constructor(t);let i=r;var o,s;return n.numComponents&&n.numElements&&Yn(r,n.numComponents),e.data&&(i={data:r},o=e,s=i,gr.forEach((function(e){const t=o[e];void 0!==t&&(s[e]=t)}))),i}const xr=br(pr),yr=mr(pr),Er=br(lr),Pr=mr(lr),Cr=br(or),Ar=mr(or),Sr=br(sr),kr=mr(sr),Tr=br(cr),Lr=mr(cr),Rr=br(ir),Ir=mr(ir),Fr=br(dr),Mr=mr(dr),Vr=br(hr),Or=mr(hr),Nr=br(fr),Br=mr(fr),Dr=br(vr),zr=mr(vr),Ur=Fr,jr=Mr,Gr=dr;var Wr=Object.freeze({__proto__:null,create3DFBufferInfo:xr,create3DFBuffers:yr,create3DFVertices:pr,createAugmentedTypedArray:$n,createCubeBufferInfo:Er,createCubeBuffers:Pr,createCubeVertices:lr,createPlaneBufferInfo:Cr,createPlaneBuffers:Ar,createPlaneVertices:or,createSphereBufferInfo:Sr,createSphereBuffers:kr,createSphereVertices:sr,createTruncatedConeBufferInfo:Tr,createTruncatedConeBuffers:Lr,createTruncatedConeVertices:cr,createXYQuadBufferInfo:Rr,createXYQuadBuffers:Ir,createXYQuadVertices:ir,createCresentBufferInfo:Ur,createCresentBuffers:jr,createCresentVertices:Gr,createCrescentBufferInfo:Fr,createCrescentBuffers:Mr,createCrescentVertices:dr,createCylinderBufferInfo:Vr,createCylinderBuffers:Or,createCylinderVertices:hr,createTorusBufferInfo:Nr,createTorusBuffers:Br,createTorusVertices:fr,createDiscBufferInfo:Dr,createDiscBuffers:zr,createDiscVertices:vr,deindexVertices:function(e){const t=e.indices,n={},r=t.length;return Object.keys(e).filter(Qn).forEach((function(i){const o=e[i],s=o.numComponents,a=$n(s,r,o.constructor);for(let e=0;e<r;++e){const n=t[e]*s;for(let e=0;e<s;++e)a.push(o[n+e])}n[i]=a})),n},flattenNormals:function(e){if(e.indices)throw new Error("can not flatten normals of indexed vertices. deindex them first");const t=e.normal,n=t.length;for(let r=0;r<n;r+=9){const e=t[r+0],n=t[r+1],i=t[r+2],o=t[r+3],s=t[r+4],a=t[r+5];let l=e+o+t[r+6],c=n+s+t[r+7],u=i+a+t[r+8];const p=Math.sqrt(l*l+c*c+u*u);l/=p,c/=p,u/=p,t[r+0]=l,t[r+1]=c,t[r+2]=u,t[r+3]=l,t[r+4]=c,t[r+5]=u,t[r+6]=l,t[r+7]=c,t[r+8]=u}return e},makeRandomVertexColors:function(e,t){t=t||{};const n=e.position.numElements,r=$n(4,n,Uint8Array),i=t.rand||function(e,t){return t<3?(n=256,Math.random()*n|0):255;var n};if(e.color=r,e.indices)for(let o=0;o<n;++o)r.push(i(o,0),i(o,1),i(o,2),i(o,3));else{const e=t.vertsPerColor||3,o=n/e;for(let t=0;t<o;++t){const n=[i(t,0),i(t,1),i(t,2),i(t,3)];for(let t=0;t<e;++t)r.push(n)}}return e},reorientDirections:er,reorientNormals:tr,reorientPositions:nr,reorientVertices:rr,concatVertices:function(e){const t={};let n;for(let o=0;o<e.length;++o){const r=e[o];Object.keys(r).forEach((function(e){t[e]||(t[e]=[]),n||"indices"===e||(n=e);const i=r[e],o=Xn(i,e),s=qn(i).length/o;t[e].push(s)}))}const r=t[n],i={};return Object.keys(t).forEach((function(t){const n=function(t){let n,r=0;for(let i=0;i<e.length;++i){const o=e[i][t];r+=qn(o).length,n&&!o.data||(n=o)}return{length:r,spec:n}}(t),o=wr(n.spec,n.length);!function(t,n,r){let i=0,o=0;for(let s=0;s<e.length;++s){const a=e[s][t],l=qn(a);"indices"===t?(_r(l,r,o,i),i+=n[s]):_r(l,r,o),o+=l.length}}(t,r,qn(o)),i[t]=o})),i},duplicateVertices:function(e){const t={};return Object.keys(e).forEach((function(n){const r=e[n],i=qn(r),o=wr(r,i.length);_r(i,qn(o),0),t[n]=o})),t}});function Hr(e){return!!e.texStorage2D}const Kr=function(){const e={},t={};return function(n,r){return function(n){const r=n.constructor.name;if(!e[r]){for(const e in n)if("number"==typeof n[e]){const r=t[n[e]];t[n[e]]=r?`${r} | ${e}`:e}e[r]=!0}}(n),t[r]||("number"==typeof r?`0x${r.toString(16)}`:r)}}(),qr={textureColor:new Uint8Array([128,192,255,255]),textureOptions:{},crossOrigin:void 0},Xr=xn,Yr=function(){let e;return function(){return e=e||("undefined"!=typeof document&&document.createElement?document.createElement("canvas").getContext("2d"):null),e}}(),$r=6407,Qr=6408,Zr=6402,Jr=33071,ei=3553,ti=34067,ni=32879,ri=35866,ii=34069,oi=10241,si=10240,ai=10242,li=10243,ci=3317,ui=5120,pi=5121,di=5122,hi=5123,fi=5124,vi=5125,mi=5126,bi=5131,gi=36193,_i=33640,wi=33319,xi=33320,yi=6403,Ei=36244,Pi=36248,Ci=36249;let Ai;function Si(e){if(!Ai){const e={};e[6406]={textureFormat:6406,colorRenderable:!0,textureFilterable:!0,bytesPerElement:[1,2,2,4],type:[pi,bi,gi,mi]},e[6409]={textureFormat:6409,colorRenderable:!0,textureFilterable:!0,bytesPerElement:[1,2,2,4],type:[pi,bi,gi,mi]},e[6410]={textureFormat:6410,colorRenderable:!0,textureFilterable:!0,bytesPerElement:[2,4,4,8],type:[pi,bi,gi,mi]},e[$r]={textureFormat:$r,colorRenderable:!0,textureFilterable:!0,bytesPerElement:[3,6,6,12,2],type:[pi,bi,gi,mi,33635]},e[6408]={textureFormat:Qr,colorRenderable:!0,textureFilterable:!0,bytesPerElement:[4,8,8,16,2,2],type:[pi,bi,gi,mi,32819,32820]},e[6402]={textureFormat:Zr,colorRenderable:!0,textureFilterable:!1,bytesPerElement:[2,4],type:[vi,hi]},e[33321]={textureFormat:yi,colorRenderable:!0,textureFilterable:!0,bytesPerElement:[1],type:[pi]},e[36756]={textureFormat:yi,colorRenderable:!1,textureFilterable:!0,bytesPerElement:[1],type:[ui]},e[33325]={textureFormat:yi,colorRenderable:!1,textureFilterable:!0,bytesPerElement:[4,2],type:[mi,bi]},e[33326]={textureFormat:yi,colorRenderable:!1,textureFilterable:!1,bytesPerElement:[4],type:[mi]},e[33330]={textureFormat:Ei,colorRenderable:!0,textureFilterable:!1,bytesPerElement:[1],type:[pi]},e[33329]={textureFormat:Ei,colorRenderable:!0,textureFilterable:!1,bytesPerElement:[1],type:[ui]},e[33332]={textureFormat:Ei,colorRenderable:!0,textureFilterable:!1,bytesPerElement:[2],type:[hi]},e[33331]={textureFormat:Ei,colorRenderable:!0,textureFilterable:!1,bytesPerElement:[2],type:[di]},e[33334]={textureFormat:Ei,colorRenderable:!0,textureFilterable:!1,bytesPerElement:[4],type:[vi]},e[33333]={textureFormat:Ei,colorRenderable:!0,textureFilterable:!1,bytesPerElement:[4],type:[fi]},e[33323]={textureFormat:wi,colorRenderable:!0,textureFilterable:!0,bytesPerElement:[2],type:[pi]},e[36757]={textureFormat:wi,colorRenderable:!1,textureFilterable:!0,bytesPerElement:[2],type:[ui]},e[33327]={textureFormat:wi,colorRenderable:!1,textureFilterable:!0,bytesPerElement:[8,4],type:[mi,bi]},e[33328]={textureFormat:wi,colorRenderable:!1,textureFilterable:!1,bytesPerElement:[8],type:[mi]},e[33336]={textureFormat:xi,colorRenderable:!0,textureFilterable:!1,bytesPerElement:[2],type:[pi]},e[33335]={textureFormat:xi,colorRenderable:!0,textureFilterable:!1,bytesPerElement:[2],type:[ui]},e[33338]={textureFormat:xi,colorRenderable:!0,textureFilterable:!1,bytesPerElement:[4],type:[hi]},e[33337]={textureFormat:xi,colorRenderable:!0,textureFilterable:!1,bytesPerElement:[4],type:[di]},e[33340]={textureFormat:xi,colorRenderable:!0,textureFilterable:!1,bytesPerElement:[8],type:[vi]},e[33339]={textureFormat:xi,colorRenderable:!0,textureFilterable:!1,bytesPerElement:[8],type:[fi]},e[32849]={textureFormat:$r,colorRenderable:!0,textureFilterable:!0,bytesPerElement:[3],type:[pi]},e[35905]={textureFormat:$r,colorRenderable:!1,textureFilterable:!0,bytesPerElement:[3],type:[pi]},e[36194]={textureFormat:$r,colorRenderable:!0,textureFilterable:!0,bytesPerElement:[3,2],type:[pi,33635]},e[36758]={textureFormat:$r,colorRenderable:!1,textureFilterable:!0,bytesPerElement:[3],type:[ui]},e[35898]={textureFormat:$r,colorRenderable:!1,textureFilterable:!0,bytesPerElement:[12,6,4],type:[mi,bi,35899]},e[35901]={textureFormat:$r,colorRenderable:!1,textureFilterable:!0,bytesPerElement:[12,6,4],type:[mi,bi,35902]},e[34843]={textureFormat:$r,colorRenderable:!1,textureFilterable:!0,bytesPerElement:[12,6],type:[mi,bi]},e[34837]={textureFormat:$r,colorRenderable:!1,textureFilterable:!1,bytesPerElement:[12],type:[mi]},e[36221]={textureFormat:Pi,colorRenderable:!1,textureFilterable:!1,bytesPerElement:[3],type:[pi]},e[36239]={textureFormat:Pi,colorRenderable:!1,textureFilterable:!1,bytesPerElement:[3],type:[ui]},e[36215]={textureFormat:Pi,colorRenderable:!1,textureFilterable:!1,bytesPerElement:[6],type:[hi]},e[36233]={textureFormat:Pi,colorRenderable:!1,textureFilterable:!1,bytesPerElement:[6],type:[di]},e[36209]={textureFormat:Pi,colorRenderable:!1,textureFilterable:!1,bytesPerElement:[12],type:[vi]},e[36227]={textureFormat:Pi,colorRenderable:!1,textureFilterable:!1,bytesPerElement:[12],type:[fi]},e[32856]={textureFormat:Qr,colorRenderable:!0,textureFilterable:!0,bytesPerElement:[4],type:[pi]},e[35907]={textureFormat:Qr,colorRenderable:!0,textureFilterable:!0,bytesPerElement:[4],type:[pi]},e[36759]={textureFormat:Qr,colorRenderable:!1,textureFilterable:!0,bytesPerElement:[4],type:[ui]},e[32855]={textureFormat:Qr,colorRenderable:!0,textureFilterable:!0,bytesPerElement:[4,2,4],type:[pi,32820,_i]},e[32854]={textureFormat:Qr,colorRenderable:!0,textureFilterable:!0,bytesPerElement:[4,2],type:[pi,32819]},e[32857]={textureFormat:Qr,colorRenderable:!0,textureFilterable:!0,bytesPerElement:[4],type:[_i]},e[34842]={textureFormat:Qr,colorRenderable:!1,textureFilterable:!0,bytesPerElement:[16,8],type:[mi,bi]},e[34836]={textureFormat:Qr,colorRenderable:!1,textureFilterable:!1,bytesPerElement:[16],type:[mi]},e[36220]={textureFormat:Ci,colorRenderable:!0,textureFilterable:!1,bytesPerElement:[4],type:[pi]},e[36238]={textureFormat:Ci,colorRenderable:!0,textureFilterable:!1,bytesPerElement:[4],type:[ui]},e[36975]={textureFormat:Ci,colorRenderable:!0,textureFilterable:!1,bytesPerElement:[4],type:[_i]},e[36214]={textureFormat:Ci,colorRenderable:!0,textureFilterable:!1,bytesPerElement:[8],type:[hi]},e[36232]={textureFormat:Ci,colorRenderable:!0,textureFilterable:!1,bytesPerElement:[8],type:[di]},e[36226]={textureFormat:Ci,colorRenderable:!0,textureFilterable:!1,bytesPerElement:[16],type:[fi]},e[36208]={textureFormat:Ci,colorRenderable:!0,textureFilterable:!1,bytesPerElement:[16],type:[vi]},e[33189]={textureFormat:Zr,colorRenderable:!0,textureFilterable:!1,bytesPerElement:[2,4],type:[hi,vi]},e[33190]={textureFormat:Zr,colorRenderable:!0,textureFilterable:!1,bytesPerElement:[4],type:[vi]},e[36012]={textureFormat:Zr,colorRenderable:!0,textureFilterable:!1,bytesPerElement:[4],type:[mi]},e[35056]={textureFormat:34041,colorRenderable:!0,textureFilterable:!1,bytesPerElement:[4],type:[34042]},e[36013]={textureFormat:34041,colorRenderable:!0,textureFilterable:!1,bytesPerElement:[4],type:[36269]},Object.keys(e).forEach((function(t){const n=e[t];n.bytesPerElementMap={},n.bytesPerElement.forEach((function(e,t){const r=n.type[t];n.bytesPerElementMap[r]=e}))})),Ai=e}return Ai[e]}function ki(e){const t=Si(e);if(!t)throw"unknown internal format";return{format:t.textureFormat,type:t.type[0]}}function Ti(e){return 0==(e&e-1)}function Li(e,t,n){return Xr(t)?gn(t):n||pi}function Ri(e,t,n,r,i){if(i%1!=0)throw"can't guess dimensions";if(n||r){if(r){if(!n&&(n=i/r)%1)throw"can't guess dimensions"}else if((r=i/n)%1)throw"can't guess dimensions"}else{const e=Math.sqrt(i/(t===ti?6:1));e%1==0?(n=e,r=e):(n=i,r=1)}return{width:n,height:r}}function Ii(e,t){void 0!==t.colorspaceConversion&&e.pixelStorei(37443,t.colorspaceConversion),void 0!==t.premultiplyAlpha&&e.pixelStorei(37441,t.premultiplyAlpha),void 0!==t.flipY&&e.pixelStorei(37440,t.flipY)}function Fi(e){e.pixelStorei(ci,4),Hr(e)&&(e.pixelStorei(3314,0),e.pixelStorei(32878,0),e.pixelStorei(3316,0),e.pixelStorei(3315,0),e.pixelStorei(32877,0))}function Mi(e,t,n,r){var i;r.minMag&&(n.call(e,t,oi,r.minMag),n.call(e,t,si,r.minMag)),r.min&&n.call(e,t,oi,r.min),r.mag&&n.call(e,t,si,r.mag),r.wrap&&(n.call(e,t,ai,r.wrap),n.call(e,t,li,r.wrap),(t===ni||(i=t,"undefined"!=typeof WebGLSampler&&Cn(i,"WebGLSampler")))&&n.call(e,t,32882,r.wrap)),r.wrapR&&n.call(e,t,32882,r.wrapR),r.wrapS&&n.call(e,t,ai,r.wrapS),r.wrapT&&n.call(e,t,li,r.wrapT),r.minLod&&n.call(e,t,33082,r.minLod),r.maxLod&&n.call(e,t,33083,r.maxLod),r.baseLevel&&n.call(e,t,33084,r.baseLevel),r.maxLevel&&n.call(e,t,33085,r.maxLevel)}function Vi(e,t,n){const r=n.target||ei;e.bindTexture(r,t),Mi(e,r,e.texParameteri,n)}function Oi(e,t,n,r,i,o){o=o||Qr;const s=(n=n||qr.textureOptions).target||ei;if(r=r||n.width,i=i||n.height,e.bindTexture(s,t),function(e,t,n,r){if(!Hr(e))return Ti(t)&&Ti(n);const i=Si(r);if(!i)throw"unknown internal format";return i.colorRenderable&&i.textureFilterable}(e,r,i,o))e.generateMipmap(s);else{const t=function(e){const t=Si(e);if(!t)throw"unknown internal format";return t.textureFilterable}(o)?9729:9728;e.texParameteri(s,oi,t),e.texParameteri(s,si,t),e.texParameteri(s,ai,Jr),e.texParameteri(s,li,Jr)}}function Ni(e){return!0===e.auto||void 0===e.auto&&void 0===e.level}function Bi(e,t){return(t=t||{}).cubeFaceOrder||[ii,34070,34071,34072,34073,34074]}function Di(e,t){const n=Bi(0,t).map((function(e,t){return{face:e,ndx:t}}));return n.sort((function(e,t){return e.face-t.face})),n}function zi(e,t,n,r){const i=(r=r||qr.textureOptions).target||ei,o=r.level||0;let s=n.width,a=n.height;const l=r.internalFormat||r.format||Qr,c=ki(l),u=r.format||c.format,p=r.type||c.type;if(Ii(e,r),e.bindTexture(i,t),i===ti){const c=n.width,d=n.height;let h,f;if(c/6===d)h=d,f=[0,0,1,0,2,0,3,0,4,0,5,0];else if(d/6===c)h=c,f=[0,0,0,1,0,2,0,3,0,4,0,5];else if(c/3==d/2)h=c/3,f=[0,0,1,0,2,0,0,1,1,1,2,1];else{if(c/2!=d/3)throw"can't figure out cube map from element: "+(n.src?n.src:n.nodeName);h=c/2,f=[0,0,1,0,0,1,1,1,0,2,1,2]}const v=Yr();v?(v.canvas.width=h,v.canvas.height=h,s=h,a=h,Di(0,r).forEach((function(t){const r=f[2*t.ndx+0]*h,i=f[2*t.ndx+1]*h;v.drawImage(n,r,i,h,h,0,0,h,h),e.texImage2D(t.face,o,l,u,p,v.canvas)})),v.canvas.width=1,v.canvas.height=1):"undefined"!=typeof createImageBitmap&&(s=h,a=h,Di(0,r).forEach((function(c){const d=f[2*c.ndx+0]*h,v=f[2*c.ndx+1]*h;e.texImage2D(c.face,o,l,h,h,0,u,p,null),createImageBitmap(n,d,v,h,h,{premultiplyAlpha:"none",colorSpaceConversion:"none"}).then((function(n){Ii(e,r),e.bindTexture(i,t),e.texImage2D(c.face,o,l,u,p,n),Ni(r)&&Oi(e,t,r,s,a,l)}))})))}else if(i===ni||i===ri){const t=Math.min(n.width,n.height),r=Math.max(n.width,n.height),s=r/t;if(s%1!=0)throw"can not compute 3D dimensions of element";const a=n.width===r?1:0,c=n.height===r?1:0;e.pixelStorei(ci,1),e.pixelStorei(3314,n.width),e.pixelStorei(32878,0),e.pixelStorei(32877,0),e.texImage3D(i,o,l,t,t,t,0,u,p,null);for(let l=0;l<s;++l){const r=l*t*a,s=l*t*c;e.pixelStorei(3316,r),e.pixelStorei(3315,s),e.texSubImage3D(i,o,0,0,l,t,t,1,u,p,n)}Fi(e)}else e.texImage2D(i,o,l,u,p,n);Ni(r)&&Oi(e,t,r,s,a,l),Vi(e,t,r)}function Ui(){}function ji(e,t){return void 0!==t||function(e){if("undefined"!=typeof document){const t=document.createElement("a");return t.href=e,t.hostname===location.hostname&&t.port===location.port&&t.protocol===location.protocol}{const t=new URL(location.href).origin;return new URL(e,location.href).origin===t}}(e)?t:"anonymous"}function Gi(e){return"undefined"!=typeof ImageBitmap&&e instanceof ImageBitmap||"undefined"!=typeof ImageData&&e instanceof ImageData||"undefined"!=typeof HTMLElement&&e instanceof HTMLElement}function Wi(e,t,n){return Gi(e)?(setTimeout((function(){n(null,e)})),e):function(e,t,n){let r;if(n=n||Ui,t=ji(e,t=void 0!==t?t:qr.crossOrigin),"undefined"!=typeof Image){r=new Image,void 0!==t&&(r.crossOrigin=t);const i=function(){r.removeEventListener("error",o),r.removeEventListener("load",s),r=null},o=function(){const t="couldn't load image: "+e;yn(t),n(t,r),i()},s=function(){n(null,r),i()};return r.addEventListener("error",o),r.addEventListener("load",s),r.src=e,r}if("undefined"!=typeof ImageBitmap){let i,o;const s=function(){n(i,o)},a={};t&&(a.mode="cors"),fetch(e,a).then((function(e){if(!e.ok)throw e;return e.blob()})).then((function(e){return createImageBitmap(e,{premultiplyAlpha:"none",colorSpaceConversion:"none"})})).then((function(e){o=e,setTimeout(s)})).catch((function(e){i=e,setTimeout(s)})),r=null}return r}(e,t,n)}function Hi(e,t,n){const r=(n=n||qr.textureOptions).target||ei;if(e.bindTexture(r,t),!1===n.color)return;const i=function(e){return Xr(e=e||qr.textureColor)?e:new Uint8Array([255*e[0],255*e[1],255*e[2],255*e[3]])}(n.color);if(r===ti)for(let o=0;o<6;++o)e.texImage2D(ii+o,0,Qr,1,1,0,Qr,pi,i);else r===ni||r===ri?e.texImage3D(r,0,Qr,1,1,1,0,Qr,pi,i):e.texImage2D(r,0,Qr,1,1,0,Qr,pi,i)}function Ki(e,t,n,r){r=r||Ui;const i=n.src;if(6!==i.length)throw"there must be 6 urls for a cubemap";const o=n.level||0,s=n.internalFormat||n.format||Qr,a=ki(s),l=n.format||a.format,c=n.type||pi,u=n.target||ei;if(u!==ti)throw"target must be TEXTURE_CUBE_MAP";Hi(e,t,n),n=Object.assign({},n);let p=6;const d=[],h=Bi(0,n);let f;f=i.map((function(i,a){return Wi(i,n.crossOrigin,(v=h[a],function(i,a){--p,i?d.push(i):a.width!==a.height?d.push("cubemap face img is not a square: "+a.src):(Ii(e,n),e.bindTexture(u,t),5===p?Bi().forEach((function(t){e.texImage2D(t,o,s,l,c,a)})):e.texImage2D(v,o,s,l,c,a),Ni(n)&&e.generateMipmap(u)),0===p&&r(d.length?d:void 0,t,f)}));var v}))}function qi(e,t,n,r){r=r||Ui;const i=n.src,o=n.internalFormat||n.format||Qr,s=ki(o),a=n.format||s.format,l=n.type||pi,c=n.target||ri;if(c!==ni&&c!==ri)throw"target must be TEXTURE_3D or TEXTURE_2D_ARRAY";Hi(e,t,n),n=Object.assign({},n);let u=i.length;const p=[];let d;const h=n.level||0;let f=n.width,v=n.height;const m=i.length;let b=!0;d=i.map((function(i,s){return Wi(i,n.crossOrigin,(g=s,function(i,s){if(--u,i)p.push(i);else{if(Ii(e,n),e.bindTexture(c,t),b){b=!1,f=n.width||s.width,v=n.height||s.height,e.texImage3D(c,h,o,f,v,m,0,a,l,null);for(let t=0;t<m;++t)e.texSubImage3D(c,h,0,0,t,f,v,1,a,l,s)}else{let t,n=s;s.width===f&&s.height===v||(t=Yr(),n=t.canvas,t.canvas.width=f,t.canvas.height=v,t.drawImage(s,0,0,f,v)),e.texSubImage3D(c,h,0,0,g,f,v,1,a,l,n),t&&n===t.canvas&&(t.canvas.width=0,t.canvas.height=0)}Ni(n)&&e.generateMipmap(c)}0===u&&r(p.length?p:void 0,t,d)}));var g}))}function Xi(e,t,n,r){const i=(r=r||qr.textureOptions).target||ei;e.bindTexture(i,t);let o=r.width,s=r.height,a=r.depth;const l=r.level||0,c=r.internalFormat||r.format||Qr,u=ki(c),p=r.format||u.format,d=r.type||Li(0,n,u.type);if(Xr(n))n instanceof Uint8ClampedArray&&(n=new Uint8Array(n.buffer));else{const e=wn(d);n=new e(n)}const h=function(e,t){const n=Si(e);if(!n)throw"unknown internal format";const r=n.bytesPerElementMap[t];if(void 0===r)throw"unknown internal format";return r}(c,d),f=n.byteLength/h;if(f%1)throw"length wrong size for format: "+Kr(e,p);let v;if(i===ni||i===ri)if(o||s||a)!o||s&&a?!s||o&&a?(v=Ri(0,i,o,s,f/a),o=v.width,s=v.height):(v=Ri(0,i,o,a,f/s),o=v.width,a=v.height):(v=Ri(0,i,s,a,f/o),s=v.width,a=v.height);else{const e=Math.cbrt(f);if(e%1!=0)throw"can't guess cube size of array of numElements: "+f;o=e,s=e,a=e}else v=Ri(0,i,o,s,f),o=v.width,s=v.height;if(Fi(e),e.pixelStorei(ci,r.unpackAlignment||1),Ii(e,r),i===ti){const t=f/6*(h/n.BYTES_PER_ELEMENT);Di(0,r).forEach((r=>{const i=t*r.ndx,a=n.subarray(i,i+t);e.texImage2D(r.face,l,c,o,s,0,p,d,a)}))}else i===ni||i===ri?e.texImage3D(i,l,c,o,s,a,0,p,d,n):e.texImage2D(i,l,c,o,s,0,p,d,n);return{width:o,height:s,depth:a,type:d}}function Yi(e,t,n){n=n||Ui,t=t||qr.textureOptions;const r=e.createTexture(),i=t.target||ei;let o=t.width||1,s=t.height||1;const a=t.internalFormat||Qr;e.bindTexture(i,r),i===ti&&(e.texParameteri(i,ai,Jr),e.texParameteri(i,li,Jr));let l=t.src;if(l)if("function"==typeof l&&(l=l(e,t)),"string"==typeof l)!function(e,t,n,r){r=r||Ui,Hi(e,t,n=n||qr.textureOptions),Wi((n=Object.assign({},n)).src,n.crossOrigin,(function(i,o){i?r(i,t,o):(zi(e,t,o,n),r(null,t,o))}))}(e,r,t,n);else if(Xr(l)||Array.isArray(l)&&("number"==typeof l[0]||Array.isArray(l[0])||Xr(l[0]))){const n=Xi(e,r,l,t);o=n.width,s=n.height}else Array.isArray(l)&&("string"==typeof l[0]||Gi(l[0]))?i===ti?Ki(e,r,t,n):qi(e,r,t,n):(zi(e,r,l,t),o=l.width,s=l.height);else!function(e,t,n){const r=n.target||ei;e.bindTexture(r,t);const i=n.level||0,o=n.internalFormat||n.format||Qr,s=ki(o),a=n.format||s.format,l=n.type||s.type;if(Ii(e,n),r===ti)for(let c=0;c<6;++c)e.texImage2D(ii+c,i,o,n.width,n.height,0,a,l,null);else r===ni||r===ri?e.texImage3D(r,i,o,n.width,n.height,n.depth,0,a,l,null):e.texImage2D(r,i,o,n.width,n.height,0,a,l,null)}(e,r,t);return Ni(t)&&Oi(e,r,t,o,s,a),Vi(e,r,t),r}const $i=yn;function Qi(e){return"undefined"!=typeof document&&document.getElementById?document.getElementById(e):null}const Zi=33984,Ji=34962,eo=5126,to=5124,no=5125,ro=3553,io=34067,oo=32879,so=35866,ao={};function lo(e,t){return ao[t].bindPoint}function co(e,t){return function(n){e.uniform1i(t,n)}}function uo(e,t){return function(n){e.uniform1iv(t,n)}}function po(e,t){return function(n){e.uniform2iv(t,n)}}function ho(e,t){return function(n){e.uniform3iv(t,n)}}function fo(e,t){return function(n){e.uniform4iv(t,n)}}function vo(e,t,n,r){const i=lo(0,t);return Hr(e)?function(t){let o,s;!t||Sn(0,t)?(o=t,s=null):(o=t.texture,s=t.sampler),e.uniform1i(r,n),e.activeTexture(Zi+n),e.bindTexture(i,o),e.bindSampler(n,s)}:function(t){e.uniform1i(r,n),e.activeTexture(Zi+n),e.bindTexture(i,t)}}function mo(e,t,n,r,i){const o=lo(0,t),s=new Int32Array(i);for(let a=0;a<i;++a)s[a]=n+a;return Hr(e)?function(t){e.uniform1iv(r,s),t.forEach((function(t,r){let i,a;e.activeTexture(Zi+s[r]),Sn(0,t)?(i=t,a=null):(i=t.texture,a=t.sampler),e.bindSampler(n,a),e.bindTexture(o,i)}))}:function(t){e.uniform1iv(r,s),t.forEach((function(t,n){e.activeTexture(Zi+s[n]),e.bindTexture(o,t)}))}}function bo(e,t){return function(n){if(n.value)switch(e.disableVertexAttribArray(t),n.value.length){case 4:e.vertexAttrib4fv(t,n.value);break;case 3:e.vertexAttrib3fv(t,n.value);break;case 2:e.vertexAttrib2fv(t,n.value);break;case 1:e.vertexAttrib1fv(t,n.value);break;default:throw new Error("the length of a float constant value must be between 1 and 4!")}else e.bindBuffer(Ji,n.buffer),e.enableVertexAttribArray(t),e.vertexAttribPointer(t,n.numComponents||n.size,n.type||eo,n.normalize||!1,n.stride||0,n.offset||0),e.vertexAttribDivisor&&e.vertexAttribDivisor(t,n.divisor||0)}}function go(e,t){return function(n){if(n.value){if(e.disableVertexAttribArray(t),4!==n.value.length)throw new Error("The length of an integer constant value must be 4!");e.vertexAttrib4iv(t,n.value)}else e.bindBuffer(Ji,n.buffer),e.enableVertexAttribArray(t),e.vertexAttribIPointer(t,n.numComponents||n.size,n.type||to,n.stride||0,n.offset||0),e.vertexAttribDivisor&&e.vertexAttribDivisor(t,n.divisor||0)}}function _o(e,t){return function(n){if(n.value){if(e.disableVertexAttribArray(t),4!==n.value.length)throw new Error("The length of an unsigned integer constant value must be 4!");e.vertexAttrib4uiv(t,n.value)}else e.bindBuffer(Ji,n.buffer),e.enableVertexAttribArray(t),e.vertexAttribIPointer(t,n.numComponents||n.size,n.type||no,n.stride||0,n.offset||0),e.vertexAttribDivisor&&e.vertexAttribDivisor(t,n.divisor||0)}}function wo(e,t,n){const r=n.size,i=n.count;return function(n){e.bindBuffer(Ji,n.buffer);const o=n.size||n.numComponents||r,s=o/i,a=n.type||eo,l=ao[a].size*o,c=n.normalize||!1,u=n.offset||0,p=l/i;for(let r=0;r<i;++r)e.enableVertexAttribArray(t+r),e.vertexAttribPointer(t+r,s,a,c,l,u+p*r),e.vertexAttribDivisor&&e.vertexAttribDivisor(t+r,n.divisor||0)}}ao[5126]={Type:Float32Array,size:4,setter:function(e,t){return function(n){e.uniform1f(t,n)}},arraySetter:function(e,t){return function(n){e.uniform1fv(t,n)}}},ao[35664]={Type:Float32Array,size:8,setter:function(e,t){return function(n){e.uniform2fv(t,n)}},cols:2},ao[35665]={Type:Float32Array,size:12,setter:function(e,t){return function(n){e.uniform3fv(t,n)}},cols:3},ao[35666]={Type:Float32Array,size:16,setter:function(e,t){return function(n){e.uniform4fv(t,n)}},cols:4},ao[to]={Type:Int32Array,size:4,setter:co,arraySetter:uo},ao[35667]={Type:Int32Array,size:8,setter:po,cols:2},ao[35668]={Type:Int32Array,size:12,setter:ho,cols:3},ao[35669]={Type:Int32Array,size:16,setter:fo,cols:4},ao[5125]={Type:Uint32Array,size:4,setter:function(e,t){return function(n){e.uniform1ui(t,n)}},arraySetter:function(e,t){return function(n){e.uniform1uiv(t,n)}}},ao[36294]={Type:Uint32Array,size:8,setter:function(e,t){return function(n){e.uniform2uiv(t,n)}},cols:2},ao[36295]={Type:Uint32Array,size:12,setter:function(e,t){return function(n){e.uniform3uiv(t,n)}},cols:3},ao[36296]={Type:Uint32Array,size:16,setter:function(e,t){return function(n){e.uniform4uiv(t,n)}},cols:4},ao[35670]={Type:Uint32Array,size:4,setter:co,arraySetter:uo},ao[35671]={Type:Uint32Array,size:8,setter:po,cols:2},ao[35672]={Type:Uint32Array,size:12,setter:ho,cols:3},ao[35673]={Type:Uint32Array,size:16,setter:fo,cols:4},ao[35674]={Type:Float32Array,size:32,setter:function(e,t){return function(n){e.uniformMatrix2fv(t,!1,n)}},rows:2,cols:2},ao[35675]={Type:Float32Array,size:48,setter:function(e,t){return function(n){e.uniformMatrix3fv(t,!1,n)}},rows:3,cols:3},ao[35676]={Type:Float32Array,size:64,setter:function(e,t){return function(n){e.uniformMatrix4fv(t,!1,n)}},rows:4,cols:4},ao[35685]={Type:Float32Array,size:32,setter:function(e,t){return function(n){e.uniformMatrix2x3fv(t,!1,n)}},rows:2,cols:3},ao[35686]={Type:Float32Array,size:32,setter:function(e,t){return function(n){e.uniformMatrix2x4fv(t,!1,n)}},rows:2,cols:4},ao[35687]={Type:Float32Array,size:48,setter:function(e,t){return function(n){e.uniformMatrix3x2fv(t,!1,n)}},rows:3,cols:2},ao[35688]={Type:Float32Array,size:48,setter:function(e,t){return function(n){e.uniformMatrix3x4fv(t,!1,n)}},rows:3,cols:4},ao[35689]={Type:Float32Array,size:64,setter:function(e,t){return function(n){e.uniformMatrix4x2fv(t,!1,n)}},rows:4,cols:2},ao[35690]={Type:Float32Array,size:64,setter:function(e,t){return function(n){e.uniformMatrix4x3fv(t,!1,n)}},rows:4,cols:3},ao[35678]={Type:null,size:0,setter:vo,arraySetter:mo,bindPoint:ro},ao[35680]={Type:null,size:0,setter:vo,arraySetter:mo,bindPoint:io},ao[35679]={Type:null,size:0,setter:vo,arraySetter:mo,bindPoint:oo},ao[35682]={Type:null,size:0,setter:vo,arraySetter:mo,bindPoint:ro},ao[36289]={Type:null,size:0,setter:vo,arraySetter:mo,bindPoint:so},ao[36292]={Type:null,size:0,setter:vo,arraySetter:mo,bindPoint:so},ao[36293]={Type:null,size:0,setter:vo,arraySetter:mo,bindPoint:io},ao[36298]={Type:null,size:0,setter:vo,arraySetter:mo,bindPoint:ro},ao[36299]={Type:null,size:0,setter:vo,arraySetter:mo,bindPoint:oo},ao[36300]={Type:null,size:0,setter:vo,arraySetter:mo,bindPoint:io},ao[36303]={Type:null,size:0,setter:vo,arraySetter:mo,bindPoint:so},ao[36306]={Type:null,size:0,setter:vo,arraySetter:mo,bindPoint:ro},ao[36307]={Type:null,size:0,setter:vo,arraySetter:mo,bindPoint:oo},ao[36308]={Type:null,size:0,setter:vo,arraySetter:mo,bindPoint:io},ao[36311]={Type:null,size:0,setter:vo,arraySetter:mo,bindPoint:so};const xo={};xo[5126]={size:4,setter:bo},xo[35664]={size:8,setter:bo},xo[35665]={size:12,setter:bo},xo[35666]={size:16,setter:bo},xo[to]={size:4,setter:go},xo[35667]={size:8,setter:go},xo[35668]={size:12,setter:go},xo[35669]={size:16,setter:go},xo[5125]={size:4,setter:_o},xo[36294]={size:8,setter:_o},xo[36295]={size:12,setter:_o},xo[36296]={size:16,setter:_o},xo[35670]={size:4,setter:go},xo[35671]={size:8,setter:go},xo[35672]={size:12,setter:go},xo[35673]={size:16,setter:go},xo[35674]={size:4,setter:wo,count:2},xo[35675]={size:9,setter:wo,count:3},xo[35676]={size:16,setter:wo,count:4};const yo=/ERROR:\s*\d+:(\d+)/gi;const Eo=/^[ \t]*\n/;function Po(e){let t=0;return Eo.test(e)&&(t=1,e=e.replace(Eo,"")),{lineOffset:t,shaderSource:e}}function Co(e,t,n,r){r=r||$i;if(!e.getShaderParameter(n,35713)){const i=e.getShaderInfoLog(n),{lineOffset:o,shaderSource:s}=Po(e.getShaderSource(n)),a=`${function(e,t="",n=0){const r=[...t.matchAll(yo)],i=new Map(r.map(((e,n)=>{const i=parseInt(e[1]),o=r[n+1],s=o?o.index:t.length;return[i-1,t.substring(e.index,s)]})));return e.split("\n").map(((e,t)=>{const r=i.get(t);return`${t+1+n}: ${e}${r?`\n\n^^^ ${r}`:""}`})).join("\n")}(s,i,o)}\nError compiling ${Kr(e,t)}: ${i}`;return r(a),a}return""}function Ao(e,t,n){let r,i,o;if("function"==typeof t&&(n=t,t=void 0),"function"==typeof e)n=e,e=void 0;else if(e&&!Array.isArray(e)){const t=e;n=t.errorCallback,e=t.attribLocations,r=t.transformFeedbackVaryings,i=t.transformFeedbackMode,o=t.callback}const s=n||$i,a=[],l={errorCallback(e,...t){a.push(e),s(e,...t)},transformFeedbackVaryings:r,transformFeedbackMode:i,callback:o,errors:a};{let n={};Array.isArray(e)?e.forEach((function(e,r){n[e]=t?t[r]:r})):n=e||{},l.attribLocations=n}return l}const So=["VERTEX_SHADER","FRAGMENT_SHADER"];const ko=(e=0)=>new Promise((t=>setTimeout(t,e)));function To(e,t,n,r,i){const o=Ao(n,r,i),s=new Set(t),a=function(e,t,n){const r=e.createProgram(),{attribLocations:i,transformFeedbackVaryings:o,transformFeedbackMode:s}=Ao(n);for(let l=0;l<t.length;++l){let n=t[l];if("string"==typeof n){const t=Qi(n),i=t?t.text:n;let o=e[So[l]];t&&t.type&&(o=((a=t.type).indexOf("frag")>=0?35632:a.indexOf("vert")>=0?35633:void 0)||o),n=e.createShader(o),e.shaderSource(n,Po(i).shaderSource),e.compileShader(n),e.attachShader(r,n)}}var a;Object.entries(i).forEach((([t,n])=>e.bindAttribLocation(r,n,t)));{let t=o;t&&(t.attribs&&(t=t.attribs),Array.isArray(t)||(t=Object.keys(t)),e.transformFeedbackVaryings(r,t,s||35981))}return e.linkProgram(r),r}(e,t,o);function l(e,t){const n=function(e,t,n){n=n||$i;const r=e.getProgramParameter(t,35714);if(!r){const r=e.getProgramInfoLog(t);n(`Error in program linking: ${r}`);return`${r}\n${e.getAttachedShaders(t).map((t=>Co(e,e.getShaderParameter(t,e.SHADER_TYPE),t,n))).filter((e=>e)).join("\n")}`}return}(e,t,o.errorCallback);return n&&function(e,t,n){const r=e.getAttachedShaders(t);for(const i of r)n.has(i)&&e.deleteShader(i);e.deleteProgram(t)}(e,t,s),n}if(!o.callback)return l(e,a)?void 0:a;(async function(e,t){const n=e.getExtension("KHR_parallel_shader_compile"),r=n?(e,t)=>e.getProgramParameter(t,n.COMPLETION_STATUS_KHR):()=>!0;let i=0;do{await ko(i),i=1e3/60}while(!r(e,t))})(e,a).then((()=>{const t=l(e,a);o.callback(t,t?void 0:a)}))}function Lo(e){const t=e.name;return t.startsWith("gl_")||t.startsWith("webgl_")}const Ro=/(\.|\[|]|\w+)/g;function Io(e,t,n,r){const i=e.split(Ro).filter((e=>""!==e));let o=0,s="";for(;;){const e=i[o++];s+=e;const l=(a=e[0])>="0"&&a<="9",c=l?parseInt(e):e;l&&(s+=i[o++]);if(o===i.length){n[c]=t;break}{const e=i[o++],t="["===e,a=n[c]||(t?[]:{});n[c]=a,n=a,r[s]=r[s]||function(e){return function(t){Fo(e,t)}}(a),s+=e}}var a}function Fo(e,t){for(const n in t){const r=e[n];"function"==typeof r?r(t[n]):Fo(e[n],t[n])}}function Mo(e,...t){const n=e.uniformSetters||e,r=t.length;for(let i=0;i<r;++i){const e=t[i];if(Array.isArray(e)){const t=e.length;for(let r=0;r<t;++r)Mo(n,e[r])}else for(const t in e){const r=n[t];r&&r(e[t])}}}function Vo(e,t){const n=function(e,t){let n=0;function r(t,r,i){const o=r.name.endsWith("[0]"),s=r.type,a=ao[s];if(!a)throw new Error(`unknown type: 0x${s.toString(16)}`);let l;if(a.bindPoint){const t=n;n+=r.size,l=o?a.arraySetter(e,s,t,i,r.size):a.setter(e,s,t,i,r.size)}else l=a.arraySetter&&o?a.arraySetter(e,i):a.setter(e,i);return l.location=i,l}const i={},o={},s=e.getProgramParameter(t,35718);for(let a=0;a<s;++a){const n=e.getActiveUniform(t,a);if(Lo(n))continue;let s=n.name;s.endsWith("[0]")&&(s=s.substr(0,s.length-3));const l=e.getUniformLocation(t,n.name);if(l){const e=r(0,n,l);i[s]=e,Io(s,e,o,i)}}return i}(e,t),r=function(e,t){const n={},r=e.getProgramParameter(t,35721);for(let i=0;i<r;++i){const r=e.getActiveAttrib(t,i);if(Lo(r))continue;const o=e.getAttribLocation(t,r.name),s=xo[r.type],a=s.setter(e,o,s);a.location=o,n[r.name]=a}return n}(e,t),i={program:t,uniformSetters:n,attribSetters:r};return Hr(e)&&(i.uniformBlockSpec=function(e,t){const n=e.getProgramParameter(t,35718),r=[],i=[];for(let a=0;a<n;++a){i.push(a),r.push({});const n=e.getActiveUniform(t,a);r[a].name=n.name}[["UNIFORM_TYPE","type"],["UNIFORM_SIZE","size"],["UNIFORM_BLOCK_INDEX","blockNdx"],["UNIFORM_OFFSET","offset"]].forEach((function(n){const o=n[0],s=n[1];e.getActiveUniforms(t,i,e[o]).forEach((function(e,t){r[t][s]=e}))}));const o={},s=e.getProgramParameter(t,35382);for(let a=0;a<s;++a){const n=e.getActiveUniformBlockName(t,a),r={index:e.getUniformBlockIndex(t,n),usedByVertexShader:e.getActiveUniformBlockParameter(t,a,35396),usedByFragmentShader:e.getActiveUniformBlockParameter(t,a,35398),size:e.getActiveUniformBlockParameter(t,a,35392),uniformIndices:e.getActiveUniformBlockParameter(t,a,35395)};r.used=r.usedByVertexShader||r.usedByFragmentShader,o[n]=r}return{blockSpecs:o,uniformData:r}}(e,t),i.transformFeedbackInfo=function(e,t){const n={},r=e.getProgramParameter(t,35971);for(let i=0;i<r;++i){const r=e.getTransformFeedbackVarying(t,i);n[r.name]={index:i,type:r.type,size:r.size}}return n}(e,t)),i}const Oo=/\s|{|}|;/;function No(e,t,n,r,i){const o=Ao(n,r,i),s=[];if(t=t.map((function(e){if(!Oo.test(e)){const t=Qi(e);if(t)e=t.text;else{const t=`no element with id: ${e}`;o.errorCallback(t),s.push(t)}}return e})),s.length)return function(e,t){return e.errorCallback(t),e.callback&&setTimeout((()=>{e.callback(`${t}\n${e.errors.join("\n")}`)})),null}(o,"");const a=o.callback;a&&(o.callback=(t,n)=>{a(t,t?void 0:Vo(e,n))});const l=function(e,t,n,r,i){return To(e,t,n,r,i)}(e,t,o);return l?Vo(e,l):null}function Bo(e,t,n,r,i,o){n=void 0===n?4:n;const s=t.indices,a=t.elementType,l=void 0===r?t.numElements:r;i=void 0===i?0:i,a||s?void 0!==o?e.drawElementsInstanced(n,l,void 0===a?5123:t.elementType,i,o):e.drawElements(n,l,void 0===a?5123:t.elementType,i):void 0!==o?e.drawArraysInstanced(n,i,l,o):e.drawArrays(n,i,l)}const Do=36161,zo=34041,Uo=36064,jo=36096,Go=33306,Wo=33071,Ho=9729,Ko=[{format:6408,type:5121,min:Ho,wrap:Wo},{format:zo}],qo={};qo[34041]=Go,qo[6401]=36128,qo[36168]=36128,qo[6402]=jo,qo[33189]=jo,qo[33190]=jo,qo[36012]=jo,qo[35056]=Go,qo[36013]=Go;const Xo={};Xo[32854]=!0,Xo[32855]=!0,Xo[36194]=!0,Xo[34041]=!0,Xo[33189]=!0,Xo[6401]=!0,Xo[36168]=!0;function Yo(e,t,n,r){const i=36160,o=e.createFramebuffer();e.bindFramebuffer(i,o),n=n||e.drawingBufferWidth,r=r||e.drawingBufferHeight;const s=[],a={framebuffer:o,attachments:[],width:n,height:r};return(t=t||Ko).forEach((function(t,o){let l=t.attachment;const c=t.samples,u=t.format;let p=t.attachmentPoint||function(e,t){return qo[e]||qo[t]}(u,t.internalFormat);if(p||(p=Uo+o),function(e){return e>=Uo&&e<36096}(p)&&s.push(p),!l)if(void 0!==c||function(e){return Xo[e]}(u))l=e.createRenderbuffer(),e.bindRenderbuffer(Do,l),c>1?e.renderbufferStorageMultisample(Do,c,u,n,r):e.renderbufferStorage(Do,u,n,r);else{const i=Object.assign({},t);i.width=n,i.height=r,void 0===i.auto&&(i.auto=!1,i.min=i.min||i.minMag||Ho,i.mag=i.mag||i.minMag||Ho,i.wrapS=i.wrapS||i.wrap||Wo,i.wrapT=i.wrapT||i.wrap||Wo),l=Yi(e,i)}if(An(0,l))e.framebufferRenderbuffer(i,p,Do,l);else{if(!Sn(0,l))throw new Error("unknown attachment type");void 0!==t.layer?e.framebufferTextureLayer(i,p,l,t.level||0,t.layer):e.framebufferTexture2D(i,p,t.target||3553,l,t.level||0)}a.attachments.push(l)})),e.drawBuffers&&e.drawBuffers(s),a}function $o(e,t,n,r,i){r=r||e.drawingBufferWidth,i=i||e.drawingBufferHeight,t.width=r,t.height=i,(n=n||Ko).forEach((function(n,o){const s=t.attachments[o],a=n.format,l=n.samples;if(void 0!==l||An(0,s))e.bindRenderbuffer(Do,s),l>1?e.renderbufferStorageMultisample(Do,l,a,r,i):e.renderbufferStorage(Do,a,r,i);else{if(!Sn(0,s))throw new Error("unknown attachment type");!function(e,t,n,r,i,o){r=r||n.width,i=i||n.height,o=o||n.depth;const s=n.target||ei;e.bindTexture(s,t);const a=n.level||0,l=n.internalFormat||n.format||Qr,c=ki(l),u=n.format||c.format;let p;const d=n.src;if(p=d&&(Xr(d)||Array.isArray(d)&&"number"==typeof d[0])?n.type||Li(0,d,c.type):n.type||c.type,s===ti)for(let h=0;h<6;++h)e.texImage2D(ii+h,a,l,r,i,0,u,p,null);else s===ni||s===ri?e.texImage3D(s,a,l,r,i,o,0,u,p,null):e.texImage2D(s,a,l,r,i,0,u,p,null)}(e,s,n,r,i)}}))}function Qo(e,t,n){n=n||36160,t?(e.bindFramebuffer(n,t.framebuffer),e.viewport(0,0,t.width,t.height)):(e.bindFramebuffer(n,null),e.viewport(0,0,e.drawingBufferWidth,e.drawingBufferHeight))}function Zo(e,t,n){const r=e.createVertexArray();return e.bindVertexArray(r),t.length||(t=[t]),t.forEach((function(t){!function(e,t,n){n.vertexArrayObject?e.bindVertexArray(n.vertexArrayObject):(function(e,t){for(const n in t){const r=e[n];r&&r(t[n])}}(t.attribSetters||t,n.attribs),n.indices&&e.bindBuffer(34963,n.indices))}(e,t,n)})),e.bindVertexArray(null),{numElements:n.numElements,elementType:n.elementType,vertexArrayObject:r}}const Jo=/^(.*?)_/;function es(e,t){Kr(e,0);const n=e.getExtension(t);if(n){const r={},i=Jo.exec(t)[1],o="_"+i;for(const t in n){const s=n[t],a="function"==typeof s,l=a?i:o;let c=t;t.endsWith(l)&&(c=t.substring(0,t.length-l.length)),void 0!==e[c]?a||e[c]===s||En(c,e[c],s,t):a?e[c]=function(e){return function(){return e.apply(n,arguments)}}(s):(e[c]=s,r[c]=s)}r.constructor={name:n.constructor.name},Kr(r,0)}return n}const ts=["ANGLE_instanced_arrays","EXT_blend_minmax","EXT_color_buffer_float","EXT_color_buffer_half_float","EXT_disjoint_timer_query","EXT_disjoint_timer_query_webgl2","EXT_frag_depth","EXT_sRGB","EXT_shader_texture_lod","EXT_texture_filter_anisotropic","OES_element_index_uint","OES_standard_derivatives","OES_texture_float","OES_texture_float_linear","OES_texture_half_float","OES_texture_half_float_linear","OES_vertex_array_object","WEBGL_color_buffer_float","WEBGL_compressed_texture_atc","WEBGL_compressed_texture_etc1","WEBGL_compressed_texture_pvrtc","WEBGL_compressed_texture_s3tc","WEBGL_compressed_texture_s3tc_srgb","WEBGL_depth_texture","WEBGL_draw_buffers"];const ns={diff:(e,t,n)=>{const r=function(e,t){return e[0]=-t[0],e[1]=-t[1],e[2]=-t[2],e[3]=t[3],e}(Kt(),n);return Xt(e,t,r)},exp:(e,t)=>{const n=t[0],r=t[1],i=t[2],o=Math.sqrt(n*n+r*r+i*i);if(o<1e-8)return en(e,Qt(n,r,i,1));{const t=Math.cos(o),s=Math.sin(o)/o;return Zt(e,Qt(s*n,s*r,s*i,t))}}};ns.log=(e,t)=>{const n=t[0],r=t[1],i=t[2],o=t[3],s=Math.sqrt(n*n+r*r+i*i);if(s<1e-8)return Vt(e,Mt(n,r,i));{const t=Math.acos((a=o,l=-1,c=1,Math.min(Math.max(a,l),c))),u=Mt(n,r,i);return Bt(u,u,1/s),Bt(e,u,t)}var a,l,c},ns.expApprox=(e,t)=>en(e,[...t,1]),ns.logApprox=(e,t)=>Vt(e,t),ns.fromScaledAngleAxis=(e,t)=>ns.exp(e,Bt(It(),t,.5)),ns.toScaledAngleAxis=(e,t)=>Bt(e,ns.log(e,t),2),ns.toAngularVelocity=(e,t,n)=>Bt(e,ns.toScaledAngleAxis(It(),t),1/n),ns.fromAngularVelocity=(e,t,n)=>{const r=Bt(It(),t,n);return ns.fromScaledAngleAxis(e,r)},ns.abs=(e,t)=>t[3]<0?Jt(e,t,-1):Zt(e,t),ns.differentiateAngularVelocity=(e,t,n,r)=>{const i=ns.diff(Kt(),t,n);return ns.abs(i,i),ns.toAngularVelocity(e,i,r)},ns.integrateAngularVelocity=(e,t,n,r)=>Xt(e,ns.fromAngularVelocity(Kt(),t,r),n),ns.fromScaledAngleAxisApprox=(e,t)=>ns.expApprox(e,Bt(It(),t,.5)),ns.toScaledAngleAxisApprox=(e,t)=>Bt(e,ns.logApprox(e,t),2),ns.toAngularVerlocityApprox=(e,t,n)=>Bt(e,ns.toScaledAngleAxisApprox(It(),t),1/n),ns.fromAngularVelocityApprox=(e,t,n)=>{const r=Bt(It(),t,n);return ns.fromScaledAngleAxisApprox(e,r)},ns.differentiateAngularVelocityApprox=(e,t,n,r)=>{const i=ns.diff(Kt(),t,n);return ns.abs(i,i),ns.toAngularVerlocityApprox(e,i,r)},ns.integrateAngularVelocityApprox=(e,t,n,r)=>Xt(e,ns.fromAngularVelocityApprox(Kt(),t,r),n),Object.preventExtensions(ns);class rs{constructor(h,f,v,m){re(this,e,void 0),re(this,t,void 0),re(this,n,void 0),re(this,r,void 0),re(this,i,void 0),re(this,o,void 0),re(this,s,void 0),re(this,a,void 0),re(this,l,void 0),re(this,c,void 0),re(this,u,void 0),re(this,p,void 0),re(this,d,void 0),ie(this,e,[...m]),ie(this,n,[...m]),ie(this,t,It()),ie(this,r,f/(Math.PI*h)),ie(this,i,1/(2*Math.PI*h*(2*Math.PI*h))),ie(this,o,v*f/(2*Math.PI*h)),ie(this,s,Kt()),ie(this,a,It()),ie(this,l,It()),ie(this,c,It()),ie(this,u,It()),ie(this,p,It()),ie(this,d,It())}update(h,f){ns.differentiateAngularVelocity(ne(this,a),f,ne(this,n),h),Zt(ne(this,n),f),ns.integrateAngularVelocity(ne(this,e),ne(this,t),ne(this,e),h);const v=1/Math.max(ne(this,i),1.1*(h*h/4+h*ne(this,r)/2));return ns.diff(ne(this,s),f,ne(this,e)),ns.abs(ne(this,s),ne(this,s)),ns.toScaledAngleAxis(ne(this,l),ne(this,s)),Bt(ne(this,l),ne(this,l),v),Bt(ne(this,c),ne(this,a),ne(this,o)*v),Bt(ne(this,u),ne(this,t),ne(this,r)*v),jt(ne(this,p),ne(this,c),ne(this,u)),Ot(ne(this,d),ne(this,l),ne(this,p)),Bt(ne(this,p),ne(this,d),h),Ot(ne(this,t),ne(this,t),ne(this,p)),ne(this,e)}updateApprox(h,f){ns.differentiateAngularVelocityApprox(ne(this,a),f,ne(this,n),h),Zt(ne(this,n),f),ns.integrateAngularVelocityApprox(ne(this,e),ne(this,t),ne(this,e),h);const v=1/Math.max(ne(this,i),1.1*(h*h/4+h*ne(this,r)/2));return ns.diff(ne(this,s),f,ne(this,e)),ns.abs(ne(this,s),ne(this,s)),ns.toScaledAngleAxisApprox(ne(this,l),ne(this,s)),Bt(ne(this,l),ne(this,l),v),Bt(ne(this,c),ne(this,a),ne(this,o)*v),Bt(ne(this,u),ne(this,t),ne(this,r)*v),jt(ne(this,p),ne(this,c),ne(this,u)),Ot(ne(this,d),ne(this,l),ne(this,p)),Bt(ne(this,p),ne(this,d),h),Ot(ne(this,t),ne(this,t),ne(this,p)),ne(this,e)}get value(){return ne(this,e)}}e=new WeakMap,t=new WeakMap,n=new WeakMap,r=new WeakMap,i=new WeakMap,o=new WeakMap,s=new WeakMap,a=new WeakMap,l=new WeakMap,c=new WeakMap,u=new WeakMap,p=new WeakMap,d=new WeakMap;class is{constructor(e,t){re(this,h),ee(this,"rotationQuat",Kt()),ee(this,"rotationQuatInner",Kt()),ee(this,"rotationSOQ",new rs(1,.5,1,Kt())),this.canvas=e,this.updateCallback=t||(()=>null),this.pointerDown=!1,this.pointerDownPos=tn(),this.pointerPos=tn(),this.followPos=It(),this.prevFollowPos=It(),this.autoRotationSpeed=0,this.velocity=.002,this.rotationAxis=Mt(0,1,0),e.style.touchAction="none",e.addEventListener("pointerdown",(e=>{this.pointerDownPos=nn(e.clientX,e.clientY),this.followPos=Mt(e.clientX,e.clientY,0),this.pointerPos=nn(e.clientX,e.clientY),this.prevFollowPos=Mt(e.clientX,e.clientY,0),this.pointerDown=!0,this.autoRotationSpeed=0})),e.addEventListener("pointerup",(e=>{this.pointerDown=!1})),e.addEventListener("pointerleave",(e=>{this.pointerDown=!1})),e.addEventListener("pointermove",(e=>{this.pointerDown&&(this.pointerPos[0]=e.clientX,this.pointerPos[1]=e.clientY)}))}update(e){const t=16/(e+.01);let n;if(this.followPos[0]+=this.pointerPos[0]-this.followPos[0],this.followPos[1]+=this.pointerPos[1]-this.followPos[1],this.pointerDown){const e=oe(this,h,f).call(this,this.followPos),r=oe(this,h,f).call(this,this.prevFollowPos),i=Dt(It(),e),o=Dt(It(),r),s=Ut(It(),e,r);Dt(s,s);const a=Math.max(-1,Math.min(1,zt(i,o))),l=Math.acos(a)*t*3;this.velocity=l,this.rotationAxis=Ft(s),n=qt(Kt(),s,l)}else this.velocity*=this.velocity>.002?.97:1,n=qt(Kt(),this.rotationAxis,this.velocity);Xt(this.rotationQuatInner,n,this.rotationQuatInner),en(this.rotationQuatInner,this.rotationQuatInner),this.rotationSOQ.updateApprox(.001*e,this.rotationQuatInner),this.rotationQuat=$t(this.rotationSOQ.value),this.prevFollowPos=Ft(this.followPos),this.updateCallback()}}h=new WeakSet,f=function(e){const t=this.canvas.clientWidth,n=this.canvas.clientHeight,r=Math.max(t,n)-1,i=(2*e[0]-t-1)/r,o=(2*e[1]-n-1)/r;let s=0;const a=i*i+o*o;return s=a<=.5?Math.sqrt(1-a):.5/Math.sqrt(a),Mt(-i,o,s)};var os="#version 300 es\n\nlayout(location = 0) in vec4 position;\n\nout vec2 v_texcoord;\n\nvoid main() {\n    gl_Position = position;\n    v_texcoord = position.xy * 0.5 + 0.5;\n}";const ss=(e,t)=>(void 0===t&&(t=e,e=0),Math.random()*(t-e)+e);function as(e,t){if(!e)throw new Error(t||"loader assertion failed.")}const ls=Boolean("object"!=typeof process||"[object process]"!==String(process)||process.browser),cs="undefined"!=typeof process&&process.version&&/v([0-9]*)/.exec(process.version);cs&&parseFloat(cs[1]);function us(e,t){if(!e)throw new Error(t||"loaders.gl assertion failed.")}const ps="object"!=typeof process||"[object process]"!==String(process)||process.browser,ds="undefined"!=typeof window&&void 0!==window.orientation,hs="undefined"!=typeof process&&process.version&&/v([0-9]*)/.exec(process.version);function fs(e){return(fs="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function vs(e){var t=function(e,t){if("object"!==fs(e)||null===e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,t||"default");if("object"!==fs(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"===fs(t)?t:String(t)}function ms(e,t,n){return(t=vs(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}hs&&parseFloat(hs[1]);class bs{constructor(e,t){ms(this,"name",void 0),ms(this,"workerThread",void 0),ms(this,"isRunning",!0),ms(this,"result",void 0),ms(this,"_resolve",(()=>{})),ms(this,"_reject",(()=>{})),this.name=e,this.workerThread=t,this.result=new Promise(((e,t)=>{this._resolve=e,this._reject=t}))}postMessage(e,t){this.workerThread.postMessage({source:"loaders.gl",type:e,payload:t})}done(e){us(this.isRunning),this.isRunning=!1,this._resolve(e)}error(e){us(this.isRunning),this.isRunning=!1,this._reject(e)}}class gs{}const _s=new Map;function ws(e){us(e.source&&!e.url||!e.source&&e.url);let t=_s.get(e.source||e.url);return t||(e.url&&(t=function(e){if(!e.startsWith("http"))return e;return xs((t=e,"try {\n  importScripts('".concat(t,"');\n} catch (error) {\n  console.error(error);\n  throw error;\n}")));var t}(e.url),_s.set(e.url,t)),e.source&&(t=xs(e.source),_s.set(e.source,t))),us(t),t}function xs(e){const t=new Blob([e],{type:"application/javascript"});return URL.createObjectURL(t)}function ys(e,t=!0,n){const r=n||new Set;if(e){if(Es(e))r.add(e);else if(Es(e.buffer))r.add(e.buffer);else if(ArrayBuffer.isView(e));else if(t&&"object"==typeof e)for(const i in e)ys(e[i],t,r)}else;return void 0===n?Array.from(r):[]}function Es(e){return!!e&&(e instanceof ArrayBuffer||("undefined"!=typeof MessagePort&&e instanceof MessagePort||("undefined"!=typeof ImageBitmap&&e instanceof ImageBitmap||"undefined"!=typeof OffscreenCanvas&&e instanceof OffscreenCanvas)))}const Ps=()=>{};class Cs{static isSupported(){return"undefined"!=typeof Worker&&ps||void 0!==gs&&!ps}constructor(e){ms(this,"name",void 0),ms(this,"source",void 0),ms(this,"url",void 0),ms(this,"terminated",!1),ms(this,"worker",void 0),ms(this,"onMessage",void 0),ms(this,"onError",void 0),ms(this,"_loadableURL","");const{name:t,source:n,url:r}=e;us(n||r),this.name=t,this.source=n,this.url=r,this.onMessage=Ps,this.onError=e=>console.log(e),this.worker=ps?this._createBrowserWorker():this._createNodeWorker()}destroy(){this.onMessage=Ps,this.onError=Ps,this.worker.terminate(),this.terminated=!0}get isRunning(){return Boolean(this.onMessage)}postMessage(e,t){t=t||ys(e),this.worker.postMessage(e,t)}_getErrorFromErrorEvent(e){let t="Failed to load ";return t+="worker ".concat(this.name," from ").concat(this.url,". "),e.message&&(t+="".concat(e.message," in ")),e.lineno&&(t+=":".concat(e.lineno,":").concat(e.colno)),new Error(t)}_createBrowserWorker(){this._loadableURL=ws({source:this.source,url:this.url});const e=new Worker(this._loadableURL,{name:this.name});return e.onmessage=e=>{e.data?this.onMessage(e.data):this.onError(new Error("No data received"))},e.onerror=e=>{this.onError(this._getErrorFromErrorEvent(e)),this.terminated=!0},e.onmessageerror=e=>console.error(e),e}_createNodeWorker(){let e;if(this.url){const t=this.url.includes(":/")||this.url.startsWith("/")?this.url:"./".concat(this.url);e=new gs(t,{eval:!1})}else{if(!this.source)throw new Error("no worker");e=new gs(this.source,{eval:!0})}return e.on("message",(e=>{this.onMessage(e)})),e.on("error",(e=>{this.onError(e)})),e.on("exit",(e=>{})),e}}class As{static isSupported(){return Cs.isSupported()}constructor(e){ms(this,"name","unnamed"),ms(this,"source",void 0),ms(this,"url",void 0),ms(this,"maxConcurrency",1),ms(this,"maxMobileConcurrency",1),ms(this,"onDebug",(()=>{})),ms(this,"reuseWorkers",!0),ms(this,"props",{}),ms(this,"jobQueue",[]),ms(this,"idleQueue",[]),ms(this,"count",0),ms(this,"isDestroyed",!1),this.source=e.source,this.url=e.url,this.setProps(e)}destroy(){this.idleQueue.forEach((e=>e.destroy())),this.isDestroyed=!0}setProps(e){this.props={...this.props,...e},void 0!==e.name&&(this.name=e.name),void 0!==e.maxConcurrency&&(this.maxConcurrency=e.maxConcurrency),void 0!==e.maxMobileConcurrency&&(this.maxMobileConcurrency=e.maxMobileConcurrency),void 0!==e.reuseWorkers&&(this.reuseWorkers=e.reuseWorkers),void 0!==e.onDebug&&(this.onDebug=e.onDebug)}async startJob(e,t=((e,t,n)=>e.done(n)),n=((e,t)=>e.error(t))){const r=new Promise((r=>(this.jobQueue.push({name:e,onMessage:t,onError:n,onStart:r}),this)));return this._startQueuedJob(),await r}async _startQueuedJob(){if(!this.jobQueue.length)return;const e=this._getAvailableWorker();if(!e)return;const t=this.jobQueue.shift();if(t){this.onDebug({message:"Starting job",name:t.name,workerThread:e,backlog:this.jobQueue.length});const n=new bs(t.name,e);e.onMessage=e=>t.onMessage(n,e.type,e.payload),e.onError=e=>t.onError(n,e),t.onStart(n);try{await n.result}finally{this.returnWorkerToQueue(e)}}}returnWorkerToQueue(e){this.isDestroyed||!this.reuseWorkers||this.count>this._getMaxConcurrency()?(e.destroy(),this.count--):this.idleQueue.push(e),this.isDestroyed||this._startQueuedJob()}_getAvailableWorker(){if(this.idleQueue.length>0)return this.idleQueue.shift()||null;if(this.count<this._getMaxConcurrency()){this.count++;const e="".concat(this.name.toLowerCase()," (#").concat(this.count," of ").concat(this.maxConcurrency,")");return new Cs({name:e,source:this.source,url:this.url})}return null}_getMaxConcurrency(){return ds?this.maxMobileConcurrency:this.maxConcurrency}}const Ss={maxConcurrency:3,maxMobileConcurrency:1,reuseWorkers:!0,onDebug:()=>{}};class ks{static isSupported(){return Cs.isSupported()}static getWorkerFarm(e={}){return ks._workerFarm=ks._workerFarm||new ks({}),ks._workerFarm.setProps(e),ks._workerFarm}constructor(e){ms(this,"props",void 0),ms(this,"workerPools",new Map),this.props={...Ss},this.setProps(e),this.workerPools=new Map}destroy(){for(const e of this.workerPools.values())e.destroy();this.workerPools=new Map}setProps(e){this.props={...this.props,...e};for(const t of this.workerPools.values())t.setProps(this._getWorkerPoolProps())}getWorkerPool(e){const{name:t,source:n,url:r}=e;let i=this.workerPools.get(t);return i||(i=new As({name:t,source:n,url:r}),i.setProps(this._getWorkerPoolProps()),this.workerPools.set(t,i)),i}_getWorkerPoolProps(){return{maxConcurrency:this.props.maxConcurrency,maxMobileConcurrency:this.props.maxMobileConcurrency,reuseWorkers:this.props.reuseWorkers,onDebug:this.props.onDebug}}}ms(ks,"_workerFarm",void 0);async function Ts(e,t,n,r,i){const o=e.id,s=function(e,t={}){const n=t[e.id]||{},r="".concat(e.id,"-worker.js");let i=n.workerUrl;if(i||"compression"!==e.id||(i=t.workerUrl),"test"===t._workerType&&(i="modules/".concat(e.module,"/dist/").concat(r)),!i){let t=e.version;"latest"===t&&(t="latest");const n=t?"@".concat(t):"";i="https://unpkg.com/@loaders.gl/".concat(e.module).concat(n,"/dist/").concat(r)}return us(i),i}(e,n),a=ks.getWorkerFarm(n).getWorkerPool({name:o,url:s});n=JSON.parse(JSON.stringify(n)),r=JSON.parse(JSON.stringify(r||{}));const l=await a.startJob("process-on-worker",Ls.bind(null,i));l.postMessage("process",{input:t,options:n,context:r});const c=await l.result;return await c.result}async function Ls(e,t,n,r){switch(n){case"done":t.done(r);break;case"error":t.error(new Error(r.error));break;case"process":const{id:o,input:s,options:a}=r;try{const n=await e(s,a);t.postMessage("done",{id:o,result:n})}catch(i){const e=i instanceof Error?i.message:"unknown error";t.postMessage("error",{id:o,error:e})}break;default:console.warn("parse-with-worker unknown message ".concat(n))}}function Rs(e){return e&&"object"==typeof e&&e.isBuffer}function Is(e){if(Rs(e))return function(e){if(Rs(e))return new Uint8Array(e.buffer,e.byteOffset,e.length).slice().buffer;return e}(e);if(e instanceof ArrayBuffer)return e;if(ArrayBuffer.isView(e))return 0===e.byteOffset&&e.byteLength===e.buffer.byteLength?e.buffer:e.buffer.slice(e.byteOffset,e.byteOffset+e.byteLength);if("string"==typeof e){const t=e;return(new TextEncoder).encode(t).buffer}if(e&&"object"==typeof e&&e._toArrayBuffer)return e._toArrayBuffer();throw new Error("toArrayBuffer")}function Fs(e,t){return as(e>=0),as(t>0),e+(t-1)&~(t-1)}async function Ms(e){const t=[];for await(const n of e)t.push(n);return function(...e){const t=e.map((e=>e instanceof ArrayBuffer?new Uint8Array(e):e)),n=t.reduce(((e,t)=>e+t.byteLength),0),r=new Uint8Array(n);let i=0;for(const o of t)r.set(o,i),i+=o.byteLength;return r.buffer}(...t)}const Vs={};const Os=e=>"function"==typeof e,Ns=e=>null!==e&&"object"==typeof e,Bs=e=>Ns(e)&&e.constructor==={}.constructor,Ds=e=>"undefined"!=typeof Response&&e instanceof Response||e&&e.arrayBuffer&&e.text&&e.json,zs=e=>"undefined"!=typeof Blob&&e instanceof Blob,Us=e=>(e=>"undefined"!=typeof ReadableStream&&e instanceof ReadableStream||Ns(e)&&Os(e.tee)&&Os(e.cancel)&&Os(e.getReader))(e)||(e=>Ns(e)&&Os(e.read)&&Os(e.pipe)&&(e=>"boolean"==typeof e)(e.readable))(e),js=/^data:([-\w.]+\/[-\w.+]+)(;|,)/,Gs=/^([-\w.]+\/[-\w.+]+)/;function Ws(e){const t=Gs.exec(e);return t?t[1]:e}function Hs(e){const t=js.exec(e);return t?t[1]:""}const Ks=/\?.*/;function qs(e){if(Ds(e)){const t=Xs(e.url||"");return{url:t,type:Ws(e.headers.get("content-type")||"")||Hs(t)}}return zs(e)?{url:Xs(e.name||""),type:e.type||""}:"string"==typeof e?{url:Xs(e),type:Hs(e)}:{url:"",type:""}}function Xs(e){return e.replace(Ks,"")}async function Ys(e){if(Ds(e))return e;const t={},n=function(e){return Ds(e)?e.headers["content-length"]||-1:zs(e)?e.size:"string"==typeof e?e.length:e instanceof ArrayBuffer||ArrayBuffer.isView(e)?e.byteLength:-1}(e);n>=0&&(t["content-length"]=String(n));const{url:r,type:i}=qs(e);i&&(t["content-type"]=i);const o=await async function(e){const t=5;if("string"==typeof e)return"data:,".concat(e.slice(0,t));if(e instanceof Blob){const t=e.slice(0,5);return await new Promise((e=>{const n=new FileReader;n.onload=t=>{var n;return e(null==t||null===(n=t.target)||void 0===n?void 0:n.result)},n.readAsDataURL(t)}))}if(e instanceof ArrayBuffer){const n=function(e){let t="";const n=new Uint8Array(e);for(let r=0;r<n.byteLength;r++)t+=String.fromCharCode(n[r]);return btoa(t)}(e.slice(0,t));return"data:base64,".concat(n)}return null}(e);o&&(t["x-first-bytes"]=o),"string"==typeof e&&(e=(new TextEncoder).encode(e));const s=new Response(e,{headers:t});return Object.defineProperty(s,"url",{value:r}),s}async function $s(e,t){if("string"==typeof e){e=function(e){for(const t in Vs)if(e.startsWith(t)){const n=Vs[t];e=e.replace(t,n)}return e.startsWith("http://")||e.startsWith("https://")||(e="".concat("").concat(e)),e}(e);let n=t;return null!=t&&t.fetch&&"function"!=typeof(null==t?void 0:t.fetch)&&(n=t.fetch),await fetch(e,n)}return await Ys(e)}function Qs(){return!("object"==typeof process&&"[object process]"===String(process)&&!process.browser)||function(e){if("undefined"!=typeof window&&"object"==typeof window.process&&"renderer"===window.process.type)return!0;if("undefined"!=typeof process&&"object"==typeof process.versions&&Boolean(process.versions.electron))return!0;const t="object"==typeof navigator&&"string"==typeof navigator.userAgent&&navigator.userAgent,n=e||t;return!!(n&&n.indexOf("Electron")>=0)}()}const Zs={self:"undefined"!=typeof self&&self,window:"undefined"!=typeof window&&window,global:"undefined"!=typeof global&&global,document:"undefined"!=typeof document&&document,process:"object"==typeof process&&process},Js=Zs.window||Zs.self||Zs.global,ea=Zs.process||{},ta="undefined"!=typeof __VERSION__?__VERSION__:"untranspiled source";Qs();class na{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"sessionStorage";ms(this,"storage",void 0),ms(this,"id",void 0),ms(this,"config",{}),this.storage=function(e){try{const t=window[e],n="__storage_test__";return t.setItem(n,n),t.removeItem(n),t}catch(t){return null}}(n),this.id=e,this.config={},Object.assign(this.config,t),this._loadConfiguration()}getConfiguration(){return this.config}setConfiguration(e){return this.config={},this.updateConfiguration(e)}updateConfiguration(e){if(Object.assign(this.config,e),this.storage){const e=JSON.stringify(this.config);this.storage.setItem(this.id,e)}return this}_loadConfiguration(){let e={};if(this.storage){const t=this.storage.getItem(this.id);e=t?JSON.parse(t):{}}return Object.assign(this.config,e),this}}function ra(e,t,n){let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:600;const i=e.src.replace(/\(/g,"%28").replace(/\)/g,"%29");e.width>r&&(n=Math.min(n,r/e.width));const o=e.width*n,s=e.height*n,a=["font-size:1px;","padding:".concat(Math.floor(s/2),"px ").concat(Math.floor(o/2),"px;"),"line-height:".concat(s,"px;"),"background:url(".concat(i,");"),"background-size:".concat(o,"px ").concat(s,"px;"),"color:transparent;"].join("");return["".concat(t," %c+"),a]}let ia;var oa;function sa(e){return"string"==typeof e?ia[e.toUpperCase()]||ia.WHITE:e}function aa(e,t){if(!e)throw new Error(t||"Assertion failed")}function la(){let e;var t,n;if(Qs&&"performance"in Js)e=null==Js||null===(t=Js.performance)||void 0===t||null===(n=t.now)||void 0===n?void 0:n.call(t);else if("hrtime"in ea){var r;const t=null==ea||null===(r=ea.hrtime)||void 0===r?void 0:r.call(ea);e=1e3*t[0]+t[1]/1e6}else e=Date.now();return e}(oa=ia||(ia={}))[oa.BLACK=30]="BLACK",oa[oa.RED=31]="RED",oa[oa.GREEN=32]="GREEN",oa[oa.YELLOW=33]="YELLOW",oa[oa.BLUE=34]="BLUE",oa[oa.MAGENTA=35]="MAGENTA",oa[oa.CYAN=36]="CYAN",oa[oa.WHITE=37]="WHITE",oa[oa.BRIGHT_BLACK=90]="BRIGHT_BLACK",oa[oa.BRIGHT_RED=91]="BRIGHT_RED",oa[oa.BRIGHT_GREEN=92]="BRIGHT_GREEN",oa[oa.BRIGHT_YELLOW=93]="BRIGHT_YELLOW",oa[oa.BRIGHT_BLUE=94]="BRIGHT_BLUE",oa[oa.BRIGHT_MAGENTA=95]="BRIGHT_MAGENTA",oa[oa.BRIGHT_CYAN=96]="BRIGHT_CYAN",oa[oa.BRIGHT_WHITE=97]="BRIGHT_WHITE";const ca={debug:Qs&&console.debug||console.log,log:console.log,info:console.info,warn:console.warn,error:console.error},ua={enabled:!0,level:0};function pa(){}const da={},ha={once:!0};class fa{constructor(){let{id:e}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{id:""};ms(this,"id",void 0),ms(this,"VERSION",ta),ms(this,"_startTs",la()),ms(this,"_deltaTs",la()),ms(this,"_storage",void 0),ms(this,"userData",{}),ms(this,"LOG_THROTTLE_TIMEOUT",0),this.id=e,this._storage=new na("__probe-".concat(this.id,"__"),ua),this.userData={},this.timeStamp("".concat(this.id," started")),function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:["constructor"];const n=Object.getPrototypeOf(e),r=Object.getOwnPropertyNames(n);for(const i of r)"function"==typeof e[i]&&(t.find((e=>i===e))||(e[i]=e[i].bind(e)))}(this),Object.seal(this)}set level(e){this.setLevel(e)}get level(){return this.getLevel()}isEnabled(){return this._storage.config.enabled}getLevel(){return this._storage.config.level}getTotal(){return Number((la()-this._startTs).toPrecision(10))}getDelta(){return Number((la()-this._deltaTs).toPrecision(10))}set priority(e){this.level=e}get priority(){return this.level}getPriority(){return this.level}enable(){let e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];return this._storage.updateConfiguration({enabled:e}),this}setLevel(e){return this._storage.updateConfiguration({level:e}),this}get(e){return this._storage.config[e]}set(e,t){this._storage.updateConfiguration({[e]:t})}settings(){console.table?console.table(this._storage.config):console.log(this._storage.config)}assert(e,t){aa(e,t)}warn(e){return this._getLogFunction(0,e,ca.warn,arguments,ha)}error(e){return this._getLogFunction(0,e,ca.error,arguments)}deprecated(e,t){return this.warn("`".concat(e,"` is deprecated and will be removed in a later version. Use `").concat(t,"` instead"))}removed(e,t){return this.error("`".concat(e,"` has been removed. Use `").concat(t,"` instead"))}probe(e,t){return this._getLogFunction(e,t,ca.log,arguments,{time:!0,once:!0})}log(e,t){return this._getLogFunction(e,t,ca.debug,arguments)}info(e,t){return this._getLogFunction(e,t,console.info,arguments)}once(e,t){for(var n=arguments.length,r=new Array(n>2?n-2:0),i=2;i<n;i++)r[i-2]=arguments[i];return this._getLogFunction(e,t,ca.debug||ca.info,arguments,ha)}table(e,t,n){return t?this._getLogFunction(e,t,console.table||pa,n&&[n],{tag:ba(t)}):pa}image(e){let{logLevel:t,priority:n,image:r,message:i="",scale:o=1}=e;return this._shouldLog(t||n)?Qs?function(e){let{image:t,message:n="",scale:r=1}=e;if("string"==typeof t){const e=new Image;return e.onload=()=>{const t=ra(e,n,r);console.log(...t)},e.src=t,pa}const i=t.nodeName||"";if("img"===i.toLowerCase())return console.log(...ra(t,n,r)),pa;if("canvas"===i.toLowerCase()){const e=new Image;return e.onload=()=>console.log(...ra(e,n,r)),e.src=t.toDataURL(),pa}return pa}({image:r,message:i,scale:o}):function(e){let{image:t,message:n="",scale:r=1}=e;return(void 0)({image:t,message:n,scale:r}),pa}({image:r,message:i,scale:o}):pa}time(e,t){return this._getLogFunction(e,t,console.time?console.time:console.info)}timeEnd(e,t){return this._getLogFunction(e,t,console.timeEnd?console.timeEnd:console.info)}timeStamp(e,t){return this._getLogFunction(e,t,console.timeStamp||pa)}group(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{collapsed:!1};const r=ma({logLevel:e,message:t,opts:n}),{collapsed:i}=n;return r.method=(i?console.groupCollapsed:console.group)||console.info,this._getLogFunction(r)}groupCollapsed(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return this.group(e,t,Object.assign({},n,{collapsed:!0}))}groupEnd(e){return this._getLogFunction(e,"",console.groupEnd||pa)}withGroup(e,t,n){this.group(e,t)();try{n()}finally{this.groupEnd(e)()}}trace(){console.trace&&console.trace()}_shouldLog(e){return this.isEnabled()&&this.getLevel()>=va(e)}_getLogFunction(e,t,n,r,i){if(this._shouldLog(e)){i=ma({logLevel:e,message:t,args:r,opts:i}),aa(n=n||i.method),i.total=this.getTotal(),i.delta=this.getDelta(),this._deltaTs=la();const o=i.tag||i.message;if(i.once){if(da[o])return pa;da[o]=la()}return t=function(e,t,n){if("string"==typeof t){const s=n.time?function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:8;const n=Math.max(t-e.length,0);return"".concat(" ".repeat(n)).concat(e)}(function(e){let t;return t=e<10?"".concat(e.toFixed(2),"ms"):e<100?"".concat(e.toFixed(1),"ms"):e<1e3?"".concat(e.toFixed(0),"ms"):"".concat((e/1e3).toFixed(2),"s"),t}(n.total)):"";t=n.time?"".concat(e,": ").concat(s,"  ").concat(t):"".concat(e,": ").concat(t),r=t,i=n.color,o=n.background,Qs||"string"!=typeof r||(i&&(i=sa(i),r="[".concat(i,"m").concat(r,"[39m")),o&&(i=sa(o),r="[".concat(o+10,"m").concat(r,"[49m"))),t=r}var r,i,o;return t}(this.id,i.message,i),n.bind(console,t,...i.args)}return pa}}function va(e){if(!e)return 0;let t;switch(typeof e){case"number":t=e;break;case"object":t=e.logLevel||e.priority||0;break;default:return 0}return aa(Number.isFinite(t)&&t>=0),t}function ma(e){const{logLevel:t,message:n}=e;e.logLevel=va(t);const r=e.args?Array.from(e.args):[];for(;r.length&&r.shift()!==n;);switch(typeof t){case"string":case"function":void 0!==n&&r.unshift(n),e.message=t;break;case"object":Object.assign(e,t)}"function"==typeof e.message&&(e.message=e.message());const i=typeof e.message;return aa("string"===i||"object"===i),Object.assign(e,{args:r},e.opts)}function ba(e){for(const t in e)for(const n in e[t])return n||"untitled";return"empty"}ms(fa,"VERSION",ta);const ga=new fa({id:"loaders.gl"});class _a{log(){return()=>{}}info(){return()=>{}}warn(){return()=>{}}error(){return()=>{}}}const wa={fetch:null,mimeType:void 0,nothrow:!1,log:new class{constructor(){ms(this,"console",void 0),this.console=console}log(...e){return this.console.log.bind(this.console,...e)}info(...e){return this.console.info.bind(this.console,...e)}warn(...e){return this.console.warn.bind(this.console,...e)}error(...e){return this.console.error.bind(this.console,...e)}},CDN:"https://unpkg.com/@loaders.gl",worker:!0,maxConcurrency:3,maxMobileConcurrency:1,reuseWorkers:ls,_nodeWorkers:!1,_workerType:"",limit:0,_limitMB:0,batchSize:"auto",batchDebounceMs:0,metadata:!1,transforms:[]},xa={throws:"nothrow",dataType:"(no longer used)",uri:"baseUri",method:"fetch.method",headers:"fetch.headers",body:"fetch.body",mode:"fetch.mode",credentials:"fetch.credentials",cache:"fetch.cache",redirect:"fetch.redirect",referrer:"fetch.referrer",referrerPolicy:"fetch.referrerPolicy",integrity:"fetch.integrity",keepalive:"fetch.keepalive",signal:"fetch.signal"};function ya(){globalThis.loaders=globalThis.loaders||{};const{loaders:e}=globalThis;return e._state=e._state||{},e._state}const Ea=()=>{const e=ya();return e.globalOptions=e.globalOptions||{...wa},e.globalOptions};function Pa(e,t,n,r){return n=n||[],function(e,t){Aa(e,null,wa,xa,t);for(const n of t){const r=e&&e[n.id]||{},i=n.options&&n.options[n.id]||{},o=n.deprecatedOptions&&n.deprecatedOptions[n.id]||{};Aa(r,n.id,i,o,t)}}(e,n=Array.isArray(n)?n:[n]),function(e,t,n){const r=e.options||{},i={...r};(function(e,t){t&&!("baseUri"in e)&&(e.baseUri=t)})(i,n),null===i.log&&(i.log=new _a);return ka(i,Ea()),ka(i,t),i}(t,e,r)}function Ca(e,t){const n=Ea(),r=e||n;return"function"==typeof r.fetch?r.fetch:Ns(r.fetch)?e=>$s(e,r):null!=t&&t.fetch?null==t?void 0:t.fetch:$s}function Aa(e,t,n,r,i){const o=t||"Top level",s=t?"".concat(t,"."):"";for(const a in e){const l=!t&&Ns(e[a]);if(!(a in n)&&!("baseUri"===a&&!t)&&!("workerUrl"===a&&t))if(a in r)ga.warn("".concat(o," loader option '").concat(s).concat(a,"' no longer supported, use '").concat(r[a],"'"))();else if(!l){const e=Sa(a,i);ga.warn("".concat(o," loader option '").concat(s).concat(a,"' not recognized. ").concat(e))()}}}function Sa(e,t){const n=e.toLowerCase();let r="";for(const i of t)for(const t in i.options){if(e===t)return"Did you mean '".concat(i.id,".").concat(t,"'?");const o=t.toLowerCase();(n.startsWith(o)||o.startsWith(n))&&(r=r||"Did you mean '".concat(i.id,".").concat(t,"'?"))}return r}function ka(e,t){for(const n in t)if(n in t){const r=t[n];Bs(r)&&Bs(e[n])?e[n]={...e[n],...t[n]}:e[n]=t[n]}}function Ta(e){var t;if(!e)return!1;Array.isArray(e)&&(e=e[0]);return Array.isArray(null===(t=e)||void 0===t?void 0:t.extensions)}function La(e){var t,n;let r;return as(e,"null loader"),as(Ta(e),"invalid loader"),Array.isArray(e)&&(r=e[1],e=e[0],e={...e,options:{...e.options,...r}}),(null!==(t=e)&&void 0!==t&&t.parseTextSync||null!==(n=e)&&void 0!==n&&n.parseText)&&(e.text=!0),e.text||(e.binary=!0),e}function Ra(){return(()=>{const e=ya();return e.loaderRegistry=e.loaderRegistry||[],e.loaderRegistry})()}const Ia=new fa({id:"loaders.gl"}),Fa=/\.([^.]+)$/;function Ma(e,t=[],n,r){if(!Va(e))return null;if(t&&!Array.isArray(t))return La(t);let i=[];t&&(i=i.concat(t)),null!=n&&n.ignoreRegisteredLoaders||i.push(...Ra()),function(e){for(const t of e)La(t)}(i);const o=function(e,t,n,r){const{url:i,type:o}=qs(e),s=i||(null==r?void 0:r.url);let a=null,l="";null!=n&&n.mimeType&&(a=Na(t,null==n?void 0:n.mimeType),l="match forced by supplied MIME type ".concat(null==n?void 0:n.mimeType));var c;a=a||function(e,t){const n=t&&Fa.exec(t),r=n&&n[1];return r?function(e,t){t=t.toLowerCase();for(const n of e)for(const e of n.extensions)if(e.toLowerCase()===t)return n;return null}(e,r):null}(t,s),l=l||(a?"matched url ".concat(s):""),a=a||Na(t,o),l=l||(a?"matched MIME type ".concat(o):""),a=a||function(e,t){if(!t)return null;for(const n of e)if("string"==typeof t){if(Ba(t,n))return n}else if(ArrayBuffer.isView(t)){if(Da(t.buffer,t.byteOffset,n))return n}else if(t instanceof ArrayBuffer){if(Da(t,0,n))return n}return null}(t,e),l=l||(a?"matched initial data ".concat(za(e)):""),a=a||Na(t,null==n?void 0:n.fallbackMimeType),l=l||(a?"matched fallback MIME type ".concat(o):""),l&&Ia.log(1,"selectLoader selected ".concat(null===(c=a)||void 0===c?void 0:c.name,": ").concat(l,"."));return a}(e,i,n,r);if(!(o||null!=n&&n.nothrow))throw new Error(Oa(e));return o}function Va(e){return!(e instanceof Response&&204===e.status)}function Oa(e){const{url:t,type:n}=qs(e);let r="No valid loader found (";r+=t?"".concat(function(e){const t=e&&e.lastIndexOf("/");return t>=0?e.substr(t+1):""}(t),", "):"no url provided, ",r+="MIME type: ".concat(n?'"'.concat(n,'"'):"not provided",", ");const i=e?za(e):"";return r+=i?' first bytes: "'.concat(i,'"'):"first bytes: not available",r+=")",r}function Na(e,t){for(const n of e){if(n.mimeTypes&&n.mimeTypes.includes(t))return n;if(t==="application/x.".concat(n.id))return n}return null}function Ba(e,t){if(t.testText)return t.testText(e);return(Array.isArray(t.tests)?t.tests:[t.tests]).some((t=>e.startsWith(t)))}function Da(e,t,n){return(Array.isArray(n.tests)?n.tests:[n.tests]).some((r=>function(e,t,n,r){if(r instanceof ArrayBuffer)return function(e,t,n){if(n=n||e.byteLength,e.byteLength<n||t.byteLength<n)return!1;const r=new Uint8Array(e),i=new Uint8Array(t);for(let o=0;o<r.length;++o)if(r[o]!==i[o])return!1;return!0}(r,e,r.byteLength);switch(typeof r){case"function":return r(e,n);case"string":return r===Ua(e,t,r.length);default:return!1}}(e,t,n,r)))}function za(e,t=5){if("string"==typeof e)return e.slice(0,t);if(ArrayBuffer.isView(e))return Ua(e.buffer,e.byteOffset,t);if(e instanceof ArrayBuffer){return Ua(e,0,t)}return""}function Ua(e,t,n){if(e.byteLength<t+n)return"";const r=new DataView(e);let i="";for(let o=0;o<n;o++)i+=String.fromCharCode(r.getUint8(t+o));return i}const ja=262144;function Ga(e,t){return ls?async function*(e,t){const n=e.getReader();let r;try{for(;;){const e=r||n.read();null!=t&&t._streamReadAhead&&(r=n.read());const{done:i,value:o}=await e;if(i)return;yield Is(o)}}catch(i){n.releaseLock()}}(e,t):async function*(e,t){for await(const n of e)yield Is(n)}(e)}function Wa(e,t){if("string"==typeof e)return function*(e,t){const n=(null==t?void 0:t.chunkSize)||262144;let r=0;const i=new TextEncoder;for(;r<e.length;){const t=Math.min(e.length-r,n),o=e.slice(r,r+t);r+=t,yield i.encode(o)}}(e,t);if(e instanceof ArrayBuffer)return function*(e,t={}){const{chunkSize:n=ja}=t;let r=0;for(;r<e.byteLength;){const t=Math.min(e.byteLength-r,n),i=new ArrayBuffer(t),o=new Uint8Array(e,r,t);new Uint8Array(i).set(o),r+=t,yield i}}(e,t);if(zs(e))return async function*(e,t){const n=(null==t?void 0:t.chunkSize)||1048576;let r=0;for(;r<e.size;){const t=r+n,i=await e.slice(r,t).arrayBuffer();r=t,yield i}}(e,t);if(Us(e))return Ga(e,t);if(Ds(e)){return Ga(e.body,t)}throw new Error("makeIterator")}const Ha="Cannot convert supplied data type";async function Ka(e,t,n){const r=e instanceof ArrayBuffer||ArrayBuffer.isView(e);if("string"==typeof e||r)return function(e,t,n){if(t.text&&"string"==typeof e)return e;var r;if((r=e)&&"object"==typeof r&&r.isBuffer&&(e=e.buffer),e instanceof ArrayBuffer){const n=e;return t.text&&!t.binary?new TextDecoder("utf8").decode(n):n}if(ArrayBuffer.isView(e)){if(t.text&&!t.binary)return new TextDecoder("utf8").decode(e);let n=e.buffer;const r=e.byteLength||e.length;return 0===e.byteOffset&&r===n.byteLength||(n=n.slice(e.byteOffset,e.byteOffset+r)),n}throw new Error(Ha)}(e,t);if(zs(e)&&(e=await Ys(e)),Ds(e)){const n=e;return await async function(e){if(!e.ok){const t=await async function(e){let t="Failed to fetch resource ".concat(e.url," (").concat(e.status,"): ");try{const n=e.headers.get("Content-Type");let r=e.statusText;n.includes("application/json")&&(r+=" ".concat(await e.text())),t+=r,t=t.length>60?"".concat(t.slice(0,60),"..."):t}catch(n){}return t}(e);throw new Error(t)}}(n),t.binary?await n.arrayBuffer():await n.text()}if(Us(e)&&(e=Wa(e,n)),(i=e)&&"function"==typeof i[Symbol.iterator]||(e=>e&&"function"==typeof e[Symbol.asyncIterator])(e))return Ms(e);var i;throw new Error(Ha)}async function qa(e,t,n,r){us(!r||"object"==typeof r),!t||Array.isArray(t)||Ta(t)||(r=void 0,n=t,t=void 0),e=await e,n=n||{};const{url:i}=qs(e),o=function(e,t){if(!t&&e&&!Array.isArray(e))return e;let n;if(e&&(n=Array.isArray(e)?e:[e]),t&&t.loaders){const e=Array.isArray(t.loaders)?t.loaders:[t.loaders];n=n?[...n,...e]:e}return n&&n.length?n:null}(t,r),s=await async function(e,t=[],n,r){if(!Va(e))return null;let i=Ma(e,t,{...n,nothrow:!0},r);if(i)return i;if(zs(e)&&(i=Ma(e=await e.slice(0,10).arrayBuffer(),t,n,r)),!(i||null!=n&&n.nothrow))throw new Error(Oa(e));return i}(e,o,n);return s?(r=function(e,t,n=null){if(n)return n;const r={fetch:Ca(t,e),...e};return Array.isArray(r.loaders)||(r.loaders=null),r}({url:i,parse:qa,loaders:o},n=Pa(n,s,o,i),r),await async function(e,t,n,r){if(function(e,t="3.2.12"){us(e,"no worker provided");const n=e.version}(e),Ds(t)){const e=t,{ok:n,redirected:i,status:o,statusText:s,type:a,url:l}=e,c=Object.fromEntries(e.headers.entries());r.response={headers:c,ok:n,redirected:i,status:o,statusText:s,type:a,url:l}}if(t=await Ka(t,e,n),e.parseTextSync&&"string"==typeof t)return n.dataType="text",e.parseTextSync(t,n,r,e);if(function(e,t){return!!ks.isSupported()&&!!(ps||null!=t&&t._nodeWorkers)&&e.worker&&(null==t?void 0:t.worker)}(e,n))return await Ts(e,t,n,r,qa);if(e.parseText&&"string"==typeof t)return await e.parseText(t,n,r,e);if(e.parse)return await e.parse(t,n,r,e);throw us(!e.parseSync),new Error("".concat(e.id," loader - no parser found and worker is disabled"))}(s,e,n,r)):null}const Xa=1313821514,Ya=5130562,$a=!0;function Qa(e,t,n=0,r={}){const i=new DataView(t),o=function(e,t=0){return"".concat(String.fromCharCode(e.getUint8(t+0))).concat(String.fromCharCode(e.getUint8(t+1))).concat(String.fromCharCode(e.getUint8(t+2))).concat(String.fromCharCode(e.getUint8(t+3)))}(i,n+0),s=i.getUint32(n+4,$a),a=i.getUint32(n+8,$a);switch(Object.assign(e,{header:{byteOffset:n,byteLength:a,hasBinChunk:!1},type:o,version:s,json:{},binChunks:[]}),n+=12,e.version){case 1:return function(e,t,n){as(e.header.byteLength>20);const r=t.getUint32(n+0,$a),i=t.getUint32(n+4,$a);return n+=8,as(0===i),Za(e,t,n,r),n+=r,n+=Ja(e,t,n,e.header.byteLength),n}(e,i,n);case 2:return function(e,t,n,r){return as(e.header.byteLength>20),function(e,t,n,r){for(;n+8<=e.header.byteLength;){const i=t.getUint32(n+0,$a),o=t.getUint32(n+4,$a);switch(n+=8,o){case Xa:Za(e,t,n,i);break;case Ya:Ja(e,t,n,i);break;case 0:r.strict||Za(e,t,n,i);break;case 1:r.strict||Ja(e,t,n,i)}n+=Fs(i,4)}}(e,t,n,r),n+e.header.byteLength}(e,i,n,{});default:throw new Error("Invalid GLB version ".concat(e.version,". Only supports v1 and v2."))}}function Za(e,t,n,r){const i=new Uint8Array(t.buffer,n,r),o=new TextDecoder("utf8").decode(i);return e.json=JSON.parse(o),Fs(r,4)}function Ja(e,t,n,r){return e.header.hasBinChunk=!0,e.binChunks.push({byteOffset:n,byteLength:r,arrayBuffer:t.buffer}),Fs(r,4)}const el={name:"GLB",id:"glb",module:"gltf",version:"3.2.12",extensions:["glb"],mimeTypes:["model/gltf-binary"],binary:!0,parse:async function(e,t){return tl(e,t)},parseSync:tl,options:{glb:{strict:!1}}};function tl(e,t){const{byteOffset:n=0}=t||{},r={};return Qa(r,e,n,null==t?void 0:t.glb),r}class nl{constructor(e){this.gl=e}async load(e){this.glb=await async function(e,t,n,r){Array.isArray(t)||Ta(t)||(n=t,t=void 0);const i=Ca(n);let o=e;return"string"==typeof e&&(o=await i(e)),zs(e)&&(o=await i(e)),await qa(o,t,n)}(fetch(e),el),this.primitives=[];for(let t of this.glb.json.meshes)for(let e of t.primitives){const n=await this.loadPrimitive(this.glb,t.name,e);n&&this.primitives.push(n)}return this.primitives}getPrimitiveDataByMeshName(e){return this.primitives.find((t=>t.meshName==e))}async loadPrimitive(e,t,n){const r=this.gl,i=nl.getAccessorData(e,n.indices),o=nl.getAccessorData(e,n.attributes.POSITION),s=nl.getAccessorData(e,n.attributes.NORMAL),a=nl.getAccessorData(e,n.attributes.TEXCOORD_0),l=nl.getAccessorData(e,n.attributes.TANGENT);if(!(i&&o&&s&&a&&l))return null;const c=r.createBuffer();r.bindBuffer(r.ELEMENT_ARRAY_BUFFER,c),r.bufferData(r.ELEMENT_ARRAY_BUFFER,i,r.STATIC_DRAW);const u=r.createBuffer();r.bindBuffer(r.ARRAY_BUFFER,u),r.bufferData(r.ARRAY_BUFFER,o,r.STATIC_DRAW);const p=r.createBuffer();r.bindBuffer(r.ARRAY_BUFFER,p),r.bufferData(r.ARRAY_BUFFER,s,r.STATIC_DRAW);const d=r.createBuffer();r.bindBuffer(r.ARRAY_BUFFER,d),r.bufferData(r.ARRAY_BUFFER,a,r.STATIC_DRAW);const h=r.createBuffer();r.bindBuffer(r.ARRAY_BUFFER,h),r.bufferData(r.ARRAY_BUFFER,l,r.STATIC_DRAW);return{meshName:t,buffers:{indices:{data:i,webglBuffer:c,length:i.length,dataType:nl.getAccessorDataType(r,e,n.indices),numberOfComponents:nl.getAccessorNumberOfComponents(e,n.indices)},vertices:{data:o,webglBuffer:u,length:o.length,dataType:nl.getAccessorDataType(r,e,n.attributes.POSITION),numberOfComponents:nl.getAccessorNumberOfComponents(e,n.attributes.POSITION),stride:e.json.bufferViews[e.json.accessors[n.attributes.POSITION].bufferView].byteStride||0},normals:{data:s,webglBuffer:p,length:s.length,dataType:nl.getAccessorDataType(r,e,n.attributes.NORMAL),numberOfComponents:nl.getAccessorNumberOfComponents(e,n.attributes.NORMAL),stride:e.json.bufferViews[e.json.accessors[n.attributes.NORMAL].bufferView].byteStride||0},texcoords:{data:a,webglBuffer:d,length:a.length,dataType:nl.getAccessorDataType(r,e,n.attributes.TEXCOORD_0),numberOfComponents:nl.getAccessorNumberOfComponents(e,n.attributes.TEXCOORD_0),stride:e.json.bufferViews[e.json.accessors[n.attributes.TEXCOORD_0].bufferView].byteStride||0},tangents:{data:l,webglBuffer:h,length:l.length,dataType:nl.getAccessorDataType(r,e,n.attributes.TANGENT),numberOfComponents:nl.getAccessorNumberOfComponents(e,n.attributes.TANGENT),stride:e.json.bufferViews[e.json.accessors[n.attributes.TANGENT].bufferView].byteStride||0}}}}static getAccessorData(e,t){const n=e.json.accessors[t];if(n){const r=e.binChunks[0],i=e.json.bufferViews[n.bufferView],o=n.componentType,s=n.count,a=r.byteOffset+(n.byteOffset||0)+i.byteOffset;let l=nl.getAccessorNumberOfComponents(e,t);switch(o){case 5120:return new Int8Array(r.arrayBuffer,a,s*l);case 5121:return new Uint8Array(r.arrayBuffer,a,s*l);case 5122:return new Int16Array(r.arrayBuffer,a,s*l);case 5123:return new Uint16Array(r.arrayBuffer,a,s*l);case 5125:return new Uint32Array(r.arrayBuffer,a,s*l);case 5126:return new Float32Array(r.arrayBuffer,a,s*l)}}return null}static getAccessorNumberOfComponents(e,t){switch(e.json.accessors[t].type){case"SCALAR":return 1;case"VEC2":return 2;case"VEC3":return 3;case"VEC4":case"MAT2":return 4;case"MAT3":return 9;case"MAT4":return 16}return null}static getAccessorDataType(e,t,n){switch(t.json.accessors[n].componentType){case 5120:return e.BYTE;case 5121:return e.UNSIGNED_BYTE;case 5122:return e.SHORT;case 5123:return e.UNSIGNED_SHORT;case 5125:return e.UNSIGNED_INT;case 5126:return e.FLOAT}}}class rl{constructor(e,t,n,r){re(this,v,void 0),re(this,m,void 0),re(this,b,void 0),re(this,g,void 0),re(this,_,void 0),re(this,w,void 0),ie(this,v,r),ie(this,b,r),ie(this,m,0),ie(this,g,t/(Math.PI*e)),ie(this,_,1/(2*Math.PI*e*(2*Math.PI*e))),ie(this,w,n*t/(2*Math.PI*e))}update(e,t,n){null==n&&(n=(t-ne(this,b))/e,ie(this,b,t)),ie(this,v,ne(this,v)+ne(this,m)*e);const r=Math.max(ne(this,_),1.1*(e*e/4+e*ne(this,g)/2)),i=(t+ne(this,w)*n-ne(this,v)-ne(this,g)*ne(this,m))/r;return ie(this,m,ne(this,m)+i*e),ne(this,v)}get value(){return ne(this,v)}}v=new WeakMap,m=new WeakMap,b=new WeakMap,g=new WeakMap,_=new WeakMap,w=new WeakMap;x=new WeakMap,y=new WeakMap,E=new WeakMap,P=new WeakMap,C=new WeakSet,A=async function(){this.gl=this.canvas.getContext("webgl2",{antialias:!1,alpha:!1}),this.touchevents=Modernizr.touchevents;const e=this.gl;!function(e){for(let t=0;t<ts.length;++t)es(e,ts[t])}(e),e.getExtension("EXT_color_buffer_float"),e.getExtension("OES_texture_float_linear"),this.viewportSize=nn(this.canvas.clientWidth,this.canvas.clientHeight),this.processPrg=No(e,["#version 300 es\n  \nin vec3 position;\nin vec3 axis;\n\nout vec3 v_position;\nout vec3 v_axis;\nout vec4 v_color;\n\nuniform vec2 resolution;\nuniform float moveSpeed;\nuniform float turnSpeed;\nuniform float trailWeight;\nuniform float sensorOffsetDist;\nuniform float sensorAngleSpacing;\nuniform float deltaTime;\nuniform sampler2D tex;\nuniform vec2 u_pointer;\nuniform vec3 u_pointerDir;\nuniform vec2 u_pointerVelocity;\nuniform float u_pointerStrength;\n\n#ifndef QTR_PI\n#define QTR_PI 0.78539816339\n#endif\n#ifndef HALF_PI\n#define HALF_PI 1.5707963267948966192313216916398\n#endif\n#ifndef PI\n#define PI 3.1415926535897932384626433832795\n#endif\n#ifndef TWO_PI\n#define TWO_PI 6.2831853071795864769252867665590\n#endif\n#ifndef TAU\n#define TAU 6.2831853071795864769252867665590\n#endif\n#ifndef ONE_OVER_PI\n#define ONE_OVER_PI 0.31830988618\n#endif\n#ifndef SQRT_HALF_PI\n#define SQRT_HALF_PI 1.25331413732\n#endif\n#ifndef PHI\n#define PHI 1.618033988749894848204586834\n#endif\n#ifndef EPSILON\n#define EPSILON 0.0000001\n#endif\n#ifndef GOLDEN_RATIO\n#define GOLDEN_RATIO 1.6180339887\n#endif\n#ifndef GOLDEN_RATIO_CONJUGATE \n#define GOLDEN_RATIO_CONJUGATE 0.61803398875\n#endif\n#ifndef GOLDEN_ANGLE \n#define GOLDEN_ANGLE 2.39996323\n#endif\nvec3 octahedron2xyz(vec2 octahedron) {\n    \n    vec3 position = vec3(octahedron * 2. - 1., 0);                \n\n    \n    \n    \n    vec2 absolute = abs(position.xy);\n    position.z = 1. - absolute.x - absolute.y;\n\n    \n    \n    float posZ = step(0., position.z); \n    position.xy = mix(sign(position.xy) * vec2(1. - absolute.y, 1. - absolute.x), position.xy, posZ);\n\n    return normalize(position);\n}\nvec2 xyz2octahedron(vec3 direction) {\n    vec3 octant = sign(direction);\n\n    \n    float sum = dot(direction, octant);        \n    vec3 octahedron = direction / sum;    \n\n    \n    \n    vec3 absolute = abs(octahedron);\n    float posZ = step(0., octahedron.z); \n    octahedron.xy = mix(octant.xy * vec2(1. - absolute.y, 1. - absolute.x), octahedron.xy, posZ);\n\n    return octahedron.xy * 0.5 + 0.5;\n}\n\nuint hash(uint s) {\n    s ^= 2747636419u;\n    s *= 2654435769u;\n    s ^= s >> 16;\n    s *= 2654435769u;\n    s ^= s >> 16;\n    s *= 2654435769u;\n    return s;\n}\n\nfloat scaleToRange01(uint v) {\n    return float(v) / 4294967295.0;\n}\n\nfloat sense(vec3 position, vec3 direction) {\n    vec3 sensorCenter = position + direction * sensorOffsetDist;\n    sensorCenter = normalize(sensorCenter);\n    vec2 size = vec2(textureSize(tex, 0));\n    vec2 sensorUV = xyz2octahedron(sensorCenter);\n    vec4 s = texture(tex, sensorUV);\n    return s.r;\n}\n\nvec3 shiftAxis(vec3 axis, vec3 offset) {\n    return normalize(axis + offset);\n}\n\nvoid main() {\n    uint width = uint(resolution.x);\n    uint height = uint(resolution.y);\n    uint random = hash(uint(position.y) * width + uint(position.x) + uint(gl_VertexID));\n    float directionScaleFactor = 0.01;\n    v_axis = normalize(axis);\n\n    \n    \n    vec3 directionForward = cross(position, v_axis);\n    float weightForward = sense(position, directionForward * directionScaleFactor);\n    \n    vec3 axisLeft = shiftAxis(v_axis, directionForward * sensorAngleSpacing);\n    vec3 directionLeft = cross(position, axisLeft);\n    float weightLeft = sense(position, directionLeft * directionScaleFactor);\n    \n    vec3 axisRight = shiftAxis(v_axis, directionForward * -sensorAngleSpacing);\n    vec3 directionRight = cross(position, axisRight);\n    float weightRight = sense(position, directionRight * directionScaleFactor);\n\n    float randomSteerStrength = scaleToRange01(random);\n\n    \n    if (weightForward > weightLeft && weightForward > weightRight) {\n        \n    } else if (weightForward < weightLeft && weightForward < weightRight) {\n        v_axis = shiftAxis(v_axis, directionForward * (randomSteerStrength - 0.5) * 2.0 * turnSpeed * deltaTime);\n    } else if (weightRight > weightLeft) {\n        v_axis = shiftAxis(v_axis, directionForward * -randomSteerStrength * turnSpeed * deltaTime);\n    } else if (weightLeft > weightRight) {\n        v_axis = shiftAxis(v_axis, directionForward * randomSteerStrength * turnSpeed * deltaTime);\n    }\n\n    \n    vec3 newDirection = cross(position, v_axis);\n\n    \n    vec3 pointer = normalize(u_pointerDir);\n    vec3 toPointer = pointer - position;\n    \n    float pointerContributionRadius = 0.5;\n    float pointerContributionStrength = smoothstep(1. - pointerContributionRadius, 1., max(0., dot(position, pointer)));\n    \n    newDirection = normalize(newDirection - toPointer);\n    \n    newDirection *= (1. - pointerContributionStrength) * pointerContributionStrength;\n    \n    vec2 pointerPos = u_pointer * 2. - 1.;\n    float pointerPosFactor = 1. -  smoothstep(0.5, 1., length(pointerPos));\n    newDirection *= u_pointerStrength;\n    \n    float attraction = 1.2;\n    v_axis = shiftAxis(v_axis, newDirection * attraction);\n\n    \n    newDirection = cross(position, v_axis) * directionScaleFactor;\n    vec3 newPos = position + newDirection * moveSpeed * deltaTime;\n    newPos = normalize(newPos);\n    v_position = newPos;\n\n    \n    gl_Position = vec4(xyz2octahedron(v_position) * 2. - 1., 0., 1.);\n    gl_PointSize = 1.;\n    v_color = vec4(vec3(trailWeight * deltaTime), 1.);\n}","#version 300 es\n\nprecision highp float;\n\nin vec4 v_color;\n\nout vec4 outColor;\n\nvoid main() {\n    outColor = v_color;\n}"],{transformFeedbackVaryings:["v_position","v_axis"]}),this.texturePrg=No(e,["#version 300 es\n\nin vec2 position;\n\nout vec2 v_texcoord;\n\nvoid main() {\n    gl_Position = vec4(position, 0., 1.);\n    v_texcoord = position * 0.5 + 0.5;\n}","#version 300 es\n\nprecision highp float;\n\nout vec4 outColor;\n\nin vec2 v_texcoord;\n\n#ifndef QTR_PI\n#define QTR_PI 0.78539816339\n#endif\n#ifndef HALF_PI\n#define HALF_PI 1.5707963267948966192313216916398\n#endif\n#ifndef PI\n#define PI 3.1415926535897932384626433832795\n#endif\n#ifndef TWO_PI\n#define TWO_PI 6.2831853071795864769252867665590\n#endif\n#ifndef TAU\n#define TAU 6.2831853071795864769252867665590\n#endif\n#ifndef ONE_OVER_PI\n#define ONE_OVER_PI 0.31830988618\n#endif\n#ifndef SQRT_HALF_PI\n#define SQRT_HALF_PI 1.25331413732\n#endif\n#ifndef PHI\n#define PHI 1.618033988749894848204586834\n#endif\n#ifndef EPSILON\n#define EPSILON 0.0000001\n#endif\n#ifndef GOLDEN_RATIO\n#define GOLDEN_RATIO 1.6180339887\n#endif\n#ifndef GOLDEN_RATIO_CONJUGATE \n#define GOLDEN_RATIO_CONJUGATE 0.61803398875\n#endif\n#ifndef GOLDEN_ANGLE \n#define GOLDEN_ANGLE 2.39996323\n#endif\n\n#ifndef FNC_EQUIRECT2XYZ\n#define FNC_EQUIRECT2XYZ\nvec3 equirect2xyz(vec2 uv) {\n    float Phi = PI - uv.y * PI;\n    float Theta = uv.x * TWO_PI;\n    vec3 dir = vec3(cos(Theta), 0.0, sin(Theta));\n    dir.y   = cos(Phi);\n    dir.xz *= sqrt(1.0 - dir.y * dir.y);\n    return dir;\n}\n#endif\n#ifndef QTR_PI\n#define QTR_PI 0.78539816339\n#endif\n#ifndef HALF_PI\n#define HALF_PI 1.5707963267948966192313216916398\n#endif\n#ifndef PI\n#define PI 3.1415926535897932384626433832795\n#endif\n#ifndef TWO_PI\n#define TWO_PI 6.2831853071795864769252867665590\n#endif\n#ifndef TAU\n#define TAU 6.2831853071795864769252867665590\n#endif\n#ifndef ONE_OVER_PI\n#define ONE_OVER_PI 0.31830988618\n#endif\n#ifndef SQRT_HALF_PI\n#define SQRT_HALF_PI 1.25331413732\n#endif\n#ifndef PHI\n#define PHI 1.618033988749894848204586834\n#endif\n#ifndef EPSILON\n#define EPSILON 0.0000001\n#endif\n#ifndef GOLDEN_RATIO\n#define GOLDEN_RATIO 1.6180339887\n#endif\n#ifndef GOLDEN_RATIO_CONJUGATE \n#define GOLDEN_RATIO_CONJUGATE 0.61803398875\n#endif\n#ifndef GOLDEN_ANGLE \n#define GOLDEN_ANGLE 2.39996323\n#endif\n\n#ifndef FNC_XYZ2EQUIRECT\n#define FNC_XYZ2EQUIRECT\nvec2 xyz2equirect(vec3 d) {\n    return vec2(atan(d.z, d.x) + PI, acos(-d.y)) / vec2(2.0 * PI, PI);\n}\n#endif\n#ifndef FNC_MOD289\n#define FNC_MOD289\n\nfloat mod289(const in float x) { return x - floor(x * (1. / 289.)) * 289.; }\nvec2 mod289(const in vec2 x) { return x - floor(x * (1. / 289.)) * 289.; }\nvec3 mod289(const in vec3 x) { return x - floor(x * (1. / 289.)) * 289.; }\nvec4 mod289(const in vec4 x) { return x - floor(x * (1. / 289.)) * 289.; }\n\n#endif\n#ifndef FNC_MOD289\n#define FNC_MOD289\n\nfloat mod289(const in float x) { return x - floor(x * (1. / 289.)) * 289.; }\nvec2 mod289(const in vec2 x) { return x - floor(x * (1. / 289.)) * 289.; }\nvec3 mod289(const in vec3 x) { return x - floor(x * (1. / 289.)) * 289.; }\nvec4 mod289(const in vec4 x) { return x - floor(x * (1. / 289.)) * 289.; }\n\n#endif\n\n#ifndef FNC_PERMUTE\n#define FNC_PERMUTE\n\nfloat permute(const in float x) { return mod289(((x * 34.0) + 1.0) * x); }\nvec2 permute(const in vec2 x) { return mod289(((x * 34.0) + 1.0) * x); }\nvec3 permute(const in vec3 x) { return mod289(((x * 34.0) + 1.0) * x); }\nvec4 permute(const in vec4 x) { return mod289(((x * 34.0) + 1.0) * x); }\n\n#endif\n#ifndef FNC_TAYLORINVSQRT\n#define FNC_TAYLORINVSQRT\n\nfloat taylorInvSqrt(in float r) { return 1.79284291400159 - 0.85373472095314 * r; }\nvec2 taylorInvSqrt(in vec2 r) { return 1.79284291400159 - 0.85373472095314 * r; }\nvec3 taylorInvSqrt(in vec3 r) { return 1.79284291400159 - 0.85373472095314 * r; }\nvec4 taylorInvSqrt(in vec4 r) { return 1.79284291400159 - 0.85373472095314 * r; }\n\n#endif\n#ifndef FNC_GRAD4\n#define FNC_GRAD4\nvec4 grad4(float j, vec4 ip) {\n    const vec4 ones = vec4(1.0, 1.0, 1.0, -1.0);\n    vec4 p,s;\n\n    p.xyz = floor( fract (vec3(j) * ip.xyz) * 7.0) * ip.z - 1.0;\n    p.w = 1.5 - dot(abs(p.xyz), ones.xyz);\n    s = vec4(lessThan(p, vec4(0.0)));\n    p.xyz = p.xyz + (s.xyz*2.0 - 1.0) * s.www;\n\n    return p;\n}\n#endif\n\n#ifndef FNC_SNOISE\n#define FNC_SNOISE\nfloat snoise(in vec2 v) {\n    const vec4 C = vec4(0.211324865405187,  \n                        0.366025403784439,  \n                        -0.577350269189626,  \n                        0.024390243902439); \n    \n    vec2 i  = floor(v + dot(v, C.yy) );\n    vec2 x0 = v -   i + dot(i, C.xx);\n\n    \n    vec2 i1;\n    \n    \n    i1 = (x0.x > x0.y) ? vec2(1.0, 0.0) : vec2(0.0, 1.0);\n    \n    \n    \n    vec4 x12 = x0.xyxy + C.xxzz;\n    x12.xy -= i1;\n\n    \n    i = mod289(i); \n    vec3 p = permute( permute( i.y + vec3(0.0, i1.y, 1.0 ))\n    + i.x + vec3(0.0, i1.x, 1.0 ));\n\n    vec3 m = max(0.5 - vec3(dot(x0,x0), dot(x12.xy,x12.xy), dot(x12.zw,x12.zw)), 0.0);\n    m = m*m ;\n    m = m*m ;\n\n    \n    \n\n    vec3 x = 2.0 * fract(p * C.www) - 1.0;\n    vec3 h = abs(x) - 0.5;\n    vec3 ox = floor(x + 0.5);\n    vec3 a0 = x - ox;\n\n    \n    \n    m *= 1.79284291400159 - 0.85373472095314 * ( a0*a0 + h*h );\n\n    \n    vec3 g;\n    g.x  = a0.x  * x0.x  + h.x  * x0.y;\n    g.yz = a0.yz * x12.xz + h.yz * x12.yw;\n    return 130.0 * dot(m, g);\n}\n\nfloat snoise(in vec3 v) {\n    const vec2  C = vec2(1.0/6.0, 1.0/3.0) ;\n    const vec4  D = vec4(0.0, 0.5, 1.0, 2.0);\n\n    \n    vec3 i  = floor(v + dot(v, C.yyy) );\n    vec3 x0 =   v - i + dot(i, C.xxx) ;\n\n    \n    vec3 g = step(x0.yzx, x0.xyz);\n    vec3 l = 1.0 - g;\n    vec3 i1 = min( g.xyz, l.zxy );\n    vec3 i2 = max( g.xyz, l.zxy );\n\n    \n    \n    \n    \n    vec3 x1 = x0 - i1 + C.xxx;\n    vec3 x2 = x0 - i2 + C.yyy; \n    vec3 x3 = x0 - D.yyy;      \n\n    \n    i = mod289(i);\n    vec4 p = permute( permute( permute(\n                i.z + vec4(0.0, i1.z, i2.z, 1.0 ))\n            + i.y + vec4(0.0, i1.y, i2.y, 1.0 ))\n            + i.x + vec4(0.0, i1.x, i2.x, 1.0 ));\n\n    \n    \n    float n_ = 0.142857142857; \n    vec3  ns = n_ * D.wyz - D.xzx;\n\n    vec4 j = p - 49.0 * floor(p * ns.z * ns.z);  \n\n    vec4 x_ = floor(j * ns.z);\n    vec4 y_ = floor(j - 7.0 * x_ );    \n\n    vec4 x = x_ *ns.x + ns.yyyy;\n    vec4 y = y_ *ns.x + ns.yyyy;\n    vec4 h = 1.0 - abs(x) - abs(y);\n\n    vec4 b0 = vec4( x.xy, y.xy );\n    vec4 b1 = vec4( x.zw, y.zw );\n\n    \n    \n    vec4 s0 = floor(b0)*2.0 + 1.0;\n    vec4 s1 = floor(b1)*2.0 + 1.0;\n    vec4 sh = -step(h, vec4(0.0));\n\n    vec4 a0 = b0.xzyw + s0.xzyw*sh.xxyy ;\n    vec4 a1 = b1.xzyw + s1.xzyw*sh.zzww ;\n\n    vec3 p0 = vec3(a0.xy,h.x);\n    vec3 p1 = vec3(a0.zw,h.y);\n    vec3 p2 = vec3(a1.xy,h.z);\n    vec3 p3 = vec3(a1.zw,h.w);\n\n    \n    vec4 norm = taylorInvSqrt(vec4(dot(p0,p0), dot(p1,p1), dot(p2, p2), dot(p3,p3)));\n    p0 *= norm.x;\n    p1 *= norm.y;\n    p2 *= norm.z;\n    p3 *= norm.w;\n\n    \n    vec4 m = max(0.6 - vec4(dot(x0,x0), dot(x1,x1), dot(x2,x2), dot(x3,x3)), 0.0);\n    m = m * m;\n    return 42.0 * dot( m*m, vec4( dot(p0,x0), dot(p1,x1),\n                                dot(p2,x2), dot(p3,x3) ) );\n}\n\nfloat snoise(in vec4 v) {\n    const vec4  C = vec4( 0.138196601125011,  \n                        0.276393202250021,  \n                        0.414589803375032,  \n                        -0.447213595499958); \n\n    \n    vec4 i  = floor(v + dot(v, vec4(.309016994374947451)) ); \n    vec4 x0 = v -   i + dot(i, C.xxxx);\n\n    \n\n    \n    vec4 i0;\n    vec3 isX = step( x0.yzw, x0.xxx );\n    vec3 isYZ = step( x0.zww, x0.yyz );\n    \n    i0.x = isX.x + isX.y + isX.z;\n    i0.yzw = 1.0 - isX;\n    \n    i0.y += isYZ.x + isYZ.y;\n    i0.zw += 1.0 - isYZ.xy;\n    i0.z += isYZ.z;\n    i0.w += 1.0 - isYZ.z;\n\n    \n    vec4 i3 = clamp( i0, 0.0, 1.0 );\n    vec4 i2 = clamp( i0-1.0, 0.0, 1.0 );\n    vec4 i1 = clamp( i0-2.0, 0.0, 1.0 );\n\n    \n    \n    \n    \n    \n    vec4 x1 = x0 - i1 + C.xxxx;\n    vec4 x2 = x0 - i2 + C.yyyy;\n    vec4 x3 = x0 - i3 + C.zzzz;\n    vec4 x4 = x0 + C.wwww;\n\n    \n    i = mod289(i);\n    float j0 = permute( permute( permute( permute(i.w) + i.z) + i.y) + i.x);\n    vec4 j1 = permute( permute( permute( permute (\n                i.w + vec4(i1.w, i2.w, i3.w, 1.0 ))\n            + i.z + vec4(i1.z, i2.z, i3.z, 1.0 ))\n            + i.y + vec4(i1.y, i2.y, i3.y, 1.0 ))\n            + i.x + vec4(i1.x, i2.x, i3.x, 1.0 ));\n\n    \n    \n    vec4 ip = vec4(1.0/294.0, 1.0/49.0, 1.0/7.0, 0.0) ;\n\n    vec4 p0 = grad4(j0,   ip);\n    vec4 p1 = grad4(j1.x, ip);\n    vec4 p2 = grad4(j1.y, ip);\n    vec4 p3 = grad4(j1.z, ip);\n    vec4 p4 = grad4(j1.w, ip);\n\n    \n    vec4 norm = taylorInvSqrt(vec4(dot(p0,p0), dot(p1,p1), dot(p2, p2), dot(p3,p3)));\n    p0 *= norm.x;\n    p1 *= norm.y;\n    p2 *= norm.z;\n    p3 *= norm.w;\n    p4 *= taylorInvSqrt(dot(p4,p4));\n\n    \n    vec3 m0 = max(0.6 - vec3(dot(x0,x0), dot(x1,x1), dot(x2,x2)), 0.0);\n    vec2 m1 = max(0.6 - vec2(dot(x3,x3), dot(x4,x4)            ), 0.0);\n    m0 = m0 * m0;\n    m1 = m1 * m1;\n    return 49.0 * ( dot(m0*m0, vec3( dot( p0, x0 ), dot( p1, x1 ), dot( p2, x2 )))\n                + dot(m1*m1, vec2( dot( p3, x3 ), dot( p4, x4 ) ) ) ) ;\n}\n\nvec2 snoise2( vec2 x ){\n    float s  = snoise(vec2( x ));\n    float s1 = snoise(vec2( x.y - 19.1, x.x + 47.2 ));\n    return vec2( s , s1 );\n}\n\nvec3 snoise3( vec3 x ){\n    float s  = snoise(vec3( x ));\n    float s1 = snoise(vec3( x.y - 19.1 , x.z + 33.4 , x.x + 47.2 ));\n    float s2 = snoise(vec3( x.z + 74.2 , x.x - 124.5 , x.y + 99.4 ));\n    return vec3( s , s1 , s2 );\n}\n\nvec3 snoise3( vec4 x ){\n    float s  = snoise(vec4( x ));\n    float s1 = snoise(vec4( x.y - 19.1 , x.z + 33.4 , x.x + 47.2, x.w ));\n    float s2 = snoise(vec4( x.z + 74.2 , x.x - 124.5 , x.y + 99.4, x.w ));\n    return vec3( s , s1 , s2 );\n}\n\n#endif\n#ifndef FNC_RANDOM\n#define FNC_RANDOM\nfloat random(in float x) {\n  return fract(sin(x) * 43758.5453);\n}\n\nfloat random(in vec2 st) {\n  return fract(sin(dot(st.xy, vec2(12.9898, 78.233))) * 43758.5453);\n}\n\nfloat random(in vec3 pos) {\n  return fract(sin(dot(pos.xyz, vec3(70.9898, 78.233, 32.4355))) * 43758.5453123);\n}\n\nfloat random(in vec4 pos) {\n    float dot_product = dot(pos, vec4(12.9898,78.233,45.164,94.673));\n    return fract(sin(dot_product) * 43758.5453);\n}\n\n#ifndef RANDOM_SCALE3\n#define RANDOM_SCALE3 vec3(.1031, .1030, .0973)\n#endif\n\n#ifndef RANDOM_SCALE4\n#define RANDOM_SCALE4 vec4(1031, .1030, .0973, .1099)\n#endif\nvec2 random2(float p) {\n    vec3 p3 = fract(vec3(p) * RANDOM_SCALE3);\n    p3 += dot(p3, p3.yzx + 19.19);\n    return fract((p3.xx+p3.yz)*p3.zy);\n}\n\nvec2 random2(vec2 p) {\n    vec3 p3 = fract(p.xyx * RANDOM_SCALE3);\n    p3 += dot(p3, p3.yzx + 19.19);\n    return fract((p3.xx+p3.yz)*p3.zy);\n}\n\nvec2 random2(vec3 p3) {\n    p3 = fract(p3 * RANDOM_SCALE3);\n    p3 += dot(p3, p3.yzx+19.19);\n    return fract((p3.xx+p3.yz)*p3.zy);\n}\n\nvec3 random3(float p) {\n    vec3 p3 = fract(vec3(p) * RANDOM_SCALE3);\n    p3 += dot(p3, p3.yzx+19.19);\n    return fract((p3.xxy+p3.yzz)*p3.zyx); \n}\n\nvec3 random3(vec2 p) {\n    vec3 p3 = fract(vec3(p.xyx) * RANDOM_SCALE3);\n    p3 += dot(p3, p3.yxz+19.19);\n    return fract((p3.xxy+p3.yzz)*p3.zyx);\n}\n\nvec3 random3(vec3 p) {\n    p = fract(p * RANDOM_SCALE3);\n    p += dot(p, p.yxz+19.19);\n    return fract((p.xxy + p.yzz)*p.zyx);\n}\n\nvec4 random4(float p) {\n    vec4 p4 = fract(vec4(p) * RANDOM_SCALE4);\n    p4 += dot(p4, p4.wzxy+19.19);\n    return fract((p4.xxyz+p4.yzzw)*p4.zywx);   \n}\n\nvec4 random4(vec2 p) {\n    vec4 p4 = fract(vec4(p.xyxy) * RANDOM_SCALE4);\n    p4 += dot(p4, p4.wzxy+19.19);\n    return fract((p4.xxyz+p4.yzzw)*p4.zywx);\n}\n\nvec4 random4(vec3 p) {\n    vec4 p4 = fract(vec4(p.xyzx)  * RANDOM_SCALE4);\n    p4 += dot(p4, p4.wzxy+19.19);\n    return fract((p4.xxyz+p4.yzzw)*p4.zywx);\n}\n\nvec4 random4(vec4 p4) {\n    p4 = fract(p4  * RANDOM_SCALE4);\n    p4 += dot(p4, p4.wzxy+19.19);\n    return fract((p4.xxyz+p4.yzzw)*p4.zywx);\n}\n\n#endif\n\n#ifndef FNC_WORLEY\n#define FNC_WORLEY\n\nfloat worley(vec2 p){\n    vec2 n = floor( p );\n    vec2 f = fract( p );\n\n    float dis = 1.0;\n    for( int j= -1; j <= 1; j++ )\n        for( int i=-1; i <= 1; i++ ) {\t\n                vec2  g = vec2(i,j);\n                vec2  o = random2( n + g );\n                vec2  delta = g + o - f;\n                float d = length(delta);\n                dis = min(dis,d);\n    }\n\n    return 1.0-dis;\n}\n\nfloat worley(vec3 p) {\n    vec3 n = floor( p );\n    vec3 f = fract( p );\n\n    float dis = 1.0;\n    for( int k = -1; k <= 1; k++ )\n        for( int j= -1; j <= 1; j++ )\n            for( int i=-1; i <= 1; i++ ) {\t\n                vec3  g = vec3(i,j,k);\n                vec3  o = random3( n + g );\n                vec3  delta = g+o-f;\n                float d = length(delta);\n                dis = min(dis,d);\n    }\n\n    return 1.0-dis;\n}\n\n#endif\n\nvoid main() {\n    vec2 st = v_texcoord;\n    vec3 dir = equirect2xyz(st);\n\n    float noiseSimplex = snoise(dir * 90.);\n\n    float noiseWorley_c = worley(dir * 30.);\n    vec2 texelSize = vec2(dFdx(st).x, dFdy(st).y);\n    float noiseScale = 30.;\n    float noiseWorley_px = worley(equirect2xyz(st + texelSize) * noiseScale);\n    float noiseWorley_py = worley(equirect2xyz(st + texelSize) * noiseScale);\n    float noiseWorley_nx = worley(equirect2xyz(st - texelSize) * noiseScale);\n    float noiseWorley_ny = worley(equirect2xyz(st - texelSize) * noiseScale);\n\n    \n    float dy = noiseWorley_nx - noiseWorley_px;\n    float dx = noiseWorley_ny - noiseWorley_py;\n\n    \n    float nz = 1. / sqrt(dx * dx + dy * dy + 1.);\n    float nx = min(max(-dx * nz, -1.), 1.);\n    float ny = min(max(-dy * nz, -1.), 1.);\n    vec3 normal = vec3(nx, ny, nz);\n\n    outColor = vec4(normal * 0.5 + 0.5, noiseSimplex);\n}"]),this.spreadPrg=No(e,[os,"#version 300 es\n\nprecision highp float;\n\nin vec2 v_texcoord;\n\nuniform float evaporateSpeed;\nuniform float diffuseSpeed;\nuniform float deltaTime;\nuniform sampler2D tex;\n\nout vec4 outColor;\n\nvec2 wrapOctahedron(vec2 uv) {\n  vec2 st = abs(fract(uv * 0.5 - 0.5) * 2. - 1.);\n  vec2 flip = sign(1. - abs(uv.xy * 2. - 1.));\n  return (st * flip.yx);\n}\n\n#ifndef BOXBLUR2D_FAST9_SAMPLER_FNC\n#define BOXBLUR2D_FAST9_SAMPLER_FNC(TEX, UV) texture(TEX, wrapOctahedron(UV))\n#endif\n\n#ifndef SAMPLER_FNC\n\n#if __VERSION__ >= 300\n#define SAMPLER_FNC(TEX, UV) texture(TEX, UV)\n#else\n#define SAMPLER_FNC(TEX, UV) texture2D(TEX, UV)\n#endif\n\n#endif\n\n#ifndef BOXBLUR2D_FAST9_TYPE\n#ifdef BOXBLUR_TYPE\n#define BOXBLUR2D_FAST9_TYPE BOXBLUR_TYPE\n#else\n#define BOXBLUR2D_FAST9_TYPE vec4\n#endif\n#endif\n\n#ifndef BOXBLUR2D_FAST9_SAMPLER_FNC\n#ifdef BOXBLUR_SAMPLER_FNC\n#define BOXBLUR2D_FAST9_SAMPLER_FNC(TEX, UV) BOXBLUR_SAMPLER_FNC(TEX, UV)\n#else\n#define BOXBLUR2D_FAST9_SAMPLER_FNC(TEX, UV) SAMPLER_FNC(TEX, UV)\n#endif\n#endif\n\n#ifndef FNC_BOXBLUR2D_FAST9\n#define FNC_BOXBLUR2D_FAST9\nBOXBLUR2D_FAST9_TYPE boxBlur2D_fast9(in sampler2D tex, in vec2 st, in vec2 offset) {\n    BOXBLUR2D_FAST9_TYPE color = BOXBLUR2D_FAST9_SAMPLER_FNC(tex, st);          \n    color += BOXBLUR2D_FAST9_SAMPLER_FNC(tex, st + vec2(-offset.x, offset.y));  \n    color += BOXBLUR2D_FAST9_SAMPLER_FNC(tex, st + vec2(-offset.x, 0.));        \n    color += BOXBLUR2D_FAST9_SAMPLER_FNC(tex, st + vec2(-offset.x, -offset.y)); \n    color += BOXBLUR2D_FAST9_SAMPLER_FNC(tex, st + vec2(0., offset.y));         \n    color += BOXBLUR2D_FAST9_SAMPLER_FNC(tex, st + vec2(0., -offset.y));        \n    color += BOXBLUR2D_FAST9_SAMPLER_FNC(tex, st + offset);                     \n    color += BOXBLUR2D_FAST9_SAMPLER_FNC(tex, st + vec2(offset.x, 0.));         \n    color += BOXBLUR2D_FAST9_SAMPLER_FNC(tex, st + vec2(offset.x, -offset.y));  \n    return color * 0.1111111111; \n}\n#endif\n\nvoid main() {\n  vec2 resolution = vec2(textureSize(tex, 0));\n  vec2 texelSize = 1. / resolution;\n\n  \n  vec4 blurResult = boxBlur2D_fast9(tex, v_texcoord, texelSize);\n\n  \n  vec4 originalValue = texture(tex, v_texcoord);\n  vec4 diffusedValue = mix(originalValue, blurResult, diffuseSpeed * deltaTime);\n  vec4 diffusedAndEvaporatedValue = max(vec4(0), diffusedValue - evaporateSpeed * deltaTime);\n\n  outColor = vec4(diffusedAndEvaporatedValue.rgb, 1.);\n}"]),this.blurPrg=No(e,[os,"#version 300 es\n\nprecision highp float;\n\nuniform sampler2D u_texture;\n\nin vec2 v_texcoord;\n\nout vec4 outColor;\n\nvec2 wrapOctahedron(vec2 uv) {\n  vec2 st = abs(fract(uv * 0.5 - 0.5) * 2. - 1.);\n  vec2 flip = sign(1. - abs(uv.xy * 2. - 1.));\n  return (st * flip.yx);\n}\n\n#ifndef GAUSSIANBLUR2D_SAMPLER_FNC\n#define GAUSSIANBLUR2D_SAMPLER_FNC(TEX, UV) texture(TEX, wrapOctahedron(UV))\n#endif\n\n#ifndef SAMPLER_FNC\n\n#if __VERSION__ >= 300\n#define SAMPLER_FNC(TEX, UV) texture(TEX, UV)\n#else\n#define SAMPLER_FNC(TEX, UV) texture2D(TEX, UV)\n#endif\n\n#endif\n\n#ifndef GAUSSIANBLUR2D_TYPE\n#ifdef GAUSSIANBLUR_TYPE\n#define GAUSSIANBLUR2D_TYPE GAUSSIANBLUR_TYPE\n#else\n#define GAUSSIANBLUR2D_TYPE vec4\n#endif\n#endif\n\n#ifndef GAUSSIANBLUR2D_SAMPLER_FNC\n#ifdef GAUSSIANBLUR_SAMPLER_FNC\n#define GAUSSIANBLUR2D_SAMPLER_FNC(TEX, UV) GAUSSIANBLUR_SAMPLER_FNC(TEX, UV)\n#else\n#define GAUSSIANBLUR2D_SAMPLER_FNC(TEX, UV) SAMPLER_FNC(TEX, UV)\n#endif\n#endif\n\n#ifndef FNC_GAUSSIANBLUR2D\n#define FNC_GAUSSIANBLUR2D\nGAUSSIANBLUR2D_TYPE gaussianBlur2D(in sampler2D tex, in vec2 st, in vec2 offset, const int kernelSize) {\n    GAUSSIANBLUR2D_TYPE accumColor = GAUSSIANBLUR2D_TYPE(0.);\n    \n    #ifndef GAUSSIANBLUR2D_KERNELSIZE\n    \n    #if defined(PLATFORM_WEBGL)\n    #define GAUSSIANBLUR2D_KERNELSIZE 20\n    float kernelSizef = float(kernelSize);\n    #else\n    #define GAUSSIANBLUR2D_KERNELSIZE kernelSize\n    float kernelSizef = float(GAUSSIANBLUR2D_KERNELSIZE);\n    #endif\n\n    #else\n    float kernelSizef = float(GAUSSIANBLUR2D_KERNELSIZE);\n    #endif\n\n    float accumWeight = 0.;\n    const float k = .15915494; \n    float kernelSize2 = kernelSizef * kernelSizef;\n\n    for (int j = 0; j < GAUSSIANBLUR2D_KERNELSIZE; j++) {\n        #if defined(PLATFORM_WEBGL)\n        if (j >= kernelSize)\n            break;\n        #endif\n        float y = -.5 * (kernelSizef - 1.) + float(j);\n        for (int i = 0; i < GAUSSIANBLUR2D_KERNELSIZE; i++) {\n            #if defined(PLATFORM_WEBGL)\n            if (i >= kernelSize)\n                break;\n            #endif\n            float x = -.5 * (kernelSizef - 1.) + float(i);\n            float weight = (k / kernelSizef) * exp(-(x * x + y * y) / (2. * kernelSize2));\n            accumColor += weight * GAUSSIANBLUR2D_SAMPLER_FNC(tex, st + vec2(x, y) * offset);\n            accumWeight += weight;\n        }\n    }\n    return accumColor / accumWeight;\n}\n#endif\n\nvoid main() {\n    vec2 size = vec2(textureSize(u_texture, 0));\n    vec4 color = gaussianBlur2D(u_texture, v_texcoord, 1.5 / size, 8);\n    outColor = color;\n}"]),this.spherePrg=No(e,["#version 300 es\n\nuniform mat4 u_worldMatrix;\nuniform mat4 u_worldInverseTransposeMatrix;\nuniform mat4 u_viewMatrix;\nuniform mat4 u_projectionMatrix;\nuniform float u_time;\nuniform vec3 u_cameraPos;\nuniform sampler2D u_texture;\nuniform float u_displacementStrength;\nuniform vec3 u_pointerDir;\n\nin vec3 position;\nin vec3 normal;\nin vec2 texcoord;\nin vec3 tangent;\n\nout vec3 v_position;\nout vec2 v_texcoord;\nout vec3 v_normal;\nout vec3 v_tangent;\nout vec3 v_surfaceToView;\n\nvec2 wrapOctahedron(vec2 uv) {\n  vec2 st = abs(fract(uv * 0.5 - 0.5) * 2. - 1.);\n  vec2 flip = sign(1. - abs(uv.xy * 2. - 1.));\n  return (st * flip.yx);\n}\nvec2 xyz2octahedron(vec3 direction) {\n    vec3 octant = sign(direction);\n\n    \n    float sum = dot(direction, octant);        \n    vec3 octahedron = direction / sum;    \n\n    \n    \n    vec3 absolute = abs(octahedron);\n    float posZ = step(0., octahedron.z); \n    octahedron.xy = mix(octant.xy * vec2(1. - absolute.y, 1. - absolute.x), octahedron.xy, posZ);\n\n    return octahedron.xy * 0.5 + 0.5;\n}\n\nvec3 distort(\n    sampler2D tex, \n    vec3 position, \n    vec3 pointerDir,\n    float displacementStrength,\n    float time\n) {\n  vec3 pos = position;\n  vec2 st = wrapOctahedron(xyz2octahedron(pos));\n  vec4 map = texture(tex, st);\n\n  \n  float pointerDist = dot(pos, normalize(u_pointerDir));\n  float pointerOffset = max(0., pointerDist);\n  float pointerIntensity = smoothstep(0.5, 1., pointerOffset);\n  pos *= pow(pointerOffset, 4.) * 6. * displacementStrength + 1.;\n\n  \n  float pointerPulse = sin(pointerDist * 5. - u_time * 0.005);\n  pointerPulse = pointerPulse * displacementStrength + 1.;\n\n  \n  float h = map.r;\n  h = smoothstep(0.1, 1.5, h);\n  float displacement = 1. + h * (displacementStrength + 0.06 + pointerIntensity * 2. * displacementStrength);\n  pos *= displacement;\n\n  \n  float wobbleStrength = 0.04;\n  pos.x *= sin(time * 0.0005 + pos.x) * wobbleStrength + (1. - wobbleStrength);\n  pos.y *= cos(time * 0.0009 + pos.y) * wobbleStrength + (1. - wobbleStrength);\n\n  pos *= mix(pointerPulse, 1., h);\n\n  return pos;\n}\n\nvoid main() {\n  \n  vec3 pos = distort(u_texture, position, u_pointerDir, u_displacementStrength, u_time);\n\n  vec4 worldPosition = u_worldMatrix * vec4(pos, 1.);\n  gl_Position = u_projectionMatrix * u_viewMatrix * worldPosition;\n\n  v_position = position;\n  v_texcoord = texcoord;\n  v_tangent = tangent;\n  v_normal = normal;\n  v_surfaceToView = u_cameraPos - worldPosition.xyz;\n}","#version 300 es\n\nprecision highp float;\n\nuniform mat4 u_worldMatrix;\nuniform mat4 u_worldInverseTransposeMatrix;\nuniform mat4 u_worldInverseMatrix;\nuniform sampler2D u_texture;\nuniform float u_time;\nuniform vec3 u_pointerDir;\nuniform float u_displacementStrength;\nuniform sampler2D u_albedoRampTexture;\nuniform sampler2D u_envTexture;\nuniform sampler2D u_noiseTexture;\nuniform float u_hueShift;\n\nout vec4 outColor;\n\nin vec3 v_position;\nin vec2 v_texcoord;\nin vec3 v_normal;\nin vec3 v_tangent;\nin vec3 v_surfaceToView;\n\nvec2 wrapOctahedron(vec2 uv) {\n  vec2 st = abs(fract(uv * 0.5 - 0.5) * 2. - 1.);\n  vec2 flip = sign(1. - abs(uv.xy * 2. - 1.));\n  return (st * flip.yx);\n}\nvec2 xyz2octahedron(vec3 direction) {\n    vec3 octant = sign(direction);\n\n    \n    float sum = dot(direction, octant);        \n    vec3 octahedron = direction / sum;    \n\n    \n    \n    vec3 absolute = abs(octahedron);\n    float posZ = step(0., octahedron.z); \n    octahedron.xy = mix(octant.xy * vec2(1. - absolute.y, 1. - absolute.x), octahedron.xy, posZ);\n\n    return octahedron.xy * 0.5 + 0.5;\n}\n\nvec3 distort(\n    sampler2D tex, \n    vec3 position, \n    vec3 pointerDir,\n    float displacementStrength,\n    float time\n) {\n  vec3 pos = position;\n  vec2 st = wrapOctahedron(xyz2octahedron(pos));\n  vec4 map = texture(tex, st);\n\n  \n  float pointerDist = dot(pos, normalize(u_pointerDir));\n  float pointerOffset = max(0., pointerDist);\n  float pointerIntensity = smoothstep(0.5, 1., pointerOffset);\n  pos *= pow(pointerOffset, 4.) * 6. * displacementStrength + 1.;\n\n  \n  float pointerPulse = sin(pointerDist * 5. - u_time * 0.005);\n  pointerPulse = pointerPulse * displacementStrength + 1.;\n\n  \n  float h = map.r;\n  h = smoothstep(0.1, 1.5, h);\n  float displacement = 1. + h * (displacementStrength + 0.06 + pointerIntensity * 2. * displacementStrength);\n  pos *= displacement;\n\n  \n  float wobbleStrength = 0.04;\n  pos.x *= sin(time * 0.0005 + pos.x) * wobbleStrength + (1. - wobbleStrength);\n  pos.y *= cos(time * 0.0009 + pos.y) * wobbleStrength + (1. - wobbleStrength);\n\n  pos *= mix(pointerPulse, 1., h);\n\n  return pos;\n}\n#ifndef FNC_POWFAST\n#define FNC_POWFAST\n\nfloat powFast(const in float a, const in float b) { return a / ((1. - b) * a + b); }\n\n#endif\n#ifndef FNC_TOSHININESS\n#define FNC_TOSHININESS\n\nfloat toShininess(const in float roughness, const in float metallic) {\n    float s = .95 - roughness * 0.5;\n    s *= s;\n    s *= s;\n    return s * (80. + 160. * (1.0-metallic));\n}\n\n#endif\n\n#ifndef SPECULAR_POW\n#if defined(TARGET_MOBILE) || defined(PLATFORM_RPI) || defined(PLATFORM_WEBGL)\n#define SPECULAR_POW(A,B) powFast(A,B)\n#else\n#define SPECULAR_POW(A,B) pow(A,B)\n#endif\n#endif\n\n#ifndef FNC_SPECULAR_BLINNPHONG\n#define FNC_SPECULAR_BLINNPHONG\n\nfloat specularBlinnPhong(const in vec3 L, const in vec3 N, const in vec3 V, float shininess) {\n    \n    vec3 H = normalize(L + V);\n    return SPECULAR_POW(max(0.0, dot(N, H)), shininess);\n}\n\nfloat specularBlinnPhongRoughnes(const in vec3 L, const in vec3 N, const in vec3 V, const in float roughness) {\n    return specularBlinnPhong(L, N, V, toShininess(roughness, 0.0) );\n}\n\nfloat specularBlinnPhongRoughnes(const in vec3 L, const in vec3 N, const in vec3 V, const in float roughness, const in float fresnel) {\n    return specularBlinnPhongRoughnes(L, N, V, roughness);\n}\n\nfloat specularBlinnPhongRoughnes(const in vec3 L, const in vec3 N, const in vec3 V, const in float NoV, const in float NoL, const in float roughness, const in float fresnel) {\n    return specularBlinnPhongRoughnes(L, N, V, roughness);\n}\n\n#endif\n#ifndef QTR_PI\n#define QTR_PI 0.78539816339\n#endif\n#ifndef HALF_PI\n#define HALF_PI 1.5707963267948966192313216916398\n#endif\n#ifndef PI\n#define PI 3.1415926535897932384626433832795\n#endif\n#ifndef TWO_PI\n#define TWO_PI 6.2831853071795864769252867665590\n#endif\n#ifndef TAU\n#define TAU 6.2831853071795864769252867665590\n#endif\n#ifndef ONE_OVER_PI\n#define ONE_OVER_PI 0.31830988618\n#endif\n#ifndef SQRT_HALF_PI\n#define SQRT_HALF_PI 1.25331413732\n#endif\n#ifndef PHI\n#define PHI 1.618033988749894848204586834\n#endif\n#ifndef EPSILON\n#define EPSILON 0.0000001\n#endif\n#ifndef GOLDEN_RATIO\n#define GOLDEN_RATIO 1.6180339887\n#endif\n#ifndef GOLDEN_RATIO_CONJUGATE \n#define GOLDEN_RATIO_CONJUGATE 0.61803398875\n#endif\n#ifndef GOLDEN_ANGLE \n#define GOLDEN_ANGLE 2.39996323\n#endif\n\n#ifndef FNC_XYZ2EQUIRECT\n#define FNC_XYZ2EQUIRECT\nvec2 xyz2equirect(vec3 d) {\n    return vec2(atan(d.z, d.x) + PI, acos(-d.y)) / vec2(2.0 * PI, PI);\n}\n#endif\n#ifndef FNC_MOD289\n#define FNC_MOD289\n\nfloat mod289(const in float x) { return x - floor(x * (1. / 289.)) * 289.; }\nvec2 mod289(const in vec2 x) { return x - floor(x * (1. / 289.)) * 289.; }\nvec3 mod289(const in vec3 x) { return x - floor(x * (1. / 289.)) * 289.; }\nvec4 mod289(const in vec4 x) { return x - floor(x * (1. / 289.)) * 289.; }\n\n#endif\n#ifndef FNC_MOD289\n#define FNC_MOD289\n\nfloat mod289(const in float x) { return x - floor(x * (1. / 289.)) * 289.; }\nvec2 mod289(const in vec2 x) { return x - floor(x * (1. / 289.)) * 289.; }\nvec3 mod289(const in vec3 x) { return x - floor(x * (1. / 289.)) * 289.; }\nvec4 mod289(const in vec4 x) { return x - floor(x * (1. / 289.)) * 289.; }\n\n#endif\n\n#ifndef FNC_PERMUTE\n#define FNC_PERMUTE\n\nfloat permute(const in float x) { return mod289(((x * 34.0) + 1.0) * x); }\nvec2 permute(const in vec2 x) { return mod289(((x * 34.0) + 1.0) * x); }\nvec3 permute(const in vec3 x) { return mod289(((x * 34.0) + 1.0) * x); }\nvec4 permute(const in vec4 x) { return mod289(((x * 34.0) + 1.0) * x); }\n\n#endif\n#ifndef FNC_TAYLORINVSQRT\n#define FNC_TAYLORINVSQRT\n\nfloat taylorInvSqrt(in float r) { return 1.79284291400159 - 0.85373472095314 * r; }\nvec2 taylorInvSqrt(in vec2 r) { return 1.79284291400159 - 0.85373472095314 * r; }\nvec3 taylorInvSqrt(in vec3 r) { return 1.79284291400159 - 0.85373472095314 * r; }\nvec4 taylorInvSqrt(in vec4 r) { return 1.79284291400159 - 0.85373472095314 * r; }\n\n#endif\n#ifndef FNC_GRAD4\n#define FNC_GRAD4\nvec4 grad4(float j, vec4 ip) {\n    const vec4 ones = vec4(1.0, 1.0, 1.0, -1.0);\n    vec4 p,s;\n\n    p.xyz = floor( fract (vec3(j) * ip.xyz) * 7.0) * ip.z - 1.0;\n    p.w = 1.5 - dot(abs(p.xyz), ones.xyz);\n    s = vec4(lessThan(p, vec4(0.0)));\n    p.xyz = p.xyz + (s.xyz*2.0 - 1.0) * s.www;\n\n    return p;\n}\n#endif\n\n#ifndef FNC_SNOISE\n#define FNC_SNOISE\nfloat snoise(in vec2 v) {\n    const vec4 C = vec4(0.211324865405187,  \n                        0.366025403784439,  \n                        -0.577350269189626,  \n                        0.024390243902439); \n    \n    vec2 i  = floor(v + dot(v, C.yy) );\n    vec2 x0 = v -   i + dot(i, C.xx);\n\n    \n    vec2 i1;\n    \n    \n    i1 = (x0.x > x0.y) ? vec2(1.0, 0.0) : vec2(0.0, 1.0);\n    \n    \n    \n    vec4 x12 = x0.xyxy + C.xxzz;\n    x12.xy -= i1;\n\n    \n    i = mod289(i); \n    vec3 p = permute( permute( i.y + vec3(0.0, i1.y, 1.0 ))\n    + i.x + vec3(0.0, i1.x, 1.0 ));\n\n    vec3 m = max(0.5 - vec3(dot(x0,x0), dot(x12.xy,x12.xy), dot(x12.zw,x12.zw)), 0.0);\n    m = m*m ;\n    m = m*m ;\n\n    \n    \n\n    vec3 x = 2.0 * fract(p * C.www) - 1.0;\n    vec3 h = abs(x) - 0.5;\n    vec3 ox = floor(x + 0.5);\n    vec3 a0 = x - ox;\n\n    \n    \n    m *= 1.79284291400159 - 0.85373472095314 * ( a0*a0 + h*h );\n\n    \n    vec3 g;\n    g.x  = a0.x  * x0.x  + h.x  * x0.y;\n    g.yz = a0.yz * x12.xz + h.yz * x12.yw;\n    return 130.0 * dot(m, g);\n}\n\nfloat snoise(in vec3 v) {\n    const vec2  C = vec2(1.0/6.0, 1.0/3.0) ;\n    const vec4  D = vec4(0.0, 0.5, 1.0, 2.0);\n\n    \n    vec3 i  = floor(v + dot(v, C.yyy) );\n    vec3 x0 =   v - i + dot(i, C.xxx) ;\n\n    \n    vec3 g = step(x0.yzx, x0.xyz);\n    vec3 l = 1.0 - g;\n    vec3 i1 = min( g.xyz, l.zxy );\n    vec3 i2 = max( g.xyz, l.zxy );\n\n    \n    \n    \n    \n    vec3 x1 = x0 - i1 + C.xxx;\n    vec3 x2 = x0 - i2 + C.yyy; \n    vec3 x3 = x0 - D.yyy;      \n\n    \n    i = mod289(i);\n    vec4 p = permute( permute( permute(\n                i.z + vec4(0.0, i1.z, i2.z, 1.0 ))\n            + i.y + vec4(0.0, i1.y, i2.y, 1.0 ))\n            + i.x + vec4(0.0, i1.x, i2.x, 1.0 ));\n\n    \n    \n    float n_ = 0.142857142857; \n    vec3  ns = n_ * D.wyz - D.xzx;\n\n    vec4 j = p - 49.0 * floor(p * ns.z * ns.z);  \n\n    vec4 x_ = floor(j * ns.z);\n    vec4 y_ = floor(j - 7.0 * x_ );    \n\n    vec4 x = x_ *ns.x + ns.yyyy;\n    vec4 y = y_ *ns.x + ns.yyyy;\n    vec4 h = 1.0 - abs(x) - abs(y);\n\n    vec4 b0 = vec4( x.xy, y.xy );\n    vec4 b1 = vec4( x.zw, y.zw );\n\n    \n    \n    vec4 s0 = floor(b0)*2.0 + 1.0;\n    vec4 s1 = floor(b1)*2.0 + 1.0;\n    vec4 sh = -step(h, vec4(0.0));\n\n    vec4 a0 = b0.xzyw + s0.xzyw*sh.xxyy ;\n    vec4 a1 = b1.xzyw + s1.xzyw*sh.zzww ;\n\n    vec3 p0 = vec3(a0.xy,h.x);\n    vec3 p1 = vec3(a0.zw,h.y);\n    vec3 p2 = vec3(a1.xy,h.z);\n    vec3 p3 = vec3(a1.zw,h.w);\n\n    \n    vec4 norm = taylorInvSqrt(vec4(dot(p0,p0), dot(p1,p1), dot(p2, p2), dot(p3,p3)));\n    p0 *= norm.x;\n    p1 *= norm.y;\n    p2 *= norm.z;\n    p3 *= norm.w;\n\n    \n    vec4 m = max(0.6 - vec4(dot(x0,x0), dot(x1,x1), dot(x2,x2), dot(x3,x3)), 0.0);\n    m = m * m;\n    return 42.0 * dot( m*m, vec4( dot(p0,x0), dot(p1,x1),\n                                dot(p2,x2), dot(p3,x3) ) );\n}\n\nfloat snoise(in vec4 v) {\n    const vec4  C = vec4( 0.138196601125011,  \n                        0.276393202250021,  \n                        0.414589803375032,  \n                        -0.447213595499958); \n\n    \n    vec4 i  = floor(v + dot(v, vec4(.309016994374947451)) ); \n    vec4 x0 = v -   i + dot(i, C.xxxx);\n\n    \n\n    \n    vec4 i0;\n    vec3 isX = step( x0.yzw, x0.xxx );\n    vec3 isYZ = step( x0.zww, x0.yyz );\n    \n    i0.x = isX.x + isX.y + isX.z;\n    i0.yzw = 1.0 - isX;\n    \n    i0.y += isYZ.x + isYZ.y;\n    i0.zw += 1.0 - isYZ.xy;\n    i0.z += isYZ.z;\n    i0.w += 1.0 - isYZ.z;\n\n    \n    vec4 i3 = clamp( i0, 0.0, 1.0 );\n    vec4 i2 = clamp( i0-1.0, 0.0, 1.0 );\n    vec4 i1 = clamp( i0-2.0, 0.0, 1.0 );\n\n    \n    \n    \n    \n    \n    vec4 x1 = x0 - i1 + C.xxxx;\n    vec4 x2 = x0 - i2 + C.yyyy;\n    vec4 x3 = x0 - i3 + C.zzzz;\n    vec4 x4 = x0 + C.wwww;\n\n    \n    i = mod289(i);\n    float j0 = permute( permute( permute( permute(i.w) + i.z) + i.y) + i.x);\n    vec4 j1 = permute( permute( permute( permute (\n                i.w + vec4(i1.w, i2.w, i3.w, 1.0 ))\n            + i.z + vec4(i1.z, i2.z, i3.z, 1.0 ))\n            + i.y + vec4(i1.y, i2.y, i3.y, 1.0 ))\n            + i.x + vec4(i1.x, i2.x, i3.x, 1.0 ));\n\n    \n    \n    vec4 ip = vec4(1.0/294.0, 1.0/49.0, 1.0/7.0, 0.0) ;\n\n    vec4 p0 = grad4(j0,   ip);\n    vec4 p1 = grad4(j1.x, ip);\n    vec4 p2 = grad4(j1.y, ip);\n    vec4 p3 = grad4(j1.z, ip);\n    vec4 p4 = grad4(j1.w, ip);\n\n    \n    vec4 norm = taylorInvSqrt(vec4(dot(p0,p0), dot(p1,p1), dot(p2, p2), dot(p3,p3)));\n    p0 *= norm.x;\n    p1 *= norm.y;\n    p2 *= norm.z;\n    p3 *= norm.w;\n    p4 *= taylorInvSqrt(dot(p4,p4));\n\n    \n    vec3 m0 = max(0.6 - vec3(dot(x0,x0), dot(x1,x1), dot(x2,x2)), 0.0);\n    vec2 m1 = max(0.6 - vec2(dot(x3,x3), dot(x4,x4)            ), 0.0);\n    m0 = m0 * m0;\n    m1 = m1 * m1;\n    return 49.0 * ( dot(m0*m0, vec3( dot( p0, x0 ), dot( p1, x1 ), dot( p2, x2 )))\n                + dot(m1*m1, vec2( dot( p3, x3 ), dot( p4, x4 ) ) ) ) ;\n}\n\nvec2 snoise2( vec2 x ){\n    float s  = snoise(vec2( x ));\n    float s1 = snoise(vec2( x.y - 19.1, x.x + 47.2 ));\n    return vec2( s , s1 );\n}\n\nvec3 snoise3( vec3 x ){\n    float s  = snoise(vec3( x ));\n    float s1 = snoise(vec3( x.y - 19.1 , x.z + 33.4 , x.x + 47.2 ));\n    float s2 = snoise(vec3( x.z + 74.2 , x.x - 124.5 , x.y + 99.4 ));\n    return vec3( s , s1 , s2 );\n}\n\nvec3 snoise3( vec4 x ){\n    float s  = snoise(vec4( x ));\n    float s1 = snoise(vec4( x.y - 19.1 , x.z + 33.4 , x.x + 47.2, x.w ));\n    float s2 = snoise(vec4( x.z + 74.2 , x.x - 124.5 , x.y + 99.4, x.w ));\n    return vec3( s , s1 , s2 );\n}\n\n#endif\n#ifndef FNC_TONEMAPLINEAR\n#define FNC_TONEMAPLINEAR\nvec3 tonemapLinear(const vec3 x) { return x; }\nvec4 tonemapLinear(const vec4 x) { return x; }\n#endif\n#ifndef FNC_RGB2HSV\n#define FNC_RGB2HSV\nvec3 rgb2hsv(in vec3 c) {\n    vec4 K = vec4(0., -.33333333333333333333, .6666666666666666666, -1.);\n\n#ifdef RGB2HSV_MIX\n    vec4 p = mix(vec4(c.bg, K.wz), vec4(c.gb, K.xy), step(c.b, c.g));\n    vec4 q = mix(vec4(p.xyw, c.r), vec4(c.r, p.yzx), step(p.x, c.r));\n#else\n    vec4 p = c.g < c.b ? vec4(c.bg, K.wz) : vec4(c.gb, K.xy);\n    vec4 q = c.r < p.x ? vec4(p.xyw, c.r) : vec4(c.r, p.yzx);\n#endif\n\n    float d = q.x - min(q.w, q.y);\n    float e = 1.0e-10;\n    return vec3(abs(q.z + (q.w - q.y) / (6. * d + e)), \n                d / (q.x + e), \n                q.x);\n}\n\nvec4 rgb2hsv(in vec4 c) {\n    return vec4(rgb2hsv(c.rgb), c.a);\n}\n#endif\n#ifndef FNC_HSV2RGB\n#define FNC_HSV2RGB\nvec3 hsv2rgb(in vec3 hsb) {\n    vec3 rgb = clamp(abs(mod(hsb.x * 6. + vec3(0., 4., 2.), \n                            6.) - 3.) - 1.,\n                      0.,\n                      1.);\n    #ifdef HSV2RGB_SMOOTH\n    rgb = rgb*rgb*(3. - 2. * rgb);\n    #endif\n    return hsb.z * mix(vec3(1.), rgb, hsb.y);\n}\n\nvec4 hsv2rgb(in vec4 hsb) {\n    return vec4(hsv2rgb(hsb.rgb), hsb.a);\n}\n#endif\n\n#ifndef FNC_HUESHIFT\n#define FNC_HUESHIFT\nvec3 hueShift(in vec3 color, in float amount) {\n    vec3 hsv = rgb2hsv(color);\n    hsv.r += amount;\n    return hsv2rgb(hsv);\n}\n\nvec4 hueShift(in vec4 color, in float amount) {\n    return vec4(hueShift(color.rgb, amount), color.a);\n}\n#endif\n#ifndef FNC_DESATURATE\n#define FNC_DESATURATE\nvec3 desaturate(in vec3 color, in float amount ) {\n    return mix(color, vec3(dot(vec3(.3, .59, .11), color)), amount);\n}\n\nvec4 desaturate(in vec4 color, in float amount ) {\n    return vec4(desaturate(color.rgb, amount), color.a);\n}\n#endif\n#ifndef FNC_CONTRAST\n#define FNC_CONTRAST\nvec3 contrast(in vec3 value, in float amount) {\n    return (value - .5 ) * amount + .5;\n}\n\nvec4 contrast(in vec4 value, in float amount) {\n    return vec4(contrast(value.rgb, amount), value.a);\n}\n\nfloat contrast(in float value, in float amount) {\n    return (value - .5 ) * amount + .5;\n}\n#endif\n\nvoid main() {\n    vec3 positionNorm = normalize(v_position);\n    vec3 normal = normalize(v_normal);\n\n    \n    vec4 noiseTex = texture(u_noiseTexture, xyz2equirect(positionNorm));\n    vec3 noiseNormal = noiseTex.xyz * 2. - 1.;\n\n    vec2 uv = xyz2octahedron(positionNorm);\n    vec3 pos = (u_worldMatrix * vec4(v_position, 0.)).xyz;\n    vec3 L = normalize(vec3(.5, 1., 1.));\n    vec3 V = normalize(v_surfaceToView);\n    vec3 P = distort(u_texture, v_position, u_pointerDir, u_displacementStrength, u_time);\n    vec3 N = normal;\n    vec3 T = normalize(v_tangent);\n    vec3 B = cross(T, N);\n\n    \n    outColor = texture(u_texture, uv);\n    float value = outColor.r + noiseTex.a * 0.05;\n    float rampValue = smoothstep(0.05, 1., value);\n\n    \n    vec2 epsilon = vec2(0.05);\n    vec3 t = distort(u_texture, v_position + T * epsilon.x, u_pointerDir, u_displacementStrength, u_time);\n    vec3 b = distort(u_texture, v_position + B * epsilon.y, u_pointerDir, u_displacementStrength, u_time);\n    float normalStrength = 2.;\n    N = N + normalize(cross(t - P, P - b)) * normalStrength;\n\n    \n    B = cross(T, N);\n    T = cross(N, B);\n    mat3 tangentSpace = mat3(T, B, N);\n    N = normalize(N + tangentSpace * noiseNormal * rampValue * .06);\n\n    N = (u_worldInverseTransposeMatrix * vec4(normalize(N), 0.)).xyz;\n    vec3 R = reflect(V, N + vec3(0., .2, 0.));\n    \n    \n    float fresnel = 1. - max(0., dot(N, V));\n\n    \n    vec3 worldNormal = (u_worldInverseTransposeMatrix * vec4(normal, 0.)).xyz;\n    float flatFresnel = 1. - max(0., dot(worldNormal, V));\n\n    \n    float diffuse = mix(1., max(0., dot(N, L)), (1. - flatFresnel));\n    diffuse = smoothstep(0.5, .8, diffuse);\n\n    \n    vec3 albedo = texture(u_albedoRampTexture, vec2(1. - rampValue, 0.)).rgb;\n    \n    float vainsSSS = (flatFresnel * flatFresnel * smoothstep(0.3, 1., value));\n    \n    albedo.rg += vainsSSS;\n    albedo.b += vainsSSS * 0.85;\n    albedo += flatFresnel * flatFresnel * .2 * (1. - value); \n    albedo = mix(albedo * vec3(.95, 0.85, 0.85), albedo, min(1., diffuse + 0.5));\n    albedo = hueShift(albedo, u_hueShift);\n    \n    \n    float specular = specularBlinnPhong(L, N, V, 100.);\n\n    \n    vec3 envReflection = texture(u_envTexture, xyz2equirect(R)).rgb;\n\n    \n    vec3 color = albedo * 0.95 + (envReflection * .3 + specular * 0.5) * rampValue;\n\n    outColor = tonemapLinear(vec4(color, rampValue * 0.1 + 0.9));\n\n    \n    \n    \n    \n    \n}"]),this.sphereBackPrg=No(e,["#version 300 es\n\nuniform mat4 u_worldMatrix;\nuniform mat4 u_viewMatrix;\nuniform mat4 u_projectionMatrix;\n\nin vec3 position;\nin vec3 normal;\nin vec2 texcoord;\nin vec3 tangent;\n\nout vec3 v_position;\nout vec3 v_normal;\n\nvoid main() {\n  vec3 pos = position * 0.99;\n  vec4 worldPosition = u_worldMatrix * vec4(pos, 1.);\n  gl_Position = u_projectionMatrix * u_viewMatrix * worldPosition;\n\n  v_position = pos;\n  v_normal = (u_worldMatrix * vec4(normal, 0.)).xyz;\n}","#version 300 es\n\nprecision highp float;\n\nuniform sampler2D u_texture;\n\nin vec3 v_position;\nin vec3 v_normal;\n\nout vec4 outColor;\n\nvec2 xyz2octahedron(vec3 direction) {\n    vec3 octant = sign(direction);\n\n    \n    float sum = dot(direction, octant);        \n    vec3 octahedron = direction / sum;    \n\n    \n    \n    vec3 absolute = abs(octahedron);\n    float posZ = step(0., octahedron.z); \n    octahedron.xy = mix(octant.xy * vec2(1. - absolute.y, 1. - absolute.x), octahedron.xy, posZ);\n\n    return octahedron.xy * 0.5 + 0.5;\n}\n\nvoid main() {\n    float attenuation = dot(vec3(0., 0., -.7), v_normal);\n    vec2 uv = xyz2octahedron(normalize(v_position));\n    outColor = mix(vec4(0.5, 0.5, 0.8, 1.) * 1.2, vec4(1.), 1. - texture(u_texture, uv) * attenuation);\n}"]),this.quadBufferInfo=Wr.createXYQuadBufferInfo(e),this.quadVAI=Zo(e,this.blurPrg,this.quadBufferInfo),this.sphereBufferInfo=Wr.createSphereBufferInfo(e,1,15,15),this.sphereVAI=Zo(e,this.spherePrg,this.sphereBufferInfo),this.glbBuilder=new nl(e),await this.glbBuilder.load(new URL("/symbiont/dist/assets/model.glb",self.location)),this.modelPrimitive=this.glbBuilder.getPrimitiveDataByMeshName("Icosphere.001"),this.modelBuffers=this.modelPrimitive.buffers,this.modelBufferInfo=Hn(e,{position:{...this.modelBuffers.vertices,numComponents:this.modelBuffers.vertices.numberOfComponents},normal:{...this.modelBuffers.normals,numComponents:this.modelBuffers.normals.numberOfComponents},texcoord:{...this.modelBuffers.texcoords,numComponents:this.modelBuffers.texcoords.numberOfComponents},tangent:{...this.modelBuffers.tangents,numComponents:this.modelBuffers.tangents.numberOfComponents},indices:{...this.modelBuffers.indices,numComponents:this.modelBuffers.indices.numberOfComponents}}),this.icosphereVAI=Zo(e,this.spherePrg,this.modelBufferInfo),this.agentAttachments=[{internalFormat:e.RGBA8,min:e.LINEAR,mag:e.LINEAR,wrap:e.REPEAT}],this.fbi1=Yo(e,this.agentAttachments,this.texSize[0],this.texSize[1]),e.generateMipmap(e.TEXTURE_2D),e.clearColor(0,0,0,1),e.clear(e.COLOR_BUFFER_BIT),this.fbi2=Yo(e,this.agentAttachments,this.texSize[0],this.texSize[1]),e.generateMipmap(e.TEXTURE_2D),e.clearColor(0,0,0,1),e.clear(e.COLOR_BUFFER_BIT),this.blurFBI=Yo(e,[{min:e.LINEAR,mag:e.LINEAR}],this.texSize[0],this.texSize[1]),e.generateMipmap(e.TEXTURE_2D);const t=Math.max(this.viewportSize[0],this.viewportSize[1])>800?1:.5;this.textureFBI=Yo(e,[{minMag:e.LINEAR}],2048*t,1024*t),this.albedoRampTexture=Yi(e,{minMag:e.LINEAR,format:e.RGB,wrap:e.CLAMP_TO_EDGE,src:new Uint8Array([155,10,10,130,20,20,190,155,160,210,200,190]),width:4,height:1}),await oe(this,V,O).call(this),this.worldMatrix=St(),this.worldInverseMatrix=St(),this.worldInverseTransposeMatrix=St(),this.resize(),this.control=new is(this.canvas),oe(this,N,B).call(this),oe(this,H,K).call(this),oe(this,q,X).call(this,e),oe(this,F,M).call(this),oe(this,S,k).call(this),this.currentFBI=this.fbi1,this.sourceTFI=this.tfi1,this.then=0},S=new WeakSet,k=function(){const e=this.gl,{positions:t,axis:n}=oe(this,R,I).call(this,this.AGENT_COUNT);this.tfi1=oe(this,T,L).call(this,t,n),this.tfi2=oe(this,T,L).call(this,t,n),Gn(e,this.tfi1.bufferInfo.attribs.position,t),Gn(e,this.tfi2.bufferInfo.attribs.position,t),Gn(e,this.tfi1.bufferInfo.attribs.axis,n),Gn(e,this.tfi2.bufferInfo.attribs.axis,n),Qo(e,this.fbi1),e.clear(e.COLOR_BUFFER_BIT),Qo(e,this.fbi2),e.clear(e.COLOR_BUFFER_BIT)},T=new WeakSet,L=function(e,t){const n=this.gl,r=Hn(n,{position:{data:e,numComponents:3},axis:{data:t,numComponents:3}}),i=Zo(n,this.processPrg,r),o=function(e,t,n){const r=e.createTransformFeedback();return e.bindTransformFeedback(36386,r),e.useProgram(t.program),function(e,t,n){t.transformFeedbackInfo&&(t=t.transformFeedbackInfo),n.attribs&&(n=n.attribs);for(const r in n){const i=t[r];if(i){const t=n[r];t.offset?e.bindBufferRange(35982,i.index,t.buffer,t.offset,t.size):e.bindBufferBase(35982,i.index,t.buffer)}}}(e,t,n),e.bindTransformFeedback(36386,null),r}(n,this.processPrg,{v_position:r.attribs.position,v_axis:r.attribs.axis});return{bufferInfo:r,transformFeedback:o,vertexArrayInfo:i}},R=new WeakSet,I=function(e){this.gl;const t=[],n=[],r=2*Math.PI;for(let i=0;i<e;++i){let e=ss(0,r),i=ss(0,r),o=Math.cos(i),s=0,a=Math.sin(i);s=Math.cos(e),o*=Math.sqrt(1-s*s),a*=Math.sqrt(1-s*s),t.push(o,s,a),n.push(ss(-1,1),ss(-1,1),ss(-1,1))}return{positions:t,axis:n}},F=new WeakSet,M=function(){this.isPointerDown=!1,Pt(this.canvas,"pointerdown").subscribe((e=>{this.isPointerDown=!0})),function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var n=Qe(e),r=Ze(e,1/0),i=e;return i.length?1===i.length?lt(i[0]):wt(r)(vt(i,n)):Ye}(Pt(this.canvas,"pointerup"),Pt(this.canvas,"pointerleave")).subscribe((()=>this.isPointerDown=!1)),Pt(this.canvas,"pointermove").subscribe((e=>{this.pointer[0]=e.clientX,this.pointer[1]=this.viewportSize[1]-e.clientY}))},V=new WeakSet,O=function(){const e=this.gl,t=new Promise((t=>{this.envTexture=Yi(e,{src:new URL("/symbiont/dist/assets/env.jpg",self.location).toString()},(()=>t()))}));return Promise.all([t])},N=new WeakSet,B=function(){if(!this.pane)return;const e=this.pane.addFolder({title:"Simulation",expanded:!0});e.addInput(this.settings,"moveSpeed",{min:0,max:500}),e.addInput(this.settings,"turnSpeed",{min:0,max:500}),e.addInput(this.settings,"trailWeight",{min:0,max:300}),e.addInput(this.settings,"sensorOffsetDist",{min:0,max:200}),e.addInput(this.settings,"sensorAngleSpacing",{min:0,max:4}),e.addInput(this.settings,"evaporateSpeed",{min:0,max:20}),e.addInput(this.settings,"diffuseSpeed",{min:0,max:200});const t=this.pane.addFolder({title:"Rendering",expanded:!0});t.addInput(this.renderSettings,"displacementStrength",{min:-.03,max:.03}),t.addInput(this.renderSettings,"hueShift",{min:0,max:1})},D=new WeakSet,z=function(e){this.gl,e=16*ne(this,P)+1e-4,this.control.update(e),function(e,t){var n=t[0],r=t[1],i=t[2],o=t[3],s=n+n,a=r+r,l=i+i,c=n*s,u=r*s,p=r*a,d=i*s,h=i*a,f=i*l,v=o*s,m=o*a,b=o*l;e[0]=1-p-f,e[1]=u+b,e[2]=d-m,e[3]=0,e[4]=u-b,e[5]=1-c-f,e[6]=h+v,e[7]=0,e[8]=d+m,e[9]=h-v,e[10]=1-c-p,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1}(this.worldMatrix,this.control.rotationQuat),kt(this.worldInverseMatrix,this.worldMatrix),function(e,t){if(e===t){var n=t[1],r=t[2],i=t[3],o=t[6],s=t[7],a=t[11];e[1]=t[4],e[2]=t[8],e[3]=t[12],e[4]=n,e[6]=t[9],e[7]=t[13],e[8]=r,e[9]=o,e[11]=t[14],e[12]=i,e[13]=s,e[14]=a}else e[0]=t[0],e[1]=t[4],e[2]=t[8],e[3]=t[12],e[4]=t[1],e[5]=t[5],e[6]=t[9],e[7]=t[13],e[8]=t[2],e[9]=t[6],e[10]=t[10],e[11]=t[14],e[12]=t[3],e[13]=t[7],e[14]=t[11],e[15]=t[15]}(this.worldInverseTransposeMatrix,this.worldInverseMatrix);const t=this.viewportSize[0],n=this.viewportSize[1],r=Math.max(t,n)-1,i=(2*this.pointer[0]-t-1)/r,o=(2*this.pointer[1]-n-1)/r,s=i*i+o*o;let a=0;a=s<=.4?Math.sqrt(.8-s):.4/Math.sqrt(s);const l=oe(this,Y,$).call(this,this.pointer),c=l||Mt(i,o,a);Dt(c,c);const u=Rt(St(),It(),c,Mt(0,1,0)),p=Tt(Kt(),u);this.pointerDirSOQ.updateApprox(.001*e,p),this.pointerDir=function(e,t,n){var r=n[0],i=n[1],o=n[2],s=n[3],a=t[0],l=t[1],c=t[2],u=i*c-o*l,p=o*a-r*c,d=r*l-i*a,h=i*d-o*p,f=o*u-r*d,v=r*p-i*u,m=2*s;return u*=m,p*=m,d*=m,h*=2,f*=2,v*=2,e[0]=a+u+h,e[1]=l+p+f,e[2]=c+d+v,e}(this.pointerDir,Mt(0,0,-1),this.pointerDirSOQ.value),function(e,t,n){var r=t[0],i=t[1],o=t[2],s=n[3]*r+n[7]*i+n[11]*o+n[15];s=s||1,e[0]=(n[0]*r+n[4]*i+n[8]*o+n[12])/s,e[1]=(n[1]*r+n[5]*i+n[9]*o+n[13])/s,e[2]=(n[2]*r+n[6]*i+n[10]*o+n[14])/s}(this.pointerDir,this.pointerDir,this.worldInverseMatrix);const d=l?1:0;this.pointerStrength+=(d-this.pointerStrength)/1.5,this.displacementStrength.update(.001*e,this.pointerStrength),oe(this,U,j).call(this)},U=new WeakSet,j=function(){const e=1/60,t=this.gl,n=Math.max(1,3-Math.round(1/(ne(this,P)+1e-5)));console.log(n);for(let r=0;r<n;++r){let n=this.sourceTFI===this.tfi1?this.tfi2:this.tfi1;this.outFBI=this.currentFBI===this.fbi1?this.fbi2:this.fbi1,t.bindBuffer(t.ARRAY_BUFFER,null),Qo(t,this.outFBI),t.useProgram(this.processPrg.program),t.bindVertexArray(this.sourceTFI.vertexArrayInfo.vertexArrayObject),t.bindTransformFeedback(t.TRANSFORM_FEEDBACK,n.transformFeedback),t.beginTransformFeedback(t.POINTS),Mo(this.processPrg,{resolution:this.texSize,u_pointer:this.pointer,u_pointerDir:this.pointerDir,u_pointerStrength:this.pointerStrength,deltaTime:e,tex:this.currentFBI.attachments[0]},this.settings),Bo(t,this.sourceTFI.vertexArrayInfo,t.POINTS,this.AGENT_COUNT),this.sourceTFI=n,t.endTransformFeedback(),t.bindTransformFeedback(t.TRANSFORM_FEEDBACK,null),Qo(t,this.currentFBI),t.useProgram(this.spreadPrg.program),t.bindVertexArray(this.quadVAI.vertexArrayObject),Mo(this.spreadPrg,{deltaTime:e,tex:this.outFBI.attachments[0]},this.settings),Bo(t,this.quadVAI),this.resultFBI=this.currentFBI,this.currentFBI=this.outFBI}},G=new WeakSet,W=function(){const e=this.gl;this.prerender||(this.prerender=!0,Qo(e,this.textureFBI),e.bindVertexArray(this.quadVAI.vertexArrayObject),e.disable(e.CULL_FACE),e.disable(e.DEPTH_TEST),this.gl.clearColor(0,0,0,1),this.gl.clear(this.gl.COLOR_BUFFER_BIT|this.gl.DEPTH_BUFFER_BIT),this.gl.useProgram(this.texturePrg.program),Mo(this.texturePrg,{}),Bo(e,this.quadVAI)),Qo(e,this.blurFBI),e.useProgram(this.blurPrg.program),e.bindVertexArray(this.quadVAI.vertexArrayObject),Mo(this.blurPrg,{u_texture:this.outFBI.attachments[0]}),Bo(e,this.quadVAI),Qo(e,null),e.enable(e.CULL_FACE),e.enable(e.DEPTH_TEST),this.gl.clearColor(1,1,.99,1),this.gl.clear(this.gl.COLOR_BUFFER_BIT|this.gl.DEPTH_BUFFER_BIT),e.bindTexture(e.TEXTURE_2D,this.resultFBI.attachments[0]),e.generateMipmap(e.TEXTURE_2D),e.useProgram(this.spherePrg.program),e.bindVertexArray(this.icosphereVAI.vertexArrayObject),e.cullFace(e.FRONT),e.useProgram(this.sphereBackPrg.program),Mo(this.sphereBackPrg,{u_worldMatrix:this.worldMatrix,u_viewMatrix:this.camera.matrices.view,u_projectionMatrix:this.camera.matrices.projection,u_texture:this.blurFBI.attachments[0]},this.renderSettings),Bo(e,this.icosphereVAI),e.cullFace(e.BACK),e.enable(e.BLEND),e.blendFunc(e.ONE,e.ONE_MINUS_SRC_ALPHA),e.useProgram(this.spherePrg.program),Mo(this.spherePrg,{u_worldMatrix:this.worldMatrix,u_viewMatrix:this.camera.matrices.view,u_projectionMatrix:this.camera.matrices.projection,u_worldInverseTransposeMatrix:this.worldInverseTransposeMatrix,u_time:ne(this,x),u_cameraPos:this.camera.position,u_texture:this.blurFBI.attachments[0],u_pointerDir:this.pointerDir,u_displacementStrength:this.renderSettings.displacementStrength*this.displacementStrength.value,u_albedoRampTexture:this.albedoRampTexture,u_envTexture:this.envTexture,u_noiseTexture:this.textureFBI.attachments[0],u_hueShift:this.renderSettings.hueShift},this.renderSettings),Bo(e,this.icosphereVAI),e.disable(e.BLEND)},H=new WeakSet,K=function(){Rt(this.camera.matrix,this.camera.position,[0,0,0],this.camera.up),kt(this.camera.matrices.view,this.camera.matrix)},q=new WeakSet,X=function(e){this.camera.aspect=e.canvas.clientWidth/e.canvas.clientHeight;const t=this.camera.position[2];this.camera.aspect>1?this.camera.fov=2*Math.atan(1.45/t):this.camera.fov=2*Math.atan(1.45/this.camera.aspect/t),Lt(this.camera.matrices.projection,this.camera.fov,this.camera.aspect,this.camera.near,this.camera.far),kt(this.camera.matrices.inversProjection,this.camera.matrices.projection),function(e,t,n){var r=t[0],i=t[1],o=t[2],s=t[3],a=t[4],l=t[5],c=t[6],u=t[7],p=t[8],d=t[9],h=t[10],f=t[11],v=t[12],m=t[13],b=t[14],g=t[15],_=n[0],w=n[1],x=n[2],y=n[3];e[0]=_*r+w*a+x*p+y*v,e[1]=_*i+w*l+x*d+y*m,e[2]=_*o+w*c+x*h+y*b,e[3]=_*s+w*u+x*f+y*g,_=n[4],w=n[5],x=n[6],y=n[7],e[4]=_*r+w*a+x*p+y*v,e[5]=_*i+w*l+x*d+y*m,e[6]=_*o+w*c+x*h+y*b,e[7]=_*s+w*u+x*f+y*g,_=n[8],w=n[9],x=n[10],y=n[11],e[8]=_*r+w*a+x*p+y*v,e[9]=_*i+w*l+x*d+y*m,e[10]=_*o+w*c+x*h+y*b,e[11]=_*s+w*u+x*f+y*g,_=n[12],w=n[13],x=n[14],y=n[15],e[12]=_*r+w*a+x*p+y*v,e[13]=_*i+w*l+x*d+y*m,e[14]=_*o+w*c+x*h+y*b,e[15]=_*s+w*u+x*f+y*g}(this.camera.matrices.inversViewProjection,this.camera.matrix,this.camera.matrices.inversProjection)},Y=new WeakSet,$=function(e){const t=e[0]/this.viewportSize[0]*2-1,n=e[1]/this.viewportSize[1]*2-1,r=oe(this,Q,Z).call(this,t,n,0),i=Nt(It(),r,this.camera.position);Dt(i,i);const o=zt(r,r)-1.1025,s=2*zt(i,r),a=s*s-4*o;if(a<0)return null;{const e=Math.sqrt(a),t=(-s+e)/2,n=(-s-e)/2;Bt(i,i,Math.min(t,n));return Ot(It(),r,i)}},Q=new WeakSet,Z=function(e,t,n){const r=Mt(e,t,n),i=function(e,t,n){var r=t[0],i=t[1],o=t[2],s=t[3];return e[0]=n[0]*r+n[4]*i+n[8]*o+n[12]*s,e[1]=n[1]*r+n[5]*i+n[9]*o+n[13]*s,e[2]=n[2]*r+n[6]*i+n[10]*o+n[14]*s,e[3]=n[3]*r+n[7]*i+n[11]*o+n[15]*s,e}(Gt(),Wt(r[0],r[1],r[2],1),this.camera.matrices.inversViewProjection);return 0!==i[3]&&Ht(i,i,1/i[3]),i};"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self&&self;var il={exports:{}};!function(e){class t{constructor(e){const[t,n]=e.split("-"),r=t.split(".");this.major=parseInt(r[0],10),this.minor=parseInt(r[1],10),this.patch=parseInt(r[2],10),this.prerelease=null!=n?n:null}toString(){const e=[this.major,this.minor,this.patch].join(".");return null!==this.prerelease?[e,this.prerelease].join("-"):e}}class n{constructor(e){this.controller_=e}get element(){return this.controller_.view.element}get disabled(){return this.controller_.viewProps.get("disabled")}set disabled(e){this.controller_.viewProps.set("disabled",e)}get hidden(){return this.controller_.viewProps.get("hidden")}set hidden(e){this.controller_.viewProps.set("hidden",e)}dispose(){this.controller_.viewProps.set("disposed",!0)}}class r{constructor(e){this.target=e}}class i extends r{constructor(e,t,n,r){super(e),this.value=t,this.presetKey=n,this.last=null==r||r}}class o extends r{constructor(e,t,n){super(e),this.value=t,this.presetKey=n}}class s extends r{constructor(e,t){super(e),this.expanded=t}}class a extends r{constructor(e,t){super(e),this.index=t}}function l(e){return e}function c(e){return null==e}function u(e,t){if(e.length!==t.length)return!1;for(let n=0;n<e.length;n++)if(e[n]!==t[n])return!1;return!0}const p={alreadydisposed:()=>"View has been already disposed",invalidparams:e=>`Invalid parameters for '${e.name}'`,nomatchingcontroller:e=>`No matching controller for '${e.key}'`,nomatchingview:e=>`No matching view for '${JSON.stringify(e.params)}'`,notbindable:()=>"Value is not bindable",propertynotfound:e=>`Property '${e.name}' not found`,shouldneverhappen:()=>"This error should never happen"};class d{constructor(e){var t;this.message=null!==(t=p[e.type](l(e.context)))&&void 0!==t?t:"Unexpected error",this.name=this.constructor.name,this.stack=new Error(this.message).stack,this.type=e.type}static alreadyDisposed(){return new d({type:"alreadydisposed"})}static notBindable(){return new d({type:"notbindable"})}static propertyNotFound(e){return new d({type:"propertynotfound",context:{name:e}})}static shouldNeverHappen(){return new d({type:"shouldneverhappen"})}}class h{constructor(e,t,n){this.obj_=e,this.key_=t,this.presetKey_=null!=n?n:t}static isBindable(e){return null!==e&&"object"==typeof e}get key(){return this.key_}get presetKey(){return this.presetKey_}read(){return this.obj_[this.key_]}write(e){this.obj_[this.key_]=e}writeProperty(e,t){const n=this.read();if(!h.isBindable(n))throw d.notBindable();if(!(e in n))throw d.propertyNotFound(e);n[e]=t}}class f extends n{get label(){return this.controller_.props.get("label")}set label(e){this.controller_.props.set("label",e)}get title(){var e;return null!==(e=this.controller_.valueController.props.get("title"))&&void 0!==e?e:""}set title(e){this.controller_.valueController.props.set("title",e)}on(e,t){const n=t.bind(this);return this.controller_.valueController.emitter.on(e,(()=>{n(new r(this))})),this}}class v{constructor(){this.observers_={}}on(e,t){let n=this.observers_[e];return n||(n=this.observers_[e]=[]),n.push({handler:t}),this}off(e,t){const n=this.observers_[e];return n&&(this.observers_[e]=n.filter((e=>e.handler!==t))),this}emit(e,t){const n=this.observers_[e];n&&n.forEach((e=>{e.handler(t)}))}}const m="tp";function b(e){return(t,n)=>[m,"-",e,"v",t?`_${t}`:"",n?`-${n}`:""].join("")}function g(e,t){return n=>t(e(n))}function _(e){return e.rawValue}function w(e,t){e.emitter.on("change",g(_,t)),t(e.rawValue)}function x(e,t,n){w(e.value(t),n)}function y(e,t,n){n?e.classList.add(t):e.classList.remove(t)}function E(e,t){return n=>{y(e,t,n)}}function P(e,t){w(e,(e=>{t.textContent=null!=e?e:""}))}const C=b("btn");class A{constructor(e,t){this.element=e.createElement("div"),this.element.classList.add(C()),t.viewProps.bindClassModifiers(this.element);const n=e.createElement("button");n.classList.add(C("b")),t.viewProps.bindDisabled(n),this.element.appendChild(n),this.buttonElement=n;const r=e.createElement("div");r.classList.add(C("t")),P(t.props.value("title"),r),this.buttonElement.appendChild(r)}}class S{constructor(e,t){this.emitter=new v,this.onClick_=this.onClick_.bind(this),this.props=t.props,this.viewProps=t.viewProps,this.view=new A(e,{props:this.props,viewProps:this.viewProps}),this.view.buttonElement.addEventListener("click",this.onClick_)}onClick_(){this.emitter.emit("click",{sender:this})}}class k{constructor(e,t){var n;this.constraint_=null==t?void 0:t.constraint,this.equals_=null!==(n=null==t?void 0:t.equals)&&void 0!==n?n:(e,t)=>e===t,this.emitter=new v,this.rawValue_=e}get constraint(){return this.constraint_}get rawValue(){return this.rawValue_}set rawValue(e){this.setRawValue(e,{forceEmit:!1,last:!0})}setRawValue(e,t){const n=null!=t?t:{forceEmit:!1,last:!0},r=this.constraint_?this.constraint_.constrain(e):e;(!this.equals_(this.rawValue_,r)||n.forceEmit)&&(this.emitter.emit("beforechange",{sender:this}),this.rawValue_=r,this.emitter.emit("change",{options:n,rawValue:r,sender:this}))}}class T{constructor(e){this.emitter=new v,this.value_=e}get rawValue(){return this.value_}set rawValue(e){this.setRawValue(e,{forceEmit:!1,last:!0})}setRawValue(e,t){const n=null!=t?t:{forceEmit:!1,last:!0};(this.value_!==e||n.forceEmit)&&(this.emitter.emit("beforechange",{sender:this}),this.value_=e,this.emitter.emit("change",{options:n,rawValue:this.value_,sender:this}))}}function L(e,t){const n=null==t?void 0:t.constraint,r=null==t?void 0:t.equals;return n||r?new k(e,t):new T(e)}class R{constructor(e){this.emitter=new v,this.valMap_=e;for(const t in this.valMap_)this.valMap_[t].emitter.on("change",(()=>{this.emitter.emit("change",{key:t,sender:this})}))}static createCore(e){return Object.keys(e).reduce(((t,n)=>Object.assign(t,{[n]:L(e[n])})),{})}static fromObject(e){const t=this.createCore(e);return new R(t)}get(e){return this.valMap_[e].rawValue}set(e,t){this.valMap_[e].rawValue=t}value(e){return this.valMap_[e]}}function I(e,t){return l(Object.keys(t).reduce(((n,r)=>{if(void 0===n)return;const i=(0,t[r])(e[r]);return i.succeeded?Object.assign(Object.assign({},n),{[r]:i.value}):void 0}),{}))}function F(e,t){return e.reduce(((e,n)=>{if(void 0===e)return;const r=t(n);return r.succeeded&&void 0!==r.value?[...e,r.value]:void 0}),[])}function M(e){return null!==e&&"object"==typeof e}function V(e){return t=>n=>{if(!t&&void 0===n)return{succeeded:!1,value:void 0};if(t&&void 0===n)return{succeeded:!0,value:void 0};const r=e(n);return void 0!==r?{succeeded:!0,value:r}:{succeeded:!1,value:void 0}}}function O(e){return{custom:t=>V(t)(e),boolean:V((e=>"boolean"==typeof e?e:void 0))(e),number:V((e=>"number"==typeof e?e:void 0))(e),string:V((e=>"string"==typeof e?e:void 0))(e),function:V((e=>"function"==typeof e?e:void 0))(e),constant:t=>V((e=>e===t?t:void 0))(e),raw:V((e=>e))(e),object:t=>V((e=>{if(M(e))return I(e,t)}))(e),array:t=>V((e=>{if(Array.isArray(e))return F(e,t)}))(e)}}const N={optional:O(!0),required:O(!1)};function B(e,t){const n=N.required.object(t)(e);return n.succeeded?n.value:void 0}function D(e){return e&&e.parentElement&&e.parentElement.removeChild(e),null}function z(){return["veryfirst","first","last","verylast"]}const U=b(""),j={veryfirst:"vfst",first:"fst",last:"lst",verylast:"vlst"};class G{constructor(e){this.parent_=null,this.blade=e.blade,this.view=e.view,this.viewProps=e.viewProps;const t=this.view.element;this.blade.value("positions").emitter.on("change",(()=>{z().forEach((e=>{t.classList.remove(U(void 0,j[e]))})),this.blade.get("positions").forEach((e=>{t.classList.add(U(void 0,j[e]))}))})),this.viewProps.handleDispose((()=>{D(t)}))}get parent(){return this.parent_}}const W="http://www.w3.org/2000/svg";function H(e){e.offsetHeight}function K(e,t){const n=e.style.transition;e.style.transition="none",t(),e.style.transition=n}function q(e){return void 0!==e.ontouchstart}function X(){return globalThis}function Y(){return l(X()).document}function $(e){const t=e.ownerDocument.defaultView;return t&&"document"in t?e.getContext("2d",{willReadFrequently:!0}):null}const Q={check:'<path d="M2 8l4 4l8 -8"/>',dropdown:'<path d="M5 7h6l-3 3 z"/>',p2dpad:'<path d="M8 4v8"/><path d="M4 8h8"/><circle cx="12" cy="12" r="1.2"/>'};function Z(e,t){const n=e.createElementNS(W,"svg");return n.innerHTML=Q[t],n}function J(e,t,n){e.insertBefore(t,e.children[n])}function ee(e){e.parentElement&&e.parentElement.removeChild(e)}function te(e){for(;e.children.length>0;)e.removeChild(e.children[0])}function ne(e){for(;e.childNodes.length>0;)e.removeChild(e.childNodes[0])}function re(e){return e.relatedTarget?l(e.relatedTarget):"explicitOriginalTarget"in e?e.explicitOriginalTarget:null}const ie=b("lbl");function oe(e,t){const n=e.createDocumentFragment();return t.split("\n").map((t=>e.createTextNode(t))).forEach(((t,r)=>{r>0&&n.appendChild(e.createElement("br")),n.appendChild(t)})),n}class se{constructor(e,t){this.element=e.createElement("div"),this.element.classList.add(ie()),t.viewProps.bindClassModifiers(this.element);const n=e.createElement("div");n.classList.add(ie("l")),x(t.props,"label",(t=>{c(t)?this.element.classList.add(ie(void 0,"nol")):(this.element.classList.remove(ie(void 0,"nol")),ne(n),n.appendChild(oe(e,t)))})),this.element.appendChild(n),this.labelElement=n;const r=e.createElement("div");r.classList.add(ie("v")),this.element.appendChild(r),this.valueElement=r}}class ae extends G{constructor(e,t){const n=t.valueController.viewProps;super(Object.assign(Object.assign({},t),{view:new se(e,{props:t.props,viewProps:n}),viewProps:n})),this.props=t.props,this.valueController=t.valueController,this.view.valueElement.appendChild(this.valueController.view.element)}}const le={id:"button",type:"blade",accept(e){const t=N,n=B(e,{title:t.required.string,view:t.required.constant("button"),label:t.optional.string});return n?{params:n}:null},controller:e=>new ae(e.document,{blade:e.blade,props:R.fromObject({label:e.params.label}),valueController:new S(e.document,{props:R.fromObject({title:e.params.title}),viewProps:e.viewProps})}),api:e=>e.controller instanceof ae&&e.controller.valueController instanceof S?new f(e.controller):null};class ce extends G{constructor(e){super(e),this.value=e.value}}function ue(){return new R({positions:L([],{equals:u})})}class pe extends R{constructor(e){super(e)}static create(e){const t={completed:!0,expanded:e,expandedHeight:null,shouldFixHeight:!1,temporaryExpanded:null},n=R.createCore(t);return new pe(n)}get styleExpanded(){var e;return null!==(e=this.get("temporaryExpanded"))&&void 0!==e?e:this.get("expanded")}get styleHeight(){if(!this.styleExpanded)return"0";const e=this.get("expandedHeight");return this.get("shouldFixHeight")&&!c(e)?`${e}px`:"auto"}bindExpandedClass(e,t){const n=()=>{this.styleExpanded?e.classList.add(t):e.classList.remove(t)};x(this,"expanded",n),x(this,"temporaryExpanded",n)}cleanUpTransition(){this.set("shouldFixHeight",!1),this.set("expandedHeight",null),this.set("completed",!0)}}function de(e,t){let n=0;return K(t,(()=>{e.set("expandedHeight",null),e.set("temporaryExpanded",!0),H(t),n=t.clientHeight,e.set("temporaryExpanded",null),H(t)})),n}function he(e,t){t.style.height=e.styleHeight}function fe(e,t){e.value("expanded").emitter.on("beforechange",(()=>{e.set("completed",!1),c(e.get("expandedHeight"))&&e.set("expandedHeight",de(e,t)),e.set("shouldFixHeight",!0),H(t)})),e.emitter.on("change",(()=>{he(e,t)})),he(e,t),t.addEventListener("transitionend",(t=>{"height"===t.propertyName&&e.cleanUpTransition()}))}class ve extends n{constructor(e,t){super(e),this.rackApi_=t}}function me(e,t){return e.addBlade(Object.assign(Object.assign({},t),{view:"button"}))}function be(e,t){return e.addBlade(Object.assign(Object.assign({},t),{view:"folder"}))}function ge(e,t){const n=null!=t?t:{};return e.addBlade(Object.assign(Object.assign({},n),{view:"separator"}))}function _e(e,t){return e.addBlade(Object.assign(Object.assign({},t),{view:"tab"}))}class we{constructor(e){this.emitter=new v,this.items_=[],this.cache_=new Set,this.onSubListAdd_=this.onSubListAdd_.bind(this),this.onSubListRemove_=this.onSubListRemove_.bind(this),this.extract_=e}get items(){return this.items_}allItems(){return Array.from(this.cache_)}find(e){for(const t of this.allItems())if(e(t))return t;return null}includes(e){return this.cache_.has(e)}add(e,t){if(this.includes(e))throw d.shouldNeverHappen();const n=void 0!==t?t:this.items_.length;this.items_.splice(n,0,e),this.cache_.add(e);const r=this.extract_(e);r&&(r.emitter.on("add",this.onSubListAdd_),r.emitter.on("remove",this.onSubListRemove_),r.allItems().forEach((e=>{this.cache_.add(e)}))),this.emitter.emit("add",{index:n,item:e,root:this,target:this})}remove(e){const t=this.items_.indexOf(e);if(t<0)return;this.items_.splice(t,1),this.cache_.delete(e);const n=this.extract_(e);n&&(n.emitter.off("add",this.onSubListAdd_),n.emitter.off("remove",this.onSubListRemove_)),this.emitter.emit("remove",{index:t,item:e,root:this,target:this})}onSubListAdd_(e){this.cache_.add(e.item),this.emitter.emit("add",{index:e.index,item:e.item,root:this,target:e.target})}onSubListRemove_(e){this.cache_.delete(e.item),this.emitter.emit("remove",{index:e.index,item:e.item,root:this,target:e.target})}}class xe extends n{constructor(e){super(e),this.onBindingChange_=this.onBindingChange_.bind(this),this.emitter_=new v,this.controller_.binding.emitter.on("change",this.onBindingChange_)}get label(){return this.controller_.props.get("label")}set label(e){this.controller_.props.set("label",e)}on(e,t){const n=t.bind(this);return this.emitter_.on(e,(e=>{n(e.event)})),this}refresh(){this.controller_.binding.read()}onBindingChange_(e){const t=e.sender.target.read();this.emitter_.emit("change",{event:new i(this,l(t),this.controller_.binding.target.presetKey,e.options.last)})}}class ye extends ae{constructor(e,t){super(e,t),this.binding=t.binding}}class Ee extends n{constructor(e){super(e),this.onBindingUpdate_=this.onBindingUpdate_.bind(this),this.emitter_=new v,this.controller_.binding.emitter.on("update",this.onBindingUpdate_)}get label(){return this.controller_.props.get("label")}set label(e){this.controller_.props.set("label",e)}on(e,t){const n=t.bind(this);return this.emitter_.on(e,(e=>{n(e.event)})),this}refresh(){this.controller_.binding.read()}onBindingUpdate_(e){const t=e.sender.target.read();this.emitter_.emit("update",{event:new o(this,l(t),this.controller_.binding.target.presetKey)})}}class Pe extends ae{constructor(e,t){super(e,t),this.binding=t.binding,this.viewProps.bindDisabled(this.binding.ticker),this.viewProps.handleDispose((()=>{this.binding.dispose()}))}}function Ce(e){return e instanceof ke?e.apiSet_:e instanceof ve?e.rackApi_.apiSet_:null}function Ae(e,t){const n=e.find((e=>e.controller_===t));if(!n)throw d.shouldNeverHappen();return n}function Se(e,t,n){if(!h.isBindable(e))throw d.notBindable();return new h(e,t,n)}class ke extends n{constructor(e,t){super(e),this.onRackAdd_=this.onRackAdd_.bind(this),this.onRackRemove_=this.onRackRemove_.bind(this),this.onRackInputChange_=this.onRackInputChange_.bind(this),this.onRackMonitorUpdate_=this.onRackMonitorUpdate_.bind(this),this.emitter_=new v,this.apiSet_=new we(Ce),this.pool_=t;const n=this.controller_.rack;n.emitter.on("add",this.onRackAdd_),n.emitter.on("remove",this.onRackRemove_),n.emitter.on("inputchange",this.onRackInputChange_),n.emitter.on("monitorupdate",this.onRackMonitorUpdate_),n.children.forEach((e=>{this.setUpApi_(e)}))}get children(){return this.controller_.rack.children.map((e=>Ae(this.apiSet_,e)))}addInput(e,t,n){const r=null!=n?n:{},i=this.controller_.view.element.ownerDocument,o=this.pool_.createInput(i,Se(e,t,r.presetKey),r),s=new xe(o);return this.add(s,r.index)}addMonitor(e,t,n){const r=null!=n?n:{},i=this.controller_.view.element.ownerDocument,o=this.pool_.createMonitor(i,Se(e,t),r),s=new Ee(o);return l(this.add(s,r.index))}addFolder(e){return be(this,e)}addButton(e){return me(this,e)}addSeparator(e){return ge(this,e)}addTab(e){return _e(this,e)}add(e,t){this.controller_.rack.add(e.controller_,t);const n=this.apiSet_.find((t=>t.controller_===e.controller_));return n&&this.apiSet_.remove(n),this.apiSet_.add(e),e}remove(e){this.controller_.rack.remove(e.controller_)}addBlade(e){const t=this.controller_.view.element.ownerDocument,n=this.pool_.createBlade(t,e),r=this.pool_.createBladeApi(n);return this.add(r,e.index)}on(e,t){const n=t.bind(this);return this.emitter_.on(e,(e=>{n(e.event)})),this}setUpApi_(e){this.apiSet_.find((t=>t.controller_===e))||this.apiSet_.add(this.pool_.createBladeApi(e))}onRackAdd_(e){this.setUpApi_(e.bladeController)}onRackRemove_(e){if(e.isRoot){const t=Ae(this.apiSet_,e.bladeController);this.apiSet_.remove(t)}}onRackInputChange_(e){const t=e.bladeController;if(t instanceof ye){const n=Ae(this.apiSet_,t),r=t.binding;this.emitter_.emit("change",{event:new i(n,l(r.target.read()),r.target.presetKey,e.options.last)})}else if(t instanceof ce){const n=Ae(this.apiSet_,t);this.emitter_.emit("change",{event:new i(n,t.value.rawValue,void 0,e.options.last)})}}onRackMonitorUpdate_(e){if(!(e.bladeController instanceof Pe))throw d.shouldNeverHappen();const t=Ae(this.apiSet_,e.bladeController),n=e.bladeController.binding;this.emitter_.emit("update",{event:new o(t,l(n.target.read()),n.target.presetKey)})}}class Te extends ve{constructor(e,t){super(e,new ke(e.rackController,t)),this.emitter_=new v,this.controller_.foldable.value("expanded").emitter.on("change",(e=>{this.emitter_.emit("fold",{event:new s(this,e.sender.rawValue)})})),this.rackApi_.on("change",(e=>{this.emitter_.emit("change",{event:e})})),this.rackApi_.on("update",(e=>{this.emitter_.emit("update",{event:e})}))}get expanded(){return this.controller_.foldable.get("expanded")}set expanded(e){this.controller_.foldable.set("expanded",e)}get title(){return this.controller_.props.get("title")}set title(e){this.controller_.props.set("title",e)}get children(){return this.rackApi_.children}addInput(e,t,n){return this.rackApi_.addInput(e,t,n)}addMonitor(e,t,n){return this.rackApi_.addMonitor(e,t,n)}addFolder(e){return this.rackApi_.addFolder(e)}addButton(e){return this.rackApi_.addButton(e)}addSeparator(e){return this.rackApi_.addSeparator(e)}addTab(e){return this.rackApi_.addTab(e)}add(e,t){return this.rackApi_.add(e,t)}remove(e){this.rackApi_.remove(e)}addBlade(e){return this.rackApi_.addBlade(e)}on(e,t){const n=t.bind(this);return this.emitter_.on(e,(e=>{n(e.event)})),this}}class Le extends G{constructor(e){super({blade:e.blade,view:e.view,viewProps:e.rackController.viewProps}),this.rackController=e.rackController}}class Re{constructor(e,t){const n=b(t.viewName);this.element=e.createElement("div"),this.element.classList.add(n()),t.viewProps.bindClassModifiers(this.element)}}function Ie(e,t){for(let n=0;n<e.length;n++){const r=e[n];if(r instanceof ye&&r.binding===t)return r}return null}function Fe(e,t){for(let n=0;n<e.length;n++){const r=e[n];if(r instanceof Pe&&r.binding===t)return r}return null}function Me(e,t){for(let n=0;n<e.length;n++){const r=e[n];if(r instanceof ce&&r.value===t)return r}return null}function Ve(e){return e instanceof Be?e.rack:e instanceof Le?e.rackController.rack:null}function Oe(e){const t=Ve(e);return t?t.bcSet_:null}class Ne{constructor(e){var t;this.onBladePositionsChange_=this.onBladePositionsChange_.bind(this),this.onSetAdd_=this.onSetAdd_.bind(this),this.onSetRemove_=this.onSetRemove_.bind(this),this.onChildDispose_=this.onChildDispose_.bind(this),this.onChildPositionsChange_=this.onChildPositionsChange_.bind(this),this.onChildInputChange_=this.onChildInputChange_.bind(this),this.onChildMonitorUpdate_=this.onChildMonitorUpdate_.bind(this),this.onChildValueChange_=this.onChildValueChange_.bind(this),this.onChildViewPropsChange_=this.onChildViewPropsChange_.bind(this),this.onDescendantLayout_=this.onDescendantLayout_.bind(this),this.onDescendantInputChange_=this.onDescendantInputChange_.bind(this),this.onDescendantMonitorUpdate_=this.onDescendantMonitorUpdate_.bind(this),this.emitter=new v,this.blade_=null!=e?e:null,null===(t=this.blade_)||void 0===t||t.value("positions").emitter.on("change",this.onBladePositionsChange_),this.bcSet_=new we(Oe),this.bcSet_.emitter.on("add",this.onSetAdd_),this.bcSet_.emitter.on("remove",this.onSetRemove_)}get children(){return this.bcSet_.items}add(e,t){e.parent&&e.parent.remove(e),e.parent_=this,this.bcSet_.add(e,t)}remove(e){e.parent_=null,this.bcSet_.remove(e)}find(e){return l(this.bcSet_.allItems().filter((t=>t instanceof e)))}onSetAdd_(e){this.updatePositions_();const t=e.target===e.root;if(this.emitter.emit("add",{bladeController:e.item,index:e.index,isRoot:t,sender:this}),!t)return;const n=e.item;if(n.viewProps.emitter.on("change",this.onChildViewPropsChange_),n.blade.value("positions").emitter.on("change",this.onChildPositionsChange_),n.viewProps.handleDispose(this.onChildDispose_),n instanceof ye)n.binding.emitter.on("change",this.onChildInputChange_);else if(n instanceof Pe)n.binding.emitter.on("update",this.onChildMonitorUpdate_);else if(n instanceof ce)n.value.emitter.on("change",this.onChildValueChange_);else{const e=Ve(n);if(e){const t=e.emitter;t.on("layout",this.onDescendantLayout_),t.on("inputchange",this.onDescendantInputChange_),t.on("monitorupdate",this.onDescendantMonitorUpdate_)}}}onSetRemove_(e){this.updatePositions_();const t=e.target===e.root;if(this.emitter.emit("remove",{bladeController:e.item,isRoot:t,sender:this}),!t)return;const n=e.item;if(n instanceof ye)n.binding.emitter.off("change",this.onChildInputChange_);else if(n instanceof Pe)n.binding.emitter.off("update",this.onChildMonitorUpdate_);else if(n instanceof ce)n.value.emitter.off("change",this.onChildValueChange_);else{const e=Ve(n);if(e){const t=e.emitter;t.off("layout",this.onDescendantLayout_),t.off("inputchange",this.onDescendantInputChange_),t.off("monitorupdate",this.onDescendantMonitorUpdate_)}}}updatePositions_(){const e=this.bcSet_.items.filter((e=>!e.viewProps.get("hidden"))),t=e[0],n=e[e.length-1];this.bcSet_.items.forEach((e=>{const r=[];e===t&&(r.push("first"),this.blade_&&!this.blade_.get("positions").includes("veryfirst")||r.push("veryfirst")),e===n&&(r.push("last"),this.blade_&&!this.blade_.get("positions").includes("verylast")||r.push("verylast")),e.blade.set("positions",r)}))}onChildPositionsChange_(){this.updatePositions_(),this.emitter.emit("layout",{sender:this})}onChildViewPropsChange_(e){this.updatePositions_(),this.emitter.emit("layout",{sender:this})}onChildDispose_(){this.bcSet_.items.filter((e=>e.viewProps.get("disposed"))).forEach((e=>{this.bcSet_.remove(e)}))}onChildInputChange_(e){const t=Ie(this.find(ye),e.sender);if(!t)throw d.alreadyDisposed();this.emitter.emit("inputchange",{bladeController:t,options:e.options,sender:this})}onChildMonitorUpdate_(e){const t=Fe(this.find(Pe),e.sender);if(!t)throw d.alreadyDisposed();this.emitter.emit("monitorupdate",{bladeController:t,sender:this})}onChildValueChange_(e){const t=Me(this.find(ce),e.sender);if(!t)throw d.alreadyDisposed();this.emitter.emit("inputchange",{bladeController:t,options:e.options,sender:this})}onDescendantLayout_(e){this.updatePositions_(),this.emitter.emit("layout",{sender:this})}onDescendantInputChange_(e){this.emitter.emit("inputchange",{bladeController:e.bladeController,options:e.options,sender:this})}onDescendantMonitorUpdate_(e){this.emitter.emit("monitorupdate",{bladeController:e.bladeController,sender:this})}onBladePositionsChange_(){this.updatePositions_()}}class Be extends G{constructor(e,t){super(Object.assign(Object.assign({},t),{view:new Re(e,{viewName:"brk",viewProps:t.viewProps})})),this.onRackAdd_=this.onRackAdd_.bind(this),this.onRackRemove_=this.onRackRemove_.bind(this);const n=new Ne(t.root?void 0:t.blade);n.emitter.on("add",this.onRackAdd_),n.emitter.on("remove",this.onRackRemove_),this.rack=n,this.viewProps.handleDispose((()=>{for(let e=this.rack.children.length-1;e>=0;e--)this.rack.children[e].viewProps.set("disposed",!0)}))}onRackAdd_(e){e.isRoot&&J(this.view.element,e.bladeController.view.element,e.index)}onRackRemove_(e){e.isRoot&&ee(e.bladeController.view.element)}}const De=b("cnt");class ze{constructor(e,t){var n;this.className_=b(null!==(n=t.viewName)&&void 0!==n?n:"fld"),this.element=e.createElement("div"),this.element.classList.add(this.className_(),De()),t.viewProps.bindClassModifiers(this.element),this.foldable_=t.foldable,this.foldable_.bindExpandedClass(this.element,this.className_(void 0,"expanded")),x(this.foldable_,"completed",E(this.element,this.className_(void 0,"cpl")));const r=e.createElement("button");r.classList.add(this.className_("b")),x(t.props,"title",(e=>{c(e)?this.element.classList.add(this.className_(void 0,"not")):this.element.classList.remove(this.className_(void 0,"not"))})),t.viewProps.bindDisabled(r),this.element.appendChild(r),this.buttonElement=r;const i=e.createElement("div");i.classList.add(this.className_("t")),P(t.props.value("title"),i),this.buttonElement.appendChild(i),this.titleElement=i;const o=e.createElement("div");o.classList.add(this.className_("m")),this.buttonElement.appendChild(o);const s=t.containerElement;s.classList.add(this.className_("c")),this.element.appendChild(s),this.containerElement=s}}class Ue extends Le{constructor(e,t){var n;const r=pe.create(null===(n=t.expanded)||void 0===n||n),i=new Be(e,{blade:t.blade,root:t.root,viewProps:t.viewProps});super(Object.assign(Object.assign({},t),{rackController:i,view:new ze(e,{containerElement:i.view.element,foldable:r,props:t.props,viewName:t.root?"rot":void 0,viewProps:t.viewProps})})),this.onTitleClick_=this.onTitleClick_.bind(this),this.props=t.props,this.foldable=r,fe(this.foldable,this.view.containerElement),this.rackController.rack.emitter.on("add",(()=>{this.foldable.cleanUpTransition()})),this.rackController.rack.emitter.on("remove",(()=>{this.foldable.cleanUpTransition()})),this.view.buttonElement.addEventListener("click",this.onTitleClick_)}get document(){return this.view.element.ownerDocument}onTitleClick_(){this.foldable.set("expanded",!this.foldable.get("expanded"))}}const je={id:"folder",type:"blade",accept(e){const t=N,n=B(e,{title:t.required.string,view:t.required.constant("folder"),expanded:t.optional.boolean});return n?{params:n}:null},controller:e=>new Ue(e.document,{blade:e.blade,expanded:e.params.expanded,props:R.fromObject({title:e.params.title}),viewProps:e.viewProps}),api:e=>e.controller instanceof Ue?new Te(e.controller,e.pool):null};class Ge extends ce{constructor(e,t){const n=t.valueController.viewProps;super(Object.assign(Object.assign({},t),{value:t.valueController.value,view:new se(e,{props:t.props,viewProps:n}),viewProps:n})),this.props=t.props,this.valueController=t.valueController,this.view.valueElement.appendChild(this.valueController.view.element)}}class We extends n{}const He=b("spr");class Ke{constructor(e,t){this.element=e.createElement("div"),this.element.classList.add(He()),t.viewProps.bindClassModifiers(this.element);const n=e.createElement("hr");n.classList.add(He("r")),this.element.appendChild(n)}}class qe extends G{constructor(e,t){super(Object.assign(Object.assign({},t),{view:new Ke(e,{viewProps:t.viewProps})}))}}const Xe={id:"separator",type:"blade",accept(e){const t=B(e,{view:N.required.constant("separator")});return t?{params:t}:null},controller:e=>new qe(e.document,{blade:e.blade,viewProps:e.viewProps}),api:e=>e.controller instanceof qe?new We(e.controller):null},Ye=b("");function $e(e,t){return E(e,Ye(void 0,t))}class Qe extends R{constructor(e){super(e)}static create(e){var t,n;const r=null!=e?e:{},i={disabled:null!==(t=r.disabled)&&void 0!==t&&t,disposed:!1,hidden:null!==(n=r.hidden)&&void 0!==n&&n},o=R.createCore(i);return new Qe(o)}bindClassModifiers(e){x(this,"disabled",$e(e,"disabled")),x(this,"hidden",$e(e,"hidden"))}bindDisabled(e){x(this,"disabled",(t=>{e.disabled=t}))}bindTabIndex(e){x(this,"disabled",(t=>{e.tabIndex=t?-1:0}))}handleDispose(e){this.value("disposed").emitter.on("change",(t=>{t&&e()}))}}const Ze=b("tbi");class Je{constructor(e,t){this.element=e.createElement("div"),this.element.classList.add(Ze()),t.viewProps.bindClassModifiers(this.element),x(t.props,"selected",(e=>{e?this.element.classList.add(Ze(void 0,"sel")):this.element.classList.remove(Ze(void 0,"sel"))}));const n=e.createElement("button");n.classList.add(Ze("b")),t.viewProps.bindDisabled(n),this.element.appendChild(n),this.buttonElement=n;const r=e.createElement("div");r.classList.add(Ze("t")),P(t.props.value("title"),r),this.buttonElement.appendChild(r),this.titleElement=r}}class et{constructor(e,t){this.emitter=new v,this.onClick_=this.onClick_.bind(this),this.props=t.props,this.viewProps=t.viewProps,this.view=new Je(e,{props:t.props,viewProps:t.viewProps}),this.view.buttonElement.addEventListener("click",this.onClick_)}onClick_(){this.emitter.emit("click",{sender:this})}}class tt{constructor(e,t){this.onItemClick_=this.onItemClick_.bind(this),this.ic_=new et(e,{props:t.itemProps,viewProps:Qe.create()}),this.ic_.emitter.on("click",this.onItemClick_),this.cc_=new Be(e,{blade:ue(),viewProps:Qe.create()}),this.props=t.props,x(this.props,"selected",(e=>{this.itemController.props.set("selected",e),this.contentController.viewProps.set("hidden",!e)}))}get itemController(){return this.ic_}get contentController(){return this.cc_}onItemClick_(){this.props.set("selected",!0)}}class nt{constructor(e,t){this.controller_=e,this.rackApi_=t}get title(){var e;return null!==(e=this.controller_.itemController.props.get("title"))&&void 0!==e?e:""}set title(e){this.controller_.itemController.props.set("title",e)}get selected(){return this.controller_.props.get("selected")}set selected(e){this.controller_.props.set("selected",e)}get children(){return this.rackApi_.children}addButton(e){return this.rackApi_.addButton(e)}addFolder(e){return this.rackApi_.addFolder(e)}addSeparator(e){return this.rackApi_.addSeparator(e)}addTab(e){return this.rackApi_.addTab(e)}add(e,t){this.rackApi_.add(e,t)}remove(e){this.rackApi_.remove(e)}addInput(e,t,n){return this.rackApi_.addInput(e,t,n)}addMonitor(e,t,n){return this.rackApi_.addMonitor(e,t,n)}addBlade(e){return this.rackApi_.addBlade(e)}}class rt extends ve{constructor(e,t){super(e,new ke(e.rackController,t)),this.onPageAdd_=this.onPageAdd_.bind(this),this.onPageRemove_=this.onPageRemove_.bind(this),this.onSelect_=this.onSelect_.bind(this),this.emitter_=new v,this.pageApiMap_=new Map,this.rackApi_.on("change",(e=>{this.emitter_.emit("change",{event:e})})),this.rackApi_.on("update",(e=>{this.emitter_.emit("update",{event:e})})),this.controller_.tab.selectedIndex.emitter.on("change",this.onSelect_),this.controller_.pageSet.emitter.on("add",this.onPageAdd_),this.controller_.pageSet.emitter.on("remove",this.onPageRemove_),this.controller_.pageSet.items.forEach((e=>{this.setUpPageApi_(e)}))}get pages(){return this.controller_.pageSet.items.map((e=>{const t=this.pageApiMap_.get(e);if(!t)throw d.shouldNeverHappen();return t}))}addPage(e){const t=this.controller_.view.element.ownerDocument,n=new tt(t,{itemProps:R.fromObject({selected:!1,title:e.title}),props:R.fromObject({selected:!1})});this.controller_.add(n,e.index);const r=this.pageApiMap_.get(n);if(!r)throw d.shouldNeverHappen();return r}removePage(e){this.controller_.remove(e)}on(e,t){const n=t.bind(this);return this.emitter_.on(e,(e=>{n(e.event)})),this}setUpPageApi_(e){const t=this.rackApi_.apiSet_.find((t=>t.controller_===e.contentController));if(!t)throw d.shouldNeverHappen();const n=new nt(e,t);this.pageApiMap_.set(e,n)}onPageAdd_(e){this.setUpPageApi_(e.item)}onPageRemove_(e){if(!this.pageApiMap_.get(e.item))throw d.shouldNeverHappen();this.pageApiMap_.delete(e.item)}onSelect_(e){this.emitter_.emit("select",{event:new a(this,e.rawValue)})}}const it=-1;class ot{constructor(){this.onItemSelectedChange_=this.onItemSelectedChange_.bind(this),this.empty=L(!0),this.selectedIndex=L(it),this.items_=[]}add(e,t){const n=null!=t?t:this.items_.length;this.items_.splice(n,0,e),e.emitter.on("change",this.onItemSelectedChange_),this.keepSelection_()}remove(e){const t=this.items_.indexOf(e);t<0||(this.items_.splice(t,1),e.emitter.off("change",this.onItemSelectedChange_),this.keepSelection_())}keepSelection_(){if(0===this.items_.length)return this.selectedIndex.rawValue=it,void(this.empty.rawValue=!0);const e=this.items_.findIndex((e=>e.rawValue));e<0?(this.items_.forEach(((e,t)=>{e.rawValue=0===t})),this.selectedIndex.rawValue=0):(this.items_.forEach(((t,n)=>{t.rawValue=n===e})),this.selectedIndex.rawValue=e),this.empty.rawValue=!1}onItemSelectedChange_(e){if(e.rawValue){const t=this.items_.findIndex((t=>t===e.sender));this.items_.forEach(((e,n)=>{e.rawValue=n===t})),this.selectedIndex.rawValue=t}else this.keepSelection_()}}const st=b("tab");class at{constructor(e,t){this.element=e.createElement("div"),this.element.classList.add(st(),De()),t.viewProps.bindClassModifiers(this.element),w(t.empty,E(this.element,st(void 0,"nop")));const n=e.createElement("div");n.classList.add(st("i")),this.element.appendChild(n),this.itemsElement=n;const r=t.contentsElement;r.classList.add(st("c")),this.element.appendChild(r),this.contentsElement=r}}class lt extends Le{constructor(e,t){const n=new Be(e,{blade:t.blade,viewProps:t.viewProps}),r=new ot;super({blade:t.blade,rackController:n,view:new at(e,{contentsElement:n.view.element,empty:r.empty,viewProps:t.viewProps})}),this.onPageAdd_=this.onPageAdd_.bind(this),this.onPageRemove_=this.onPageRemove_.bind(this),this.pageSet_=new we((()=>null)),this.pageSet_.emitter.on("add",this.onPageAdd_),this.pageSet_.emitter.on("remove",this.onPageRemove_),this.tab=r}get pageSet(){return this.pageSet_}add(e,t){this.pageSet_.add(e,t)}remove(e){this.pageSet_.remove(this.pageSet_.items[e])}onPageAdd_(e){const t=e.item;J(this.view.itemsElement,t.itemController.view.element,e.index),this.rackController.rack.add(t.contentController,e.index),this.tab.add(t.props.value("selected"))}onPageRemove_(e){const t=e.item;ee(t.itemController.view.element),this.rackController.rack.remove(t.contentController),this.tab.remove(t.props.value("selected"))}}const ct={id:"tab",type:"blade",accept(e){const t=N,n=B(e,{pages:t.required.array(t.required.object({title:t.required.string})),view:t.required.constant("tab")});return n&&0!==n.pages.length?{params:n}:null},controller(e){const t=new lt(e.document,{blade:e.blade,viewProps:e.viewProps});return e.params.pages.forEach((n=>{const r=new tt(e.document,{itemProps:R.fromObject({selected:!1,title:n.title}),props:R.fromObject({selected:!1})});t.add(r)})),t},api:e=>e.controller instanceof lt?new rt(e.controller,e.pool):null};function ut(e,t){const n=e.accept(t.params);if(!n)return null;const r=N.optional.boolean(t.params.disabled).value,i=N.optional.boolean(t.params.hidden).value;return e.controller({blade:ue(),document:t.document,params:l(Object.assign(Object.assign({},n.params),{disabled:r,hidden:i})),viewProps:Qe.create({disabled:r,hidden:i})})}class pt{constructor(){this.disabled=!1,this.emitter=new v}dispose(){}tick(){this.disabled||this.emitter.emit("tick",{sender:this})}}class dt{constructor(e,t){this.disabled_=!1,this.timerId_=null,this.onTick_=this.onTick_.bind(this),this.doc_=e,this.emitter=new v,this.interval_=t,this.setTimer_()}get disabled(){return this.disabled_}set disabled(e){this.disabled_=e,this.disabled_?this.clearTimer_():this.setTimer_()}dispose(){this.clearTimer_()}clearTimer_(){if(null===this.timerId_)return;const e=this.doc_.defaultView;e&&e.clearInterval(this.timerId_),this.timerId_=null}setTimer_(){if(this.clearTimer_(),this.interval_<=0)return;const e=this.doc_.defaultView;e&&(this.timerId_=e.setInterval(this.onTick_,this.interval_))}onTick_(){this.disabled_||this.emitter.emit("tick",{sender:this})}}class ht{constructor(e){this.constraints=e}constrain(e){return this.constraints.reduce(((e,t)=>t.constrain(e)),e)}}function ft(e,t){if(e instanceof t)return e;if(e instanceof ht){const n=e.constraints.reduce(((e,n)=>e||(n instanceof t?n:null)),null);if(n)return n}return null}class vt{constructor(e){this.options=e}constrain(e){const t=this.options;return 0===t.length||t.filter((t=>t.value===e)).length>0?e:t[0].value}}class mt{constructor(e){this.maxValue=e.max,this.minValue=e.min}constrain(e){let t=e;return c(this.minValue)||(t=Math.max(t,this.minValue)),c(this.maxValue)||(t=Math.min(t,this.maxValue)),t}}class bt{constructor(e,t=0){this.step=e,this.origin=t}constrain(e){const t=this.origin%this.step;return t+Math.round((e-t)/this.step)*this.step}}const gt=b("lst");class _t{constructor(e,t){this.onValueChange_=this.onValueChange_.bind(this),this.props_=t.props,this.element=e.createElement("div"),this.element.classList.add(gt()),t.viewProps.bindClassModifiers(this.element);const n=e.createElement("select");n.classList.add(gt("s")),x(this.props_,"options",(t=>{te(n),t.forEach(((t,r)=>{const i=e.createElement("option");i.dataset.index=String(r),i.textContent=t.text,i.value=String(t.value),n.appendChild(i)}))})),t.viewProps.bindDisabled(n),this.element.appendChild(n),this.selectElement=n;const r=e.createElement("div");r.classList.add(gt("m")),r.appendChild(Z(e,"dropdown")),this.element.appendChild(r),t.value.emitter.on("change",this.onValueChange_),this.value_=t.value,this.update_()}update_(){this.selectElement.value=String(this.value_.rawValue)}onValueChange_(){this.update_()}}class wt{constructor(e,t){this.onSelectChange_=this.onSelectChange_.bind(this),this.props=t.props,this.value=t.value,this.viewProps=t.viewProps,this.view=new _t(e,{props:this.props,value:this.value,viewProps:this.viewProps}),this.view.selectElement.addEventListener("change",this.onSelectChange_)}onSelectChange_(e){const t=l(e.currentTarget).selectedOptions.item(0);if(!t)return;const n=Number(t.dataset.index);this.value.rawValue=this.props.get("options")[n].value}}const xt=b("pop");class yt{constructor(e,t){this.element=e.createElement("div"),this.element.classList.add(xt()),t.viewProps.bindClassModifiers(this.element),w(t.shows,E(this.element,xt(void 0,"v")))}}class Et{constructor(e,t){this.shows=L(!1),this.viewProps=t.viewProps,this.view=new yt(e,{shows:this.shows,viewProps:this.viewProps})}}const Pt=b("txt");class Ct{constructor(e,t){this.onChange_=this.onChange_.bind(this),this.element=e.createElement("div"),this.element.classList.add(Pt()),t.viewProps.bindClassModifiers(this.element),this.props_=t.props,this.props_.emitter.on("change",this.onChange_);const n=e.createElement("input");n.classList.add(Pt("i")),n.type="text",t.viewProps.bindDisabled(n),this.element.appendChild(n),this.inputElement=n,t.value.emitter.on("change",this.onChange_),this.value_=t.value,this.refresh()}refresh(){const e=this.props_.get("formatter");this.inputElement.value=e(this.value_.rawValue)}onChange_(){this.refresh()}}class At{constructor(e,t){this.onInputChange_=this.onInputChange_.bind(this),this.parser_=t.parser,this.props=t.props,this.value=t.value,this.viewProps=t.viewProps,this.view=new Ct(e,{props:t.props,value:this.value,viewProps:this.viewProps}),this.view.inputElement.addEventListener("change",this.onInputChange_)}onInputChange_(e){const t=l(e.currentTarget).value,n=this.parser_(t);c(n)||(this.value.rawValue=n),this.view.refresh()}}function St(e){return String(e)}function kt(e){return"false"!==e&&!!e}function Tt(e){return St(e)}class Lt{constructor(e){this.text=e}evaluate(){return Number(this.text)}toString(){return this.text}}const Rt={"**":(e,t)=>Math.pow(e,t),"*":(e,t)=>e*t,"/":(e,t)=>e/t,"%":(e,t)=>e%t,"+":(e,t)=>e+t,"-":(e,t)=>e-t,"<<":(e,t)=>e<<t,">>":(e,t)=>e>>t,">>>":(e,t)=>e>>>t,"&":(e,t)=>e&t,"^":(e,t)=>e^t,"|":(e,t)=>e|t};class It{constructor(e,t,n){this.left=t,this.operator=e,this.right=n}evaluate(){const e=Rt[this.operator];if(!e)throw new Error(`unexpected binary operator: '${this.operator}`);return e(this.left.evaluate(),this.right.evaluate())}toString(){return["b(",this.left.toString(),this.operator,this.right.toString(),")"].join(" ")}}const Ft={"+":e=>e,"-":e=>-e,"~":e=>~e};class Mt{constructor(e,t){this.operator=e,this.expression=t}evaluate(){const e=Ft[this.operator];if(!e)throw new Error(`unexpected unary operator: '${this.operator}`);return e(this.expression.evaluate())}toString(){return["u(",this.operator,this.expression.toString(),")"].join(" ")}}function Vt(e){return(t,n)=>{for(let r=0;r<e.length;r++){const i=e[r](t,n);if(""!==i)return i}return""}}function Ot(e,t){var n;const r=e.substr(t).match(/^\s+/);return null!==(n=r&&r[0])&&void 0!==n?n:""}function Nt(e,t){const n=e.substr(t,1);return n.match(/^[1-9]$/)?n:""}function Bt(e,t){var n;const r=e.substr(t).match(/^[0-9]+/);return null!==(n=r&&r[0])&&void 0!==n?n:""}function Dt(e,t){const n=Bt(e,t);if(""!==n)return n;const r=e.substr(t,1);if("-"!==r&&"+"!==r)return"";const i=Bt(e,t+=1);return""===i?"":r+i}function zt(e,t){const n=e.substr(t,1);if(t+=1,"e"!==n.toLowerCase())return"";const r=Dt(e,t);return""===r?"":n+r}function Ut(e,t){const n=e.substr(t,1);if("0"===n)return n;const r=Nt(e,t);return t+=r.length,""===r?"":r+Bt(e,t)}function jt(e,t){const n=Ut(e,t);if(t+=n.length,""===n)return"";const r=e.substr(t,1);if(t+=r.length,"."!==r)return"";const i=Bt(e,t);return n+r+i+zt(e,t+=i.length)}function Gt(e,t){const n=e.substr(t,1);if(t+=n.length,"."!==n)return"";const r=Bt(e,t);return t+=r.length,""===r?"":n+r+zt(e,t)}function Wt(e,t){const n=Ut(e,t);return t+=n.length,""===n?"":n+zt(e,t)}const Ht=Vt([jt,Gt,Wt]);function Kt(e,t){var n;const r=e.substr(t).match(/^[01]+/);return null!==(n=r&&r[0])&&void 0!==n?n:""}function qt(e,t){const n=e.substr(t,2);if(t+=n.length,"0b"!==n.toLowerCase())return"";const r=Kt(e,t);return""===r?"":n+r}function Xt(e,t){var n;const r=e.substr(t).match(/^[0-7]+/);return null!==(n=r&&r[0])&&void 0!==n?n:""}function Yt(e,t){const n=e.substr(t,2);if(t+=n.length,"0o"!==n.toLowerCase())return"";const r=Xt(e,t);return""===r?"":n+r}function $t(e,t){var n;const r=e.substr(t).match(/^[0-9a-f]+/i);return null!==(n=r&&r[0])&&void 0!==n?n:""}function Qt(e,t){const n=e.substr(t,2);if(t+=n.length,"0x"!==n.toLowerCase())return"";const r=$t(e,t);return""===r?"":n+r}const Zt=Vt([qt,Yt,Qt]),Jt=Vt([Zt,Ht]);function en(e,t){const n=Jt(e,t);return t+=n.length,""===n?null:{evaluable:new Lt(n),cursor:t}}function tn(e,t){const n=e.substr(t,1);if(t+=n.length,"("!==n)return null;const r=ln(e,t);if(!r)return null;t=r.cursor,t+=Ot(e,t).length;const i=e.substr(t,1);return t+=i.length,")"!==i?null:{evaluable:r.evaluable,cursor:t}}function nn(e,t){var n;return null!==(n=en(e,t))&&void 0!==n?n:tn(e,t)}function rn(e,t){const n=nn(e,t);if(n)return n;const r=e.substr(t,1);if(t+=r.length,"+"!==r&&"-"!==r&&"~"!==r)return null;const i=rn(e,t);return i?{cursor:t=i.cursor,evaluable:new Mt(r,i.evaluable)}:null}function on(e,t,n){n+=Ot(t,n).length;const r=e.filter((e=>t.startsWith(e,n)))[0];return r?(n+=r.length,{cursor:n+=Ot(t,n).length,operator:r}):null}function sn(e,t){return(n,r)=>{const i=e(n,r);if(!i)return null;r=i.cursor;let o=i.evaluable;for(;;){const i=on(t,n,r);if(!i)break;r=i.cursor;const s=e(n,r);if(!s)return null;r=s.cursor,o=new It(i.operator,o,s.evaluable)}return o?{cursor:r,evaluable:o}:null}}const an=[["**"],["*","/","%"],["+","-"],["<<",">>>",">>"],["&"],["^"],["|"]].reduce(((e,t)=>sn(e,t)),rn);function ln(e,t){return t+=Ot(e,t).length,an(e,t)}function cn(e){const t=ln(e,0);return t?t.cursor+Ot(e,t.cursor).length!==e.length?null:t.evaluable:null}function un(e){var t;const n=cn(e);return null!==(t=null==n?void 0:n.evaluate())&&void 0!==t?t:null}function pn(e){if("number"==typeof e)return e;if("string"==typeof e){const t=un(e);if(!c(t))return t}return 0}function dn(e){return String(e)}function hn(e){return t=>t.toFixed(Math.max(Math.min(e,20),0))}const fn=hn(0);function vn(e){return fn(e)+"%"}function mn(e){return String(e)}function bn(e){return e}function gn(e,t){for(;e.length<t;)e.push(void 0)}function _n(e){const t=[];return gn(t,e),L(t)}function wn(e){const t=e.indexOf(void 0);return l(t<0?e:e.slice(0,t))}function xn(e,t){const n=[...wn(e),t];return n.length>e.length?n.splice(0,n.length-e.length):gn(n,e.length),n}function yn({primary:e,secondary:t,forward:n,backward:r}){let i=!1;function o(e){i||(i=!0,e(),i=!1)}e.emitter.on("change",(r=>{o((()=>{t.setRawValue(n(e,t),r.options)}))})),t.emitter.on("change",(i=>{o((()=>{e.setRawValue(r(e,t),i.options)})),o((()=>{t.setRawValue(n(e,t),i.options)}))})),o((()=>{t.setRawValue(n(e,t),{forceEmit:!1,last:!0})}))}function En(e,t){const n=e*(t.altKey?.1:1)*(t.shiftKey?10:1);return t.upKey?+n:t.downKey?-n:0}function Pn(e){return{altKey:e.altKey,downKey:"ArrowDown"===e.key,shiftKey:e.shiftKey,upKey:"ArrowUp"===e.key}}function Cn(e){return{altKey:e.altKey,downKey:"ArrowLeft"===e.key,shiftKey:e.shiftKey,upKey:"ArrowRight"===e.key}}function An(e){return"ArrowUp"===e||"ArrowDown"===e}function Sn(e){return An(e)||"ArrowLeft"===e||"ArrowRight"===e}function kn(e,t){var n,r;const i=t.ownerDocument.defaultView,o=t.getBoundingClientRect();return{x:e.pageX-((null!==(n=i&&i.scrollX)&&void 0!==n?n:0)+o.left),y:e.pageY-((null!==(r=i&&i.scrollY)&&void 0!==r?r:0)+o.top)}}class Tn{constructor(e){this.lastTouch_=null,this.onDocumentMouseMove_=this.onDocumentMouseMove_.bind(this),this.onDocumentMouseUp_=this.onDocumentMouseUp_.bind(this),this.onMouseDown_=this.onMouseDown_.bind(this),this.onTouchEnd_=this.onTouchEnd_.bind(this),this.onTouchMove_=this.onTouchMove_.bind(this),this.onTouchStart_=this.onTouchStart_.bind(this),this.elem_=e,this.emitter=new v,e.addEventListener("touchstart",this.onTouchStart_,{passive:!1}),e.addEventListener("touchmove",this.onTouchMove_,{passive:!0}),e.addEventListener("touchend",this.onTouchEnd_),e.addEventListener("mousedown",this.onMouseDown_)}computePosition_(e){const t=this.elem_.getBoundingClientRect();return{bounds:{width:t.width,height:t.height},point:e?{x:e.x,y:e.y}:null}}onMouseDown_(e){var t;e.preventDefault(),null===(t=e.currentTarget)||void 0===t||t.focus();const n=this.elem_.ownerDocument;n.addEventListener("mousemove",this.onDocumentMouseMove_),n.addEventListener("mouseup",this.onDocumentMouseUp_),this.emitter.emit("down",{altKey:e.altKey,data:this.computePosition_(kn(e,this.elem_)),sender:this,shiftKey:e.shiftKey})}onDocumentMouseMove_(e){this.emitter.emit("move",{altKey:e.altKey,data:this.computePosition_(kn(e,this.elem_)),sender:this,shiftKey:e.shiftKey})}onDocumentMouseUp_(e){const t=this.elem_.ownerDocument;t.removeEventListener("mousemove",this.onDocumentMouseMove_),t.removeEventListener("mouseup",this.onDocumentMouseUp_),this.emitter.emit("up",{altKey:e.altKey,data:this.computePosition_(kn(e,this.elem_)),sender:this,shiftKey:e.shiftKey})}onTouchStart_(e){e.preventDefault();const t=e.targetTouches.item(0),n=this.elem_.getBoundingClientRect();this.emitter.emit("down",{altKey:e.altKey,data:this.computePosition_(t?{x:t.clientX-n.left,y:t.clientY-n.top}:void 0),sender:this,shiftKey:e.shiftKey}),this.lastTouch_=t}onTouchMove_(e){const t=e.targetTouches.item(0),n=this.elem_.getBoundingClientRect();this.emitter.emit("move",{altKey:e.altKey,data:this.computePosition_(t?{x:t.clientX-n.left,y:t.clientY-n.top}:void 0),sender:this,shiftKey:e.shiftKey}),this.lastTouch_=t}onTouchEnd_(e){var t;const n=null!==(t=e.targetTouches.item(0))&&void 0!==t?t:this.lastTouch_,r=this.elem_.getBoundingClientRect();this.emitter.emit("up",{altKey:e.altKey,data:this.computePosition_(n?{x:n.clientX-r.left,y:n.clientY-r.top}:void 0),sender:this,shiftKey:e.shiftKey})}}function Ln(e,t,n,r,i){return r+(e-t)/(n-t)*(i-r)}function Rn(e){return String(e.toFixed(10)).split(".")[1].replace(/0+$/,"").length}function In(e,t,n){return Math.min(Math.max(e,t),n)}function Fn(e,t){return(e%t+t)%t}const Mn=b("txt");class Vn{constructor(e,t){this.onChange_=this.onChange_.bind(this),this.props_=t.props,this.props_.emitter.on("change",this.onChange_),this.element=e.createElement("div"),this.element.classList.add(Mn(),Mn(void 0,"num")),t.arrayPosition&&this.element.classList.add(Mn(void 0,t.arrayPosition)),t.viewProps.bindClassModifiers(this.element);const n=e.createElement("input");n.classList.add(Mn("i")),n.type="text",t.viewProps.bindDisabled(n),this.element.appendChild(n),this.inputElement=n,this.onDraggingChange_=this.onDraggingChange_.bind(this),this.dragging_=t.dragging,this.dragging_.emitter.on("change",this.onDraggingChange_),this.element.classList.add(Mn()),this.inputElement.classList.add(Mn("i"));const r=e.createElement("div");r.classList.add(Mn("k")),this.element.appendChild(r),this.knobElement=r;const i=e.createElementNS(W,"svg");i.classList.add(Mn("g")),this.knobElement.appendChild(i);const o=e.createElementNS(W,"path");o.classList.add(Mn("gb")),i.appendChild(o),this.guideBodyElem_=o;const s=e.createElementNS(W,"path");s.classList.add(Mn("gh")),i.appendChild(s),this.guideHeadElem_=s;const a=e.createElement("div");a.classList.add(b("tt")()),this.knobElement.appendChild(a),this.tooltipElem_=a,t.value.emitter.on("change",this.onChange_),this.value=t.value,this.refresh()}onDraggingChange_(e){if(null===e.rawValue)return void this.element.classList.remove(Mn(void 0,"drg"));this.element.classList.add(Mn(void 0,"drg"));const t=e.rawValue/this.props_.get("draggingScale"),n=t+(t>0?-1:t<0?1:0),r=In(-n,-4,4);this.guideHeadElem_.setAttributeNS(null,"d",[`M ${n+r},0 L${n},4 L${n+r},8`,`M ${t},-1 L${t},9`].join(" ")),this.guideBodyElem_.setAttributeNS(null,"d",`M 0,4 L${t},4`);const i=this.props_.get("formatter");this.tooltipElem_.textContent=i(this.value.rawValue),this.tooltipElem_.style.left=`${t}px`}refresh(){const e=this.props_.get("formatter");this.inputElement.value=e(this.value.rawValue)}onChange_(){this.refresh()}}class On{constructor(e,t){var n;this.originRawValue_=0,this.onInputChange_=this.onInputChange_.bind(this),this.onInputKeyDown_=this.onInputKeyDown_.bind(this),this.onInputKeyUp_=this.onInputKeyUp_.bind(this),this.onPointerDown_=this.onPointerDown_.bind(this),this.onPointerMove_=this.onPointerMove_.bind(this),this.onPointerUp_=this.onPointerUp_.bind(this),this.baseStep_=t.baseStep,this.parser_=t.parser,this.props=t.props,this.sliderProps_=null!==(n=t.sliderProps)&&void 0!==n?n:null,this.value=t.value,this.viewProps=t.viewProps,this.dragging_=L(null),this.view=new Vn(e,{arrayPosition:t.arrayPosition,dragging:this.dragging_,props:this.props,value:this.value,viewProps:this.viewProps}),this.view.inputElement.addEventListener("change",this.onInputChange_),this.view.inputElement.addEventListener("keydown",this.onInputKeyDown_),this.view.inputElement.addEventListener("keyup",this.onInputKeyUp_);const r=new Tn(this.view.knobElement);r.emitter.on("down",this.onPointerDown_),r.emitter.on("move",this.onPointerMove_),r.emitter.on("up",this.onPointerUp_)}constrainValue_(e){var t,n;const r=null===(t=this.sliderProps_)||void 0===t?void 0:t.get("minValue"),i=null===(n=this.sliderProps_)||void 0===n?void 0:n.get("maxValue");let o=e;return void 0!==r&&(o=Math.max(o,r)),void 0!==i&&(o=Math.min(o,i)),o}onInputChange_(e){const t=l(e.currentTarget).value,n=this.parser_(t);c(n)||(this.value.rawValue=this.constrainValue_(n)),this.view.refresh()}onInputKeyDown_(e){const t=En(this.baseStep_,Pn(e));0!==t&&this.value.setRawValue(this.constrainValue_(this.value.rawValue+t),{forceEmit:!1,last:!1})}onInputKeyUp_(e){0!==En(this.baseStep_,Pn(e))&&this.value.setRawValue(this.value.rawValue,{forceEmit:!0,last:!0})}onPointerDown_(){this.originRawValue_=this.value.rawValue,this.dragging_.rawValue=0}computeDraggingValue_(e){if(!e.point)return null;const t=e.point.x-e.bounds.width/2;return this.constrainValue_(this.originRawValue_+t*this.props.get("draggingScale"))}onPointerMove_(e){const t=this.computeDraggingValue_(e.data);null!==t&&(this.value.setRawValue(t,{forceEmit:!1,last:!1}),this.dragging_.rawValue=this.value.rawValue-this.originRawValue_)}onPointerUp_(e){const t=this.computeDraggingValue_(e.data);null!==t&&(this.value.setRawValue(t,{forceEmit:!0,last:!0}),this.dragging_.rawValue=null)}}const Nn=b("sld");class Bn{constructor(e,t){this.onChange_=this.onChange_.bind(this),this.props_=t.props,this.props_.emitter.on("change",this.onChange_),this.element=e.createElement("div"),this.element.classList.add(Nn()),t.viewProps.bindClassModifiers(this.element);const n=e.createElement("div");n.classList.add(Nn("t")),t.viewProps.bindTabIndex(n),this.element.appendChild(n),this.trackElement=n;const r=e.createElement("div");r.classList.add(Nn("k")),this.trackElement.appendChild(r),this.knobElement=r,t.value.emitter.on("change",this.onChange_),this.value=t.value,this.update_()}update_(){const e=In(Ln(this.value.rawValue,this.props_.get("minValue"),this.props_.get("maxValue"),0,100),0,100);this.knobElement.style.width=`${e}%`}onChange_(){this.update_()}}class Dn{constructor(e,t){this.onKeyDown_=this.onKeyDown_.bind(this),this.onKeyUp_=this.onKeyUp_.bind(this),this.onPointerDownOrMove_=this.onPointerDownOrMove_.bind(this),this.onPointerUp_=this.onPointerUp_.bind(this),this.baseStep_=t.baseStep,this.value=t.value,this.viewProps=t.viewProps,this.props=t.props,this.view=new Bn(e,{props:this.props,value:this.value,viewProps:this.viewProps}),this.ptHandler_=new Tn(this.view.trackElement),this.ptHandler_.emitter.on("down",this.onPointerDownOrMove_),this.ptHandler_.emitter.on("move",this.onPointerDownOrMove_),this.ptHandler_.emitter.on("up",this.onPointerUp_),this.view.trackElement.addEventListener("keydown",this.onKeyDown_),this.view.trackElement.addEventListener("keyup",this.onKeyUp_)}handlePointerEvent_(e,t){e.point&&this.value.setRawValue(Ln(In(e.point.x,0,e.bounds.width),0,e.bounds.width,this.props.get("minValue"),this.props.get("maxValue")),t)}onPointerDownOrMove_(e){this.handlePointerEvent_(e.data,{forceEmit:!1,last:!1})}onPointerUp_(e){this.handlePointerEvent_(e.data,{forceEmit:!0,last:!0})}onKeyDown_(e){const t=En(this.baseStep_,Cn(e));0!==t&&this.value.setRawValue(this.value.rawValue+t,{forceEmit:!1,last:!1})}onKeyUp_(e){0!==En(this.baseStep_,Cn(e))&&this.value.setRawValue(this.value.rawValue,{forceEmit:!0,last:!0})}}const zn=b("sldtxt");class Un{constructor(e,t){this.element=e.createElement("div"),this.element.classList.add(zn());const n=e.createElement("div");n.classList.add(zn("s")),this.sliderView_=t.sliderView,n.appendChild(this.sliderView_.element),this.element.appendChild(n);const r=e.createElement("div");r.classList.add(zn("t")),this.textView_=t.textView,r.appendChild(this.textView_.element),this.element.appendChild(r)}}class jn{constructor(e,t){this.value=t.value,this.viewProps=t.viewProps,this.sliderC_=new Dn(e,{baseStep:t.baseStep,props:t.sliderProps,value:t.value,viewProps:this.viewProps}),this.textC_=new On(e,{baseStep:t.baseStep,parser:t.parser,props:t.textProps,sliderProps:t.sliderProps,value:t.value,viewProps:t.viewProps}),this.view=new Un(e,{sliderView:this.sliderC_.view,textView:this.textC_.view})}get sliderController(){return this.sliderC_}get textController(){return this.textC_}}function Gn(e,t){e.write(t)}function Wn(e){const t=N;return Array.isArray(e)?t.required.array(t.required.object({text:t.required.string,value:t.required.raw}))(e).value:"object"==typeof e?t.required.raw(e).value:void 0}function Hn(e){if("inline"===e||"popup"===e)return e}function Kn(e){const t=N;return t.required.object({max:t.optional.number,min:t.optional.number,step:t.optional.number})(e).value}function qn(e){if(Array.isArray(e))return e;const t=[];return Object.keys(e).forEach((n=>{t.push({text:n,value:e[n]})})),t}function Xn(e){return c(e)?null:new vt(qn(l(e)))}function Yn(e){const t=e?ft(e,vt):null;return t?t.options:null}function $n(e){const t=e?ft(e,bt):null;return t?t.step:null}function Qn(e,t){const n=e&&ft(e,bt);return n?Rn(n.step):Math.max(Rn(t),2)}function Zn(e){const t=$n(e);return null!=t?t:1}function Jn(e,t){var n;const r=e&&ft(e,bt),i=Math.abs(null!==(n=null==r?void 0:r.step)&&void 0!==n?n:t);return 0===i?.1:Math.pow(10,Math.floor(Math.log10(i))-1)}const er=b("ckb");class tr{constructor(e,t){this.onValueChange_=this.onValueChange_.bind(this),this.element=e.createElement("div"),this.element.classList.add(er()),t.viewProps.bindClassModifiers(this.element);const n=e.createElement("label");n.classList.add(er("l")),this.element.appendChild(n);const r=e.createElement("input");r.classList.add(er("i")),r.type="checkbox",n.appendChild(r),this.inputElement=r,t.viewProps.bindDisabled(this.inputElement);const i=e.createElement("div");i.classList.add(er("w")),n.appendChild(i);const o=Z(e,"check");i.appendChild(o),t.value.emitter.on("change",this.onValueChange_),this.value=t.value,this.update_()}update_(){this.inputElement.checked=this.value.rawValue}onValueChange_(){this.update_()}}class nr{constructor(e,t){this.onInputChange_=this.onInputChange_.bind(this),this.value=t.value,this.viewProps=t.viewProps,this.view=new tr(e,{value:this.value,viewProps:this.viewProps}),this.view.inputElement.addEventListener("change",this.onInputChange_)}onInputChange_(e){const t=l(e.currentTarget);this.value.rawValue=t.checked}}function rr(e){const t=[],n=Xn(e.options);return n&&t.push(n),new ht(t)}const ir={id:"input-bool",type:"input",accept:(e,t)=>{if("boolean"!=typeof e)return null;const n=B(t,{options:N.optional.custom(Wn)});return n?{initialValue:e,params:n}:null},binding:{reader:e=>kt,constraint:e=>rr(e.params),writer:e=>Gn},controller:e=>{var t;const n=e.document,r=e.value,i=e.constraint;return i&&ft(i,vt)?new wt(n,{props:R.fromObject({options:null!==(t=Yn(i))&&void 0!==t?t:[]}),value:r,viewProps:e.viewProps}):new nr(n,{value:r,viewProps:e.viewProps})}},or=b("col");class sr{constructor(e,t){this.element=e.createElement("div"),this.element.classList.add(or()),t.foldable.bindExpandedClass(this.element,or(void 0,"expanded")),x(t.foldable,"completed",E(this.element,or(void 0,"cpl")));const n=e.createElement("div");n.classList.add(or("h")),this.element.appendChild(n);const r=e.createElement("div");r.classList.add(or("s")),n.appendChild(r),this.swatchElement=r;const i=e.createElement("div");if(i.classList.add(or("t")),n.appendChild(i),this.textElement=i,"inline"===t.pickerLayout){const t=e.createElement("div");t.classList.add(or("p")),this.element.appendChild(t),this.pickerElement=t}else this.pickerElement=null}}function ar(e,t,n){const r=In(e/255,0,1),i=In(t/255,0,1),o=In(n/255,0,1),s=Math.max(r,i,o),a=Math.min(r,i,o),l=s-a;let c=0,u=0;const p=(a+s)/2;return 0!==l&&(u=l/(1-Math.abs(s+a-1)),c=r===s?(i-o)/l:i===s?2+(o-r)/l:4+(r-i)/l,c=c/6+(c<0?1:0)),[360*c,100*u,100*p]}function lr(e,t,n){const r=(e%360+360)%360,i=In(t/100,0,1),o=In(n/100,0,1),s=(1-Math.abs(2*o-1))*i,a=s*(1-Math.abs(r/60%2-1)),l=o-s/2;let c,u,p;return[c,u,p]=r>=0&&r<60?[s,a,0]:r>=60&&r<120?[a,s,0]:r>=120&&r<180?[0,s,a]:r>=180&&r<240?[0,a,s]:r>=240&&r<300?[a,0,s]:[s,0,a],[255*(c+l),255*(u+l),255*(p+l)]}function cr(e,t,n){const r=In(e/255,0,1),i=In(t/255,0,1),o=In(n/255,0,1),s=Math.max(r,i,o),a=s-Math.min(r,i,o);let l;return l=0===a?0:s===r?((i-o)/a%6+6)%6*60:s===i?60*((o-r)/a+2):60*((r-i)/a+4),[l,100*(0===s?0:a/s),100*s]}function ur(e,t,n){const r=Fn(e,360),i=In(t/100,0,1),o=In(n/100,0,1),s=o*i,a=s*(1-Math.abs(r/60%2-1)),l=o-s;let c,u,p;return[c,u,p]=r>=0&&r<60?[s,a,0]:r>=60&&r<120?[a,s,0]:r>=120&&r<180?[0,s,a]:r>=180&&r<240?[0,a,s]:r>=240&&r<300?[a,0,s]:[s,0,a],[255*(c+l),255*(u+l),255*(p+l)]}function pr(e,t,n){const r=n+t*(100-Math.abs(2*n-100))/200;return[e,0!==r?t*(100-Math.abs(2*n-100))/r:0,n+t*(100-Math.abs(2*n-100))/200]}function dr(e,t,n){const r=100-Math.abs(n*(200-t)/100-100);return[e,0!==r?t*n/r:0,n*(200-t)/200]}function hr(e){return[e[0],e[1],e[2]]}function fr(e,t){return[e[0],e[1],e[2],t]}const vr={hsl:{hsl:(e,t,n)=>[e,t,n],hsv:pr,rgb:lr},hsv:{hsl:dr,hsv:(e,t,n)=>[e,t,n],rgb:ur},rgb:{hsl:ar,hsv:cr,rgb:(e,t,n)=>[e,t,n]}};function mr(e,t){return["float"===t?1:"rgb"===e?255:360,"float"===t?1:"rgb"===e?255:100,"float"===t?1:"rgb"===e?255:100]}function br(e,t,n){var r;const i=mr(t,n);return["rgb"===t?In(e[0],0,i[0]):Fn(e[0],i[0]),In(e[1],0,i[1]),In(e[2],0,i[2]),In(null!==(r=e[3])&&void 0!==r?r:1,0,1)]}function gr(e,t,n,r){const i=mr(t,n),o=mr(t,r);return e.map(((e,t)=>e/i[t]*o[t]))}function _r(e,t,n){const r=gr(e,t.mode,t.type,"int");return gr(vr[t.mode][n.mode](...r),n.mode,"int",n.type)}function wr(e,t){return"object"==typeof e&&!c(e)&&t in e&&"number"==typeof e[t]}class xr{constructor(e,t,n="int"){this.mode=t,this.type=n,this.comps_=br(e,t,n)}static black(e="int"){return new xr([0,0,0],"rgb",e)}static fromObject(e,t="int"){const n="a"in e?[e.r,e.g,e.b,e.a]:[e.r,e.g,e.b];return new xr(n,"rgb",t)}static toRgbaObject(e,t="int"){return e.toRgbaObject(t)}static isRgbColorObject(e){return wr(e,"r")&&wr(e,"g")&&wr(e,"b")}static isRgbaColorObject(e){return this.isRgbColorObject(e)&&wr(e,"a")}static isColorObject(e){return this.isRgbColorObject(e)}static equals(e,t){if(e.mode!==t.mode)return!1;const n=e.comps_,r=t.comps_;for(let i=0;i<n.length;i++)if(n[i]!==r[i])return!1;return!0}getComponents(e,t="int"){return fr(_r(hr(this.comps_),{mode:this.mode,type:this.type},{mode:null!=e?e:this.mode,type:t}),this.comps_[3])}toRgbaObject(e="int"){const t=this.getComponents("rgb",e);return{r:t[0],g:t[1],b:t[2],a:t[3]}}}const yr=b("colp");class Er{constructor(e,t){this.alphaViews_=null,this.element=e.createElement("div"),this.element.classList.add(yr());const n=e.createElement("div");n.classList.add(yr("hsv"));const r=e.createElement("div");r.classList.add(yr("sv")),this.svPaletteView_=t.svPaletteView,r.appendChild(this.svPaletteView_.element),n.appendChild(r);const i=e.createElement("div");i.classList.add(yr("h")),this.hPaletteView_=t.hPaletteView,i.appendChild(this.hPaletteView_.element),n.appendChild(i),this.element.appendChild(n);const o=e.createElement("div");if(o.classList.add(yr("rgb")),this.textView_=t.textView,o.appendChild(this.textView_.element),this.element.appendChild(o),t.alphaViews){this.alphaViews_={palette:t.alphaViews.palette,text:t.alphaViews.text};const n=e.createElement("div");n.classList.add(yr("a"));const r=e.createElement("div");r.classList.add(yr("ap")),r.appendChild(this.alphaViews_.palette.element),n.appendChild(r);const i=e.createElement("div");i.classList.add(yr("at")),i.appendChild(this.alphaViews_.text.element),n.appendChild(i),this.element.appendChild(n)}}get allFocusableElements(){const e=[this.svPaletteView_.element,this.hPaletteView_.element,this.textView_.modeSelectElement,...this.textView_.textViews.map((e=>e.inputElement))];return this.alphaViews_&&e.push(this.alphaViews_.palette.element,this.alphaViews_.text.inputElement),e}}function Pr(e){return"int"===e?"int":"float"===e?"float":void 0}function Cr(e){const t=N;return B(e,{alpha:t.optional.boolean,color:t.optional.object({alpha:t.optional.boolean,type:t.optional.custom(Pr)}),expanded:t.optional.boolean,picker:t.optional.custom(Hn)})}function Ar(e){return e?.1:1}function Sr(e){var t;return null===(t=e.color)||void 0===t?void 0:t.type}function kr(e,t){return e.alpha===t.alpha&&e.mode===t.mode&&e.notation===t.notation&&e.type===t.type}function Tr(e,t){const n=e.match(/^(.+)%$/);return n?Math.min(.01*parseFloat(n[1])*t,t):Math.min(parseFloat(e),t)}const Lr={deg:e=>e,grad:e=>360*e/400,rad:e=>360*e/(2*Math.PI),turn:e=>360*e};function Rr(e){const t=e.match(/^([0-9.]+?)(deg|grad|rad|turn)$/);if(!t)return parseFloat(e);const n=parseFloat(t[1]),r=t[2];return Lr[r](n)}function Ir(e){const t=e.match(/^rgb\(\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*\)$/);if(!t)return null;const n=[Tr(t[1],255),Tr(t[2],255),Tr(t[3],255)];return isNaN(n[0])||isNaN(n[1])||isNaN(n[2])?null:n}function Fr(e){return t=>{const n=Ir(t);return n?new xr(n,"rgb",e):null}}function Mr(e){const t=e.match(/^rgba\(\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*\)$/);if(!t)return null;const n=[Tr(t[1],255),Tr(t[2],255),Tr(t[3],255),Tr(t[4],1)];return isNaN(n[0])||isNaN(n[1])||isNaN(n[2])||isNaN(n[3])?null:n}function Vr(e){return t=>{const n=Mr(t);return n?new xr(n,"rgb",e):null}}function Or(e){const t=e.match(/^hsl\(\s*([0-9A-Fa-f.]+(?:deg|grad|rad|turn)?)\s*,\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*\)$/);if(!t)return null;const n=[Rr(t[1]),Tr(t[2],100),Tr(t[3],100)];return isNaN(n[0])||isNaN(n[1])||isNaN(n[2])?null:n}function Nr(e){return t=>{const n=Or(t);return n?new xr(n,"hsl",e):null}}function Br(e){const t=e.match(/^hsla\(\s*([0-9A-Fa-f.]+(?:deg|grad|rad|turn)?)\s*,\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*\)$/);if(!t)return null;const n=[Rr(t[1]),Tr(t[2],100),Tr(t[3],100),Tr(t[4],1)];return isNaN(n[0])||isNaN(n[1])||isNaN(n[2])||isNaN(n[3])?null:n}function Dr(e){return t=>{const n=Br(t);return n?new xr(n,"hsl",e):null}}function zr(e){const t=e.match(/^#([0-9A-Fa-f])([0-9A-Fa-f])([0-9A-Fa-f])$/);if(t)return[parseInt(t[1]+t[1],16),parseInt(t[2]+t[2],16),parseInt(t[3]+t[3],16)];const n=e.match(/^(?:#|0x)([0-9A-Fa-f]{2})([0-9A-Fa-f]{2})([0-9A-Fa-f]{2})$/);return n?[parseInt(n[1],16),parseInt(n[2],16),parseInt(n[3],16)]:null}function Ur(e){const t=zr(e);return t?new xr(t,"rgb","int"):null}function jr(e){const t=e.match(/^#?([0-9A-Fa-f])([0-9A-Fa-f])([0-9A-Fa-f])([0-9A-Fa-f])$/);if(t)return[parseInt(t[1]+t[1],16),parseInt(t[2]+t[2],16),parseInt(t[3]+t[3],16),Ln(parseInt(t[4]+t[4],16),0,255,0,1)];const n=e.match(/^(?:#|0x)?([0-9A-Fa-f]{2})([0-9A-Fa-f]{2})([0-9A-Fa-f]{2})([0-9A-Fa-f]{2})$/);return n?[parseInt(n[1],16),parseInt(n[2],16),parseInt(n[3],16),Ln(parseInt(n[4],16),0,255,0,1)]:null}function Gr(e){const t=jr(e);return t?new xr(t,"rgb","int"):null}function Wr(e){const t=e.match(/^\{\s*r\s*:\s*([0-9A-Fa-f.]+%?)\s*,\s*g\s*:\s*([0-9A-Fa-f.]+%?)\s*,\s*b\s*:\s*([0-9A-Fa-f.]+%?)\s*\}$/);if(!t)return null;const n=[parseFloat(t[1]),parseFloat(t[2]),parseFloat(t[3])];return isNaN(n[0])||isNaN(n[1])||isNaN(n[2])?null:n}function Hr(e){return t=>{const n=Wr(t);return n?new xr(n,"rgb",e):null}}function Kr(e){const t=e.match(/^\{\s*r\s*:\s*([0-9A-Fa-f.]+%?)\s*,\s*g\s*:\s*([0-9A-Fa-f.]+%?)\s*,\s*b\s*:\s*([0-9A-Fa-f.]+%?)\s*,\s*a\s*:\s*([0-9A-Fa-f.]+%?)\s*\}$/);if(!t)return null;const n=[parseFloat(t[1]),parseFloat(t[2]),parseFloat(t[3]),parseFloat(t[4])];return isNaN(n[0])||isNaN(n[1])||isNaN(n[2])||isNaN(n[3])?null:n}function qr(e){return t=>{const n=Kr(t);return n?new xr(n,"rgb",e):null}}const Xr=[{parser:zr,result:{alpha:!1,mode:"rgb",notation:"hex"}},{parser:jr,result:{alpha:!0,mode:"rgb",notation:"hex"}},{parser:Ir,result:{alpha:!1,mode:"rgb",notation:"func"}},{parser:Mr,result:{alpha:!0,mode:"rgb",notation:"func"}},{parser:Or,result:{alpha:!1,mode:"hsl",notation:"func"}},{parser:Br,result:{alpha:!0,mode:"hsl",notation:"func"}},{parser:Wr,result:{alpha:!1,mode:"rgb",notation:"object"}},{parser:Kr,result:{alpha:!0,mode:"rgb",notation:"object"}}];function Yr(e){return Xr.reduce(((t,{parser:n,result:r})=>t||(n(e)?r:null)),null)}function $r(e,t="int"){const n=Yr(e);return n?"hex"===n.notation&&"float"!==t?Object.assign(Object.assign({},n),{type:"int"}):"func"===n.notation?Object.assign(Object.assign({},n),{type:t}):null:null}const Qr={int:[Ur,Gr,Fr("int"),Vr("int"),Nr("int"),Dr("int"),Hr("int"),qr("int")],float:[Fr("float"),Vr("float"),Nr("float"),Dr("float"),Hr("float"),qr("float")]};function Zr(e){const t=Qr[e];return n=>{if("string"!=typeof n)return xr.black(e);const r=t.reduce(((e,t)=>e||t(n)),null);return null!=r?r:xr.black(e)}}function Jr(e){const t=Qr[e];return e=>t.reduce(((t,n)=>t||n(e)),null)}function ei(e){const t=In(Math.floor(e),0,255).toString(16);return 1===t.length?`0${t}`:t}function ti(e,t="#"){return`${t}${hr(e.getComponents("rgb")).map(ei).join("")}`}function ni(e,t="#"){const n=e.getComponents("rgb");return`${t}${[n[0],n[1],n[2],255*n[3]].map(ei).join("")}`}function ri(e,t){const n=hn("float"===t?2:0);return`rgb(${hr(e.getComponents("rgb",t)).map((e=>n(e))).join(", ")})`}function ii(e){return t=>ri(t,e)}function oi(e,t){const n=hn(2),r=hn("float"===t?2:0);return`rgba(${e.getComponents("rgb",t).map(((e,t)=>(3===t?n:r)(e))).join(", ")})`}function si(e){return t=>oi(t,e)}function ai(e){const t=[hn(0),vn,vn];return`hsl(${hr(e.getComponents("hsl")).map(((e,n)=>t[n](e))).join(", ")})`}function li(e){const t=[hn(0),vn,vn,hn(2)];return`hsla(${e.getComponents("hsl").map(((e,n)=>t[n](e))).join(", ")})`}function ci(e,t){const n=hn("float"===t?2:0),r=["r","g","b"];return`{${hr(e.getComponents("rgb",t)).map(((e,t)=>`${r[t]}: ${n(e)}`)).join(", ")}}`}function ui(e){return t=>ci(t,e)}function pi(e,t){const n=hn(2),r=hn("float"===t?2:0),i=["r","g","b","a"];return`{${e.getComponents("rgb",t).map(((e,t)=>{const o=3===t?n:r;return`${i[t]}: ${o(e)}`})).join(", ")}}`}function di(e){return t=>pi(t,e)}const hi=[{format:{alpha:!1,mode:"rgb",notation:"hex",type:"int"},stringifier:ti},{format:{alpha:!0,mode:"rgb",notation:"hex",type:"int"},stringifier:ni},{format:{alpha:!1,mode:"hsl",notation:"func",type:"int"},stringifier:ai},{format:{alpha:!0,mode:"hsl",notation:"func",type:"int"},stringifier:li},...["int","float"].reduce(((e,t)=>[...e,{format:{alpha:!1,mode:"rgb",notation:"func",type:t},stringifier:ii(t)},{format:{alpha:!0,mode:"rgb",notation:"func",type:t},stringifier:si(t)},{format:{alpha:!1,mode:"rgb",notation:"object",type:t},stringifier:ui(t)},{format:{alpha:!0,mode:"rgb",notation:"object",type:t},stringifier:di(t)}]),[])];function fi(e){return hi.reduce(((t,n)=>t||(kr(n.format,e)?n.stringifier:null)),null)}const vi=b("apl");class mi{constructor(e,t){this.onValueChange_=this.onValueChange_.bind(this),this.value=t.value,this.value.emitter.on("change",this.onValueChange_),this.element=e.createElement("div"),this.element.classList.add(vi()),t.viewProps.bindTabIndex(this.element);const n=e.createElement("div");n.classList.add(vi("b")),this.element.appendChild(n);const r=e.createElement("div");r.classList.add(vi("c")),n.appendChild(r),this.colorElem_=r;const i=e.createElement("div");i.classList.add(vi("m")),this.element.appendChild(i),this.markerElem_=i;const o=e.createElement("div");o.classList.add(vi("p")),this.markerElem_.appendChild(o),this.previewElem_=o,this.update_()}update_(){const e=this.value.rawValue,t=e.getComponents("rgb"),n=new xr([t[0],t[1],t[2],0],"rgb"),r=new xr([t[0],t[1],t[2],255],"rgb"),i=["to right",oi(n),oi(r)];this.colorElem_.style.background=`linear-gradient(${i.join(",")})`,this.previewElem_.style.backgroundColor=oi(e);const o=Ln(t[3],0,1,0,100);this.markerElem_.style.left=`${o}%`}onValueChange_(){this.update_()}}class bi{constructor(e,t){this.onKeyDown_=this.onKeyDown_.bind(this),this.onKeyUp_=this.onKeyUp_.bind(this),this.onPointerDown_=this.onPointerDown_.bind(this),this.onPointerMove_=this.onPointerMove_.bind(this),this.onPointerUp_=this.onPointerUp_.bind(this),this.value=t.value,this.viewProps=t.viewProps,this.view=new mi(e,{value:this.value,viewProps:this.viewProps}),this.ptHandler_=new Tn(this.view.element),this.ptHandler_.emitter.on("down",this.onPointerDown_),this.ptHandler_.emitter.on("move",this.onPointerMove_),this.ptHandler_.emitter.on("up",this.onPointerUp_),this.view.element.addEventListener("keydown",this.onKeyDown_),this.view.element.addEventListener("keyup",this.onKeyUp_)}handlePointerEvent_(e,t){if(!e.point)return;const n=e.point.x/e.bounds.width,r=this.value.rawValue,[i,o,s]=r.getComponents("hsv");this.value.setRawValue(new xr([i,o,s,n],"hsv"),t)}onPointerDown_(e){this.handlePointerEvent_(e.data,{forceEmit:!1,last:!1})}onPointerMove_(e){this.handlePointerEvent_(e.data,{forceEmit:!1,last:!1})}onPointerUp_(e){this.handlePointerEvent_(e.data,{forceEmit:!0,last:!0})}onKeyDown_(e){const t=En(Ar(!0),Cn(e));if(0===t)return;const n=this.value.rawValue,[r,i,o,s]=n.getComponents("hsv");this.value.setRawValue(new xr([r,i,o,s+t],"hsv"),{forceEmit:!1,last:!1})}onKeyUp_(e){0!==En(Ar(!0),Cn(e))&&this.value.setRawValue(this.value.rawValue,{forceEmit:!0,last:!0})}}const gi=b("coltxt");function _i(e){const t=e.createElement("select"),n=[{text:"RGB",value:"rgb"},{text:"HSL",value:"hsl"},{text:"HSV",value:"hsv"}];return t.appendChild(n.reduce(((t,n)=>{const r=e.createElement("option");return r.textContent=n.text,r.value=n.value,t.appendChild(r),t}),e.createDocumentFragment())),t}class wi{constructor(e,t){this.element=e.createElement("div"),this.element.classList.add(gi());const n=e.createElement("div");n.classList.add(gi("m")),this.modeElem_=_i(e),this.modeElem_.classList.add(gi("ms")),n.appendChild(this.modeSelectElement);const r=e.createElement("div");r.classList.add(gi("mm")),r.appendChild(Z(e,"dropdown")),n.appendChild(r),this.element.appendChild(n);const i=e.createElement("div");i.classList.add(gi("w")),this.element.appendChild(i),this.textsElem_=i,this.textViews_=t.textViews,this.applyTextViews_(),w(t.colorMode,(e=>{this.modeElem_.value=e}))}get modeSelectElement(){return this.modeElem_}get textViews(){return this.textViews_}set textViews(e){this.textViews_=e,this.applyTextViews_()}applyTextViews_(){te(this.textsElem_);const e=this.element.ownerDocument;this.textViews_.forEach((t=>{const n=e.createElement("div");n.classList.add(gi("c")),n.appendChild(t.element),this.textsElem_.appendChild(n)}))}}function xi(e){return hn("float"===e?2:0)}function yi(e,t,n){const r=mr(e,t)[n];return new mt({min:0,max:r})}function Ei(e,t,n){return new On(e,{arrayPosition:0===n?"fst":2===n?"lst":"mid",baseStep:Ar(!1),parser:t.parser,props:R.fromObject({draggingScale:"float"===t.colorType?.01:1,formatter:xi(t.colorType)}),value:L(0,{constraint:yi(t.colorMode,t.colorType,n)}),viewProps:t.viewProps})}class Pi{constructor(e,t){this.onModeSelectChange_=this.onModeSelectChange_.bind(this),this.colorType_=t.colorType,this.parser_=t.parser,this.value=t.value,this.viewProps=t.viewProps,this.colorMode=L(this.value.rawValue.mode),this.ccs_=this.createComponentControllers_(e),this.view=new wi(e,{colorMode:this.colorMode,textViews:[this.ccs_[0].view,this.ccs_[1].view,this.ccs_[2].view]}),this.view.modeSelectElement.addEventListener("change",this.onModeSelectChange_)}createComponentControllers_(e){const t={colorMode:this.colorMode.rawValue,colorType:this.colorType_,parser:this.parser_,viewProps:this.viewProps},n=[Ei(e,t,0),Ei(e,t,1),Ei(e,t,2)];return n.forEach(((e,t)=>{yn({primary:this.value,secondary:e.value,forward:e=>e.rawValue.getComponents(this.colorMode.rawValue,this.colorType_)[t],backward:(e,n)=>{const r=this.colorMode.rawValue,i=e.rawValue.getComponents(r,this.colorType_);return i[t]=n.rawValue,new xr(fr(hr(i),i[3]),r,this.colorType_)}})})),n}onModeSelectChange_(e){const t=e.currentTarget;this.colorMode.rawValue=t.value,this.ccs_=this.createComponentControllers_(this.view.element.ownerDocument),this.view.textViews=[this.ccs_[0].view,this.ccs_[1].view,this.ccs_[2].view]}}const Ci=b("hpl");class Ai{constructor(e,t){this.onValueChange_=this.onValueChange_.bind(this),this.value=t.value,this.value.emitter.on("change",this.onValueChange_),this.element=e.createElement("div"),this.element.classList.add(Ci()),t.viewProps.bindTabIndex(this.element);const n=e.createElement("div");n.classList.add(Ci("c")),this.element.appendChild(n);const r=e.createElement("div");r.classList.add(Ci("m")),this.element.appendChild(r),this.markerElem_=r,this.update_()}update_(){const e=this.value.rawValue,[t]=e.getComponents("hsv");this.markerElem_.style.backgroundColor=ri(new xr([t,100,100],"hsv"));const n=Ln(t,0,360,0,100);this.markerElem_.style.left=`${n}%`}onValueChange_(){this.update_()}}class Si{constructor(e,t){this.onKeyDown_=this.onKeyDown_.bind(this),this.onKeyUp_=this.onKeyUp_.bind(this),this.onPointerDown_=this.onPointerDown_.bind(this),this.onPointerMove_=this.onPointerMove_.bind(this),this.onPointerUp_=this.onPointerUp_.bind(this),this.value=t.value,this.viewProps=t.viewProps,this.view=new Ai(e,{value:this.value,viewProps:this.viewProps}),this.ptHandler_=new Tn(this.view.element),this.ptHandler_.emitter.on("down",this.onPointerDown_),this.ptHandler_.emitter.on("move",this.onPointerMove_),this.ptHandler_.emitter.on("up",this.onPointerUp_),this.view.element.addEventListener("keydown",this.onKeyDown_),this.view.element.addEventListener("keyup",this.onKeyUp_)}handlePointerEvent_(e,t){if(!e.point)return;const n=Ln(In(e.point.x,0,e.bounds.width),0,e.bounds.width,0,359),r=this.value.rawValue,[,i,o,s]=r.getComponents("hsv");this.value.setRawValue(new xr([n,i,o,s],"hsv"),t)}onPointerDown_(e){this.handlePointerEvent_(e.data,{forceEmit:!1,last:!1})}onPointerMove_(e){this.handlePointerEvent_(e.data,{forceEmit:!1,last:!1})}onPointerUp_(e){this.handlePointerEvent_(e.data,{forceEmit:!0,last:!0})}onKeyDown_(e){const t=En(Ar(!1),Cn(e));if(0===t)return;const n=this.value.rawValue,[r,i,o,s]=n.getComponents("hsv");this.value.setRawValue(new xr([r+t,i,o,s],"hsv"),{forceEmit:!1,last:!1})}onKeyUp_(e){0!==En(Ar(!1),Cn(e))&&this.value.setRawValue(this.value.rawValue,{forceEmit:!0,last:!0})}}const ki=b("svp"),Ti=64;class Li{constructor(e,t){this.onValueChange_=this.onValueChange_.bind(this),this.value=t.value,this.value.emitter.on("change",this.onValueChange_),this.element=e.createElement("div"),this.element.classList.add(ki()),t.viewProps.bindTabIndex(this.element);const n=e.createElement("canvas");n.height=Ti,n.width=Ti,n.classList.add(ki("c")),this.element.appendChild(n),this.canvasElement=n;const r=e.createElement("div");r.classList.add(ki("m")),this.element.appendChild(r),this.markerElem_=r,this.update_()}update_(){const e=$(this.canvasElement);if(!e)return;const t=this.value.rawValue.getComponents("hsv"),n=this.canvasElement.width,r=this.canvasElement.height,i=e.getImageData(0,0,n,r),o=i.data;for(let l=0;l<r;l++)for(let e=0;e<n;e++){const i=Ln(e,0,n,0,100),s=Ln(l,0,r,100,0),a=ur(t[0],i,s),c=4*(l*n+e);o[c]=a[0],o[c+1]=a[1],o[c+2]=a[2],o[c+3]=255}e.putImageData(i,0,0);const s=Ln(t[1],0,100,0,100);this.markerElem_.style.left=`${s}%`;const a=Ln(t[2],0,100,100,0);this.markerElem_.style.top=`${a}%`}onValueChange_(){this.update_()}}class Ri{constructor(e,t){this.onKeyDown_=this.onKeyDown_.bind(this),this.onKeyUp_=this.onKeyUp_.bind(this),this.onPointerDown_=this.onPointerDown_.bind(this),this.onPointerMove_=this.onPointerMove_.bind(this),this.onPointerUp_=this.onPointerUp_.bind(this),this.value=t.value,this.viewProps=t.viewProps,this.view=new Li(e,{value:this.value,viewProps:this.viewProps}),this.ptHandler_=new Tn(this.view.element),this.ptHandler_.emitter.on("down",this.onPointerDown_),this.ptHandler_.emitter.on("move",this.onPointerMove_),this.ptHandler_.emitter.on("up",this.onPointerUp_),this.view.element.addEventListener("keydown",this.onKeyDown_),this.view.element.addEventListener("keyup",this.onKeyUp_)}handlePointerEvent_(e,t){if(!e.point)return;const n=Ln(e.point.x,0,e.bounds.width,0,100),r=Ln(e.point.y,0,e.bounds.height,100,0),[i,,,o]=this.value.rawValue.getComponents("hsv");this.value.setRawValue(new xr([i,n,r,o],"hsv"),t)}onPointerDown_(e){this.handlePointerEvent_(e.data,{forceEmit:!1,last:!1})}onPointerMove_(e){this.handlePointerEvent_(e.data,{forceEmit:!1,last:!1})}onPointerUp_(e){this.handlePointerEvent_(e.data,{forceEmit:!0,last:!0})}onKeyDown_(e){Sn(e.key)&&e.preventDefault();const[t,n,r,i]=this.value.rawValue.getComponents("hsv"),o=Ar(!1),s=En(o,Cn(e)),a=En(o,Pn(e));0===s&&0===a||this.value.setRawValue(new xr([t,n+s,r+a,i],"hsv"),{forceEmit:!1,last:!1})}onKeyUp_(e){const t=Ar(!1),n=En(t,Cn(e)),r=En(t,Pn(e));0===n&&0===r||this.value.setRawValue(this.value.rawValue,{forceEmit:!0,last:!0})}}class Ii{constructor(e,t){this.value=t.value,this.viewProps=t.viewProps,this.hPaletteC_=new Si(e,{value:this.value,viewProps:this.viewProps}),this.svPaletteC_=new Ri(e,{value:this.value,viewProps:this.viewProps}),this.alphaIcs_=t.supportsAlpha?{palette:new bi(e,{value:this.value,viewProps:this.viewProps}),text:new On(e,{parser:un,baseStep:.1,props:R.fromObject({draggingScale:.01,formatter:hn(2)}),value:L(0,{constraint:new mt({min:0,max:1})}),viewProps:this.viewProps})}:null,this.alphaIcs_&&yn({primary:this.value,secondary:this.alphaIcs_.text.value,forward:e=>e.rawValue.getComponents()[3],backward:(e,t)=>{const n=e.rawValue.getComponents();return n[3]=t.rawValue,new xr(n,e.rawValue.mode)}}),this.textC_=new Pi(e,{colorType:t.colorType,parser:un,value:this.value,viewProps:this.viewProps}),this.view=new Er(e,{alphaViews:this.alphaIcs_?{palette:this.alphaIcs_.palette.view,text:this.alphaIcs_.text.view}:null,hPaletteView:this.hPaletteC_.view,supportsAlpha:t.supportsAlpha,svPaletteView:this.svPaletteC_.view,textView:this.textC_.view})}get textController(){return this.textC_}}const Fi=b("colsw");class Mi{constructor(e,t){this.onValueChange_=this.onValueChange_.bind(this),t.value.emitter.on("change",this.onValueChange_),this.value=t.value,this.element=e.createElement("div"),this.element.classList.add(Fi()),t.viewProps.bindClassModifiers(this.element);const n=e.createElement("div");n.classList.add(Fi("sw")),this.element.appendChild(n),this.swatchElem_=n;const r=e.createElement("button");r.classList.add(Fi("b")),t.viewProps.bindDisabled(r),this.element.appendChild(r),this.buttonElement=r,this.update_()}update_(){const e=this.value.rawValue;this.swatchElem_.style.backgroundColor=ni(e)}onValueChange_(){this.update_()}}class Vi{constructor(e,t){this.value=t.value,this.viewProps=t.viewProps,this.view=new Mi(e,{value:this.value,viewProps:this.viewProps})}}class Oi{constructor(e,t){this.onButtonBlur_=this.onButtonBlur_.bind(this),this.onButtonClick_=this.onButtonClick_.bind(this),this.onPopupChildBlur_=this.onPopupChildBlur_.bind(this),this.onPopupChildKeydown_=this.onPopupChildKeydown_.bind(this),this.value=t.value,this.viewProps=t.viewProps,this.foldable_=pe.create(t.expanded),this.swatchC_=new Vi(e,{value:this.value,viewProps:this.viewProps});const n=this.swatchC_.view.buttonElement;n.addEventListener("blur",this.onButtonBlur_),n.addEventListener("click",this.onButtonClick_),this.textC_=new At(e,{parser:t.parser,props:R.fromObject({formatter:t.formatter}),value:this.value,viewProps:this.viewProps}),this.view=new sr(e,{foldable:this.foldable_,pickerLayout:t.pickerLayout}),this.view.swatchElement.appendChild(this.swatchC_.view.element),this.view.textElement.appendChild(this.textC_.view.element),this.popC_="popup"===t.pickerLayout?new Et(e,{viewProps:this.viewProps}):null;const r=new Ii(e,{colorType:t.colorType,supportsAlpha:t.supportsAlpha,value:this.value,viewProps:this.viewProps});r.view.allFocusableElements.forEach((e=>{e.addEventListener("blur",this.onPopupChildBlur_),e.addEventListener("keydown",this.onPopupChildKeydown_)})),this.pickerC_=r,this.popC_?(this.view.element.appendChild(this.popC_.view.element),this.popC_.view.element.appendChild(r.view.element),yn({primary:this.foldable_.value("expanded"),secondary:this.popC_.shows,forward:e=>e.rawValue,backward:(e,t)=>t.rawValue})):this.view.pickerElement&&(this.view.pickerElement.appendChild(this.pickerC_.view.element),fe(this.foldable_,this.view.pickerElement))}get textController(){return this.textC_}onButtonBlur_(e){if(!this.popC_)return;const t=this.view.element,n=l(e.relatedTarget);n&&t.contains(n)||(this.popC_.shows.rawValue=!1)}onButtonClick_(){this.foldable_.set("expanded",!this.foldable_.get("expanded")),this.foldable_.get("expanded")&&this.pickerC_.view.allFocusableElements[0].focus()}onPopupChildBlur_(e){if(!this.popC_)return;const t=this.popC_.view.element,n=re(e);n&&t.contains(n)||n&&n===this.swatchC_.view.buttonElement&&!q(t.ownerDocument)||(this.popC_.shows.rawValue=!1)}onPopupChildKeydown_(e){this.popC_?"Escape"===e.key&&(this.popC_.shows.rawValue=!1):this.view.pickerElement&&"Escape"===e.key&&this.swatchC_.view.buttonElement.focus()}}function Ni(e,t){return xr.isColorObject(e)?xr.fromObject(e,t):xr.black(t)}function Bi(e){return hr(e.getComponents("rgb")).reduce(((e,t)=>e<<8|255&Math.floor(t)),0)}function Di(e){return e.getComponents("rgb").reduce(((e,t,n)=>e<<8|255&Math.floor(3===n?255*t:t)),0)>>>0}function zi(e){return new xr([e>>16&255,e>>8&255,255&e],"rgb")}function Ui(e){return new xr([e>>24&255,e>>16&255,e>>8&255,Ln(255&e,0,255,0,1)],"rgb")}function ji(e){return"number"!=typeof e?xr.black():zi(e)}function Gi(e){return"number"!=typeof e?xr.black():Ui(e)}function Wi(e){const t=fi(e);return t?(e,n)=>{Gn(e,t(n))}:null}function Hi(e){const t=e?Di:Bi;return(e,n)=>{Gn(e,t(n))}}function Ki(e,t,n){const r=t.toRgbaObject(n);e.writeProperty("r",r.r),e.writeProperty("g",r.g),e.writeProperty("b",r.b),e.writeProperty("a",r.a)}function qi(e,t,n){const r=t.toRgbaObject(n);e.writeProperty("r",r.r),e.writeProperty("g",r.g),e.writeProperty("b",r.b)}function Xi(e,t){return(n,r)=>{e?Ki(n,r,t):qi(n,r,t)}}function Yi(e){var t;return!(!(null==e?void 0:e.alpha)&&!(null===(t=null==e?void 0:e.color)||void 0===t?void 0:t.alpha))}function $i(e){return e?e=>ni(e,"0x"):e=>ti(e,"0x")}function Qi(e){return"color"in e||"view"in e&&"color"===e.view}const Zi={id:"input-color-number",type:"input",accept:(e,t)=>{if("number"!=typeof e)return null;if(!Qi(t))return null;const n=Cr(t);return n?{initialValue:e,params:n}:null},binding:{reader:e=>Yi(e.params)?Gi:ji,equals:xr.equals,writer:e=>Hi(Yi(e.params))},controller:e=>{const t=Yi(e.params),n="expanded"in e.params?e.params.expanded:void 0,r="picker"in e.params?e.params.picker:void 0;return new Oi(e.document,{colorType:"int",expanded:null!=n&&n,formatter:$i(t),parser:Jr("int"),pickerLayout:null!=r?r:"popup",supportsAlpha:t,value:e.value,viewProps:e.viewProps})}};function Ji(e){return xr.isRgbaColorObject(e)}function eo(e){return t=>Ni(t,e)}function to(e,t){return n=>e?pi(n,t):ci(n,t)}const no={id:"input-color-object",type:"input",accept:(e,t)=>{if(!xr.isColorObject(e))return null;const n=Cr(t);return n?{initialValue:e,params:n}:null},binding:{reader:e=>eo(Sr(e.params)),equals:xr.equals,writer:e=>Xi(Ji(e.initialValue),Sr(e.params))},controller:e=>{var t;const n=xr.isRgbaColorObject(e.initialValue),r="expanded"in e.params?e.params.expanded:void 0,i="picker"in e.params?e.params.picker:void 0,o=null!==(t=Sr(e.params))&&void 0!==t?t:"int";return new Oi(e.document,{colorType:o,expanded:null!=r&&r,formatter:to(n,o),parser:Jr(o),pickerLayout:null!=i?i:"popup",supportsAlpha:n,value:e.value,viewProps:e.viewProps})}},ro={id:"input-color-string",type:"input",accept:(e,t)=>{if("string"!=typeof e)return null;if("view"in t&&"text"===t.view)return null;const n=$r(e,Sr(t));if(!n)return null;if(!fi(n))return null;const r=Cr(t);return r?{initialValue:e,params:r}:null},binding:{reader:e=>{var t;return Zr(null!==(t=Sr(e.params))&&void 0!==t?t:"int")},equals:xr.equals,writer:e=>{const t=$r(e.initialValue,Sr(e.params));if(!t)throw d.shouldNeverHappen();const n=Wi(t);if(!n)throw d.notBindable();return n}},controller:e=>{const t=$r(e.initialValue,Sr(e.params));if(!t)throw d.shouldNeverHappen();const n=fi(t);if(!n)throw d.shouldNeverHappen();const r="expanded"in e.params?e.params.expanded:void 0,i="picker"in e.params?e.params.picker:void 0;return new Oi(e.document,{colorType:t.type,expanded:null!=r&&r,formatter:n,parser:Jr(t.type),pickerLayout:null!=i?i:"popup",supportsAlpha:t.alpha,value:e.value,viewProps:e.viewProps})}};class io{constructor(e){this.components=e.components,this.asm_=e.assembly}constrain(e){const t=this.asm_.toComponents(e).map(((e,t)=>{var n,r;return null!==(r=null===(n=this.components[t])||void 0===n?void 0:n.constrain(e))&&void 0!==r?r:e}));return this.asm_.fromComponents(t)}}const oo=b("pndtxt");class so{constructor(e,t){this.textViews=t.textViews,this.element=e.createElement("div"),this.element.classList.add(oo()),this.textViews.forEach((t=>{const n=e.createElement("div");n.classList.add(oo("a")),n.appendChild(t.element),this.element.appendChild(n)}))}}function ao(e,t,n){return new On(e,{arrayPosition:0===n?"fst":n===t.axes.length-1?"lst":"mid",baseStep:t.axes[n].baseStep,parser:t.parser,props:t.axes[n].textProps,value:L(0,{constraint:t.axes[n].constraint}),viewProps:t.viewProps})}class lo{constructor(e,t){this.value=t.value,this.viewProps=t.viewProps,this.acs_=t.axes.map(((n,r)=>ao(e,t,r))),this.acs_.forEach(((e,n)=>{yn({primary:this.value,secondary:e.value,forward:e=>t.assembly.toComponents(e.rawValue)[n],backward:(e,r)=>{const i=t.assembly.toComponents(e.rawValue);return i[n]=r.rawValue,t.assembly.fromComponents(i)}})})),this.view=new so(e,{textViews:this.acs_.map((e=>e.view))})}}function co(e,t){return"step"in e&&!c(e.step)?new bt(e.step,t):null}function uo(e){return"max"in e&&!c(e.max)||"min"in e&&!c(e.min)?new mt({max:e.max,min:e.min}):null}function po(e,t){const n=[],r=co(e,t);r&&n.push(r);const i=uo(e);i&&n.push(i);const o=Xn(e.options);return o&&n.push(o),new ht(n)}function ho(e){const t=e?ft(e,mt):null;return t?[t.minValue,t.maxValue]:[void 0,void 0]}function fo(e){const[t,n]=ho(e);return[null!=t?t:0,null!=n?n:100]}const vo={id:"input-number",type:"input",accept:(e,t)=>{if("number"!=typeof e)return null;const n=N,r=B(t,{format:n.optional.function,max:n.optional.number,min:n.optional.number,options:n.optional.custom(Wn),step:n.optional.number});return r?{initialValue:e,params:r}:null},binding:{reader:e=>pn,constraint:e=>po(e.params,e.initialValue),writer:e=>Gn},controller:e=>{var t,n;const r=e.value,i=e.constraint;if(i&&ft(i,vt))return new wt(e.document,{props:R.fromObject({options:null!==(t=Yn(i))&&void 0!==t?t:[]}),value:r,viewProps:e.viewProps});const o=null!==(n="format"in e.params?e.params.format:void 0)&&void 0!==n?n:hn(Qn(i,r.rawValue));if(i&&ft(i,mt)){const[t,n]=fo(i);return new jn(e.document,{baseStep:Zn(i),parser:un,sliderProps:R.fromObject({maxValue:n,minValue:t}),textProps:R.fromObject({draggingScale:Jn(i,r.rawValue),formatter:o}),value:r,viewProps:e.viewProps})}return new On(e.document,{baseStep:Zn(i),parser:un,props:R.fromObject({draggingScale:Jn(i,r.rawValue),formatter:o}),value:r,viewProps:e.viewProps})}};class mo{constructor(e=0,t=0){this.x=e,this.y=t}getComponents(){return[this.x,this.y]}static isObject(e){if(c(e))return!1;const t=e.x,n=e.y;return"number"==typeof t&&"number"==typeof n}static equals(e,t){return e.x===t.x&&e.y===t.y}toObject(){return{x:this.x,y:this.y}}}const bo={toComponents:e=>e.getComponents(),fromComponents:e=>new mo(...e)},go=b("p2d");class _o{constructor(e,t){this.element=e.createElement("div"),this.element.classList.add(go()),t.viewProps.bindClassModifiers(this.element),w(t.expanded,E(this.element,go(void 0,"expanded")));const n=e.createElement("div");n.classList.add(go("h")),this.element.appendChild(n);const r=e.createElement("button");r.classList.add(go("b")),r.appendChild(Z(e,"p2dpad")),t.viewProps.bindDisabled(r),n.appendChild(r),this.buttonElement=r;const i=e.createElement("div");if(i.classList.add(go("t")),n.appendChild(i),this.textElement=i,"inline"===t.pickerLayout){const t=e.createElement("div");t.classList.add(go("p")),this.element.appendChild(t),this.pickerElement=t}else this.pickerElement=null}}const wo=b("p2dp");class xo{constructor(e,t){this.onFoldableChange_=this.onFoldableChange_.bind(this),this.onValueChange_=this.onValueChange_.bind(this),this.invertsY_=t.invertsY,this.maxValue_=t.maxValue,this.element=e.createElement("div"),this.element.classList.add(wo()),"popup"===t.layout&&this.element.classList.add(wo(void 0,"p"));const n=e.createElement("div");n.classList.add(wo("p")),t.viewProps.bindTabIndex(n),this.element.appendChild(n),this.padElement=n;const r=e.createElementNS(W,"svg");r.classList.add(wo("g")),this.padElement.appendChild(r),this.svgElem_=r;const i=e.createElementNS(W,"line");i.classList.add(wo("ax")),i.setAttributeNS(null,"x1","0"),i.setAttributeNS(null,"y1","50%"),i.setAttributeNS(null,"x2","100%"),i.setAttributeNS(null,"y2","50%"),this.svgElem_.appendChild(i);const o=e.createElementNS(W,"line");o.classList.add(wo("ax")),o.setAttributeNS(null,"x1","50%"),o.setAttributeNS(null,"y1","0"),o.setAttributeNS(null,"x2","50%"),o.setAttributeNS(null,"y2","100%"),this.svgElem_.appendChild(o);const s=e.createElementNS(W,"line");s.classList.add(wo("l")),s.setAttributeNS(null,"x1","50%"),s.setAttributeNS(null,"y1","50%"),this.svgElem_.appendChild(s),this.lineElem_=s;const a=e.createElement("div");a.classList.add(wo("m")),this.padElement.appendChild(a),this.markerElem_=a,t.value.emitter.on("change",this.onValueChange_),this.value=t.value,this.update_()}get allFocusableElements(){return[this.padElement]}update_(){const[e,t]=this.value.rawValue.getComponents(),n=this.maxValue_,r=Ln(e,-n,+n,0,100),i=Ln(t,-n,+n,0,100),o=this.invertsY_?100-i:i;this.lineElem_.setAttributeNS(null,"x2",`${r}%`),this.lineElem_.setAttributeNS(null,"y2",`${o}%`),this.markerElem_.style.left=`${r}%`,this.markerElem_.style.top=`${o}%`}onValueChange_(){this.update_()}onFoldableChange_(){this.update_()}}function yo(e,t,n){return[En(t[0],Cn(e)),En(t[1],Pn(e))*(n?1:-1)]}class Eo{constructor(e,t){this.onPadKeyDown_=this.onPadKeyDown_.bind(this),this.onPadKeyUp_=this.onPadKeyUp_.bind(this),this.onPointerDown_=this.onPointerDown_.bind(this),this.onPointerMove_=this.onPointerMove_.bind(this),this.onPointerUp_=this.onPointerUp_.bind(this),this.value=t.value,this.viewProps=t.viewProps,this.baseSteps_=t.baseSteps,this.maxValue_=t.maxValue,this.invertsY_=t.invertsY,this.view=new xo(e,{invertsY:this.invertsY_,layout:t.layout,maxValue:this.maxValue_,value:this.value,viewProps:this.viewProps}),this.ptHandler_=new Tn(this.view.padElement),this.ptHandler_.emitter.on("down",this.onPointerDown_),this.ptHandler_.emitter.on("move",this.onPointerMove_),this.ptHandler_.emitter.on("up",this.onPointerUp_),this.view.padElement.addEventListener("keydown",this.onPadKeyDown_),this.view.padElement.addEventListener("keyup",this.onPadKeyUp_)}handlePointerEvent_(e,t){if(!e.point)return;const n=this.maxValue_,r=Ln(e.point.x,0,e.bounds.width,-n,+n),i=Ln(this.invertsY_?e.bounds.height-e.point.y:e.point.y,0,e.bounds.height,-n,+n);this.value.setRawValue(new mo(r,i),t)}onPointerDown_(e){this.handlePointerEvent_(e.data,{forceEmit:!1,last:!1})}onPointerMove_(e){this.handlePointerEvent_(e.data,{forceEmit:!1,last:!1})}onPointerUp_(e){this.handlePointerEvent_(e.data,{forceEmit:!0,last:!0})}onPadKeyDown_(e){Sn(e.key)&&e.preventDefault();const[t,n]=yo(e,this.baseSteps_,this.invertsY_);0===t&&0===n||this.value.setRawValue(new mo(this.value.rawValue.x+t,this.value.rawValue.y+n),{forceEmit:!1,last:!1})}onPadKeyUp_(e){const[t,n]=yo(e,this.baseSteps_,this.invertsY_);0===t&&0===n||this.value.setRawValue(this.value.rawValue,{forceEmit:!0,last:!0})}}class Po{constructor(e,t){var n,r;this.onPopupChildBlur_=this.onPopupChildBlur_.bind(this),this.onPopupChildKeydown_=this.onPopupChildKeydown_.bind(this),this.onPadButtonBlur_=this.onPadButtonBlur_.bind(this),this.onPadButtonClick_=this.onPadButtonClick_.bind(this),this.value=t.value,this.viewProps=t.viewProps,this.foldable_=pe.create(t.expanded),this.popC_="popup"===t.pickerLayout?new Et(e,{viewProps:this.viewProps}):null;const i=new Eo(e,{baseSteps:[t.axes[0].baseStep,t.axes[1].baseStep],invertsY:t.invertsY,layout:t.pickerLayout,maxValue:t.maxValue,value:this.value,viewProps:this.viewProps});i.view.allFocusableElements.forEach((e=>{e.addEventListener("blur",this.onPopupChildBlur_),e.addEventListener("keydown",this.onPopupChildKeydown_)})),this.pickerC_=i,this.textC_=new lo(e,{assembly:bo,axes:t.axes,parser:t.parser,value:this.value,viewProps:this.viewProps}),this.view=new _o(e,{expanded:this.foldable_.value("expanded"),pickerLayout:t.pickerLayout,viewProps:this.viewProps}),this.view.textElement.appendChild(this.textC_.view.element),null===(n=this.view.buttonElement)||void 0===n||n.addEventListener("blur",this.onPadButtonBlur_),null===(r=this.view.buttonElement)||void 0===r||r.addEventListener("click",this.onPadButtonClick_),this.popC_?(this.view.element.appendChild(this.popC_.view.element),this.popC_.view.element.appendChild(this.pickerC_.view.element),yn({primary:this.foldable_.value("expanded"),secondary:this.popC_.shows,forward:e=>e.rawValue,backward:(e,t)=>t.rawValue})):this.view.pickerElement&&(this.view.pickerElement.appendChild(this.pickerC_.view.element),fe(this.foldable_,this.view.pickerElement))}onPadButtonBlur_(e){if(!this.popC_)return;const t=this.view.element,n=l(e.relatedTarget);n&&t.contains(n)||(this.popC_.shows.rawValue=!1)}onPadButtonClick_(){this.foldable_.set("expanded",!this.foldable_.get("expanded")),this.foldable_.get("expanded")&&this.pickerC_.view.allFocusableElements[0].focus()}onPopupChildBlur_(e){if(!this.popC_)return;const t=this.popC_.view.element,n=re(e);n&&t.contains(n)||n&&n===this.view.buttonElement&&!q(t.ownerDocument)||(this.popC_.shows.rawValue=!1)}onPopupChildKeydown_(e){this.popC_?"Escape"===e.key&&(this.popC_.shows.rawValue=!1):this.view.pickerElement&&"Escape"===e.key&&this.view.buttonElement.focus()}}function Co(e){return mo.isObject(e)?new mo(e.x,e.y):new mo}function Ao(e,t){e.writeProperty("x",t.x),e.writeProperty("y",t.y)}function So(e,t){if(!e)return;const n=[],r=co(e,t);r&&n.push(r);const i=uo(e);return i&&n.push(i),new ht(n)}function ko(e,t){return new io({assembly:bo,components:[So("x"in e?e.x:void 0,t.x),So("y"in e?e.y:void 0,t.y)]})}function To(e,t){var n,r;const i=e&&ft(e,mt);if(i)return Math.max(Math.abs(null!==(n=i.minValue)&&void 0!==n?n:0),Math.abs(null!==(r=i.maxValue)&&void 0!==r?r:0));const o=Zn(e);return Math.max(10*Math.abs(o),10*Math.abs(t))}function Lo(e,t){const n=t instanceof io?t.components[0]:void 0,r=t instanceof io?t.components[1]:void 0,i=To(n,e.x),o=To(r,e.y);return Math.max(i,o)}function Ro(e,t){return{baseStep:Zn(t),constraint:t,textProps:R.fromObject({draggingScale:Jn(t,e),formatter:hn(Qn(t,e))})}}function Io(e){if(!("y"in e))return!1;const t=e.y;return!!t&&"inverted"in t&&!!t.inverted}const Fo={id:"input-point2d",type:"input",accept:(e,t)=>{if(!mo.isObject(e))return null;const n=N,r=B(t,{expanded:n.optional.boolean,picker:n.optional.custom(Hn),x:n.optional.custom(Kn),y:n.optional.object({inverted:n.optional.boolean,max:n.optional.number,min:n.optional.number,step:n.optional.number})});return r?{initialValue:e,params:r}:null},binding:{reader:e=>Co,constraint:e=>ko(e.params,e.initialValue),equals:mo.equals,writer:e=>Ao},controller:e=>{const t=e.document,n=e.value,r=e.constraint;if(!(r instanceof io))throw d.shouldNeverHappen();const i="expanded"in e.params?e.params.expanded:void 0,o="picker"in e.params?e.params.picker:void 0;return new Po(t,{axes:[Ro(n.rawValue.x,r.components[0]),Ro(n.rawValue.y,r.components[1])],expanded:null!=i&&i,invertsY:Io(e.params),maxValue:Lo(n.rawValue,r),parser:un,pickerLayout:null!=o?o:"popup",value:n,viewProps:e.viewProps})}};class Mo{constructor(e=0,t=0,n=0){this.x=e,this.y=t,this.z=n}getComponents(){return[this.x,this.y,this.z]}static isObject(e){if(c(e))return!1;const t=e.x,n=e.y,r=e.z;return"number"==typeof t&&"number"==typeof n&&"number"==typeof r}static equals(e,t){return e.x===t.x&&e.y===t.y&&e.z===t.z}toObject(){return{x:this.x,y:this.y,z:this.z}}}const Vo={toComponents:e=>e.getComponents(),fromComponents:e=>new Mo(...e)};function Oo(e){return Mo.isObject(e)?new Mo(e.x,e.y,e.z):new Mo}function No(e,t){e.writeProperty("x",t.x),e.writeProperty("y",t.y),e.writeProperty("z",t.z)}function Bo(e,t){return new io({assembly:Vo,components:[So("x"in e?e.x:void 0,t.x),So("y"in e?e.y:void 0,t.y),So("z"in e?e.z:void 0,t.z)]})}function Do(e,t){return{baseStep:Zn(t),constraint:t,textProps:R.fromObject({draggingScale:Jn(t,e),formatter:hn(Qn(t,e))})}}const zo={id:"input-point3d",type:"input",accept:(e,t)=>{if(!Mo.isObject(e))return null;const n=N,r=B(t,{x:n.optional.custom(Kn),y:n.optional.custom(Kn),z:n.optional.custom(Kn)});return r?{initialValue:e,params:r}:null},binding:{reader:e=>Oo,constraint:e=>Bo(e.params,e.initialValue),equals:Mo.equals,writer:e=>No},controller:e=>{const t=e.value,n=e.constraint;if(!(n instanceof io))throw d.shouldNeverHappen();return new lo(e.document,{assembly:Vo,axes:[Do(t.rawValue.x,n.components[0]),Do(t.rawValue.y,n.components[1]),Do(t.rawValue.z,n.components[2])],parser:un,value:t,viewProps:e.viewProps})}};class Uo{constructor(e=0,t=0,n=0,r=0){this.x=e,this.y=t,this.z=n,this.w=r}getComponents(){return[this.x,this.y,this.z,this.w]}static isObject(e){if(c(e))return!1;const t=e.x,n=e.y,r=e.z,i=e.w;return"number"==typeof t&&"number"==typeof n&&"number"==typeof r&&"number"==typeof i}static equals(e,t){return e.x===t.x&&e.y===t.y&&e.z===t.z&&e.w===t.w}toObject(){return{x:this.x,y:this.y,z:this.z,w:this.w}}}const jo={toComponents:e=>e.getComponents(),fromComponents:e=>new Uo(...e)};function Go(e){return Uo.isObject(e)?new Uo(e.x,e.y,e.z,e.w):new Uo}function Wo(e,t){e.writeProperty("x",t.x),e.writeProperty("y",t.y),e.writeProperty("z",t.z),e.writeProperty("w",t.w)}function Ho(e,t){return new io({assembly:jo,components:[So("x"in e?e.x:void 0,t.x),So("y"in e?e.y:void 0,t.y),So("z"in e?e.z:void 0,t.z),So("w"in e?e.w:void 0,t.w)]})}function Ko(e,t){return{baseStep:Zn(t),constraint:t,textProps:R.fromObject({draggingScale:Jn(t,e),formatter:hn(Qn(t,e))})}}const qo={id:"input-point4d",type:"input",accept:(e,t)=>{if(!Uo.isObject(e))return null;const n=N,r=B(t,{x:n.optional.custom(Kn),y:n.optional.custom(Kn),z:n.optional.custom(Kn),w:n.optional.custom(Kn)});return r?{initialValue:e,params:r}:null},binding:{reader:e=>Go,constraint:e=>Ho(e.params,e.initialValue),equals:Uo.equals,writer:e=>Wo},controller:e=>{const t=e.value,n=e.constraint;if(!(n instanceof io))throw d.shouldNeverHappen();return new lo(e.document,{assembly:jo,axes:t.rawValue.getComponents().map(((e,t)=>Ko(e,n.components[t]))),parser:un,value:t,viewProps:e.viewProps})}};function Xo(e){const t=[],n=Xn(e.options);return n&&t.push(n),new ht(t)}const Yo={id:"input-string",type:"input",accept:(e,t)=>{if("string"!=typeof e)return null;const n=B(t,{options:N.optional.custom(Wn)});return n?{initialValue:e,params:n}:null},binding:{reader:e=>mn,constraint:e=>Xo(e.params),writer:e=>Gn},controller:e=>{var t;const n=e.document,r=e.value,i=e.constraint;return i&&ft(i,vt)?new wt(n,{props:R.fromObject({options:null!==(t=Yn(i))&&void 0!==t?t:[]}),value:r,viewProps:e.viewProps}):new At(n,{parser:e=>e,props:R.fromObject({formatter:bn}),value:r,viewProps:e.viewProps})}},$o={monitor:{defaultInterval:200,defaultLineCount:3}},Qo=b("mll");class Zo{constructor(e,t){this.onValueUpdate_=this.onValueUpdate_.bind(this),this.formatter_=t.formatter,this.element=e.createElement("div"),this.element.classList.add(Qo()),t.viewProps.bindClassModifiers(this.element);const n=e.createElement("textarea");n.classList.add(Qo("i")),n.style.height=`calc(var(--bld-us) * ${t.lineCount})`,n.readOnly=!0,t.viewProps.bindDisabled(n),this.element.appendChild(n),this.textareaElem_=n,t.value.emitter.on("change",this.onValueUpdate_),this.value=t.value,this.update_()}update_(){const e=this.textareaElem_,t=e.scrollTop===e.scrollHeight-e.clientHeight,n=[];this.value.rawValue.forEach((e=>{void 0!==e&&n.push(this.formatter_(e))})),e.textContent=n.join("\n"),t&&(e.scrollTop=e.scrollHeight)}onValueUpdate_(){this.update_()}}class Jo{constructor(e,t){this.value=t.value,this.viewProps=t.viewProps,this.view=new Zo(e,{formatter:t.formatter,lineCount:t.lineCount,value:this.value,viewProps:this.viewProps})}}const es=b("sgl");class ts{constructor(e,t){this.onValueUpdate_=this.onValueUpdate_.bind(this),this.formatter_=t.formatter,this.element=e.createElement("div"),this.element.classList.add(es()),t.viewProps.bindClassModifiers(this.element);const n=e.createElement("input");n.classList.add(es("i")),n.readOnly=!0,n.type="text",t.viewProps.bindDisabled(n),this.element.appendChild(n),this.inputElement=n,t.value.emitter.on("change",this.onValueUpdate_),this.value=t.value,this.update_()}update_(){const e=this.value.rawValue,t=e[e.length-1];this.inputElement.value=void 0!==t?this.formatter_(t):""}onValueUpdate_(){this.update_()}}class ns{constructor(e,t){this.value=t.value,this.viewProps=t.viewProps,this.view=new ts(e,{formatter:t.formatter,value:this.value,viewProps:this.viewProps})}}const rs={id:"monitor-bool",type:"monitor",accept:(e,t)=>{if("boolean"!=typeof e)return null;const n=B(t,{lineCount:N.optional.number});return n?{initialValue:e,params:n}:null},binding:{reader:e=>kt},controller:e=>{var t;return 1===e.value.rawValue.length?new ns(e.document,{formatter:Tt,value:e.value,viewProps:e.viewProps}):new Jo(e.document,{formatter:Tt,lineCount:null!==(t=e.params.lineCount)&&void 0!==t?t:$o.monitor.defaultLineCount,value:e.value,viewProps:e.viewProps})}},is=b("grl");class os{constructor(e,t){this.onCursorChange_=this.onCursorChange_.bind(this),this.onValueUpdate_=this.onValueUpdate_.bind(this),this.element=e.createElement("div"),this.element.classList.add(is()),t.viewProps.bindClassModifiers(this.element),this.formatter_=t.formatter,this.props_=t.props,this.cursor_=t.cursor,this.cursor_.emitter.on("change",this.onCursorChange_);const n=e.createElementNS(W,"svg");n.classList.add(is("g")),n.style.height=`calc(var(--bld-us) * ${t.lineCount})`,this.element.appendChild(n),this.svgElem_=n;const r=e.createElementNS(W,"polyline");this.svgElem_.appendChild(r),this.lineElem_=r;const i=e.createElement("div");i.classList.add(is("t"),b("tt")()),this.element.appendChild(i),this.tooltipElem_=i,t.value.emitter.on("change",this.onValueUpdate_),this.value=t.value,this.update_()}get graphElement(){return this.svgElem_}update_(){const e=this.svgElem_.getBoundingClientRect(),t=this.value.rawValue.length-1,n=this.props_.get("minValue"),r=this.props_.get("maxValue"),i=[];this.value.rawValue.forEach(((o,s)=>{if(void 0===o)return;const a=Ln(s,0,t,0,e.width),l=Ln(o,n,r,e.height,0);i.push([a,l].join(","))})),this.lineElem_.setAttributeNS(null,"points",i.join(" "));const o=this.tooltipElem_,s=this.value.rawValue[this.cursor_.rawValue];if(void 0===s)return void o.classList.remove(is("t","a"));const a=Ln(this.cursor_.rawValue,0,t,0,e.width),l=Ln(s,n,r,e.height,0);o.style.left=`${a}px`,o.style.top=`${l}px`,o.textContent=`${this.formatter_(s)}`,o.classList.contains(is("t","a"))||(o.classList.add(is("t","a"),is("t","in")),H(o),o.classList.remove(is("t","in")))}onValueUpdate_(){this.update_()}onCursorChange_(){this.update_()}}class ss{constructor(e,t){if(this.onGraphMouseMove_=this.onGraphMouseMove_.bind(this),this.onGraphMouseLeave_=this.onGraphMouseLeave_.bind(this),this.onGraphPointerDown_=this.onGraphPointerDown_.bind(this),this.onGraphPointerMove_=this.onGraphPointerMove_.bind(this),this.onGraphPointerUp_=this.onGraphPointerUp_.bind(this),this.props_=t.props,this.value=t.value,this.viewProps=t.viewProps,this.cursor_=L(-1),this.view=new os(e,{cursor:this.cursor_,formatter:t.formatter,lineCount:t.lineCount,props:this.props_,value:this.value,viewProps:this.viewProps}),q(e)){const e=new Tn(this.view.element);e.emitter.on("down",this.onGraphPointerDown_),e.emitter.on("move",this.onGraphPointerMove_),e.emitter.on("up",this.onGraphPointerUp_)}else this.view.element.addEventListener("mousemove",this.onGraphMouseMove_),this.view.element.addEventListener("mouseleave",this.onGraphMouseLeave_)}onGraphMouseLeave_(){this.cursor_.rawValue=-1}onGraphMouseMove_(e){const t=this.view.element.getBoundingClientRect();this.cursor_.rawValue=Math.floor(Ln(e.offsetX,0,t.width,0,this.value.rawValue.length))}onGraphPointerDown_(e){this.onGraphPointerMove_(e)}onGraphPointerMove_(e){e.data.point?this.cursor_.rawValue=Math.floor(Ln(e.data.point.x,0,e.data.bounds.width,0,this.value.rawValue.length)):this.cursor_.rawValue=-1}onGraphPointerUp_(){this.cursor_.rawValue=-1}}function as(e){return"format"in e&&!c(e.format)?e.format:hn(2)}function ls(e){var t;return 1===e.value.rawValue.length?new ns(e.document,{formatter:as(e.params),value:e.value,viewProps:e.viewProps}):new Jo(e.document,{formatter:as(e.params),lineCount:null!==(t=e.params.lineCount)&&void 0!==t?t:$o.monitor.defaultLineCount,value:e.value,viewProps:e.viewProps})}function cs(e){var t,n,r;return new ss(e.document,{formatter:as(e.params),lineCount:null!==(t=e.params.lineCount)&&void 0!==t?t:$o.monitor.defaultLineCount,props:R.fromObject({maxValue:null!==(n="max"in e.params?e.params.max:null)&&void 0!==n?n:100,minValue:null!==(r="min"in e.params?e.params.min:null)&&void 0!==r?r:0}),value:e.value,viewProps:e.viewProps})}function us(e){return"view"in e&&"graph"===e.view}const ps={id:"monitor-number",type:"monitor",accept:(e,t)=>{if("number"!=typeof e)return null;const n=N,r=B(t,{format:n.optional.function,lineCount:n.optional.number,max:n.optional.number,min:n.optional.number,view:n.optional.string});return r?{initialValue:e,params:r}:null},binding:{defaultBufferSize:e=>us(e)?64:1,reader:e=>pn},controller:e=>us(e.params)?cs(e):ls(e)},ds={id:"monitor-string",type:"monitor",accept:(e,t)=>{if("string"!=typeof e)return null;const n=N,r=B(t,{lineCount:n.optional.number,multiline:n.optional.boolean});return r?{initialValue:e,params:r}:null},binding:{reader:e=>mn},controller:e=>{var t;const n=e.value;return n.rawValue.length>1||"multiline"in e.params&&e.params.multiline?new Jo(e.document,{formatter:bn,lineCount:null!==(t=e.params.lineCount)&&void 0!==t?t:$o.monitor.defaultLineCount,value:n,viewProps:e.viewProps}):new ns(e.document,{formatter:bn,value:n,viewProps:e.viewProps})}};class hs{constructor(e){this.onValueChange_=this.onValueChange_.bind(this),this.reader=e.reader,this.writer=e.writer,this.emitter=new v,this.value=e.value,this.value.emitter.on("change",this.onValueChange_),this.target=e.target,this.read()}read(){const e=this.target.read();void 0!==e&&(this.value.rawValue=this.reader(e))}write_(e){this.writer(this.target,e)}onValueChange_(e){this.write_(e.rawValue),this.emitter.emit("change",{options:e.options,rawValue:e.rawValue,sender:this})}}function fs(e,t){const n=e.accept(t.target.read(),t.params);if(c(n))return null;const r=N,i={target:t.target,initialValue:n.initialValue,params:n.params},o=e.binding.reader(i),s=e.binding.constraint?e.binding.constraint(i):void 0,a=L(o(n.initialValue),{constraint:s,equals:e.binding.equals}),l=new hs({reader:o,target:t.target,value:a,writer:e.binding.writer(i)}),u=r.optional.boolean(t.params.disabled).value,p=r.optional.boolean(t.params.hidden).value,d=e.controller({constraint:s,document:t.document,initialValue:n.initialValue,params:n.params,value:l.value,viewProps:Qe.create({disabled:u,hidden:p})}),h=r.optional.string(t.params.label).value;return new ye(t.document,{binding:l,blade:ue(),props:R.fromObject({label:null!=h?h:t.target.key}),valueController:d})}class vs{constructor(e){this.onTick_=this.onTick_.bind(this),this.reader_=e.reader,this.target=e.target,this.emitter=new v,this.value=e.value,this.ticker=e.ticker,this.ticker.emitter.on("tick",this.onTick_),this.read()}dispose(){this.ticker.dispose()}read(){const e=this.target.read();if(void 0===e)return;const t=this.value.rawValue,n=this.reader_(e);this.value.rawValue=xn(t,n),this.emitter.emit("update",{rawValue:n,sender:this})}onTick_(e){this.read()}}function ms(e,t){return 0===t?new pt:new dt(e,null!=t?t:$o.monitor.defaultInterval)}function bs(e,t){var n,r,i;const o=N,s=e.accept(t.target.read(),t.params);if(c(s))return null;const a={target:t.target,initialValue:s.initialValue,params:s.params},l=e.binding.reader(a),u=null!==(r=null!==(n=o.optional.number(t.params.bufferSize).value)&&void 0!==n?n:e.binding.defaultBufferSize&&e.binding.defaultBufferSize(s.params))&&void 0!==r?r:1,p=o.optional.number(t.params.interval).value,d=new vs({reader:l,target:t.target,ticker:ms(t.document,p),value:_n(u)}),h=o.optional.boolean(t.params.disabled).value,f=o.optional.boolean(t.params.hidden).value,v=e.controller({document:t.document,params:s.params,value:d.value,viewProps:Qe.create({disabled:h,hidden:f})}),m=null!==(i=o.optional.string(t.params.label).value)&&void 0!==i?i:t.target.key;return new Pe(t.document,{binding:d,blade:ue(),props:R.fromObject({label:m}),valueController:v})}class gs{constructor(){this.pluginsMap_={blades:[],inputs:[],monitors:[]}}getAll(){return[...this.pluginsMap_.blades,...this.pluginsMap_.inputs,...this.pluginsMap_.monitors]}register(e){"blade"===e.type?this.pluginsMap_.blades.unshift(e):"input"===e.type?this.pluginsMap_.inputs.unshift(e):"monitor"===e.type&&this.pluginsMap_.monitors.unshift(e)}createInput(e,t,n){if(c(t.read()))throw new d({context:{key:t.key},type:"nomatchingcontroller"});const r=this.pluginsMap_.inputs.reduce(((r,i)=>null!=r?r:fs(i,{document:e,target:t,params:n})),null);if(r)return r;throw new d({context:{key:t.key},type:"nomatchingcontroller"})}createMonitor(e,t,n){const r=this.pluginsMap_.monitors.reduce(((r,i)=>null!=r?r:bs(i,{document:e,params:n,target:t})),null);if(r)return r;throw new d({context:{key:t.key},type:"nomatchingcontroller"})}createBlade(e,t){const n=this.pluginsMap_.blades.reduce(((n,r)=>null!=n?n:ut(r,{document:e,params:t})),null);if(!n)throw new d({type:"nomatchingview",context:{params:t}});return n}createBladeApi(e){if(e instanceof ye)return new xe(e);if(e instanceof Pe)return new Ee(e);if(e instanceof Be)return new ke(e,this);const t=this.pluginsMap_.blades.reduce(((t,n)=>null!=t?t:n.api({controller:e,pool:this})),null);if(!t)throw d.shouldNeverHappen();return t}}function _s(){const e=new gs;return[Fo,zo,qo,Yo,vo,ro,no,Zi,ir,rs,ds,ps,le,je,Xe,ct].forEach((t=>{e.register(t)})),e}class ws extends n{constructor(e){super(e),this.emitter_=new v,this.controller_.valueController.value.emitter.on("change",(e=>{this.emitter_.emit("change",{event:new i(this,e.rawValue)})}))}get label(){return this.controller_.props.get("label")}set label(e){this.controller_.props.set("label",e)}get options(){return this.controller_.valueController.props.get("options")}set options(e){this.controller_.valueController.props.set("options",e)}get value(){return this.controller_.valueController.value.rawValue}set value(e){this.controller_.valueController.value.rawValue=e}on(e,t){const n=t.bind(this);return this.emitter_.on(e,(e=>{n(e.event)})),this}}class xs extends n{constructor(e){super(e),this.emitter_=new v,this.controller_.valueController.value.emitter.on("change",(e=>{this.emitter_.emit("change",{event:new i(this,e.rawValue)})}))}get label(){return this.controller_.props.get("label")}set label(e){this.controller_.props.set("label",e)}get maxValue(){return this.controller_.valueController.sliderController.props.get("maxValue")}set maxValue(e){this.controller_.valueController.sliderController.props.set("maxValue",e)}get minValue(){return this.controller_.valueController.sliderController.props.get("minValue")}set minValue(e){this.controller_.valueController.sliderController.props.set("minValue",e)}get value(){return this.controller_.valueController.value.rawValue}set value(e){this.controller_.valueController.value.rawValue=e}on(e,t){const n=t.bind(this);return this.emitter_.on(e,(e=>{n(e.event)})),this}}class ys extends n{constructor(e){super(e),this.emitter_=new v,this.controller_.valueController.value.emitter.on("change",(e=>{this.emitter_.emit("change",{event:new i(this,e.rawValue)})}))}get label(){return this.controller_.props.get("label")}set label(e){this.controller_.props.set("label",e)}get formatter(){return this.controller_.valueController.props.get("formatter")}set formatter(e){this.controller_.valueController.props.set("formatter",e)}get value(){return this.controller_.valueController.value.rawValue}set value(e){this.controller_.valueController.value.rawValue=e}on(e,t){const n=t.bind(this);return this.emitter_.on(e,(e=>{n(e.event)})),this}}const Es={id:"list",type:"blade",accept(e){const t=N,n=B(e,{options:t.required.custom(Wn),value:t.required.raw,view:t.required.constant("list"),label:t.optional.string});return n?{params:n}:null},controller(e){const t=new wt(e.document,{props:R.fromObject({options:qn(e.params.options)}),value:L(e.params.value),viewProps:e.viewProps});return new Ge(e.document,{blade:e.blade,props:R.fromObject({label:e.params.label}),valueController:t})},api:e=>e.controller instanceof Ge&&e.controller.valueController instanceof wt?new ws(e.controller):null};function Ps(e){return e.reduce(((e,t)=>Object.assign(e,{[t.presetKey]:t.read()})),{})}function Cs(e,t){e.forEach((e=>{const n=t[e.presetKey];void 0!==n&&e.write(n)}))}class As extends Te{constructor(e,t){super(e,t)}get element(){return this.controller_.view.element}importPreset(e){Cs(this.controller_.rackController.rack.find(ye).map((e=>e.binding.target)),e),this.refresh()}exportPreset(){return Ps(this.controller_.rackController.rack.find(ye).map((e=>e.binding.target)))}refresh(){this.controller_.rackController.rack.find(ye).forEach((e=>{e.binding.read()})),this.controller_.rackController.rack.find(Pe).forEach((e=>{e.binding.read()}))}}class Ss extends Ue{constructor(e,t){super(e,{expanded:t.expanded,blade:t.blade,props:t.props,root:!0,viewProps:t.viewProps})}}const ks={id:"slider",type:"blade",accept(e){const t=N,n=B(e,{max:t.required.number,min:t.required.number,view:t.required.constant("slider"),format:t.optional.function,label:t.optional.string,value:t.optional.number});return n?{params:n}:null},controller(e){var t,n;const r=null!==(t=e.params.value)&&void 0!==t?t:0,i=new jn(e.document,{baseStep:1,parser:un,sliderProps:R.fromObject({maxValue:e.params.max,minValue:e.params.min}),textProps:R.fromObject({draggingScale:Jn(void 0,r),formatter:null!==(n=e.params.format)&&void 0!==n?n:dn}),value:L(r),viewProps:e.viewProps});return new Ge(e.document,{blade:e.blade,props:R.fromObject({label:e.params.label}),valueController:i})},api:e=>e.controller instanceof Ge&&e.controller.valueController instanceof jn?new xs(e.controller):null},Ts={id:"text",type:"blade",accept(e){const t=N,n=B(e,{parse:t.required.function,value:t.required.raw,view:t.required.constant("text"),format:t.optional.function,label:t.optional.string});return n?{params:n}:null},controller(e){var t;const n=new At(e.document,{parser:e.params.parse,props:R.fromObject({formatter:null!==(t=e.params.format)&&void 0!==t?t:e=>String(e)}),value:L(e.params.value),viewProps:e.viewProps});return new Ge(e.document,{blade:e.blade,props:R.fromObject({label:e.params.label}),valueController:n})},api:e=>e.controller instanceof Ge&&e.controller.valueController instanceof At?new ys(e.controller):null};function Ls(e){const t=e.createElement("div");return t.classList.add(b("dfw")()),e.body&&e.body.appendChild(t),t}function Rs(e,t,n){if(e.querySelector(`style[data-tp-style=${t}]`))return;const r=e.createElement("style");r.dataset.tpStyle=t,r.textContent=n,e.head.appendChild(r)}class Is extends As{constructor(e){var t,n;const r=null!=e?e:{},i=null!==(t=r.document)&&void 0!==t?t:Y(),o=_s();super(new Ss(i,{expanded:r.expanded,blade:ue(),props:R.fromObject({title:r.title}),viewProps:Qe.create()}),o),this.pool_=o,this.containerElem_=null!==(n=r.container)&&void 0!==n?n:Ls(i),this.containerElem_.appendChild(this.element),this.doc_=i,this.usesDefaultWrapper_=!r.container,this.setUpDefaultPlugins_()}get document(){if(!this.doc_)throw d.alreadyDisposed();return this.doc_}dispose(){const e=this.containerElem_;if(!e)throw d.alreadyDisposed();if(this.usesDefaultWrapper_){const t=e.parentElement;t&&t.removeChild(e)}this.containerElem_=null,this.doc_=null,super.dispose()}registerPlugin(e){("plugin"in e?[e.plugin]:"plugins"in e?e.plugins:[]).forEach((e=>{this.pool_.register(e),this.embedPluginStyle_(e)}))}embedPluginStyle_(e){e.css&&Rs(this.document,`plugin-${e.id}`,e.css)}setUpDefaultPlugins_(){Rs(this.document,"default",'.tp-tbiv_b,.tp-coltxtv_ms,.tp-ckbv_i,.tp-rotv_b,.tp-fldv_b,.tp-mllv_i,.tp-sglv_i,.tp-grlv_g,.tp-txtv_i,.tp-p2dpv_p,.tp-colswv_sw,.tp-p2dv_b,.tp-btnv_b,.tp-lstv_s{-webkit-appearance:none;-moz-appearance:none;appearance:none;background-color:rgba(0,0,0,0);border-width:0;font-family:inherit;font-size:inherit;font-weight:inherit;margin:0;outline:none;padding:0}.tp-p2dv_b,.tp-btnv_b,.tp-lstv_s{background-color:var(--btn-bg);border-radius:var(--elm-br);color:var(--btn-fg);cursor:pointer;display:block;font-weight:bold;height:var(--bld-us);line-height:var(--bld-us);overflow:hidden;text-overflow:ellipsis;white-space:nowrap}.tp-p2dv_b:hover,.tp-btnv_b:hover,.tp-lstv_s:hover{background-color:var(--btn-bg-h)}.tp-p2dv_b:focus,.tp-btnv_b:focus,.tp-lstv_s:focus{background-color:var(--btn-bg-f)}.tp-p2dv_b:active,.tp-btnv_b:active,.tp-lstv_s:active{background-color:var(--btn-bg-a)}.tp-p2dv_b:disabled,.tp-btnv_b:disabled,.tp-lstv_s:disabled{opacity:.5}.tp-txtv_i,.tp-p2dpv_p,.tp-colswv_sw{background-color:var(--in-bg);border-radius:var(--elm-br);box-sizing:border-box;color:var(--in-fg);font-family:inherit;height:var(--bld-us);line-height:var(--bld-us);min-width:0;width:100%}.tp-txtv_i:hover,.tp-p2dpv_p:hover,.tp-colswv_sw:hover{background-color:var(--in-bg-h)}.tp-txtv_i:focus,.tp-p2dpv_p:focus,.tp-colswv_sw:focus{background-color:var(--in-bg-f)}.tp-txtv_i:active,.tp-p2dpv_p:active,.tp-colswv_sw:active{background-color:var(--in-bg-a)}.tp-txtv_i:disabled,.tp-p2dpv_p:disabled,.tp-colswv_sw:disabled{opacity:.5}.tp-mllv_i,.tp-sglv_i,.tp-grlv_g{background-color:var(--mo-bg);border-radius:var(--elm-br);box-sizing:border-box;color:var(--mo-fg);height:var(--bld-us);scrollbar-color:currentColor rgba(0,0,0,0);scrollbar-width:thin;width:100%}.tp-mllv_i::-webkit-scrollbar,.tp-sglv_i::-webkit-scrollbar,.tp-grlv_g::-webkit-scrollbar{height:8px;width:8px}.tp-mllv_i::-webkit-scrollbar-corner,.tp-sglv_i::-webkit-scrollbar-corner,.tp-grlv_g::-webkit-scrollbar-corner{background-color:rgba(0,0,0,0)}.tp-mllv_i::-webkit-scrollbar-thumb,.tp-sglv_i::-webkit-scrollbar-thumb,.tp-grlv_g::-webkit-scrollbar-thumb{background-clip:padding-box;background-color:currentColor;border:rgba(0,0,0,0) solid 2px;border-radius:4px}.tp-rotv{--font-family: var(--tp-font-family, Roboto Mono, Source Code Pro, Menlo, Courier, monospace);--bs-br: var(--tp-base-border-radius, 6px);--cnt-h-p: var(--tp-container-horizontal-padding, 4px);--cnt-v-p: var(--tp-container-vertical-padding, 4px);--elm-br: var(--tp-element-border-radius, 2px);--bld-s: var(--tp-blade-spacing, 4px);--bld-us: var(--tp-blade-unit-size, 20px);--bs-bg: var(--tp-base-background-color, hsl(230deg, 7%, 17%));--bs-sh: var(--tp-base-shadow-color, rgba(0, 0, 0, 0.2));--btn-bg: var(--tp-button-background-color, hsl(230deg, 7%, 70%));--btn-bg-a: var(--tp-button-background-color-active, #d6d7db);--btn-bg-f: var(--tp-button-background-color-focus, #c8cad0);--btn-bg-h: var(--tp-button-background-color-hover, #bbbcc4);--btn-fg: var(--tp-button-foreground-color, hsl(230deg, 7%, 17%));--cnt-bg: var(--tp-container-background-color, rgba(187, 188, 196, 0.1));--cnt-bg-a: var(--tp-container-background-color-active, rgba(187, 188, 196, 0.25));--cnt-bg-f: var(--tp-container-background-color-focus, rgba(187, 188, 196, 0.2));--cnt-bg-h: var(--tp-container-background-color-hover, rgba(187, 188, 196, 0.15));--cnt-fg: var(--tp-container-foreground-color, hsl(230deg, 7%, 75%));--in-bg: var(--tp-input-background-color, rgba(187, 188, 196, 0.1));--in-bg-a: var(--tp-input-background-color-active, rgba(187, 188, 196, 0.25));--in-bg-f: var(--tp-input-background-color-focus, rgba(187, 188, 196, 0.2));--in-bg-h: var(--tp-input-background-color-hover, rgba(187, 188, 196, 0.15));--in-fg: var(--tp-input-foreground-color, hsl(230deg, 7%, 75%));--lbl-fg: var(--tp-label-foreground-color, rgba(187, 188, 196, 0.7));--mo-bg: var(--tp-monitor-background-color, rgba(0, 0, 0, 0.2));--mo-fg: var(--tp-monitor-foreground-color, rgba(187, 188, 196, 0.7));--grv-fg: var(--tp-groove-foreground-color, rgba(187, 188, 196, 0.1))}.tp-rotv_c>.tp-cntv.tp-v-lst,.tp-tabv_c .tp-brkv>.tp-cntv.tp-v-lst,.tp-fldv_c>.tp-cntv.tp-v-lst{margin-bottom:calc(-1*var(--cnt-v-p))}.tp-rotv_c>.tp-fldv.tp-v-lst .tp-fldv_c,.tp-tabv_c .tp-brkv>.tp-fldv.tp-v-lst .tp-fldv_c,.tp-fldv_c>.tp-fldv.tp-v-lst .tp-fldv_c{border-bottom-left-radius:0}.tp-rotv_c>.tp-fldv.tp-v-lst .tp-fldv_b,.tp-tabv_c .tp-brkv>.tp-fldv.tp-v-lst .tp-fldv_b,.tp-fldv_c>.tp-fldv.tp-v-lst .tp-fldv_b{border-bottom-left-radius:0}.tp-rotv_c>*:not(.tp-v-fst),.tp-tabv_c .tp-brkv>*:not(.tp-v-fst),.tp-fldv_c>*:not(.tp-v-fst){margin-top:var(--bld-s)}.tp-rotv_c>.tp-sprv:not(.tp-v-fst),.tp-tabv_c .tp-brkv>.tp-sprv:not(.tp-v-fst),.tp-fldv_c>.tp-sprv:not(.tp-v-fst),.tp-rotv_c>.tp-cntv:not(.tp-v-fst),.tp-tabv_c .tp-brkv>.tp-cntv:not(.tp-v-fst),.tp-fldv_c>.tp-cntv:not(.tp-v-fst){margin-top:var(--cnt-v-p)}.tp-rotv_c>.tp-sprv+*:not(.tp-v-hidden),.tp-tabv_c .tp-brkv>.tp-sprv+*:not(.tp-v-hidden),.tp-fldv_c>.tp-sprv+*:not(.tp-v-hidden),.tp-rotv_c>.tp-cntv+*:not(.tp-v-hidden),.tp-tabv_c .tp-brkv>.tp-cntv+*:not(.tp-v-hidden),.tp-fldv_c>.tp-cntv+*:not(.tp-v-hidden){margin-top:var(--cnt-v-p)}.tp-rotv_c>.tp-sprv:not(.tp-v-hidden)+.tp-sprv,.tp-tabv_c .tp-brkv>.tp-sprv:not(.tp-v-hidden)+.tp-sprv,.tp-fldv_c>.tp-sprv:not(.tp-v-hidden)+.tp-sprv,.tp-rotv_c>.tp-cntv:not(.tp-v-hidden)+.tp-cntv,.tp-tabv_c .tp-brkv>.tp-cntv:not(.tp-v-hidden)+.tp-cntv,.tp-fldv_c>.tp-cntv:not(.tp-v-hidden)+.tp-cntv{margin-top:0}.tp-tabv_c .tp-brkv>.tp-cntv,.tp-fldv_c>.tp-cntv{margin-left:4px}.tp-tabv_c .tp-brkv>.tp-fldv>.tp-fldv_b,.tp-fldv_c>.tp-fldv>.tp-fldv_b{border-top-left-radius:var(--elm-br);border-bottom-left-radius:var(--elm-br)}.tp-tabv_c .tp-brkv>.tp-fldv.tp-fldv-expanded>.tp-fldv_b,.tp-fldv_c>.tp-fldv.tp-fldv-expanded>.tp-fldv_b{border-bottom-left-radius:0}.tp-tabv_c .tp-brkv .tp-fldv>.tp-fldv_c,.tp-fldv_c .tp-fldv>.tp-fldv_c{border-bottom-left-radius:var(--elm-br)}.tp-tabv_c .tp-brkv>.tp-tabv>.tp-tabv_i,.tp-fldv_c>.tp-tabv>.tp-tabv_i{border-top-left-radius:var(--elm-br)}.tp-tabv_c .tp-brkv .tp-tabv>.tp-tabv_c,.tp-fldv_c .tp-tabv>.tp-tabv_c{border-bottom-left-radius:var(--elm-br)}.tp-rotv_b,.tp-fldv_b{background-color:var(--cnt-bg);color:var(--cnt-fg);cursor:pointer;display:block;height:calc(var(--bld-us) + 4px);line-height:calc(var(--bld-us) + 4px);overflow:hidden;padding-left:var(--cnt-h-p);padding-right:calc(4px + var(--bld-us) + var(--cnt-h-p));position:relative;text-align:left;text-overflow:ellipsis;white-space:nowrap;width:100%;transition:border-radius .2s ease-in-out .2s}.tp-rotv_b:hover,.tp-fldv_b:hover{background-color:var(--cnt-bg-h)}.tp-rotv_b:focus,.tp-fldv_b:focus{background-color:var(--cnt-bg-f)}.tp-rotv_b:active,.tp-fldv_b:active{background-color:var(--cnt-bg-a)}.tp-rotv_b:disabled,.tp-fldv_b:disabled{opacity:.5}.tp-rotv_m,.tp-fldv_m{background:linear-gradient(to left, var(--cnt-fg), var(--cnt-fg) 2px, transparent 2px, transparent 4px, var(--cnt-fg) 4px);border-radius:2px;bottom:0;content:"";display:block;height:6px;right:calc(var(--cnt-h-p) + (var(--bld-us) + 4px - 6px)/2 - 2px);margin:auto;opacity:.5;position:absolute;top:0;transform:rotate(90deg);transition:transform .2s ease-in-out;width:6px}.tp-rotv.tp-rotv-expanded .tp-rotv_m,.tp-fldv.tp-fldv-expanded>.tp-fldv_b>.tp-fldv_m{transform:none}.tp-rotv_c,.tp-fldv_c{box-sizing:border-box;height:0;opacity:0;overflow:hidden;padding-bottom:0;padding-top:0;position:relative;transition:height .2s ease-in-out,opacity .2s linear,padding .2s ease-in-out}.tp-rotv.tp-rotv-cpl:not(.tp-rotv-expanded) .tp-rotv_c,.tp-fldv.tp-fldv-cpl:not(.tp-fldv-expanded)>.tp-fldv_c{display:none}.tp-rotv.tp-rotv-expanded .tp-rotv_c,.tp-fldv.tp-fldv-expanded>.tp-fldv_c{opacity:1;padding-bottom:var(--cnt-v-p);padding-top:var(--cnt-v-p);transform:none;overflow:visible;transition:height .2s ease-in-out,opacity .2s linear .2s,padding .2s ease-in-out}.tp-lstv,.tp-coltxtv_m{position:relative}.tp-lstv_s{padding:0 20px 0 4px;width:100%}.tp-lstv_m,.tp-coltxtv_mm{bottom:0;margin:auto;pointer-events:none;position:absolute;right:2px;top:0}.tp-lstv_m svg,.tp-coltxtv_mm svg{bottom:0;height:16px;margin:auto;position:absolute;right:0;top:0;width:16px}.tp-lstv_m svg path,.tp-coltxtv_mm svg path{fill:currentColor}.tp-pndtxtv,.tp-coltxtv_w{display:flex}.tp-pndtxtv_a,.tp-coltxtv_c{width:100%}.tp-pndtxtv_a+.tp-pndtxtv_a,.tp-coltxtv_c+.tp-pndtxtv_a,.tp-pndtxtv_a+.tp-coltxtv_c,.tp-coltxtv_c+.tp-coltxtv_c{margin-left:2px}.tp-btnv_b{width:100%}.tp-btnv_t{text-align:center}.tp-ckbv_l{display:block;position:relative}.tp-ckbv_i{left:0;opacity:0;position:absolute;top:0}.tp-ckbv_w{background-color:var(--in-bg);border-radius:var(--elm-br);cursor:pointer;display:block;height:var(--bld-us);position:relative;width:var(--bld-us)}.tp-ckbv_w svg{bottom:0;display:block;height:16px;left:0;margin:auto;opacity:0;position:absolute;right:0;top:0;width:16px}.tp-ckbv_w svg path{fill:none;stroke:var(--in-fg);stroke-width:2}.tp-ckbv_i:hover+.tp-ckbv_w{background-color:var(--in-bg-h)}.tp-ckbv_i:focus+.tp-ckbv_w{background-color:var(--in-bg-f)}.tp-ckbv_i:active+.tp-ckbv_w{background-color:var(--in-bg-a)}.tp-ckbv_i:checked+.tp-ckbv_w svg{opacity:1}.tp-ckbv.tp-v-disabled .tp-ckbv_w{opacity:.5}.tp-colv{position:relative}.tp-colv_h{display:flex}.tp-colv_s{flex-grow:0;flex-shrink:0;width:var(--bld-us)}.tp-colv_t{flex:1;margin-left:4px}.tp-colv_p{height:0;margin-top:0;opacity:0;overflow:hidden;transition:height .2s ease-in-out,opacity .2s linear,margin .2s ease-in-out}.tp-colv.tp-colv-cpl .tp-colv_p{overflow:visible}.tp-colv.tp-colv-expanded .tp-colv_p{margin-top:var(--bld-s);opacity:1}.tp-colv .tp-popv{left:calc(-1*var(--cnt-h-p));right:calc(-1*var(--cnt-h-p));top:var(--bld-us)}.tp-colpv_h,.tp-colpv_ap{margin-left:6px;margin-right:6px}.tp-colpv_h{margin-top:var(--bld-s)}.tp-colpv_rgb{display:flex;margin-top:var(--bld-s);width:100%}.tp-colpv_a{display:flex;margin-top:var(--cnt-v-p);padding-top:calc(var(--cnt-v-p) + 2px);position:relative}.tp-colpv_a:before{background-color:var(--grv-fg);content:"";height:2px;left:calc(-1*var(--cnt-h-p));position:absolute;right:calc(-1*var(--cnt-h-p));top:0}.tp-colpv_ap{align-items:center;display:flex;flex:3}.tp-colpv_at{flex:1;margin-left:4px}.tp-svpv{border-radius:var(--elm-br);outline:none;overflow:hidden;position:relative}.tp-svpv_c{cursor:crosshair;display:block;height:calc(var(--bld-us)*4);width:100%}.tp-svpv_m{border-radius:100%;border:rgba(255,255,255,.75) solid 2px;box-sizing:border-box;filter:drop-shadow(0 0 1px rgba(0, 0, 0, 0.3));height:12px;margin-left:-6px;margin-top:-6px;pointer-events:none;position:absolute;width:12px}.tp-svpv:focus .tp-svpv_m{border-color:#fff}.tp-hplv{cursor:pointer;height:var(--bld-us);outline:none;position:relative}.tp-hplv_c{background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEAAAAABCAYAAABubagXAAAAQ0lEQVQoU2P8z8Dwn0GCgQEDi2OK/RBgYHjBgIpfovFh8j8YBIgzFGQxuqEgPhaDOT5gOhPkdCxOZeBg+IDFZZiGAgCaSSMYtcRHLgAAAABJRU5ErkJggg==);background-position:left top;background-repeat:no-repeat;background-size:100% 100%;border-radius:2px;display:block;height:4px;left:0;margin-top:-2px;position:absolute;top:50%;width:100%}.tp-hplv_m{border-radius:var(--elm-br);border:rgba(255,255,255,.75) solid 2px;box-shadow:0 0 2px rgba(0,0,0,.1);box-sizing:border-box;height:12px;left:50%;margin-left:-6px;margin-top:-6px;pointer-events:none;position:absolute;top:50%;width:12px}.tp-hplv:focus .tp-hplv_m{border-color:#fff}.tp-aplv{cursor:pointer;height:var(--bld-us);outline:none;position:relative;width:100%}.tp-aplv_b{background-color:#fff;background-image:linear-gradient(to top right, #ddd 25%, transparent 25%, transparent 75%, #ddd 75%),linear-gradient(to top right, #ddd 25%, transparent 25%, transparent 75%, #ddd 75%);background-size:4px 4px;background-position:0 0,2px 2px;border-radius:2px;display:block;height:4px;left:0;margin-top:-2px;overflow:hidden;position:absolute;top:50%;width:100%}.tp-aplv_c{bottom:0;left:0;position:absolute;right:0;top:0}.tp-aplv_m{background-color:#fff;background-image:linear-gradient(to top right, #ddd 25%, transparent 25%, transparent 75%, #ddd 75%),linear-gradient(to top right, #ddd 25%, transparent 25%, transparent 75%, #ddd 75%);background-size:12px 12px;background-position:0 0,6px 6px;border-radius:var(--elm-br);box-shadow:0 0 2px rgba(0,0,0,.1);height:12px;left:50%;margin-left:-6px;margin-top:-6px;overflow:hidden;pointer-events:none;position:absolute;top:50%;width:12px}.tp-aplv_p{border-radius:var(--elm-br);border:rgba(255,255,255,.75) solid 2px;box-sizing:border-box;bottom:0;left:0;position:absolute;right:0;top:0}.tp-aplv:focus .tp-aplv_p{border-color:#fff}.tp-colswv{background-color:#fff;background-image:linear-gradient(to top right, #ddd 25%, transparent 25%, transparent 75%, #ddd 75%),linear-gradient(to top right, #ddd 25%, transparent 25%, transparent 75%, #ddd 75%);background-size:10px 10px;background-position:0 0,5px 5px;border-radius:var(--elm-br);overflow:hidden}.tp-colswv.tp-v-disabled{opacity:.5}.tp-colswv_sw{border-radius:0}.tp-colswv_b{-webkit-appearance:none;-moz-appearance:none;appearance:none;background-color:rgba(0,0,0,0);border-width:0;cursor:pointer;display:block;height:var(--bld-us);left:0;margin:0;outline:none;padding:0;position:absolute;top:0;width:var(--bld-us)}.tp-colswv_b:focus::after{border:rgba(255,255,255,.75) solid 2px;border-radius:var(--elm-br);bottom:0;content:"";display:block;left:0;position:absolute;right:0;top:0}.tp-coltxtv{display:flex;width:100%}.tp-coltxtv_m{margin-right:4px}.tp-coltxtv_ms{border-radius:var(--elm-br);color:var(--lbl-fg);cursor:pointer;height:var(--bld-us);line-height:var(--bld-us);padding:0 18px 0 4px}.tp-coltxtv_ms:hover{background-color:var(--in-bg-h)}.tp-coltxtv_ms:focus{background-color:var(--in-bg-f)}.tp-coltxtv_ms:active{background-color:var(--in-bg-a)}.tp-coltxtv_mm{color:var(--lbl-fg)}.tp-coltxtv_w{flex:1}.tp-dfwv{position:absolute;top:8px;right:8px;width:256px}.tp-fldv.tp-fldv-not .tp-fldv_b{display:none}.tp-fldv_t{padding-left:4px}.tp-fldv_c{border-left:var(--cnt-bg) solid 4px}.tp-fldv_b:hover+.tp-fldv_c{border-left-color:var(--cnt-bg-h)}.tp-fldv_b:focus+.tp-fldv_c{border-left-color:var(--cnt-bg-f)}.tp-fldv_b:active+.tp-fldv_c{border-left-color:var(--cnt-bg-a)}.tp-grlv{position:relative}.tp-grlv_g{display:block;height:calc(var(--bld-us)*3)}.tp-grlv_g polyline{fill:none;stroke:var(--mo-fg);stroke-linejoin:round}.tp-grlv_t{margin-top:-4px;transition:left .05s,top .05s;visibility:hidden}.tp-grlv_t.tp-grlv_t-a{visibility:visible}.tp-grlv_t.tp-grlv_t-in{transition:none}.tp-grlv.tp-v-disabled .tp-grlv_g{opacity:.5}.tp-grlv .tp-ttv{background-color:var(--mo-fg)}.tp-grlv .tp-ttv::before{border-top-color:var(--mo-fg)}.tp-lblv{align-items:center;display:flex;line-height:1.3;padding-left:var(--cnt-h-p);padding-right:var(--cnt-h-p)}.tp-lblv.tp-lblv-nol{display:block}.tp-lblv_l{color:var(--lbl-fg);flex:1;-webkit-hyphens:auto;hyphens:auto;overflow:hidden;padding-left:4px;padding-right:16px}.tp-lblv.tp-v-disabled .tp-lblv_l{opacity:.5}.tp-lblv.tp-lblv-nol .tp-lblv_l{display:none}.tp-lblv_v{align-self:flex-start;flex-grow:0;flex-shrink:0;width:160px}.tp-lblv.tp-lblv-nol .tp-lblv_v{width:100%}.tp-lstv_s{padding:0 20px 0 4px;width:100%}.tp-lstv_m{color:var(--btn-fg)}.tp-sglv_i{padding:0 4px}.tp-sglv.tp-v-disabled .tp-sglv_i{opacity:.5}.tp-mllv_i{display:block;height:calc(var(--bld-us)*3);line-height:var(--bld-us);padding:0 4px;resize:none;white-space:pre}.tp-mllv.tp-v-disabled .tp-mllv_i{opacity:.5}.tp-p2dv{position:relative}.tp-p2dv_h{display:flex}.tp-p2dv_b{height:var(--bld-us);margin-right:4px;position:relative;width:var(--bld-us)}.tp-p2dv_b svg{display:block;height:16px;left:50%;margin-left:-8px;margin-top:-8px;position:absolute;top:50%;width:16px}.tp-p2dv_b svg path{stroke:currentColor;stroke-width:2}.tp-p2dv_b svg circle{fill:currentColor}.tp-p2dv_t{flex:1}.tp-p2dv_p{height:0;margin-top:0;opacity:0;overflow:hidden;transition:height .2s ease-in-out,opacity .2s linear,margin .2s ease-in-out}.tp-p2dv.tp-p2dv-expanded .tp-p2dv_p{margin-top:var(--bld-s);opacity:1}.tp-p2dv .tp-popv{left:calc(-1*var(--cnt-h-p));right:calc(-1*var(--cnt-h-p));top:var(--bld-us)}.tp-p2dpv{padding-left:calc(var(--bld-us) + 4px)}.tp-p2dpv_p{cursor:crosshair;height:0;overflow:hidden;padding-bottom:100%;position:relative}.tp-p2dpv_g{display:block;height:100%;left:0;pointer-events:none;position:absolute;top:0;width:100%}.tp-p2dpv_ax{opacity:.1;stroke:var(--in-fg);stroke-dasharray:1}.tp-p2dpv_l{opacity:.5;stroke:var(--in-fg);stroke-dasharray:1}.tp-p2dpv_m{border:var(--in-fg) solid 1px;border-radius:50%;box-sizing:border-box;height:4px;margin-left:-2px;margin-top:-2px;position:absolute;width:4px}.tp-p2dpv_p:focus .tp-p2dpv_m{background-color:var(--in-fg);border-width:0}.tp-popv{background-color:var(--bs-bg);border-radius:6px;box-shadow:0 2px 4px var(--bs-sh);display:none;max-width:168px;padding:var(--cnt-v-p) var(--cnt-h-p);position:absolute;visibility:hidden;z-index:1000}.tp-popv.tp-popv-v{display:block;visibility:visible}.tp-sprv_r{background-color:var(--grv-fg);border-width:0;display:block;height:2px;margin:0;width:100%}.tp-sldv.tp-v-disabled{opacity:.5}.tp-sldv_t{box-sizing:border-box;cursor:pointer;height:var(--bld-us);margin:0 6px;outline:none;position:relative}.tp-sldv_t::before{background-color:var(--in-bg);border-radius:1px;bottom:0;content:"";display:block;height:2px;left:0;margin:auto;position:absolute;right:0;top:0}.tp-sldv_k{height:100%;left:0;position:absolute;top:0}.tp-sldv_k::before{background-color:var(--in-fg);border-radius:1px;bottom:0;content:"";display:block;height:2px;left:0;margin-bottom:auto;margin-top:auto;position:absolute;right:0;top:0}.tp-sldv_k::after{background-color:var(--btn-bg);border-radius:var(--elm-br);bottom:0;content:"";display:block;height:12px;margin-bottom:auto;margin-top:auto;position:absolute;right:-6px;top:0;width:12px}.tp-sldv_t:hover .tp-sldv_k::after{background-color:var(--btn-bg-h)}.tp-sldv_t:focus .tp-sldv_k::after{background-color:var(--btn-bg-f)}.tp-sldv_t:active .tp-sldv_k::after{background-color:var(--btn-bg-a)}.tp-sldtxtv{display:flex}.tp-sldtxtv_s{flex:2}.tp-sldtxtv_t{flex:1;margin-left:4px}.tp-tabv.tp-v-disabled{opacity:.5}.tp-tabv_i{align-items:flex-end;display:flex;overflow:hidden}.tp-tabv.tp-tabv-nop .tp-tabv_i{height:calc(var(--bld-us) + 4px);position:relative}.tp-tabv.tp-tabv-nop .tp-tabv_i::before{background-color:var(--cnt-bg);bottom:0;content:"";height:2px;left:0;position:absolute;right:0}.tp-tabv_c{border-left:var(--cnt-bg) solid 4px;padding-bottom:var(--cnt-v-p);padding-top:var(--cnt-v-p)}.tp-tbiv{flex:1;min-width:0;position:relative}.tp-tbiv+.tp-tbiv{margin-left:2px}.tp-tbiv+.tp-tbiv::before{background-color:var(--cnt-bg);bottom:0;content:"";height:2px;left:-2px;position:absolute;width:2px}.tp-tbiv_b{background-color:var(--cnt-bg);display:block;padding-left:calc(var(--cnt-h-p) + 4px);padding-right:calc(var(--cnt-h-p) + 4px);width:100%}.tp-tbiv_b:hover{background-color:var(--cnt-bg-h)}.tp-tbiv_b:focus{background-color:var(--cnt-bg-f)}.tp-tbiv_b:active{background-color:var(--cnt-bg-a)}.tp-tbiv_b:disabled{opacity:.5}.tp-tbiv_t{color:var(--cnt-fg);height:calc(var(--bld-us) + 4px);line-height:calc(var(--bld-us) + 4px);opacity:.5;overflow:hidden;text-overflow:ellipsis}.tp-tbiv.tp-tbiv-sel .tp-tbiv_t{opacity:1}.tp-txtv{position:relative}.tp-txtv_i{padding:0 4px}.tp-txtv.tp-txtv-fst .tp-txtv_i{border-bottom-right-radius:0;border-top-right-radius:0}.tp-txtv.tp-txtv-mid .tp-txtv_i{border-radius:0}.tp-txtv.tp-txtv-lst .tp-txtv_i{border-bottom-left-radius:0;border-top-left-radius:0}.tp-txtv.tp-txtv-num .tp-txtv_i{text-align:right}.tp-txtv.tp-txtv-drg .tp-txtv_i{opacity:.3}.tp-txtv_k{cursor:pointer;height:100%;left:-3px;position:absolute;top:0;width:12px}.tp-txtv_k::before{background-color:var(--in-fg);border-radius:1px;bottom:0;content:"";height:calc(var(--bld-us) - 4px);left:50%;margin-bottom:auto;margin-left:-1px;margin-top:auto;opacity:.1;position:absolute;top:0;transition:border-radius .1s,height .1s,transform .1s,width .1s;width:2px}.tp-txtv_k:hover::before,.tp-txtv.tp-txtv-drg .tp-txtv_k::before{opacity:1}.tp-txtv.tp-txtv-drg .tp-txtv_k::before{border-radius:50%;height:4px;transform:translateX(-1px);width:4px}.tp-txtv_g{bottom:0;display:block;height:8px;left:50%;margin:auto;overflow:visible;pointer-events:none;position:absolute;top:0;visibility:hidden;width:100%}.tp-txtv.tp-txtv-drg .tp-txtv_g{visibility:visible}.tp-txtv_gb{fill:none;stroke:var(--in-fg);stroke-dasharray:1}.tp-txtv_gh{fill:none;stroke:var(--in-fg)}.tp-txtv .tp-ttv{margin-left:6px;visibility:hidden}.tp-txtv.tp-txtv-drg .tp-ttv{visibility:visible}.tp-ttv{background-color:var(--in-fg);border-radius:var(--elm-br);color:var(--bs-bg);padding:2px 4px;pointer-events:none;position:absolute;transform:translate(-50%, -100%)}.tp-ttv::before{border-color:var(--in-fg) rgba(0,0,0,0) rgba(0,0,0,0) rgba(0,0,0,0);border-style:solid;border-width:2px;box-sizing:border-box;content:"";font-size:.9em;height:4px;left:50%;margin-left:-2px;position:absolute;top:100%;width:4px}.tp-rotv{background-color:var(--bs-bg);border-radius:var(--bs-br);box-shadow:0 2px 4px var(--bs-sh);font-family:var(--font-family);font-size:11px;font-weight:500;line-height:1;text-align:left}.tp-rotv_b{border-bottom-left-radius:var(--bs-br);border-bottom-right-radius:var(--bs-br);border-top-left-radius:var(--bs-br);border-top-right-radius:var(--bs-br);padding-left:calc(4px + var(--bld-us) + var(--cnt-h-p));text-align:center}.tp-rotv.tp-rotv-expanded .tp-rotv_b{border-bottom-left-radius:0;border-bottom-right-radius:0}.tp-rotv.tp-rotv-not .tp-rotv_b{display:none}.tp-rotv_c>.tp-fldv.tp-v-lst>.tp-fldv_c,.tp-rotv_c>.tp-tabv.tp-v-lst>.tp-tabv_c{border-bottom-left-radius:var(--bs-br);border-bottom-right-radius:var(--bs-br)}.tp-rotv_c>.tp-fldv.tp-v-lst:not(.tp-fldv-expanded)>.tp-fldv_b{border-bottom-left-radius:var(--bs-br);border-bottom-right-radius:var(--bs-br)}.tp-rotv_c .tp-fldv.tp-v-vlst:not(.tp-fldv-expanded)>.tp-fldv_b{border-bottom-right-radius:var(--bs-br)}.tp-rotv.tp-rotv-not .tp-rotv_c>.tp-fldv.tp-v-fst{margin-top:calc(-1*var(--cnt-v-p))}.tp-rotv.tp-rotv-not .tp-rotv_c>.tp-fldv.tp-v-fst>.tp-fldv_b{border-top-left-radius:var(--bs-br);border-top-right-radius:var(--bs-br)}.tp-rotv.tp-rotv-not .tp-rotv_c>.tp-tabv.tp-v-fst{margin-top:calc(-1*var(--cnt-v-p))}.tp-rotv.tp-rotv-not .tp-rotv_c>.tp-tabv.tp-v-fst>.tp-tabv_i{border-top-left-radius:var(--bs-br);border-top-right-radius:var(--bs-br)}.tp-rotv.tp-v-disabled,.tp-rotv .tp-v-disabled{pointer-events:none}.tp-rotv.tp-v-hidden,.tp-rotv .tp-v-hidden{display:none}'),this.pool_.getAll().forEach((e=>{this.embedPluginStyle_(e)})),this.registerPlugin({plugins:[ks,Es,ct,Ts]})}}const Fs=new t("3.1.1");e.BladeApi=n,e.ButtonApi=f,e.FolderApi=Te,e.InputBindingApi=xe,e.ListApi=ws,e.MonitorBindingApi=Ee,e.Pane=Is,e.SeparatorApi=We,e.SliderApi=xs,e.TabApi=rt,e.TabPageApi=nt,e.TextApi=ys,e.TpChangeEvent=i,e.VERSION=Fs,Object.defineProperty(e,"__esModule",{value:!0})}(il.exports),function(e,t,n){function r(e,t){return typeof e===t}function i(){return"function"!=typeof t.createElement?t.createElement(arguments[0]):a?t.createElementNS.call(t,"http://www.w3.org/2000/svg",arguments[0]):t.createElement.apply(t,arguments)}var o=[],s=t.documentElement,a="svg"===s.nodeName.toLowerCase(),l=[],c={_version:"3.6.0",_config:{classPrefix:"",enableClasses:!0,enableJSClass:!0,usePrefixes:!0},_q:[],on:function(e,t){var n=this;setTimeout((function(){t(n[e])}),0)},addTest:function(e,t,n){l.push({name:e,fn:t,options:n})},addAsyncTest:function(e){l.push({name:null,fn:e})}},u=function(){};u.prototype=c,u=new u;var p=c._config.usePrefixes?" -webkit- -moz- -o- -ms- ".split(" "):["",""];c._prefixes=p;var d=c.testStyles=function(e,n,r,o){var l,c,u,p,d="modernizr",h=i("div"),f=function(){var e=t.body;return e||((e=i(a?"svg":"body")).fake=!0),e}();if(parseInt(r,10))for(;r--;)(u=i("div")).id=o?o[r]:d+(r+1),h.appendChild(u);return(l=i("style")).type="text/css",l.id="s"+d,(f.fake?f:h).appendChild(l),f.appendChild(h),l.styleSheet?l.styleSheet.cssText=e:l.appendChild(t.createTextNode(e)),h.id=d,f.fake&&(f.style.background="",f.style.overflow="hidden",p=s.style.overflow,s.style.overflow="hidden",s.appendChild(f)),c=n(h,e),f.fake?(f.parentNode.removeChild(f),s.style.overflow=p,s.offsetHeight):h.parentNode.removeChild(h),!!c};u.addTest("touchevents",(function(){var n;if("ontouchstart"in e||e.DocumentTouch&&t instanceof DocumentTouch)n=!0;else{var r=["@media (",p.join("touch-enabled),("),"heartz",")","{#modernizr{top:9px;position:absolute}}"].join("");d(r,(function(e){n=9===e.offsetTop}))}return n})),function(){var e,t,n,i,s,a;for(var c in l)if(l.hasOwnProperty(c)){if(e=[],(t=l[c]).name&&(e.push(t.name.toLowerCase()),t.options&&t.options.aliases&&t.options.aliases.length))for(n=0;n<t.options.aliases.length;n++)e.push(t.options.aliases[n].toLowerCase());for(i=r(t.fn,"function")?t.fn():t.fn,s=0;s<e.length;s++)1===(a=e[s].split(".")).length?u[a[0]]=i:(!u[a[0]]||u[a[0]]instanceof Boolean||(u[a[0]]=new Boolean(u[a[0]])),u[a[0]][a[1]]=i),o.push((i?"":"no-")+a.join("-"))}}(),function(e){var t=s.className,n=u._config.classPrefix||"";if(a&&(t=t.baseVal),u._config.enableJSClass){var r=new RegExp("(^|\\s)"+n+"no-js(\\s|$)");t=t.replace(r,"$1"+n+"js$2")}u._config.enableClasses&&(t+=" "+n+e.join(" "+n),a?s.className.baseVal=t:s.className=t)}(o),delete c.addTest,delete c.addAsyncTest;for(var h=0;h<u._q.length;h++)u._q[h]();e.Modernizr=u}(window,document);const ol=window.location.search,sl=!1;let al,ll;new URLSearchParams(ol).get("debug")&&(ll=new il.exports.Pane({title:"Settings",expanded:sl}));const cl=()=>{document.body.style.width=`${document.documentElement.clientWidth}px`,document.body.style.height=`${document.documentElement.clientHeight}px`,al&&al.resize()};var ul,pl,dl;Pt(window,"resize").pipe((ul=100,void 0===pl&&(pl=Xe),ze((function(e,t){var n=null,r=null,i=null,o=function(){if(n){n.unsubscribe(),n=null;var e=r;r=null,t.next(e)}};function s(){var e=i+ul,r=pl.now();if(r<e)return n=this.schedule(void 0,e-r),void t.add(n);o()}e.subscribe(Ue(t,(function(e){r=e,i=pl.now(),n||(n=pl.schedule(s,ul),t.add(n))}),(function(){o(),t.complete()}),void 0,(function(){r=n=null})))})))).subscribe((()=>cl())),Pt(window,"load").pipe((dl=1,dl<=0?function(){return Ye}:ze((function(e,t){var n=0;e.subscribe(Ue(t,(function(e){++n<=dl&&(t.next(e),dl<=n&&t.complete())})))})))).subscribe((()=>cl()));const hl=document.querySelector("canvas");document.querySelector("#start-button"),document.querySelector("#intro"),al=new class{constructor(e,t=null,n=!1,r=null){re(this,C),re(this,S),re(this,T),re(this,R),re(this,F),re(this,V),re(this,N),re(this,D),re(this,U),re(this,G),re(this,H),re(this,q),re(this,Y),re(this,Q),ee(this,"TARGET_FRAME_DURATION",16),re(this,x,0),re(this,y,0),re(this,E,0),re(this,P,0),ee(this,"camera",{matrix:St(),near:2,far:6,fov:Math.PI/3,aspect:1,position:Mt(0,0,4),up:Mt(0,1,0),matrices:{view:St(),projection:St(),inversProjection:St(),inversViewProjection:St()}}),ee(this,"animationProps",{}),ee(this,"settings",{moveSpeed:240.82207943566837,turnSpeed:60.712084174761486,trailWeight:100.41252941466865,sensorOffsetDist:11,sensorAngleSpacing:.8108652381980153,evaporateSpeed:1.5932796335343884,diffuseSpeed:37.7184512302995}),ee(this,"renderSettings",{displacementStrength:.02,hueShift:0}),ee(this,"AGENT_COUNT",3e4),ee(this,"texSize",[800,800]),ee(this,"pointer",[0,0]),ee(this,"pointerDir",[0,0,-1]),ee(this,"pointerStrength",0),ee(this,"displacementStrength",new rl(1.8,.3,2,0)),ee(this,"pointerDirSOQ",new rs(2,.5,1,Kt())),this.canvas=e,this.onInit=t,this.isDev=n,this.pane=r,oe(this,C,A).call(this).then((()=>{this.onInit&&this.onInit(this)}))}run(e=0){ie(this,y,Math.min(16,e-ne(this,x))),ie(this,x,e),ie(this,P,ne(this,y)/this.TARGET_FRAME_DURATION),ie(this,E,ne(this,E)+ne(this,P)),oe(this,D,z).call(this,ne(this,y)),oe(this,G,W).call(this),requestAnimationFrame((e=>this.run(e)))}resize(){const e=this.gl;this.viewportSize=function(e,t,n){return e[0]=t,e[1]=n,e}(this.viewportSize,this.canvas.clientWidth,this.canvas.clientHeight);(function(e,t){t=t||1,t=Math.max(0,t);const n=e.clientWidth*t|0,r=e.clientHeight*t|0;return(e.width!==n||e.height!==r)&&(e.width=n,e.height=r,!0)})(this.canvas)&&(e.viewport(0,0,e.drawingBufferWidth,e.drawingBufferHeight),this.fbi1&&this.fbi2&&($o(e,this.fbi1,this.agentAttachments,this.texSize[0],this.texSize[1]),$o(e,this.fbi2,this.agentAttachments,this.texSize[0],this.texSize[1]))),oe(this,q,X).call(this,e)}}(hl,(e=>e.run()),sl,ll);
